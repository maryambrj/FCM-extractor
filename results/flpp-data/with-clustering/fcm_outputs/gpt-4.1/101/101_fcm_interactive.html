
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Social Determinants": {"concepts": "food skills, nutritious foods, food metrics, food systems, food availability, nutrition, food insecurity, food system modeling, food system strain, nutritional content, food portions, cooking, food quality, food conditioning, food access, food products, food deserts, raw vegetables, food sourcing, food preferences, supplemental nutrition programs, food quantity, food equity, food security, food options, additives, food environment, food stamps, agriculture, food organization, double up food bucks, food affordability, food system research, food system challenges, food choice, food assistance, food system solutions, food system analysis, price of food, food distribution, food system improvement, farmers market, preservatives, refrigeration units, flint food system, food delivery, food system, food price, meal prep time, food system values, nutrition programs, food accessibility, dietary habits", "concept_list": ["food skills", "nutritious foods", "food metrics", "food systems", "food availability", "nutrition", "food insecurity", "food system modeling", "food system strain", "nutritional content", "food portions", "cooking", "food quality", "food conditioning", "food access", "food products", "food deserts", "raw vegetables", "food sourcing", "food preferences", "supplemental nutrition programs", "food quantity", "food equity", "food security", "food options", "additives", "food environment", "food stamps", "agriculture", "food organization", "double up food bucks", "food affordability", "food system research", "food system challenges", "food choice", "food assistance", "food system solutions", "food system analysis", "price of food", "food distribution", "food system improvement", "farmers market", "preservatives", "refrigeration units", "flint food system", "food delivery", "food system", "food price", "meal prep time", "food system values", "nutrition programs", "food accessibility", "dietary habits"], "type": "cluster", "node_size": 174, "label": "Social Determinants"}, "Organizational Change": {"concepts": "benefit increase, convenience, participant confidentiality, weak negative, stigma, evaluation anonymity, social determinants, survey process, definitions, economic barriers, availability, cultural values, snap benefits, resident income, pricing structure, consumer behavior, hunger, health outcomes, decision-making, trust issues, trust, safety, covid, product variety, public health, consumer choice, resource allocation, quality environment, correlation, research project, career development, leadership, welcoming environment, pilot round, economic development, pandemic, support, research branches, resident choices, takeout, curbside service, quality of life, dignity, confidentiality, survival strategies, communication, impact assessment, funding, pilot interview, values, modeling analysis, product expansion, residents, transportation, positive relationship, anonymity, consumer experience, health, collaboration, fraud, workshops, creativity, partnerships, comfort, produce access, public perception, flint, disposable income, emergency sector, common good, benefit programs, affordability, educational opportunities, metric, systemic barriers, covid-19, weak positive, pandemic impact, negative connection, debit cards, cascading benefits, crowdsource ideas, role modeling, credit cards, social equity, choices, participant feedback, poverty, supplemental sector, problem solving, evaluation, leverage points, systemic racism, accessibility", "concept_list": ["benefit increase", "convenience", "participant confidentiality", "weak negative", "stigma", "evaluation anonymity", "social determinants", "survey process", "definitions", "economic barriers", "availability", "cultural values", "snap benefits", "resident income", "pricing structure", "consumer behavior", "hunger", "health outcomes", "decision-making", "trust issues", "trust", "safety", "covid", "product variety", "public health", "consumer choice", "resource allocation", "quality environment", "correlation", "research project", "career development", "leadership", "welcoming environment", "pilot round", "economic development", "pandemic", "support", "research branches", "resident choices", "takeout", "curbside service", "quality of life", "dignity", "confidentiality", "survival strategies", "communication", "impact assessment", "funding", "pilot interview", "values", "modeling analysis", "product expansion", "residents", "transportation", "positive relationship", "anonymity", "consumer experience", "health", "collaboration", "fraud", "workshops", "creativity", "partnerships", "comfort", "produce access", "public perception", "flint", "disposable income", "emergency sector", "common good", "benefit programs", "affordability", "educational opportunities", "metric", "systemic barriers", "covid-19", "weak positive", "pandemic impact", "negative connection", "debit cards", "cascading benefits", "crowdsource ideas", "role modeling", "credit cards", "social equity", "choices", "participant feedback", "poverty", "supplemental sector", "problem solving", "evaluation", "leverage points", "systemic racism", "accessibility"], "type": "cluster", "node_size": 297, "label": "Organizational Change"}, "Retail Options": {"concepts": "organizational change, organizational levers, organizational processes, organizational impact, organizational process, system change", "concept_list": ["organizational change", "organizational levers", "organizational processes", "organizational impact", "organizational process", "system change"], "type": "cluster", "node_size": 33, "label": "Retail Options"}, "Community Engagement": {"concepts": "chain stores, local stores, chain restaurants, retail options, local restaurants, convenience stores, grocery stores, retail sector, neighborhood stores, out-county stores", "concept_list": ["chain stores", "local stores", "chain restaurants", "retail options", "local restaurants", "convenience stores", "grocery stores", "retail sector", "neighborhood stores", "out-county stores"], "type": "cluster", "node_size": 45, "label": "Community Engagement"}, "Food Systems": {"concepts": "community inclusion, community input, community empowerment, stakeholder inclusion, gardening, stakeholder engagement, stakeholder participation, community participation, community members, indoor dining", "concept_list": ["community inclusion", "community input", "community empowerment", "stakeholder inclusion", "gardening", "stakeholder engagement", "stakeholder participation", "community participation", "community members", "indoor dining"], "type": "cluster", "node_size": 45, "label": "Food Systems"}};
        const conceptData = {};
        const interClusterEdges = [["Social Determinants", "Food Systems", {"weight": 1.0, "confidence": 0.7750000000000001, "type": "inter_cluster", "style": "solid"}], ["Social Determinants", "Organizational Change", {"weight": 0.6, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Social Determinants", "Community Engagement", {"weight": 0.75, "confidence": 0.525, "type": "inter_cluster", "style": "solid"}], ["Social Determinants", "Retail Options", {"weight": 0.6, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Organizational Change", "Social Determinants", {"weight": 0.8, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Organizational Change", "Community Engagement", {"weight": 0.6, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["Organizational Change", "Food Systems", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Organizational Change", "Retail Options", {"weight": 0.5, "confidence": 0.3125, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Food Systems", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Organizational Change", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Community Engagement", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Social Determinants", {"weight": 0.4, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Social Determinants", {"weight": 0.8, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Organizational Change", {"weight": 0.8, "confidence": 0.6100000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Retail Options", {"weight": 0.8, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food Systems", {"weight": 0.5, "confidence": 0.3125, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Social Determinants", {"weight": 0.8, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Organizational Change", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Retail Options", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Community Engagement", {"weight": 0.5, "confidence": 0.3125, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Social Determinants": [], "Organizational Change": [], "Retail Options": [], "Community Engagement": [], "Food Systems": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
