
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Equity": {"concepts": "food system innovation, food system change, food system development", "concept_list": ["food system innovation", "food system change", "food system development"], "type": "cluster", "node_size": 24, "label": "Food Equity"}, "Food Choices": {"concepts": "food equity, food system equity", "concept_list": ["food equity", "food system equity"], "type": "cluster", "node_size": 21, "label": "Food Choices"}, "Community Engagement": {"concepts": "food system choice, food choice", "concept_list": ["food system choice", "food choice"], "type": "cluster", "node_size": 21, "label": "Community Engagement"}, "System Resilience": {"concepts": "social organization, neighborhood engagement hub, organizational involvement", "concept_list": ["social organization", "neighborhood engagement hub", "organizational involvement"], "type": "cluster", "node_size": 24, "label": "System Resilience"}, "Food System Innovation": {"concepts": "food system resilience, food system vulnerability", "concept_list": ["food system resilience", "food system vulnerability"], "type": "cluster", "node_size": 21, "label": "Food System Innovation"}, "Food System Networks": {"concepts": "food system larder, resilience, food system entrepreneurship, food availability, food preferences, food system affordability, herbs, food affordability, food system impacts, ethnic groups, organizational support, technical knowledge, food system improvement, food system storage, food system networks, local food, food system stakeholders, food system readiness, lentils, organization, food system advocacy, food networks, food retail, food system practices, food system diversity, food system impact, food exchange, farm to table, extension services, food system motivation, food sustainability, food storage, spices, food system challenges, food selection, food system map, food system transition, larder, food production, organizational programs, community gardeners, food system flexibility, food system retail, food system business, community garden, barriers, food system production, food system distribution, educational resources, cornbread, food system traditions, food resourcefulness, food system network, food resilience, food system justice, social media, practical knowledge, cultural differences, food support, gardening, food resources, information sharing, food awareness, food system gardening, food systems research, food system availability, food system produce, food system culture, local gardeners, food system economics, self-sufficiency, social connections, food system transformation, food system values, food connections, food improvement, food system governance, food traditions, food system awareness, farmers markets, cultural dishes, food values, food mapping, food system capacity, food system engagement, food system variety, food system routines, food system fulfillment, food system sustainability, food system research, food system exchange, food system continuity, educational opportunities, food system connections, small business, nutritional knowledge", "concept_list": ["food system larder", "resilience", "food system entrepreneurship", "food availability", "food preferences", "food system affordability", "herbs", "food affordability", "food system impacts", "ethnic groups", "organizational support", "technical knowledge", "food system improvement", "food system storage", "food system networks", "local food", "food system stakeholders", "food system readiness", "lentils", "organization", "food system advocacy", "food networks", "food retail", "food system practices", "food system diversity", "food system impact", "food exchange", "farm to table", "extension services", "food system motivation", "food sustainability", "food storage", "spices", "food system challenges", "food selection", "food system map", "food system transition", "larder", "food production", "organizational programs", "community gardeners", "food system flexibility", "food system retail", "food system business", "community garden", "barriers", "food system production", "food system distribution", "educational resources", "cornbread", "food system traditions", "food resourcefulness", "food system network", "food resilience", "food system justice", "social media", "practical knowledge", "cultural differences", "food support", "gardening", "food resources", "information sharing", "food awareness", "food system gardening", "food systems research", "food system availability", "food system produce", "food system culture", "local gardeners", "food system economics", "self-sufficiency", "social connections", "food system transformation", "food system values", "food connections", "food improvement", "food system governance", "food traditions", "food system awareness", "farmers markets", "cultural dishes", "food values", "food mapping", "food system capacity", "food system engagement", "food system variety", "food system routines", "food system fulfillment", "food system sustainability", "food system research", "food system exchange", "food system continuity", "educational opportunities", "food system connections", "small business", "nutritional knowledge"], "type": "cluster", "node_size": 303, "label": "Food System Networks"}, "Food Preparation Logistics": {"concepts": "food system preparation purchasing, food system preparation retail, food system preparedness, food preparation, food purchasing, food system preparation, food system preparation canning, food system canning, food system preparation consumption, food system management, food system preparation larder, food system preparation information, food preservation, food system preparation warehousing, food system preparation business, food system preparation exchange, food system preparation selection, food system preparation produce, food system purchasing, food system logistics, food system warehousing", "concept_list": ["food system preparation purchasing", "food system preparation retail", "food system preparedness", "food preparation", "food purchasing", "food system preparation", "food system preparation canning", "food system canning", "food system preparation consumption", "food system management", "food system preparation larder", "food system preparation information", "food preservation", "food system preparation warehousing", "food system preparation business", "food system preparation exchange", "food system preparation selection", "food system preparation produce", "food system purchasing", "food system logistics", "food system warehousing"], "type": "cluster", "node_size": 78, "label": "Food Preparation Logistics"}, "Seasonal Growing": {"concepts": "root cellar, harvest, growing season, seeds, seedlings, lake huron, harvest time, seedling, native plants, edible plants", "concept_list": ["root cellar", "harvest", "growing season", "seeds", "seedlings", "lake huron", "harvest time", "seedling", "native plants", "edible plants"], "type": "cluster", "node_size": 45, "label": "Seasonal Growing"}, "Community Adaptation": {"concepts": "diversity, power outage, feedback loop, fat back, basket, traditional methods, home economics, adaptation, fungus, blight, voting, state of michigan, black eyed peas, programs, produce selection, access to information, store, availability, basic needs, pricing, color coding, covid-19 pandemic, neighbors, importing, united states, canning, michigan, covid-19, relationships, warehousing, preservation, arab american association, simplicity, variety, msu extension, latinx center, technical assistance, pandemic impact, research, inclusion, state programs, flint, picnic table, tool shed, delicacy, internet, onion, produce, leverage points", "concept_list": ["diversity", "power outage", "feedback loop", "fat back", "basket", "traditional methods", "home economics", "adaptation", "fungus", "blight", "voting", "state of michigan", "black eyed peas", "programs", "produce selection", "access to information", "store", "availability", "basic needs", "pricing", "color coding", "covid-19 pandemic", "neighbors", "importing", "united states", "canning", "michigan", "covid-19", "relationships", "warehousing", "preservation", "arab american association", "simplicity", "variety", "msu extension", "latinx center", "technical assistance", "pandemic impact", "research", "inclusion", "state programs", "flint", "picnic table", "tool shed", "delicacy", "internet", "onion", "produce", "leverage points"], "type": "cluster", "node_size": 162, "label": "Community Adaptation"}, "Food Retail Types": {"concepts": "grocery stores, local restaurants, chain restaurants, convenience stores, retail use, retail types", "concept_list": ["grocery stores", "local restaurants", "chain restaurants", "convenience stores", "retail use", "retail types"], "type": "cluster", "node_size": 33, "label": "Food Retail Types"}, "Food System Behaviors": {"concepts": "food system response, food system adaptation, food system behaviors, food system memory, food system attention, food system regulation, food system behavior, food system happiness", "concept_list": ["food system response", "food system adaptation", "food system behaviors", "food system memory", "food system attention", "food system regulation", "food system behavior", "food system happiness"], "type": "cluster", "node_size": 39, "label": "Food System Behaviors"}, "Food Access & Engagement": {"concepts": "food system accessibility, food system preparation community, food mentorship, food empowerment, food system involvement, food engagement, food system barriers, food leadership, food system community, food partnerships, food system leadership, food outreach, food access, food access programs, food system alliance, food system partnership, food system facilitators, food advocacy, food system empowerment, food system coalition, food initiatives, food system participation, food system intervention, food programs, food system access, food participation, food system collaboration, food collaboration, information exchange, online communities, community mapping, outreach, collaboration, engagement, program awareness, social participation, support services, resource sharing, community involvement, group membership, community exchange, knowledge exchange, community programs, community resources, community building, community engagement, participation, community support", "concept_list": ["food system accessibility", "food system preparation community", "food mentorship", "food empowerment", "food system involvement", "food engagement", "food system barriers", "food leadership", "food system community", "food partnerships", "food system leadership", "food outreach", "food access", "food access programs", "food system alliance", "food system partnership", "food system facilitators", "food advocacy", "food system empowerment", "food system coalition", "food initiatives", "food system participation", "food system intervention", "food programs", "food system access", "food participation", "food system collaboration", "food collaboration", "information exchange", "online communities", "community mapping", "outreach", "collaboration", "engagement", "program awareness", "social participation", "support services", "resource sharing", "community involvement", "group membership", "community exchange", "knowledge exchange", "community programs", "community resources", "community building", "community engagement", "participation", "community support"], "type": "cluster", "node_size": 159, "label": "Food Access & Engagement"}, "Food Habits & Nutrition": {"concepts": "dried beans, african foods, food habits, food system consumption, food system habits, food consumption, traditional foods, food nutrition, food system nutrition, food system quality of life, food system well-being, food system self-sufficiency, food practices, nutritious foods, food system utilization, food system health", "concept_list": ["dried beans", "african foods", "food habits", "food system consumption", "food system habits", "food consumption", "traditional foods", "food nutrition", "food system nutrition", "food system quality of life", "food system well-being", "food system self-sufficiency", "food practices", "nutritious foods", "food system utilization", "food system health"], "type": "cluster", "node_size": 63, "label": "Food Habits & Nutrition"}, "Awareness & Skills": {"concepts": "cultural awareness, technology use, awareness, skillet, beans, affordability, resource awareness, generational differences, survival skills, education, resourcefulness", "concept_list": ["cultural awareness", "technology use", "awareness", "skillet", "beans", "affordability", "resource awareness", "generational differences", "survival skills", "education", "resourcefulness"], "type": "cluster", "node_size": 48, "label": "Awareness & Skills"}, "Food System Infrastructure": {"concepts": "food system funding, food system policy, food sector, food system investment, food system society, food system agriculture, food system capacity building, food system infrastructure, food system importing, food system sectors, food system resources, food system preparation importing", "concept_list": ["food system funding", "food system policy", "food sector", "food system investment", "food system society", "food system agriculture", "food system capacity building", "food system infrastructure", "food system importing", "food system sectors", "food system resources", "food system preparation importing"], "type": "cluster", "node_size": 51, "label": "Food System Infrastructure"}, "Food System Evaluation": {"concepts": "food system evidence, food system relevance, food system inclusion, food system priority, food system importance, food system risk, food system heritage, food system assessment, food system evaluation", "concept_list": ["food system evidence", "food system relevance", "food system inclusion", "food system priority", "food system importance", "food system risk", "food system heritage", "food system assessment", "food system evaluation"], "type": "cluster", "node_size": 42, "label": "Food System Evaluation"}, "Food Security & Resilience": {"concepts": "food system security, food system recovery, food system adaptability, food system safety, food system history, food organization, food system, food system selection, older days, food system planning, food security, food system legacy, food system technology, food system stability, food system identity, food system robustness, food system meaning, food culture, food system purpose, food system understanding", "concept_list": ["food system security", "food system recovery", "food system adaptability", "food system safety", "food system history", "food organization", "food system", "food system selection", "older days", "food system planning", "food security", "food system legacy", "food system technology", "food system stability", "food system identity", "food system robustness", "food system meaning", "food culture", "food system purpose", "food system understanding"], "type": "cluster", "node_size": 75, "label": "Food Security & Resilience"}, "Food System Monitoring": {"concepts": "food system customs, food system data, food system measurement, food system monitoring, food system information, food system support, food system prompts", "concept_list": ["food system customs", "food system data", "food system measurement", "food system monitoring", "food system information", "food system support", "food system prompts"], "type": "cluster", "node_size": 36, "label": "Food System Monitoring"}, "Food Education & Skills": {"concepts": "food preparation skills, food learning, food system education, food system learning, food system preparation skills, food system knowledge, food knowledge, food system training, food education, food system preparation knowledge", "concept_list": ["food preparation skills", "food learning", "food system education", "food system learning", "food system preparation skills", "food system knowledge", "food knowledge", "food system training", "food education", "food system preparation knowledge"], "type": "cluster", "node_size": 45, "label": "Food Education & Skills"}, "Food System Dynamics": {"concepts": "food system markets, food system demand, food system supply", "concept_list": ["food system markets", "food system demand", "food system supply"], "type": "cluster", "node_size": 24, "label": "Food System Dynamics"}, "Food Pricing": {"concepts": "food prices, food system pricing, food system prices", "concept_list": ["food prices", "food system pricing", "food system prices"], "type": "cluster", "node_size": 24, "label": "Food Pricing"}, "Regional Programs": {"concepts": "regional programs, county programs, genesee county", "concept_list": ["regional programs", "county programs", "genesee county"], "type": "cluster", "node_size": 24, "label": "Regional Programs"}, "Rural Differences": {"concepts": "rural living, regional differences", "concept_list": ["rural living", "regional differences"], "type": "cluster", "node_size": 21, "label": "Rural Differences"}, "Local Initiatives": {"concepts": "local initiatives, local markets, urban agriculture", "concept_list": ["local initiatives", "local markets", "urban agriculture"], "type": "cluster", "node_size": 24, "label": "Local Initiatives"}, "Food Access": {"concepts": "food environment, food deserts, food distribution", "concept_list": ["food environment", "food deserts", "food distribution"], "type": "cluster", "node_size": 24, "label": "Food Access"}, "Food Sharing": {"concepts": "food inclusion, food communication, food sharing, home cooking, food variety, food diversity", "concept_list": ["food inclusion", "food communication", "food sharing", "home cooking", "food variety", "food diversity"], "type": "cluster", "node_size": 33, "label": "Food Sharing"}, "System Satisfaction": {"concepts": "food system acceptability, food system satisfaction, food system quality", "concept_list": ["food system acceptability", "food system satisfaction", "food system quality"], "type": "cluster", "node_size": 24, "label": "System Satisfaction"}, "System Perceptions": {"concepts": "food system beliefs, food system perceptions, food system attitudes, food system norms", "concept_list": ["food system beliefs", "food system perceptions", "food system attitudes", "food system norms"], "type": "cluster", "node_size": 27, "label": "System Perceptions"}, "System Efficiency": {"concepts": "food system efficiency, food system effectiveness", "concept_list": ["food system efficiency", "food system effectiveness"], "type": "cluster", "node_size": 21, "label": "System Efficiency"}, "System Impact": {"concepts": "food system significance, food system outcomes, food impact", "concept_list": ["food system significance", "food system outcomes", "food impact"], "type": "cluster", "node_size": 24, "label": "System Impact"}, "System Potential": {"concepts": "food system opportunities, food system focus, food system potential", "concept_list": ["food system opportunities", "food system focus", "food system potential"], "type": "cluster", "node_size": 24, "label": "System Potential"}};
        const conceptData = {};
        const interClusterEdges = [["Food Equity", "Regional Programs", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Choices", "Food System Behaviors", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food Education & Skills", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["System Resilience", "Food Preparation Logistics", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["System Resilience", "Food Retail Types", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food System Innovation", "Food System Monitoring", {"weight": 1.0, "confidence": 0.5666666666666668, "type": "inter_cluster", "style": "solid"}], ["Food System Innovation", "Food Sharing", {"weight": 0.5, "confidence": 0.275, "type": "inter_cluster", "style": "solid"}], ["Food System Networks", "Food System Monitoring", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food System Networks", "System Efficiency", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food System Networks", "Food System Evaluation", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Food Preparation Logistics", "System Satisfaction", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Preparation Logistics", "Food Education & Skills", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Food Preparation Logistics", "Community Engagement", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Seasonal Growing", "Food Security & Resilience", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Seasonal Growing", "System Impact", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Seasonal Growing", "Food Education & Skills", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Community Adaptation", "Food Pricing", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community Adaptation", "System Resilience", {"weight": 0.5, "confidence": 0.32499999999999996, "type": "inter_cluster", "style": "solid"}], ["Community Adaptation", "Food Choices", {"weight": 0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Food Retail Types", "System Resilience", {"weight": 0.75, "confidence": 0.44999999999999996, "type": "inter_cluster", "style": "solid"}], ["Food Retail Types", "Local Initiatives", {"weight": 0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Food System Behaviors", "Community Engagement", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food System Behaviors", "Rural Differences", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Access & Engagement", "Awareness & Skills", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Food Access & Engagement", "Community Adaptation", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Food Access & Engagement", "Seasonal Growing", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access & Engagement", "Food System Dynamics", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Access & Engagement", "Food Access", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Habits & Nutrition", "Food Access & Engagement", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Awareness & Skills", "Food Choices", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Awareness & Skills", "Food System Infrastructure", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Awareness & Skills", "System Perceptions", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Awareness & Skills", "System Potential", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food System Infrastructure", "System Impact", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food System Infrastructure", "Food Access", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food System Evaluation", "Food Equity", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Security & Resilience", "Awareness & Skills", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food System Monitoring", "Food Equity", {"weight": 0.75, "confidence": 0.525, "type": "inter_cluster", "style": "solid"}], ["Food Education & Skills", "Seasonal Growing", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Education & Skills", "Food System Monitoring", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Food Education & Skills", "Food System Networks", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food System Dynamics", "Food Retail Types", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Food Pricing", "Food Access", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Pricing", "Food Retail Types", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Regional Programs", "Food Preparation Logistics", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Rural Differences", "Food System Networks", {"weight": 1.0, "confidence": 0.7875, "type": "inter_cluster", "style": "solid"}], ["Rural Differences", "System Impact", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Rural Differences", "Food System Innovation", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Local Initiatives", "Community Engagement", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Pricing", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Awareness & Skills", {"weight": 0.3333333333333333, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food System Evaluation", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Sharing", "Food Preparation Logistics", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["System Satisfaction", "Seasonal Growing", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["System Satisfaction", "Food System Monitoring", {"weight": 1.0, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["System Satisfaction", "Food System Networks", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["System Perceptions", "Local Initiatives", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["System Impact", "Food Preparation Logistics", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["System Impact", "Food System Dynamics", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["System Potential", "Food Choices", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["System Potential", "Food System Innovation", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["System Potential", "Food Access", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["System Potential", "Community Adaptation", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Equity": [], "Food Choices": [], "Community Engagement": [], "System Resilience": [], "Food System Innovation": [], "Food System Networks": [], "Food Preparation Logistics": [], "Seasonal Growing": [], "Community Adaptation": [], "Food Retail Types": [], "Food System Behaviors": [], "Food Access & Engagement": [], "Food Habits & Nutrition": [], "Awareness & Skills": [], "Food System Infrastructure": [], "Food System Evaluation": [], "Food Security & Resilience": [], "Food System Monitoring": [], "Food Education & Skills": [], "Food System Dynamics": [], "Food Pricing": [], "Regional Programs": [], "Rural Differences": [], "Local Initiatives": [], "Food Access": [], "Food Sharing": [], "System Satisfaction": [], "System Perceptions": [], "System Efficiency": [], "System Impact": [], "System Potential": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
