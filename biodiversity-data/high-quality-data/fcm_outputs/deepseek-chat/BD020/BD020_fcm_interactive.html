
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"demographic criteria": {"concepts": "demographic criteria", "concept_list": ["demographic criteria"], "type": "cluster", "node_size": 18, "label": "demographic criteria"}, "population consequences": {"concepts": "population consequences", "concept_list": ["population consequences"], "type": "cluster", "node_size": 18, "label": "population consequences"}, "Ecosystem Stressors": {"concepts": "dams, management measures, adaptive management, dynamic management, recovery plan, inadequacy of management, management actions, recovery plans", "concept_list": ["dams", "management measures", "adaptive management", "dynamic management", "recovery plan", "inadequacy of management", "management actions", "recovery plans"], "type": "cluster", "node_size": 39, "label": "Ecosystem Stressors"}, "Species Conservation": {"concepts": "connectivity, productivity, multiple stressors, connectivity disruptions, mate finding, stressors, conceptual model, weighting adjustments, mmpa, knowledge gaps, human activity, diversity, qualitative tool, observer coverage, semi-quantitative, overutilization, msa, entanglement, esa, section 7, gear entanglement, bycatch, cumulative effects, abundance, disease, odds ratios, gear entanglements", "concept_list": ["connectivity", "productivity", "multiple stressors", "connectivity disruptions", "mate finding", "stressors", "conceptual model", "weighting adjustments", "mmpa", "knowledge gaps", "human activity", "diversity", "qualitative tool", "observer coverage", "semi-quantitative", "overutilization", "msa", "entanglement", "esa", "section 7", "gear entanglement", "bycatch", "cumulative effects", "abundance", "disease", "odds ratios", "gear entanglements"], "type": "cluster", "node_size": 96, "label": "Species Conservation"}, "Habitat Threats": {"concepts": "species presence, protected species, climate change, water temperature, ecosystem function, climate adaptation, fisheries, conservation concern, habitat conservation, river ecosystems, ecosystem services, reproductive fitness, predation, species conservation, calving rates, spawning habitats, bioenergetics perspective, key food web species, invasive species, community composition, gene flow, genetic diversity, food base, species abundance, harmful organisms, species of conservation concern, species resilience, large predators, poaching, hormonal cycle, prey distribution, bioenergetics, biodiversity, reproductive output, fishery management, ecosystem maintenance, fishery ecosystem plans, ecosystem influence, reproduction thresholds, genetic techniques, ecosystem plans, endangered species, food web, lionfish", "concept_list": ["species presence", "protected species", "climate change", "water temperature", "ecosystem function", "climate adaptation", "fisheries", "conservation concern", "habitat conservation", "river ecosystems", "ecosystem services", "reproductive fitness", "predation", "species conservation", "calving rates", "spawning habitats", "bioenergetics perspective", "key food web species", "invasive species", "community composition", "gene flow", "genetic diversity", "food base", "species abundance", "harmful organisms", "species of conservation concern", "species resilience", "large predators", "poaching", "hormonal cycle", "prey distribution", "bioenergetics", "biodiversity", "reproductive output", "fishery management", "ecosystem maintenance", "fishery ecosystem plans", "ecosystem influence", "reproduction thresholds", "genetic techniques", "ecosystem plans", "endangered species", "food web", "lionfish"], "type": "cluster", "node_size": 147, "label": "Habitat Threats"}, "Pollution Risks": {"concepts": "habitat destruction, statutory authority, habitat forming species, regional shifts, regime shifts, esa regulations, spawning aggregations, regional communication, regional collaboration, stress factors", "concept_list": ["habitat destruction", "statutory authority", "habitat forming species", "regional shifts", "regime shifts", "esa regulations", "spawning aggregations", "regional communication", "regional collaboration", "stress factors"], "type": "cluster", "node_size": 45, "label": "Pollution Risks"}, "Adaptive Management": {"concepts": "noise pollution, pollution, enforcement, threats, vessel strikes, oil spills, marine debris, ship strikes, regulations", "concept_list": ["noise pollution", "pollution", "enforcement", "threats", "vessel strikes", "oil spills", "marine debris", "ship strikes", "regulations"], "type": "cluster", "node_size": 42, "label": "Adaptive Management"}, "Population Trends": {"concepts": "population recovery, population trajectory", "concept_list": ["population recovery", "population trajectory"], "type": "cluster", "node_size": 21, "label": "Population Trends"}, "Population Resilience": {"concepts": "population viability analysis, demographic resilience", "concept_list": ["population viability analysis", "demographic resilience"], "type": "cluster", "node_size": 21, "label": "Population Resilience"}};
        const conceptData = {"dams": {"concepts": "dams", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "dams"}, "management measures": {"concepts": "management measures", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "management measures"}, "adaptive management": {"concepts": "adaptive management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "adaptive management"}, "dynamic management": {"concepts": "dynamic management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "dynamic management"}, "recovery plan": {"concepts": "recovery plan", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "recovery plan"}, "inadequacy of management": {"concepts": "inadequacy of management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "inadequacy of management"}, "management actions": {"concepts": "management actions", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "management actions"}, "recovery plans": {"concepts": "recovery plans", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "recovery plans"}, "connectivity": {"concepts": "connectivity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "connectivity"}, "productivity": {"concepts": "productivity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "productivity"}, "multiple stressors": {"concepts": "multiple stressors", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "multiple stressors"}, "connectivity disruptions": {"concepts": "connectivity disruptions", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "connectivity disruptions"}, "mate finding": {"concepts": "mate finding", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "mate finding"}, "stressors": {"concepts": "stressors", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "stressors"}, "conceptual model": {"concepts": "conceptual model", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "conceptual model"}, "weighting adjustments": {"concepts": "weighting adjustments", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "weighting adjustments"}, "mmpa": {"concepts": "mmpa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "mmpa"}, "knowledge gaps": {"concepts": "knowledge gaps", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "knowledge gaps"}, "human activity": {"concepts": "human activity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "human activity"}, "diversity": {"concepts": "diversity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "diversity"}, "qualitative tool": {"concepts": "qualitative tool", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "qualitative tool"}, "observer coverage": {"concepts": "observer coverage", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "observer coverage"}, "semi-quantitative": {"concepts": "semi-quantitative", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "semi-quantitative"}, "overutilization": {"concepts": "overutilization", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "overutilization"}, "msa": {"concepts": "msa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "msa"}, "entanglement": {"concepts": "entanglement", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "entanglement"}, "esa": {"concepts": "esa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "esa"}, "section 7": {"concepts": "section 7", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "section 7"}, "gear entanglement": {"concepts": "gear entanglement", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "gear entanglement"}, "bycatch": {"concepts": "bycatch", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "bycatch"}, "cumulative effects": {"concepts": "cumulative effects", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "cumulative effects"}, "abundance": {"concepts": "abundance", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "abundance"}, "disease": {"concepts": "disease", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "disease"}, "odds ratios": {"concepts": "odds ratios", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "odds ratios"}, "gear entanglements": {"concepts": "gear entanglements", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "gear entanglements"}, "species presence": {"concepts": "species presence", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species presence"}, "protected species": {"concepts": "protected species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "protected species"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "climate change"}, "water temperature": {"concepts": "water temperature", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "water temperature"}, "ecosystem function": {"concepts": "ecosystem function", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem function"}, "climate adaptation": {"concepts": "climate adaptation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "climate adaptation"}, "fisheries": {"concepts": "fisheries", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fisheries"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "conservation concern"}, "habitat conservation": {"concepts": "habitat conservation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "habitat conservation"}, "river ecosystems": {"concepts": "river ecosystems", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "river ecosystems"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem services"}, "reproductive fitness": {"concepts": "reproductive fitness", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproductive fitness"}, "predation": {"concepts": "predation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "predation"}, "species conservation": {"concepts": "species conservation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species conservation"}, "calving rates": {"concepts": "calving rates", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "calving rates"}, "spawning habitats": {"concepts": "spawning habitats", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "spawning habitats"}, "bioenergetics perspective": {"concepts": "bioenergetics perspective", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "bioenergetics perspective"}, "key food web species": {"concepts": "key food web species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "key food web species"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "invasive species"}, "community composition": {"concepts": "community composition", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "community composition"}, "gene flow": {"concepts": "gene flow", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "gene flow"}, "genetic diversity": {"concepts": "genetic diversity", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "genetic diversity"}, "food base": {"concepts": "food base", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "food base"}, "species abundance": {"concepts": "species abundance", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species abundance"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "harmful organisms"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species of conservation concern"}, "species resilience": {"concepts": "species resilience", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species resilience"}, "large predators": {"concepts": "large predators", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "large predators"}, "poaching": {"concepts": "poaching", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "poaching"}, "hormonal cycle": {"concepts": "hormonal cycle", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "hormonal cycle"}, "prey distribution": {"concepts": "prey distribution", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "prey distribution"}, "bioenergetics": {"concepts": "bioenergetics", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "bioenergetics"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "biodiversity"}, "reproductive output": {"concepts": "reproductive output", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproductive output"}, "fishery management": {"concepts": "fishery management", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fishery management"}, "ecosystem maintenance": {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem maintenance"}, "fishery ecosystem plans": {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fishery ecosystem plans"}, "ecosystem influence": {"concepts": "ecosystem influence", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem influence"}, "reproduction thresholds": {"concepts": "reproduction thresholds", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproduction thresholds"}, "genetic techniques": {"concepts": "genetic techniques", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "genetic techniques"}, "ecosystem plans": {"concepts": "ecosystem plans", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem plans"}, "endangered species": {"concepts": "endangered species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "endangered species"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "food web"}, "lionfish": {"concepts": "lionfish", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "lionfish"}, "habitat destruction": {"concepts": "habitat destruction", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "habitat destruction"}, "statutory authority": {"concepts": "statutory authority", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "statutory authority"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "habitat forming species"}, "regional shifts": {"concepts": "regional shifts", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional shifts"}, "regime shifts": {"concepts": "regime shifts", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regime shifts"}, "esa regulations": {"concepts": "esa regulations", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "esa regulations"}, "spawning aggregations": {"concepts": "spawning aggregations", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "spawning aggregations"}, "regional communication": {"concepts": "regional communication", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional communication"}, "regional collaboration": {"concepts": "regional collaboration", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional collaboration"}, "stress factors": {"concepts": "stress factors", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "stress factors"}, "noise pollution": {"concepts": "noise pollution", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "noise pollution"}, "pollution": {"concepts": "pollution", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "pollution"}, "enforcement": {"concepts": "enforcement", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "enforcement"}, "threats": {"concepts": "threats", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "threats"}, "vessel strikes": {"concepts": "vessel strikes", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "vessel strikes"}, "oil spills": {"concepts": "oil spills", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "oil spills"}, "marine debris": {"concepts": "marine debris", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "marine debris"}, "ship strikes": {"concepts": "ship strikes", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "ship strikes"}, "regulations": {"concepts": "regulations", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "regulations"}, "population recovery": {"concepts": "population recovery", "type": "concept", "cluster": "Population Trends", "node_size": 10, "label": "population recovery"}, "population trajectory": {"concepts": "population trajectory", "type": "concept", "cluster": "Population Trends", "node_size": 10, "label": "population trajectory"}, "population viability analysis": {"concepts": "population viability analysis", "type": "concept", "cluster": "Population Resilience", "node_size": 10, "label": "population viability analysis"}, "demographic resilience": {"concepts": "demographic resilience", "type": "concept", "cluster": "Population Resilience", "node_size": 10, "label": "demographic resilience"}};
        const interClusterEdges = [["demographic criteria", "population consequences", {"weight": -0.5, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["demographic criteria", "Population Trends", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["demographic criteria", "Adaptive Management", {"weight": -1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["demographic criteria", "Pollution Risks", {"weight": -1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["population consequences", "Population Trends", {"weight": -1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["population consequences", "demographic criteria", {"weight": -1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["population consequences", "Ecosystem Stressors", {"weight": -0.5, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["population consequences", "Habitat Threats", {"weight": -0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["population consequences", "Population Resilience", {"weight": -0.3333333333333333, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "Pollution Risks", {"weight": -0.2, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "Adaptive Management", {"weight": -0.6, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "Population Trends", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "Habitat Threats", {"weight": 1.0, "confidence": 0.7825, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "demographic criteria", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stressors", "Population Resilience", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "population consequences", {"weight": -0.6, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "demographic criteria", {"weight": -0.2, "confidence": 0.8360000000000001, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "Habitat Threats", {"weight": -1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "Population Resilience", {"weight": -1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "Adaptive Management", {"weight": 0.3333333333333333, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Species Conservation", "Pollution Risks", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Habitat Threats", "population consequences", {"weight": -0.6, "confidence": 0.8360000000000001, "type": "inter_cluster", "style": "solid"}], ["Habitat Threats", "Population Trends", {"weight": 1.0, "confidence": 0.8039999999999999, "type": "inter_cluster", "style": "solid"}], ["Habitat Threats", "Ecosystem Stressors", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Habitat Threats", "Population Resilience", {"weight": 1.0, "confidence": 0.7949999999999999, "type": "inter_cluster", "style": "solid"}], ["Habitat Threats", "Adaptive Management", {"weight": -1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Pollution Risks", "population consequences", {"weight": -0.6, "confidence": 0.8099999999999999, "type": "inter_cluster", "style": "solid"}], ["Pollution Risks", "Habitat Threats", {"weight": -0.6, "confidence": 0.8140000000000001, "type": "inter_cluster", "style": "solid"}], ["Pollution Risks", "demographic criteria", {"weight": -1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Pollution Risks", "Population Resilience", {"weight": -1.0, "confidence": 0.8174999999999999, "type": "inter_cluster", "style": "solid"}], ["Pollution Risks", "Population Trends", {"weight": -1.0, "confidence": 0.7874999999999999, "type": "inter_cluster", "style": "solid"}], ["Adaptive Management", "Population Trends", {"weight": -1.0, "confidence": 0.8399999999999999, "type": "inter_cluster", "style": "solid"}], ["Adaptive Management", "Population Resilience", {"weight": -1.0, "confidence": 0.7860000000000001, "type": "inter_cluster", "style": "solid"}], ["Adaptive Management", "demographic criteria", {"weight": -1.0, "confidence": 0.7700000000000001, "type": "inter_cluster", "style": "solid"}], ["Adaptive Management", "Pollution Risks", {"weight": -0.3333333333333333, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Adaptive Management", "Species Conservation", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "Population Resilience", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "Ecosystem Stressors", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "demographic criteria", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "population consequences", {"weight": -0.5, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "Habitat Threats", {"weight": 0.3333333333333333, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Population Trends", "Adaptive Management", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Population Resilience", "Population Trends", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Population Resilience", "Adaptive Management", {"weight": -1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Population Resilience", "demographic criteria", {"weight": 1.0, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Population Resilience", "Species Conservation", {"weight": -1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Population Resilience", "Pollution Risks", {"weight": -0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Ecosystem Stressors": [["dams", {"concepts": "dams", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "dams"}], ["management measures", {"concepts": "management measures", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "management measures"}], ["adaptive management", {"concepts": "adaptive management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "adaptive management"}], ["dynamic management", {"concepts": "dynamic management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "dynamic management"}], ["recovery plan", {"concepts": "recovery plan", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "recovery plan"}], ["inadequacy of management", {"concepts": "inadequacy of management", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "inadequacy of management"}], ["management actions", {"concepts": "management actions", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "management actions"}], ["recovery plans", {"concepts": "recovery plans", "type": "concept", "cluster": "Ecosystem Stressors", "node_size": 10, "label": "recovery plans"}]], "Species Conservation": [["connectivity", {"concepts": "connectivity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "connectivity"}], ["productivity", {"concepts": "productivity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "productivity"}], ["multiple stressors", {"concepts": "multiple stressors", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "multiple stressors"}], ["connectivity disruptions", {"concepts": "connectivity disruptions", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "connectivity disruptions"}], ["mate finding", {"concepts": "mate finding", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "mate finding"}], ["stressors", {"concepts": "stressors", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "stressors"}], ["conceptual model", {"concepts": "conceptual model", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "conceptual model"}], ["weighting adjustments", {"concepts": "weighting adjustments", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "weighting adjustments"}], ["mmpa", {"concepts": "mmpa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "mmpa"}], ["knowledge gaps", {"concepts": "knowledge gaps", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "knowledge gaps"}], ["human activity", {"concepts": "human activity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "human activity"}], ["diversity", {"concepts": "diversity", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "diversity"}], ["qualitative tool", {"concepts": "qualitative tool", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "qualitative tool"}], ["observer coverage", {"concepts": "observer coverage", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "observer coverage"}], ["semi-quantitative", {"concepts": "semi-quantitative", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "semi-quantitative"}], ["overutilization", {"concepts": "overutilization", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "overutilization"}], ["msa", {"concepts": "msa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "msa"}], ["entanglement", {"concepts": "entanglement", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "entanglement"}], ["esa", {"concepts": "esa", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "esa"}], ["section 7", {"concepts": "section 7", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "section 7"}], ["gear entanglement", {"concepts": "gear entanglement", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "gear entanglement"}], ["bycatch", {"concepts": "bycatch", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "bycatch"}], ["cumulative effects", {"concepts": "cumulative effects", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "cumulative effects"}], ["abundance", {"concepts": "abundance", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "abundance"}], ["disease", {"concepts": "disease", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "disease"}], ["odds ratios", {"concepts": "odds ratios", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "odds ratios"}], ["gear entanglements", {"concepts": "gear entanglements", "type": "concept", "cluster": "Species Conservation", "node_size": 10, "label": "gear entanglements"}]], "Habitat Threats": [["species presence", {"concepts": "species presence", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species presence"}], ["protected species", {"concepts": "protected species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "protected species"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "climate change"}], ["water temperature", {"concepts": "water temperature", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "water temperature"}], ["ecosystem function", {"concepts": "ecosystem function", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem function"}], ["climate adaptation", {"concepts": "climate adaptation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "climate adaptation"}], ["fisheries", {"concepts": "fisheries", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fisheries"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "conservation concern"}], ["habitat conservation", {"concepts": "habitat conservation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "habitat conservation"}], ["river ecosystems", {"concepts": "river ecosystems", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "river ecosystems"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem services"}], ["reproductive fitness", {"concepts": "reproductive fitness", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproductive fitness"}], ["predation", {"concepts": "predation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "predation"}], ["species conservation", {"concepts": "species conservation", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species conservation"}], ["calving rates", {"concepts": "calving rates", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "calving rates"}], ["spawning habitats", {"concepts": "spawning habitats", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "spawning habitats"}], ["bioenergetics perspective", {"concepts": "bioenergetics perspective", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "bioenergetics perspective"}], ["key food web species", {"concepts": "key food web species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "key food web species"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "invasive species"}], ["community composition", {"concepts": "community composition", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "community composition"}], ["gene flow", {"concepts": "gene flow", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "gene flow"}], ["genetic diversity", {"concepts": "genetic diversity", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "genetic diversity"}], ["food base", {"concepts": "food base", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "food base"}], ["species abundance", {"concepts": "species abundance", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species abundance"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "harmful organisms"}], ["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species of conservation concern"}], ["species resilience", {"concepts": "species resilience", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "species resilience"}], ["large predators", {"concepts": "large predators", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "large predators"}], ["poaching", {"concepts": "poaching", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "poaching"}], ["hormonal cycle", {"concepts": "hormonal cycle", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "hormonal cycle"}], ["prey distribution", {"concepts": "prey distribution", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "prey distribution"}], ["bioenergetics", {"concepts": "bioenergetics", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "bioenergetics"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "biodiversity"}], ["reproductive output", {"concepts": "reproductive output", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproductive output"}], ["fishery management", {"concepts": "fishery management", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fishery management"}], ["ecosystem maintenance", {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem maintenance"}], ["fishery ecosystem plans", {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "fishery ecosystem plans"}], ["ecosystem influence", {"concepts": "ecosystem influence", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem influence"}], ["reproduction thresholds", {"concepts": "reproduction thresholds", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "reproduction thresholds"}], ["genetic techniques", {"concepts": "genetic techniques", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "genetic techniques"}], ["ecosystem plans", {"concepts": "ecosystem plans", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "ecosystem plans"}], ["endangered species", {"concepts": "endangered species", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "endangered species"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "food web"}], ["lionfish", {"concepts": "lionfish", "type": "concept", "cluster": "Habitat Threats", "node_size": 10, "label": "lionfish"}]], "Pollution Risks": [["habitat destruction", {"concepts": "habitat destruction", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "habitat destruction"}], ["statutory authority", {"concepts": "statutory authority", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "statutory authority"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "habitat forming species"}], ["regional shifts", {"concepts": "regional shifts", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional shifts"}], ["regime shifts", {"concepts": "regime shifts", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regime shifts"}], ["esa regulations", {"concepts": "esa regulations", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "esa regulations"}], ["spawning aggregations", {"concepts": "spawning aggregations", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "spawning aggregations"}], ["regional communication", {"concepts": "regional communication", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional communication"}], ["regional collaboration", {"concepts": "regional collaboration", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "regional collaboration"}], ["stress factors", {"concepts": "stress factors", "type": "concept", "cluster": "Pollution Risks", "node_size": 10, "label": "stress factors"}]], "Adaptive Management": [["noise pollution", {"concepts": "noise pollution", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "noise pollution"}], ["pollution", {"concepts": "pollution", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "pollution"}], ["enforcement", {"concepts": "enforcement", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "enforcement"}], ["threats", {"concepts": "threats", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "threats"}], ["vessel strikes", {"concepts": "vessel strikes", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "vessel strikes"}], ["oil spills", {"concepts": "oil spills", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "oil spills"}], ["marine debris", {"concepts": "marine debris", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "marine debris"}], ["ship strikes", {"concepts": "ship strikes", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "ship strikes"}], ["regulations", {"concepts": "regulations", "type": "concept", "cluster": "Adaptive Management", "node_size": 10, "label": "regulations"}]], "Population Trends": [["population recovery", {"concepts": "population recovery", "type": "concept", "cluster": "Population Trends", "node_size": 10, "label": "population recovery"}], ["population trajectory", {"concepts": "population trajectory", "type": "concept", "cluster": "Population Trends", "node_size": 10, "label": "population trajectory"}]], "Population Resilience": [["population viability analysis", {"concepts": "population viability analysis", "type": "concept", "cluster": "Population Resilience", "node_size": 10, "label": "population viability analysis"}], ["demographic resilience", {"concepts": "demographic resilience", "type": "concept", "cluster": "Population Resilience", "node_size": 10, "label": "demographic resilience"}]]};
        const clusterEdges = {"Ecosystem Stressors": [], "Species Conservation": [], "Habitat Threats": [], "Pollution Risks": [], "Adaptive Management": [], "Population Trends": [], "Population Resilience": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
