
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"management measures": {"concepts": "management measures", "concept_list": ["management measures"], "type": "cluster", "node_size": 18, "label": "management measures"}, "adaptive management": {"concepts": "adaptive management", "concept_list": ["adaptive management"], "type": "cluster", "node_size": 18, "label": "adaptive management"}, "food web": {"concepts": "food web", "concept_list": ["food web"], "type": "cluster", "node_size": 18, "label": "food web"}, "connectivity": {"concepts": "connectivity", "concept_list": ["connectivity"], "type": "cluster", "node_size": 18, "label": "connectivity"}, "spawning aggregations": {"concepts": "spawning aggregations", "concept_list": ["spawning aggregations"], "type": "cluster", "node_size": 18, "label": "spawning aggregations"}, "invasive species": {"concepts": "invasive species", "concept_list": ["invasive species"], "type": "cluster", "node_size": 18, "label": "invasive species"}, "noise pollution": {"concepts": "noise pollution", "concept_list": ["noise pollution"], "type": "cluster", "node_size": 18, "label": "noise pollution"}, "Stakeholder Consultation": {"concepts": "jeopardy consultation, collaboration", "concept_list": ["jeopardy consultation", "collaboration"], "type": "cluster", "node_size": 21, "label": "Stakeholder Consultation"}, "Management Response": {"concepts": "management inadequacy, management actions, recovery plans, dynamic management", "concept_list": ["management inadequacy", "management actions", "recovery plans", "dynamic management"], "type": "cluster", "node_size": 27, "label": "Management Response"}, "Legal Frameworks": {"concepts": "msa, esa", "concept_list": ["msa", "esa"], "type": "cluster", "node_size": 21, "label": "Legal Frameworks"}, "Regulatory Compliance": {"concepts": "bycatch, semi-quantitative, system components, qualitative assessment, regulatory compliance, mmpa", "concept_list": ["bycatch", "semi-quantitative", "system components", "qualitative assessment", "regulatory compliance", "mmpa"], "type": "cluster", "node_size": 33, "label": "Regulatory Compliance"}, "Conceptual Tools": {"concepts": "conceptual model, conceptual tool, framework, mental models, semi-quantitative tool", "concept_list": ["conceptual model", "conceptual tool", "framework", "mental models", "semi-quantitative tool"], "type": "cluster", "node_size": 30, "label": "Conceptual Tools"}, "Knowledge Assessment": {"concepts": "knowledge gaps, listing factors, threat assessment", "concept_list": ["knowledge gaps", "listing factors", "threat assessment"], "type": "cluster", "node_size": 24, "label": "Knowledge Assessment"}, "Vessel Monitoring": {"concepts": "vessel strikes, observer coverage", "concept_list": ["vessel strikes", "observer coverage"], "type": "cluster", "node_size": 21, "label": "Vessel Monitoring"}, "Reproductive Health": {"concepts": "birth rates, mortality rates, reproductive success, reproductive fitness, reproductive output, reproduction, hormonal cycles", "concept_list": ["birth rates", "mortality rates", "reproductive success", "reproductive fitness", "reproductive output", "reproduction", "hormonal cycles"], "type": "cluster", "node_size": 36, "label": "Reproductive Health"}, "Population Dynamics": {"concepts": "migration patterns, reproductive thresholds, temperature tolerance, fishing pressure, predator removal, habitat shifts, parrotfish, diversity, regional composition, cumulative effects, recovery rates, coral settlement, confidence intervals, habitat forming, gear entanglements, population resilience", "concept_list": ["migration patterns", "reproductive thresholds", "temperature tolerance", "fishing pressure", "predator removal", "habitat shifts", "parrotfish", "diversity", "regional composition", "cumulative effects", "recovery rates", "coral settlement", "confidence intervals", "habitat forming", "gear entanglements", "population resilience"], "type": "cluster", "node_size": 63, "label": "Population Dynamics"}, "Species Distribution": {"concepts": "species abundance, abundance, species presence, spatial distribution", "concept_list": ["species abundance", "abundance", "species presence", "spatial distribution"], "type": "cluster", "node_size": 27, "label": "Species Distribution"}, "Genetic Diversity": {"concepts": "genetic diversity, gene flow", "concept_list": ["genetic diversity", "gene flow"], "type": "cluster", "node_size": 21, "label": "Genetic Diversity"}, "Prey Availability": {"concepts": "prey distribution, prey abundance, prey availability", "concept_list": ["prey distribution", "prey abundance", "prey availability"], "type": "cluster", "node_size": 24, "label": "Prey Availability"}, "Predation Pressure": {"concepts": "predation, predators", "concept_list": ["predation", "predators"], "type": "cluster", "node_size": 21, "label": "Predation Pressure"}, "Multiple Stressors": {"concepts": "multiple stressors, stressors, stress accumulation", "concept_list": ["multiple stressors", "stressors", "stress accumulation"], "type": "cluster", "node_size": 24, "label": "Multiple Stressors"}, "Marine Threats": {"concepts": "oil spill impacts, ship strikes, disease outbreaks, harmful organisms, climate change, marine debris, entanglement risk", "concept_list": ["oil spill impacts", "ship strikes", "disease outbreaks", "harmful organisms", "climate change", "marine debris", "entanglement risk"], "type": "cluster", "node_size": 36, "label": "Marine Threats"}, "Habitat Disruption": {"concepts": "habitat destruction, connectivity disruption", "concept_list": ["habitat destruction", "connectivity disruption"], "type": "cluster", "node_size": 21, "label": "Habitat Disruption"}, "Species Productivity": {"concepts": "productivity, species resilience", "concept_list": ["productivity", "species resilience"], "type": "cluster", "node_size": 21, "label": "Species Productivity"}, "Ecosystem Health": {"concepts": "biodiversity, ecosystem functioning, ecosystem function, ecosystem maintenance", "concept_list": ["biodiversity", "ecosystem functioning", "ecosystem function", "ecosystem maintenance"], "type": "cluster", "node_size": 27, "label": "Ecosystem Health"}, "Conservation Risks": {"concepts": "regime shifts, population consequences, mate finding, species conservation, conservation concern, fishery ecosystem plans, extinction risk", "concept_list": ["regime shifts", "population consequences", "mate finding", "species conservation", "conservation concern", "fishery ecosystem plans", "extinction risk"], "type": "cluster", "node_size": 36, "label": "Conservation Risks"}, "Weight Adjustments": {"concepts": "categorical weights, weights, weighting adjustments, bioenergetics", "concept_list": ["categorical weights", "weights", "weighting adjustments", "bioenergetics"], "type": "cluster", "node_size": 27, "label": "Weight Adjustments"}, "Resource Overuse": {"concepts": "over utilization, historical utilization", "concept_list": ["over utilization", "historical utilization"], "type": "cluster", "node_size": 21, "label": "Resource Overuse"}, "Management Coordination": {"concepts": "interagency coordination, overutilization, odds ratios, gear entanglement", "concept_list": ["interagency coordination", "overutilization", "odds ratios", "gear entanglement"], "type": "cluster", "node_size": 27, "label": "Management Coordination"}};
        const conceptData = {"jeopardy consultation": {"concepts": "jeopardy consultation", "type": "concept", "cluster": "Stakeholder Consultation", "node_size": 10, "label": "jeopardy consultation"}, "collaboration": {"concepts": "collaboration", "type": "concept", "cluster": "Stakeholder Consultation", "node_size": 10, "label": "collaboration"}, "management inadequacy": {"concepts": "management inadequacy", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "management inadequacy"}, "management actions": {"concepts": "management actions", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "management actions"}, "recovery plans": {"concepts": "recovery plans", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "recovery plans"}, "dynamic management": {"concepts": "dynamic management", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "dynamic management"}, "msa": {"concepts": "msa", "type": "concept", "cluster": "Legal Frameworks", "node_size": 10, "label": "msa"}, "esa": {"concepts": "esa", "type": "concept", "cluster": "Legal Frameworks", "node_size": 10, "label": "esa"}, "bycatch": {"concepts": "bycatch", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "bycatch"}, "semi-quantitative": {"concepts": "semi-quantitative", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "semi-quantitative"}, "system components": {"concepts": "system components", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "system components"}, "qualitative assessment": {"concepts": "qualitative assessment", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "qualitative assessment"}, "regulatory compliance": {"concepts": "regulatory compliance", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "regulatory compliance"}, "mmpa": {"concepts": "mmpa", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "mmpa"}, "conceptual model": {"concepts": "conceptual model", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "conceptual model"}, "conceptual tool": {"concepts": "conceptual tool", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "conceptual tool"}, "framework": {"concepts": "framework", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "framework"}, "mental models": {"concepts": "mental models", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "mental models"}, "semi-quantitative tool": {"concepts": "semi-quantitative tool", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "semi-quantitative tool"}, "knowledge gaps": {"concepts": "knowledge gaps", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "knowledge gaps"}, "listing factors": {"concepts": "listing factors", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "listing factors"}, "threat assessment": {"concepts": "threat assessment", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "threat assessment"}, "vessel strikes": {"concepts": "vessel strikes", "type": "concept", "cluster": "Vessel Monitoring", "node_size": 10, "label": "vessel strikes"}, "observer coverage": {"concepts": "observer coverage", "type": "concept", "cluster": "Vessel Monitoring", "node_size": 10, "label": "observer coverage"}, "birth rates": {"concepts": "birth rates", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "birth rates"}, "mortality rates": {"concepts": "mortality rates", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "mortality rates"}, "reproductive success": {"concepts": "reproductive success", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive success"}, "reproductive fitness": {"concepts": "reproductive fitness", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive fitness"}, "reproductive output": {"concepts": "reproductive output", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive output"}, "reproduction": {"concepts": "reproduction", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproduction"}, "hormonal cycles": {"concepts": "hormonal cycles", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "hormonal cycles"}, "migration patterns": {"concepts": "migration patterns", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "migration patterns"}, "reproductive thresholds": {"concepts": "reproductive thresholds", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "reproductive thresholds"}, "temperature tolerance": {"concepts": "temperature tolerance", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "temperature tolerance"}, "fishing pressure": {"concepts": "fishing pressure", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "fishing pressure"}, "predator removal": {"concepts": "predator removal", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "predator removal"}, "habitat shifts": {"concepts": "habitat shifts", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "habitat shifts"}, "parrotfish": {"concepts": "parrotfish", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "parrotfish"}, "diversity": {"concepts": "diversity", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "diversity"}, "regional composition": {"concepts": "regional composition", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "regional composition"}, "cumulative effects": {"concepts": "cumulative effects", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "cumulative effects"}, "recovery rates": {"concepts": "recovery rates", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "recovery rates"}, "coral settlement": {"concepts": "coral settlement", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "coral settlement"}, "confidence intervals": {"concepts": "confidence intervals", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "confidence intervals"}, "habitat forming": {"concepts": "habitat forming", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "habitat forming"}, "gear entanglements": {"concepts": "gear entanglements", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "gear entanglements"}, "population resilience": {"concepts": "population resilience", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "population resilience"}, "species abundance": {"concepts": "species abundance", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "species abundance"}, "abundance": {"concepts": "abundance", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "abundance"}, "species presence": {"concepts": "species presence", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "species presence"}, "spatial distribution": {"concepts": "spatial distribution", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "spatial distribution"}, "genetic diversity": {"concepts": "genetic diversity", "type": "concept", "cluster": "Genetic Diversity", "node_size": 10, "label": "genetic diversity"}, "gene flow": {"concepts": "gene flow", "type": "concept", "cluster": "Genetic Diversity", "node_size": 10, "label": "gene flow"}, "prey distribution": {"concepts": "prey distribution", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey distribution"}, "prey abundance": {"concepts": "prey abundance", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey abundance"}, "prey availability": {"concepts": "prey availability", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey availability"}, "predation": {"concepts": "predation", "type": "concept", "cluster": "Predation Pressure", "node_size": 10, "label": "predation"}, "predators": {"concepts": "predators", "type": "concept", "cluster": "Predation Pressure", "node_size": 10, "label": "predators"}, "multiple stressors": {"concepts": "multiple stressors", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "multiple stressors"}, "stressors": {"concepts": "stressors", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "stressors"}, "stress accumulation": {"concepts": "stress accumulation", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "stress accumulation"}, "oil spill impacts": {"concepts": "oil spill impacts", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "oil spill impacts"}, "ship strikes": {"concepts": "ship strikes", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "ship strikes"}, "disease outbreaks": {"concepts": "disease outbreaks", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "disease outbreaks"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "harmful organisms"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "climate change"}, "marine debris": {"concepts": "marine debris", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "marine debris"}, "entanglement risk": {"concepts": "entanglement risk", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "entanglement risk"}, "habitat destruction": {"concepts": "habitat destruction", "type": "concept", "cluster": "Habitat Disruption", "node_size": 10, "label": "habitat destruction"}, "connectivity disruption": {"concepts": "connectivity disruption", "type": "concept", "cluster": "Habitat Disruption", "node_size": 10, "label": "connectivity disruption"}, "productivity": {"concepts": "productivity", "type": "concept", "cluster": "Species Productivity", "node_size": 10, "label": "productivity"}, "species resilience": {"concepts": "species resilience", "type": "concept", "cluster": "Species Productivity", "node_size": 10, "label": "species resilience"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "biodiversity"}, "ecosystem functioning": {"concepts": "ecosystem functioning", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem functioning"}, "ecosystem function": {"concepts": "ecosystem function", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem function"}, "ecosystem maintenance": {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem maintenance"}, "regime shifts": {"concepts": "regime shifts", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "regime shifts"}, "population consequences": {"concepts": "population consequences", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "population consequences"}, "mate finding": {"concepts": "mate finding", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "mate finding"}, "species conservation": {"concepts": "species conservation", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "species conservation"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "conservation concern"}, "fishery ecosystem plans": {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "fishery ecosystem plans"}, "extinction risk": {"concepts": "extinction risk", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "extinction risk"}, "categorical weights": {"concepts": "categorical weights", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "categorical weights"}, "weights": {"concepts": "weights", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "weights"}, "weighting adjustments": {"concepts": "weighting adjustments", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "weighting adjustments"}, "bioenergetics": {"concepts": "bioenergetics", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "bioenergetics"}, "over utilization": {"concepts": "over utilization", "type": "concept", "cluster": "Resource Overuse", "node_size": 10, "label": "over utilization"}, "historical utilization": {"concepts": "historical utilization", "type": "concept", "cluster": "Resource Overuse", "node_size": 10, "label": "historical utilization"}, "interagency coordination": {"concepts": "interagency coordination", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "interagency coordination"}, "overutilization": {"concepts": "overutilization", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "overutilization"}, "odds ratios": {"concepts": "odds ratios", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "odds ratios"}, "gear entanglement": {"concepts": "gear entanglement", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "gear entanglement"}};
        const interClusterEdges = [["management measures", "Management Response", {"weight": -0.4, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["management measures", "Ecosystem Health", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["adaptive management", "Conceptual Tools", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["adaptive management", "Management Response", {"weight": 0.3333333333333333, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["food web", "Species Distribution", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["food web", "Prey Availability", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["connectivity", "food web", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["connectivity", "Ecosystem Health", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["spawning aggregations", "Population Dynamics", {"weight": 0.8, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["spawning aggregations", "Weight Adjustments", {"weight": 0.6, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}], ["invasive species", "Species Distribution", {"weight": -0.5, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["invasive species", "Ecosystem Health", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["noise pollution", "management measures", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["noise pollution", "Multiple Stressors", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["noise pollution", "spawning aggregations", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Stakeholder Consultation", "Legal Frameworks", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "Management Response", {"weight": 0.2, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "Reproductive Health", {"weight": 0.8, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "noise pollution", {"weight": -0.6, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "invasive species", {"weight": -0.75, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "food web", {"weight": 0.3333333333333333, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "Prey Availability", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Legal Frameworks", "connectivity", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "Vessel Monitoring", {"weight": 1.0, "confidence": 0.7125, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "Management Coordination", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Conceptual Tools", "Predation Pressure", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Knowledge Assessment", "Species Distribution", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Knowledge Assessment", "Predation Pressure", {"weight": -0.4, "confidence": 0.5199999999999999, "type": "inter_cluster", "style": "solid"}], ["Vessel Monitoring", "Conservation Risks", {"weight": 0.5, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Reproductive Health", "food web", {"weight": 0.6, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Population Dynamics", "Habitat Disruption", {"weight": 0.8, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["Population Dynamics", "Prey Availability", {"weight": -0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Species Distribution", "Legal Frameworks", {"weight": 0.5, "confidence": 0.8250000000000001, "type": "inter_cluster", "style": "solid"}], ["Species Distribution", "Conservation Risks", {"weight": -0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Species Distribution", "connectivity", {"weight": 0.8, "confidence": 0.6300000000000001, "type": "inter_cluster", "style": "solid"}], ["Genetic Diversity", "connectivity", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Prey Availability", "Multiple Stressors", {"weight": -0.8, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["Predation Pressure", "invasive species", {"weight": -0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Multiple Stressors", "Reproductive Health", {"weight": -1.0, "confidence": 0.8875, "type": "inter_cluster", "style": "solid"}], ["Multiple Stressors", "Resource Overuse", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Multiple Stressors", "adaptive management", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Knowledge Assessment", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Legal Frameworks", {"weight": 0.75, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Prey Availability", {"weight": -1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Resource Overuse", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "management measures", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Habitat Disruption", "spawning aggregations", {"weight": -0.75, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Habitat Disruption", "Conservation Risks", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Habitat Disruption", "Legal Frameworks", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Species Productivity", "Species Distribution", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Species Productivity", "food web", {"weight": 1.0, "confidence": 0.7300000000000001, "type": "inter_cluster", "style": "solid"}], ["Species Productivity", "Ecosystem Health", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Species Productivity", {"weight": 0.75, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Conservation Risks", {"weight": -0.75, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "adaptive management", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Legal Frameworks", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Conservation Risks", "Knowledge Assessment", {"weight": 0.6, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["Conservation Risks", "Resource Overuse", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Conservation Risks", "Weight Adjustments", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Resource Overuse", "spawning aggregations", {"weight": -1.0, "confidence": 0.8875, "type": "inter_cluster", "style": "solid"}], ["Resource Overuse", "Species Distribution", {"weight": -1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Resource Overuse", "adaptive management", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Management Coordination", "Genetic Diversity", {"weight": -0.6, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Management Coordination", "Ecosystem Health", {"weight": -1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Stakeholder Consultation": [["jeopardy consultation", {"concepts": "jeopardy consultation", "type": "concept", "cluster": "Stakeholder Consultation", "node_size": 10, "label": "jeopardy consultation"}], ["collaboration", {"concepts": "collaboration", "type": "concept", "cluster": "Stakeholder Consultation", "node_size": 10, "label": "collaboration"}]], "Management Response": [["management inadequacy", {"concepts": "management inadequacy", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "management inadequacy"}], ["management actions", {"concepts": "management actions", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "management actions"}], ["recovery plans", {"concepts": "recovery plans", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "recovery plans"}], ["dynamic management", {"concepts": "dynamic management", "type": "concept", "cluster": "Management Response", "node_size": 10, "label": "dynamic management"}]], "Legal Frameworks": [["msa", {"concepts": "msa", "type": "concept", "cluster": "Legal Frameworks", "node_size": 10, "label": "msa"}], ["esa", {"concepts": "esa", "type": "concept", "cluster": "Legal Frameworks", "node_size": 10, "label": "esa"}]], "Regulatory Compliance": [["bycatch", {"concepts": "bycatch", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "bycatch"}], ["semi-quantitative", {"concepts": "semi-quantitative", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "semi-quantitative"}], ["system components", {"concepts": "system components", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "system components"}], ["qualitative assessment", {"concepts": "qualitative assessment", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "qualitative assessment"}], ["regulatory compliance", {"concepts": "regulatory compliance", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "regulatory compliance"}], ["mmpa", {"concepts": "mmpa", "type": "concept", "cluster": "Regulatory Compliance", "node_size": 10, "label": "mmpa"}]], "Conceptual Tools": [["conceptual model", {"concepts": "conceptual model", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "conceptual model"}], ["conceptual tool", {"concepts": "conceptual tool", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "conceptual tool"}], ["framework", {"concepts": "framework", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "framework"}], ["mental models", {"concepts": "mental models", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "mental models"}], ["semi-quantitative tool", {"concepts": "semi-quantitative tool", "type": "concept", "cluster": "Conceptual Tools", "node_size": 10, "label": "semi-quantitative tool"}]], "Knowledge Assessment": [["knowledge gaps", {"concepts": "knowledge gaps", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "knowledge gaps"}], ["listing factors", {"concepts": "listing factors", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "listing factors"}], ["threat assessment", {"concepts": "threat assessment", "type": "concept", "cluster": "Knowledge Assessment", "node_size": 10, "label": "threat assessment"}]], "Vessel Monitoring": [["vessel strikes", {"concepts": "vessel strikes", "type": "concept", "cluster": "Vessel Monitoring", "node_size": 10, "label": "vessel strikes"}], ["observer coverage", {"concepts": "observer coverage", "type": "concept", "cluster": "Vessel Monitoring", "node_size": 10, "label": "observer coverage"}]], "Reproductive Health": [["birth rates", {"concepts": "birth rates", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "birth rates"}], ["mortality rates", {"concepts": "mortality rates", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "mortality rates"}], ["reproductive success", {"concepts": "reproductive success", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive success"}], ["reproductive fitness", {"concepts": "reproductive fitness", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive fitness"}], ["reproductive output", {"concepts": "reproductive output", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproductive output"}], ["reproduction", {"concepts": "reproduction", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "reproduction"}], ["hormonal cycles", {"concepts": "hormonal cycles", "type": "concept", "cluster": "Reproductive Health", "node_size": 10, "label": "hormonal cycles"}]], "Population Dynamics": [["migration patterns", {"concepts": "migration patterns", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "migration patterns"}], ["reproductive thresholds", {"concepts": "reproductive thresholds", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "reproductive thresholds"}], ["temperature tolerance", {"concepts": "temperature tolerance", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "temperature tolerance"}], ["fishing pressure", {"concepts": "fishing pressure", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "fishing pressure"}], ["predator removal", {"concepts": "predator removal", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "predator removal"}], ["habitat shifts", {"concepts": "habitat shifts", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "habitat shifts"}], ["parrotfish", {"concepts": "parrotfish", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "parrotfish"}], ["diversity", {"concepts": "diversity", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "diversity"}], ["regional composition", {"concepts": "regional composition", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "regional composition"}], ["cumulative effects", {"concepts": "cumulative effects", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "cumulative effects"}], ["recovery rates", {"concepts": "recovery rates", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "recovery rates"}], ["coral settlement", {"concepts": "coral settlement", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "coral settlement"}], ["confidence intervals", {"concepts": "confidence intervals", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "confidence intervals"}], ["habitat forming", {"concepts": "habitat forming", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "habitat forming"}], ["gear entanglements", {"concepts": "gear entanglements", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "gear entanglements"}], ["population resilience", {"concepts": "population resilience", "type": "concept", "cluster": "Population Dynamics", "node_size": 10, "label": "population resilience"}]], "Species Distribution": [["species abundance", {"concepts": "species abundance", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "species abundance"}], ["abundance", {"concepts": "abundance", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "abundance"}], ["species presence", {"concepts": "species presence", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "species presence"}], ["spatial distribution", {"concepts": "spatial distribution", "type": "concept", "cluster": "Species Distribution", "node_size": 10, "label": "spatial distribution"}]], "Genetic Diversity": [["genetic diversity", {"concepts": "genetic diversity", "type": "concept", "cluster": "Genetic Diversity", "node_size": 10, "label": "genetic diversity"}], ["gene flow", {"concepts": "gene flow", "type": "concept", "cluster": "Genetic Diversity", "node_size": 10, "label": "gene flow"}]], "Prey Availability": [["prey distribution", {"concepts": "prey distribution", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey distribution"}], ["prey abundance", {"concepts": "prey abundance", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey abundance"}], ["prey availability", {"concepts": "prey availability", "type": "concept", "cluster": "Prey Availability", "node_size": 10, "label": "prey availability"}]], "Predation Pressure": [["predation", {"concepts": "predation", "type": "concept", "cluster": "Predation Pressure", "node_size": 10, "label": "predation"}], ["predators", {"concepts": "predators", "type": "concept", "cluster": "Predation Pressure", "node_size": 10, "label": "predators"}]], "Multiple Stressors": [["multiple stressors", {"concepts": "multiple stressors", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "multiple stressors"}], ["stressors", {"concepts": "stressors", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "stressors"}], ["stress accumulation", {"concepts": "stress accumulation", "type": "concept", "cluster": "Multiple Stressors", "node_size": 10, "label": "stress accumulation"}]], "Marine Threats": [["oil spill impacts", {"concepts": "oil spill impacts", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "oil spill impacts"}], ["ship strikes", {"concepts": "ship strikes", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "ship strikes"}], ["disease outbreaks", {"concepts": "disease outbreaks", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "disease outbreaks"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "harmful organisms"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "climate change"}], ["marine debris", {"concepts": "marine debris", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "marine debris"}], ["entanglement risk", {"concepts": "entanglement risk", "type": "concept", "cluster": "Marine Threats", "node_size": 10, "label": "entanglement risk"}]], "Habitat Disruption": [["habitat destruction", {"concepts": "habitat destruction", "type": "concept", "cluster": "Habitat Disruption", "node_size": 10, "label": "habitat destruction"}], ["connectivity disruption", {"concepts": "connectivity disruption", "type": "concept", "cluster": "Habitat Disruption", "node_size": 10, "label": "connectivity disruption"}]], "Species Productivity": [["productivity", {"concepts": "productivity", "type": "concept", "cluster": "Species Productivity", "node_size": 10, "label": "productivity"}], ["species resilience", {"concepts": "species resilience", "type": "concept", "cluster": "Species Productivity", "node_size": 10, "label": "species resilience"}]], "Ecosystem Health": [["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "biodiversity"}], ["ecosystem functioning", {"concepts": "ecosystem functioning", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem functioning"}], ["ecosystem function", {"concepts": "ecosystem function", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem function"}], ["ecosystem maintenance", {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem maintenance"}]], "Conservation Risks": [["regime shifts", {"concepts": "regime shifts", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "regime shifts"}], ["population consequences", {"concepts": "population consequences", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "population consequences"}], ["mate finding", {"concepts": "mate finding", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "mate finding"}], ["species conservation", {"concepts": "species conservation", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "species conservation"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "conservation concern"}], ["fishery ecosystem plans", {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "fishery ecosystem plans"}], ["extinction risk", {"concepts": "extinction risk", "type": "concept", "cluster": "Conservation Risks", "node_size": 10, "label": "extinction risk"}]], "Weight Adjustments": [["categorical weights", {"concepts": "categorical weights", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "categorical weights"}], ["weights", {"concepts": "weights", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "weights"}], ["weighting adjustments", {"concepts": "weighting adjustments", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "weighting adjustments"}], ["bioenergetics", {"concepts": "bioenergetics", "type": "concept", "cluster": "Weight Adjustments", "node_size": 10, "label": "bioenergetics"}]], "Resource Overuse": [["over utilization", {"concepts": "over utilization", "type": "concept", "cluster": "Resource Overuse", "node_size": 10, "label": "over utilization"}], ["historical utilization", {"concepts": "historical utilization", "type": "concept", "cluster": "Resource Overuse", "node_size": 10, "label": "historical utilization"}]], "Management Coordination": [["interagency coordination", {"concepts": "interagency coordination", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "interagency coordination"}], ["overutilization", {"concepts": "overutilization", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "overutilization"}], ["odds ratios", {"concepts": "odds ratios", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "odds ratios"}], ["gear entanglement", {"concepts": "gear entanglement", "type": "concept", "cluster": "Management Coordination", "node_size": 10, "label": "gear entanglement"}]]};
        const clusterEdges = {"Stakeholder Consultation": [], "Management Response": [], "Legal Frameworks": [], "Regulatory Compliance": [], "Conceptual Tools": [], "Knowledge Assessment": [], "Vessel Monitoring": [], "Reproductive Health": [], "Population Dynamics": [], "Species Distribution": [], "Genetic Diversity": [], "Prey Availability": [], "Predation Pressure": [], "Multiple Stressors": [], "Marine Threats": [], "Habitat Disruption": [], "Species Productivity": [], "Ecosystem Health": [], "Conservation Risks": [], "Weight Adjustments": [], "Resource Overuse": [], "Management Coordination": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
