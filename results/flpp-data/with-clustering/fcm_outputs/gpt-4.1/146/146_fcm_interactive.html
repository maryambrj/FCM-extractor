
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Single Parent Income": {"concepts": "family dynamics, youth engagement, negative outcomes", "concept_list": ["family dynamics", "youth engagement", "negative outcomes"], "type": "cluster", "node_size": 24, "label": "Single Parent Income"}, "Economic Resources": {"concepts": "single parent households, income generation", "concept_list": ["single parent households", "income generation"], "type": "cluster", "node_size": 21, "label": "Economic Resources"}, "Market Dynamics": {"concepts": "societal effort, eggs, honey, after school jobs, funding, unemployed adults, coffee, social assistance, multiple jobs, resource allocation, grants, nonprofit organization, substantial revenue, culture, budget constraint, consumers, revenue, produce, retired age, retirement, coupons, replication, barriers", "concept_list": ["societal effort", "eggs", "honey", "after school jobs", "funding", "unemployed adults", "coffee", "social assistance", "multiple jobs", "resource allocation", "grants", "nonprofit organization", "substantial revenue", "culture", "budget constraint", "consumers", "revenue", "produce", "retired age", "retirement", "coupons", "replication", "barriers"], "type": "cluster", "node_size": 84, "label": "Market Dynamics"}, "Systemic Change Factors": {"concepts": "customer perception, marketplace, market management, business model, price comparison, business entities, niche market, market stability, marketing cooperative, customer base, market days, business decision, business choice, marketing, purchase inputs, leverage points, entrepreneurial businesses", "concept_list": ["customer perception", "marketplace", "market management", "business model", "price comparison", "business entities", "niche market", "market stability", "marketing cooperative", "customer base", "market days", "business decision", "business choice", "marketing", "purchase inputs", "leverage points", "entrepreneurial businesses"], "type": "cluster", "node_size": 66, "label": "Systemic Change Factors"}, "Family Youth Outcomes": {"concepts": "systematic change, bridge cards, sustainability, manage labor, middle income, poverty, young mothers, wic, meaningful change, production to sale, hand labor, michigan economy, research, transportation, working mothers, long hours, labor intensive, bridge card, family engagement, cultural determinants, grant funding, transportation access, small scale, childhood influences, philosophical perspective, neighborhoods, resource management, barbecue, affordability, nrcs, young moms, usda, labor intensity, hot pockets, behavior change, outcomes", "concept_list": ["systematic change", "bridge cards", "sustainability", "manage labor", "middle income", "poverty", "young mothers", "wic", "meaningful change", "production to sale", "hand labor", "michigan economy", "research", "transportation", "working mothers", "long hours", "labor intensive", "bridge card", "family engagement", "cultural determinants", "grant funding", "transportation access", "small scale", "childhood influences", "philosophical perspective", "neighborhoods", "resource management", "barbecue", "affordability", "nrcs", "young moms", "usda", "labor intensity", "hot pockets", "behavior change", "outcomes"], "type": "cluster", "node_size": 123, "label": "Family Youth Outcomes"}, "Health Policy": {"concepts": "healthcare costs, poor health, emergency sector, federal government, national healthcare system, physical fitness, national policy, health care, lobbying, quality of life, health behaviors, physical demands, lobbying agencies, lobbying actions, health influences", "concept_list": ["healthcare costs", "poor health", "emergency sector", "federal government", "national healthcare system", "physical fitness", "national policy", "health care", "lobbying", "quality of life", "health behaviors", "physical demands", "lobbying agencies", "lobbying actions", "health influences"], "type": "cluster", "node_size": 60, "label": "Health Policy"}, "Local Community": {"concepts": "flint community, detroit, michelle obama, trade journal, detroit pistons, flint genesee area, pizza rolls, cinnamon rolls, flint, common ingredients, snap benefits", "concept_list": ["flint community", "detroit", "michelle obama", "trade journal", "detroit pistons", "flint genesee area", "pizza rolls", "cinnamon rolls", "flint", "common ingredients", "snap benefits"], "type": "cluster", "node_size": 48, "label": "Local Community"}, "Food Access": {"concepts": "salad mix packaging, obesity, food access, high sugar beverages, frozen food, one pot meals, organic food, food availability, microwave meals, convenience foods, buying habits, cooking demonstrations, nutritional choice, food selection, sugary beverages, food preparation, grocery stores, healthy eating, food production, food outlets, food system values, eating habits, food education, food quality, stovetop cooking, red meat, frozen pasta, healthy foods, food utilization, organic production, food programs, healthy food choices, capuchin soup kitchen, food production models, nutritious lunch, food affordability, liquor store, nutrition education, frozen bread, food stamp benefits, baked potatoes, agricultural food policy, food price, food sources, beef producers, local food economy, pork producers, sugar cane producers, convenience stores, food source, food purchasing habits, productive food sources, food system, vegetable utilization, flint food system, raw fruit, nutritious food, local food production, food bank, healthy food, frozen section, food addiction, cooking skills, food choices, food policy, overweight youth, quality food, beet growers, meal preparation, raw vegetable, nutritional programs, local food, food, prepared foods, food science, organic produce, grocery store, processed foods, poor diet, meat", "concept_list": ["salad mix packaging", "obesity", "food access", "high sugar beverages", "frozen food", "one pot meals", "organic food", "food availability", "microwave meals", "convenience foods", "buying habits", "cooking demonstrations", "nutritional choice", "food selection", "sugary beverages", "food preparation", "grocery stores", "healthy eating", "food production", "food outlets", "food system values", "eating habits", "food education", "food quality", "stovetop cooking", "red meat", "frozen pasta", "healthy foods", "food utilization", "organic production", "food programs", "healthy food choices", "capuchin soup kitchen", "food production models", "nutritious lunch", "food affordability", "liquor store", "nutrition education", "frozen bread", "food stamp benefits", "baked potatoes", "agricultural food policy", "food price", "food sources", "beef producers", "local food economy", "pork producers", "sugar cane producers", "convenience stores", "food source", "food purchasing habits", "productive food sources", "food system", "vegetable utilization", "flint food system", "raw fruit", "nutritious food", "local food production", "food bank", "healthy food", "frozen section", "food addiction", "cooking skills", "food choices", "food policy", "overweight youth", "quality food", "beet growers", "meal preparation", "raw vegetable", "nutritional programs", "local food", "food", "prepared foods", "food science", "organic produce", "grocery store", "processed foods", "poor diet", "meat"], "type": "cluster", "node_size": 255, "label": "Food Access"}, "Community Support": {"concepts": "support network, community, staff, collaboration, support mechanisms, partnership, tv dinners", "concept_list": ["support network", "community", "staff", "collaboration", "support mechanisms", "partnership", "tv dinners"], "type": "cluster", "node_size": 36, "label": "Community Support"}, "School Nutrition": {"concepts": "school lunch trash, school lunch program, hands-on learning, education, school meals, school districts, training, school lawn, schools, sanilac county, students, student health, college students", "concept_list": ["school lunch trash", "school lunch program", "hands-on learning", "education", "school meals", "school districts", "training", "school lawn", "schools", "sanilac county", "students", "student health", "college students"], "type": "cluster", "node_size": 54, "label": "School Nutrition"}, "Economic Systems": {"concepts": "economic opportunities, social systems, social determinants, economic systems, home economics", "concept_list": ["economic opportunities", "social systems", "social determinants", "economic systems", "home economics"], "type": "cluster", "node_size": 30, "label": "Economic Systems"}, "Urban Agriculture": {"concepts": "flint farmers market, natural resources commission, hoop houses, industrial agriculture, farmers market, student growers, garden area, land availability, farmers markets, agriculture industry, abandoned hoop houses, rotational plantings, urban farming, abandoned lots, gardening, growers, agriculture, independent farmer, crop rotation, land base, earthworks, flint farmers' market", "concept_list": ["flint farmers market", "natural resources commission", "hoop houses", "industrial agriculture", "farmers market", "student growers", "garden area", "land availability", "farmers markets", "agriculture industry", "abandoned hoop houses", "rotational plantings", "urban farming", "abandoned lots", "gardening", "growers", "agriculture", "independent farmer", "crop rotation", "land base", "earthworks", "flint farmers' market"], "type": "cluster", "node_size": 81, "label": "Urban Agriculture"}, "Community Impact": {"concepts": "community empowerment, community impact, community benefits", "concept_list": ["community empowerment", "community impact", "community benefits"], "type": "cluster", "node_size": 24, "label": "Community Impact"}, "Partnerships & Clients": {"concepts": "partnerships, clientele", "concept_list": ["partnerships", "clientele"], "type": "cluster", "node_size": 21, "label": "Partnerships & Clients"}};
        const conceptData = {};
        const interClusterEdges = [["Single Parent Income", "Urban Agriculture", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Single Parent Income", "Community Support", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Single Parent Income", "Community Impact", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Economic Resources", "Food Access", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Economic Resources", "Community Support", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Market Dynamics", "Family Youth Outcomes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Market Dynamics", "Economic Systems", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Systemic Change Factors", "Community Impact", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Systemic Change Factors", "Family Youth Outcomes", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Systemic Change Factors", "Food Access", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Systemic Change Factors", "Community Support", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Systemic Change Factors", "Urban Agriculture", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Family Youth Outcomes", "Community Support", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Family Youth Outcomes", "Economic Resources", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Family Youth Outcomes", "Local Community", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Health Policy", "Local Community", {"weight": 0.5, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Health Policy", "School Nutrition", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Health Policy", "Partnerships & Clients", {"weight": -0.3333333333333333, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}], ["Local Community", "Market Dynamics", {"weight": 1.0, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Local Community", "Community Support", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Community", "Economic Systems", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Local Community", "Urban Agriculture", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Impact", {"weight": 0.8, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Family Youth Outcomes", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Support", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Urban Agriculture", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Economic Systems", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Food Access", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Partnerships & Clients", {"weight": 0.8, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Market Dynamics", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Community Support", "School Nutrition", {"weight": 0.3333333333333333, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Economic Systems", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["School Nutrition", "Community Impact", {"weight": 0.75, "confidence": 0.5874999999999999, "type": "inter_cluster", "style": "solid"}], ["School Nutrition", "Market Dynamics", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["School Nutrition", "Partnerships & Clients", {"weight": 0.6666666666666666, "confidence": 0.4333333333333333, "type": "inter_cluster", "style": "solid"}], ["School Nutrition", "Systemic Change Factors", {"weight": 0.6666666666666666, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Local Community", {"weight": 1.0, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Community Support", {"weight": 0.8, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Partnerships & Clients", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Economic Resources", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Health Policy", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Economic Systems", "Single Parent Income", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Systemic Change Factors", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Economic Systems", {"weight": 1.0, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Local Community", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Partnerships & Clients", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Food Access", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Urban Agriculture", {"weight": 0.6666666666666666, "confidence": 0.5666666666666668, "type": "inter_cluster", "style": "solid"}], ["Community Impact", "Family Youth Outcomes", {"weight": 0.5, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Partnerships & Clients", "Food Access", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Partnerships & Clients", "Community Support", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Single Parent Income": [], "Economic Resources": [], "Market Dynamics": [], "Systemic Change Factors": [], "Family Youth Outcomes": [], "Health Policy": [], "Local Community": [], "Food Access": [], "Community Support": [], "School Nutrition": [], "Economic Systems": [], "Urban Agriculture": [], "Community Impact": [], "Partnerships & Clients": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
