
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Marine Resource Users": {"concepts": "ecosystem services, conceptual models, maryland, community members, university of south alabama, phil levin, resource users, chesapeake bay, tribal community members, mental modeler, resource managers, dive instructor, ecotourism operators, workshop, conservation, tourism, trade-offs, smithsonian environmental research center, scenario simulations, steven scyphers, puget sound, social ecological dynamics, participatory modeling, mobile bay, biodiversity, case study, waterfront homeowners, white house, annapolis", "concept_list": ["ecosystem services", "conceptual models", "maryland", "community members", "university of south alabama", "phil levin", "resource users", "chesapeake bay", "tribal community members", "mental modeler", "resource managers", "dive instructor", "ecotourism operators", "workshop", "conservation", "tourism", "trade-offs", "smithsonian environmental research center", "scenario simulations", "steven scyphers", "puget sound", "social ecological dynamics", "participatory modeling", "mobile bay", "biodiversity", "case study", "waterfront homeowners", "white house", "annapolis"], "type": "cluster", "node_size": 102, "label": "Marine Resource Users"}, "Community Ecosystem Management": {"concepts": "marine biodiversity, oyster farmers, whale watching naturalists, living shorelines, charter fishermen, coastal biodiversity, recreational fishermen, us marine resource management, commercial fishermen, northern gulf of mexico", "concept_list": ["marine biodiversity", "oyster farmers", "whale watching naturalists", "living shorelines", "charter fishermen", "coastal biodiversity", "recreational fishermen", "us marine resource management", "commercial fishermen", "northern gulf of mexico"], "type": "cluster", "node_size": 45, "label": "Community Ecosystem Management"}};
        const conceptData = {"ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "ecosystem services"}, "conceptual models": {"concepts": "conceptual models", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "conceptual models"}, "maryland": {"concepts": "maryland", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "maryland"}, "community members": {"concepts": "community members", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "community members"}, "university of south alabama": {"concepts": "university of south alabama", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "university of south alabama"}, "phil levin": {"concepts": "phil levin", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "phil levin"}, "resource users": {"concepts": "resource users", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "resource users"}, "chesapeake bay": {"concepts": "chesapeake bay", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "chesapeake bay"}, "tribal community members": {"concepts": "tribal community members", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "tribal community members"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "mental modeler"}, "resource managers": {"concepts": "resource managers", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "resource managers"}, "dive instructor": {"concepts": "dive instructor", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "dive instructor"}, "ecotourism operators": {"concepts": "ecotourism operators", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "ecotourism operators"}, "workshop": {"concepts": "workshop", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "workshop"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "conservation"}, "tourism": {"concepts": "tourism", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "tourism"}, "trade-offs": {"concepts": "trade-offs", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "trade-offs"}, "smithsonian environmental research center": {"concepts": "smithsonian environmental research center", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "smithsonian environmental research center"}, "scenario simulations": {"concepts": "scenario simulations", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "scenario simulations"}, "steven scyphers": {"concepts": "steven scyphers", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "steven scyphers"}, "puget sound": {"concepts": "puget sound", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "puget sound"}, "social ecological dynamics": {"concepts": "social ecological dynamics", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "social ecological dynamics"}, "participatory modeling": {"concepts": "participatory modeling", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "participatory modeling"}, "mobile bay": {"concepts": "mobile bay", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "mobile bay"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "biodiversity"}, "case study": {"concepts": "case study", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "case study"}, "waterfront homeowners": {"concepts": "waterfront homeowners", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "waterfront homeowners"}, "white house": {"concepts": "white house", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "white house"}, "annapolis": {"concepts": "annapolis", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "annapolis"}, "marine biodiversity": {"concepts": "marine biodiversity", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "marine biodiversity"}, "oyster farmers": {"concepts": "oyster farmers", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "oyster farmers"}, "whale watching naturalists": {"concepts": "whale watching naturalists", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "whale watching naturalists"}, "living shorelines": {"concepts": "living shorelines", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "living shorelines"}, "charter fishermen": {"concepts": "charter fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "charter fishermen"}, "coastal biodiversity": {"concepts": "coastal biodiversity", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "coastal biodiversity"}, "recreational fishermen": {"concepts": "recreational fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "recreational fishermen"}, "us marine resource management": {"concepts": "us marine resource management", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "us marine resource management"}, "commercial fishermen": {"concepts": "commercial fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "commercial fishermen"}, "northern gulf of mexico": {"concepts": "northern gulf of mexico", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "northern gulf of mexico"}};
        const interClusterEdges = [["Community Ecosystem Management", "Marine Resource Users", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Marine Resource Users": [["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "ecosystem services"}], ["conceptual models", {"concepts": "conceptual models", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "conceptual models"}], ["maryland", {"concepts": "maryland", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "maryland"}], ["community members", {"concepts": "community members", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "community members"}], ["university of south alabama", {"concepts": "university of south alabama", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "university of south alabama"}], ["phil levin", {"concepts": "phil levin", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "phil levin"}], ["resource users", {"concepts": "resource users", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "resource users"}], ["chesapeake bay", {"concepts": "chesapeake bay", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "chesapeake bay"}], ["tribal community members", {"concepts": "tribal community members", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "tribal community members"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "mental modeler"}], ["resource managers", {"concepts": "resource managers", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "resource managers"}], ["dive instructor", {"concepts": "dive instructor", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "dive instructor"}], ["ecotourism operators", {"concepts": "ecotourism operators", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "ecotourism operators"}], ["workshop", {"concepts": "workshop", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "workshop"}], ["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "conservation"}], ["tourism", {"concepts": "tourism", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "tourism"}], ["trade-offs", {"concepts": "trade-offs", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "trade-offs"}], ["smithsonian environmental research center", {"concepts": "smithsonian environmental research center", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "smithsonian environmental research center"}], ["scenario simulations", {"concepts": "scenario simulations", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "scenario simulations"}], ["steven scyphers", {"concepts": "steven scyphers", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "steven scyphers"}], ["puget sound", {"concepts": "puget sound", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "puget sound"}], ["social ecological dynamics", {"concepts": "social ecological dynamics", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "social ecological dynamics"}], ["participatory modeling", {"concepts": "participatory modeling", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "participatory modeling"}], ["mobile bay", {"concepts": "mobile bay", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "mobile bay"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "biodiversity"}], ["case study", {"concepts": "case study", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "case study"}], ["waterfront homeowners", {"concepts": "waterfront homeowners", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "waterfront homeowners"}], ["white house", {"concepts": "white house", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "white house"}], ["annapolis", {"concepts": "annapolis", "type": "concept", "cluster": "Marine Resource Users", "node_size": 10, "label": "annapolis"}]], "Community Ecosystem Management": [["marine biodiversity", {"concepts": "marine biodiversity", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "marine biodiversity"}], ["oyster farmers", {"concepts": "oyster farmers", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "oyster farmers"}], ["whale watching naturalists", {"concepts": "whale watching naturalists", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "whale watching naturalists"}], ["living shorelines", {"concepts": "living shorelines", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "living shorelines"}], ["charter fishermen", {"concepts": "charter fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "charter fishermen"}], ["coastal biodiversity", {"concepts": "coastal biodiversity", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "coastal biodiversity"}], ["recreational fishermen", {"concepts": "recreational fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "recreational fishermen"}], ["us marine resource management", {"concepts": "us marine resource management", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "us marine resource management"}], ["commercial fishermen", {"concepts": "commercial fishermen", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "commercial fishermen"}], ["northern gulf of mexico", {"concepts": "northern gulf of mexico", "type": "concept", "cluster": "Community Ecosystem Management", "node_size": 10, "label": "northern gulf of mexico"}]]};
        const clusterEdges = {"Marine Resource Users": [], "Community Ecosystem Management": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
