
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"fishermen": {"concepts": "fishermen, aquaculture, dredging, model, social media, stakeholders, workshop, species targets, fish behavior, environmental groups, captain bobby, mental modeling, legislation issues, seminars", "concept_list": ["fishermen", "aquaculture", "dredging", "model", "social media", "stakeholders", "workshop", "species targets", "fish behavior", "environmental groups", "captain bobby", "mental modeling", "legislation issues", "seminars"], "type": "cluster", "node_size": 57, "label": "fishermen"}, "breakwaters": {"concepts": "breakwaters", "concept_list": ["breakwaters"], "type": "cluster", "node_size": 18, "label": "breakwaters"}, "Marine Habitats": {"concepts": "boat cost, licensing costs, fuel, license cost, fishing business, licensing, inflation, federal permit, economy, stimulus, positive impact, negative impact, fishery impact, regulatory impact, honorarium, tourism, ecotourists, fishing guide, influencers, local favorite, marine activities, marine resource, ship traffic, boat traffic, fishing effort, fishery pressure, shrimping, shrimp fishery, gill netting, fishing regulations, regulations, penalties, law enforcement, enforcement disparity, vessel monitoring, fisheries management", "concept_list": ["boat cost", "licensing costs", "fuel", "license cost", "fishing business", "licensing", "inflation", "federal permit", "economy", "stimulus", "positive impact", "negative impact", "fishery impact", "regulatory impact", "honorarium", "tourism", "ecotourists", "fishing guide", "influencers", "local favorite", "marine activities", "marine resource", "ship traffic", "boat traffic", "fishing effort", "fishery pressure", "shrimping", "shrimp fishery", "gill netting", "fishing regulations", "regulations", "penalties", "law enforcement", "enforcement disparity", "vessel monitoring", "fisheries management"], "type": "cluster", "node_size": 123, "label": "Marine Habitats"}, "Climate & Weather": {"concepts": "habitats, limestone reefs, structured bottom, bottom types, habitat depletion, oyster shells, habitat types, coastal biodiversity, marine biodiversity, biodiversity, species", "concept_list": ["habitats", "limestone reefs", "structured bottom", "bottom types", "habitat depletion", "oyster shells", "habitat types", "coastal biodiversity", "marine biodiversity", "biodiversity", "species"], "type": "cluster", "node_size": 48, "label": "Climate & Weather"}, "Aquaculture & Stakeholders": {"concepts": "climate change, hurricanes, weather, storms, tropicalization, erosion", "concept_list": ["climate change", "hurricanes", "weather", "storms", "tropicalization", "erosion"], "type": "cluster", "node_size": 33, "label": "Aquaculture & Stakeholders"}, "Fishing & Regulation": {"concepts": "industrial runoff, freshwater runoff, marsh flow, construction runoff, sewage runoff", "concept_list": ["industrial runoff", "freshwater runoff", "marsh flow", "construction runoff", "sewage runoff"], "type": "cluster", "node_size": 30, "label": "Fishing & Regulation"}};
        const conceptData = {"aquaculture": {"concepts": "aquaculture", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "aquaculture"}, "dredging": {"concepts": "dredging", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "dredging"}, "model": {"concepts": "model", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "model"}, "social media": {"concepts": "social media", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "social media"}, "stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "stakeholders"}, "workshop": {"concepts": "workshop", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "workshop"}, "species targets": {"concepts": "species targets", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "species targets"}, "fish behavior": {"concepts": "fish behavior", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "fish behavior"}, "environmental groups": {"concepts": "environmental groups", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "environmental groups"}, "captain bobby": {"concepts": "captain bobby", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "captain bobby"}, "mental modeling": {"concepts": "mental modeling", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "mental modeling"}, "legislation issues": {"concepts": "legislation issues", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "legislation issues"}, "seminars": {"concepts": "seminars", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "seminars"}, "boat cost": {"concepts": "boat cost", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "boat cost"}, "licensing costs": {"concepts": "licensing costs", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "licensing costs"}, "fuel": {"concepts": "fuel", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fuel"}, "license cost": {"concepts": "license cost", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "license cost"}, "fishing business": {"concepts": "fishing business", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing business"}, "licensing": {"concepts": "licensing", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "licensing"}, "inflation": {"concepts": "inflation", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "inflation"}, "federal permit": {"concepts": "federal permit", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "federal permit"}, "economy": {"concepts": "economy", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "economy"}, "stimulus": {"concepts": "stimulus", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "stimulus"}, "positive impact": {"concepts": "positive impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "positive impact"}, "negative impact": {"concepts": "negative impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "negative impact"}, "fishery impact": {"concepts": "fishery impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishery impact"}, "regulatory impact": {"concepts": "regulatory impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "regulatory impact"}, "honorarium": {"concepts": "honorarium", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "honorarium"}, "tourism": {"concepts": "tourism", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "tourism"}, "ecotourists": {"concepts": "ecotourists", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "ecotourists"}, "fishing guide": {"concepts": "fishing guide", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing guide"}, "influencers": {"concepts": "influencers", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "influencers"}, "local favorite": {"concepts": "local favorite", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "local favorite"}, "marine activities": {"concepts": "marine activities", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "marine activities"}, "marine resource": {"concepts": "marine resource", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "marine resource"}, "ship traffic": {"concepts": "ship traffic", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "ship traffic"}, "boat traffic": {"concepts": "boat traffic", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "boat traffic"}, "fishing effort": {"concepts": "fishing effort", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing effort"}, "fishery pressure": {"concepts": "fishery pressure", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishery pressure"}, "shrimping": {"concepts": "shrimping", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "shrimping"}, "shrimp fishery": {"concepts": "shrimp fishery", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "shrimp fishery"}, "gill netting": {"concepts": "gill netting", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "gill netting"}, "fishing regulations": {"concepts": "fishing regulations", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing regulations"}, "regulations": {"concepts": "regulations", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "regulations"}, "penalties": {"concepts": "penalties", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "penalties"}, "law enforcement": {"concepts": "law enforcement", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "law enforcement"}, "enforcement disparity": {"concepts": "enforcement disparity", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "enforcement disparity"}, "vessel monitoring": {"concepts": "vessel monitoring", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "vessel monitoring"}, "fisheries management": {"concepts": "fisheries management", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fisheries management"}, "habitats": {"concepts": "habitats", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitats"}, "limestone reefs": {"concepts": "limestone reefs", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "limestone reefs"}, "structured bottom": {"concepts": "structured bottom", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "structured bottom"}, "bottom types": {"concepts": "bottom types", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "bottom types"}, "habitat depletion": {"concepts": "habitat depletion", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitat depletion"}, "oyster shells": {"concepts": "oyster shells", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "oyster shells"}, "habitat types": {"concepts": "habitat types", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitat types"}, "coastal biodiversity": {"concepts": "coastal biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "coastal biodiversity"}, "marine biodiversity": {"concepts": "marine biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "marine biodiversity"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "biodiversity"}, "species": {"concepts": "species", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "species"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "climate change"}, "hurricanes": {"concepts": "hurricanes", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "hurricanes"}, "weather": {"concepts": "weather", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "weather"}, "storms": {"concepts": "storms", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "storms"}, "tropicalization": {"concepts": "tropicalization", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "tropicalization"}, "erosion": {"concepts": "erosion", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "erosion"}, "industrial runoff": {"concepts": "industrial runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "industrial runoff"}, "freshwater runoff": {"concepts": "freshwater runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "freshwater runoff"}, "marsh flow": {"concepts": "marsh flow", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "marsh flow"}, "construction runoff": {"concepts": "construction runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "construction runoff"}, "sewage runoff": {"concepts": "sewage runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "sewage runoff"}};
        const interClusterEdges = [["fishermen", "Marine Habitats", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["fishermen", "Climate & Weather", {"weight": -0.6, "confidence": 0.26, "type": "inter_cluster", "style": "solid"}], ["breakwaters", "Climate & Weather", {"weight": 1.0, "confidence": 0.8800000000000001, "type": "inter_cluster", "style": "solid"}], ["breakwaters", "Marine Habitats", {"weight": 0.6, "confidence": 0.41, "type": "inter_cluster", "style": "solid"}], ["Marine Habitats", "Fishing & Regulation", {"weight": -0.2, "confidence": 0.12, "type": "inter_cluster", "style": "solid"}], ["Marine Habitats", "Aquaculture & Stakeholders", {"weight": -0.2, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Marine Habitats", "fishermen", {"weight": -0.2, "confidence": 0.08, "type": "inter_cluster", "style": "solid"}], ["Marine Habitats", "breakwaters", {"weight": 0.2, "confidence": 0.08, "type": "inter_cluster", "style": "solid"}], ["Climate & Weather", "Marine Habitats", {"weight": 0.6, "confidence": 0.29000000000000004, "type": "inter_cluster", "style": "solid"}], ["Climate & Weather", "fishermen", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Climate & Weather", "Aquaculture & Stakeholders", {"weight": -0.25, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Aquaculture & Stakeholders", "Climate & Weather", {"weight": -0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Aquaculture & Stakeholders", "Marine Habitats", {"weight": -0.75, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Aquaculture & Stakeholders", "fishermen", {"weight": -0.3333333333333333, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Fishing & Regulation", "Climate & Weather", {"weight": -1.0, "confidence": 0.9099999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishing & Regulation", "Marine Habitats", {"weight": -0.6, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"fishermen": [["aquaculture", {"concepts": "aquaculture", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "aquaculture"}], ["dredging", {"concepts": "dredging", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "dredging"}], ["model", {"concepts": "model", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "model"}], ["social media", {"concepts": "social media", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "social media"}], ["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "stakeholders"}], ["workshop", {"concepts": "workshop", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "workshop"}], ["species targets", {"concepts": "species targets", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "species targets"}], ["fish behavior", {"concepts": "fish behavior", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "fish behavior"}], ["environmental groups", {"concepts": "environmental groups", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "environmental groups"}], ["captain bobby", {"concepts": "captain bobby", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "captain bobby"}], ["mental modeling", {"concepts": "mental modeling", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "mental modeling"}], ["legislation issues", {"concepts": "legislation issues", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "legislation issues"}], ["seminars", {"concepts": "seminars", "type": "concept", "cluster": "fishermen", "node_size": 10, "label": "seminars"}]], "Marine Habitats": [["boat cost", {"concepts": "boat cost", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "boat cost"}], ["licensing costs", {"concepts": "licensing costs", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "licensing costs"}], ["fuel", {"concepts": "fuel", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fuel"}], ["license cost", {"concepts": "license cost", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "license cost"}], ["fishing business", {"concepts": "fishing business", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing business"}], ["licensing", {"concepts": "licensing", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "licensing"}], ["inflation", {"concepts": "inflation", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "inflation"}], ["federal permit", {"concepts": "federal permit", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "federal permit"}], ["economy", {"concepts": "economy", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "economy"}], ["stimulus", {"concepts": "stimulus", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "stimulus"}], ["positive impact", {"concepts": "positive impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "positive impact"}], ["negative impact", {"concepts": "negative impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "negative impact"}], ["fishery impact", {"concepts": "fishery impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishery impact"}], ["regulatory impact", {"concepts": "regulatory impact", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "regulatory impact"}], ["honorarium", {"concepts": "honorarium", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "honorarium"}], ["tourism", {"concepts": "tourism", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "tourism"}], ["ecotourists", {"concepts": "ecotourists", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "ecotourists"}], ["fishing guide", {"concepts": "fishing guide", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing guide"}], ["influencers", {"concepts": "influencers", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "influencers"}], ["local favorite", {"concepts": "local favorite", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "local favorite"}], ["marine activities", {"concepts": "marine activities", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "marine activities"}], ["marine resource", {"concepts": "marine resource", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "marine resource"}], ["ship traffic", {"concepts": "ship traffic", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "ship traffic"}], ["boat traffic", {"concepts": "boat traffic", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "boat traffic"}], ["fishing effort", {"concepts": "fishing effort", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing effort"}], ["fishery pressure", {"concepts": "fishery pressure", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishery pressure"}], ["shrimping", {"concepts": "shrimping", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "shrimping"}], ["shrimp fishery", {"concepts": "shrimp fishery", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "shrimp fishery"}], ["gill netting", {"concepts": "gill netting", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "gill netting"}], ["fishing regulations", {"concepts": "fishing regulations", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fishing regulations"}], ["regulations", {"concepts": "regulations", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "regulations"}], ["penalties", {"concepts": "penalties", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "penalties"}], ["law enforcement", {"concepts": "law enforcement", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "law enforcement"}], ["enforcement disparity", {"concepts": "enforcement disparity", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "enforcement disparity"}], ["vessel monitoring", {"concepts": "vessel monitoring", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "vessel monitoring"}], ["fisheries management", {"concepts": "fisheries management", "type": "concept", "cluster": "Marine Habitats", "node_size": 10, "label": "fisheries management"}]], "Climate & Weather": [["habitats", {"concepts": "habitats", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitats"}], ["limestone reefs", {"concepts": "limestone reefs", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "limestone reefs"}], ["structured bottom", {"concepts": "structured bottom", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "structured bottom"}], ["bottom types", {"concepts": "bottom types", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "bottom types"}], ["habitat depletion", {"concepts": "habitat depletion", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitat depletion"}], ["oyster shells", {"concepts": "oyster shells", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "oyster shells"}], ["habitat types", {"concepts": "habitat types", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "habitat types"}], ["coastal biodiversity", {"concepts": "coastal biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "coastal biodiversity"}], ["marine biodiversity", {"concepts": "marine biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "marine biodiversity"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "biodiversity"}], ["species", {"concepts": "species", "type": "concept", "cluster": "Climate & Weather", "node_size": 10, "label": "species"}]], "Aquaculture & Stakeholders": [["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "climate change"}], ["hurricanes", {"concepts": "hurricanes", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "hurricanes"}], ["weather", {"concepts": "weather", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "weather"}], ["storms", {"concepts": "storms", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "storms"}], ["tropicalization", {"concepts": "tropicalization", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "tropicalization"}], ["erosion", {"concepts": "erosion", "type": "concept", "cluster": "Aquaculture & Stakeholders", "node_size": 10, "label": "erosion"}]], "Fishing & Regulation": [["industrial runoff", {"concepts": "industrial runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "industrial runoff"}], ["freshwater runoff", {"concepts": "freshwater runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "freshwater runoff"}], ["marsh flow", {"concepts": "marsh flow", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "marsh flow"}], ["construction runoff", {"concepts": "construction runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "construction runoff"}], ["sewage runoff", {"concepts": "sewage runoff", "type": "concept", "cluster": "Fishing & Regulation", "node_size": 10, "label": "sewage runoff"}]]};
        const clusterEdges = {"fishermen": [], "Marine Habitats": [], "Climate & Weather": [], "Aquaculture & Stakeholders": [], "Fishing & Regulation": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
