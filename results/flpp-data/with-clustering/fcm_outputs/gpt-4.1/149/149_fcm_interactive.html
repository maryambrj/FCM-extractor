
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"landfill": {"concepts": "landfill", "concept_list": ["landfill"], "type": "cluster", "node_size": 18, "label": "landfill"}, "Organic Waste Processing": {"concepts": "compost awareness, international compost awareness week, composters, composter", "concept_list": ["compost awareness", "international compost awareness week", "composters", "composter"], "type": "cluster", "node_size": 27, "label": "Organic Waste Processing"}, "Organics Recycling": {"concepts": "anaerobic digester, recycled organics, feedstock, compost site", "concept_list": ["anaerobic digester", "recycled organics", "feedstock", "compost site"], "type": "cluster", "node_size": 27, "label": "Organics Recycling"}, "Community Engagement": {"concepts": "composting, aquaculture, organics recycling", "concept_list": ["composting", "aquaculture", "organics recycling"], "type": "cluster", "node_size": 24, "label": "Community Engagement"}, "Local Agriculture": {"concepts": "accessibility, community potential, community health, change potential, cultural values, knowledge sharing, community support, community empowerment, genesee county, community knowledge, flint residents, community groups, organizational collaboration, arab community, social connections, inclusivity, common good, latinx community, local understanding, empowerment, community, building community, organizational silos, community change, community resilience, community resources, community diversity, values, dignity, cultural diversity, stakeholder engagement, resident participation, collaboration, community partnerships, community values, trust, community engagement", "concept_list": ["accessibility", "community potential", "community health", "change potential", "cultural values", "knowledge sharing", "community support", "community empowerment", "genesee county", "community knowledge", "flint residents", "community groups", "organizational collaboration", "arab community", "social connections", "inclusivity", "common good", "latinx community", "local understanding", "empowerment", "community", "building community", "organizational silos", "community change", "community resilience", "community resources", "community diversity", "values", "dignity", "cultural diversity", "stakeholder engagement", "resident participation", "collaboration", "community partnerships", "community values", "trust", "community engagement"], "type": "cluster", "node_size": 126, "label": "Local Agriculture"}, "Compost Awareness": {"concepts": "national agriculture, michigan produce, farming, produce section, resource management, seeds, partnerships, farmers, agriculture, edible flint, local economy, farmers market, local sourcing, produce sourcing, washington apples, organizations, sectors, economic drivers, local markets, markets, soil, meijer, local ingredients, michigan grown, harvest loss, local infrastructure, flint fresh, michigan apples, local economic development, local agriculture, midwest, garden kits, local production, local partnerships, local vendors, global agriculture, national sourcing, produce, local sources, overproduction, economic impact, soil management, seasonal produce", "concept_list": ["national agriculture", "michigan produce", "farming", "produce section", "resource management", "seeds", "partnerships", "farmers", "agriculture", "edible flint", "local economy", "farmers market", "local sourcing", "produce sourcing", "washington apples", "organizations", "sectors", "economic drivers", "local markets", "markets", "soil", "meijer", "local ingredients", "michigan grown", "harvest loss", "local infrastructure", "flint fresh", "michigan apples", "local economic development", "local agriculture", "midwest", "garden kits", "local production", "local partnerships", "local vendors", "global agriculture", "national sourcing", "produce", "local sources", "overproduction", "economic impact", "soil management", "seasonal produce"], "type": "cluster", "node_size": 144, "label": "Compost Awareness"}, "Community Health Systems": {"concepts": "community health, positive outcomes, healthy options, system improvement, braiding sweetgrass, health outcomes, process management, healthier options, walking, mta, bike riding, public transit, organizational learning, silos, market demand, infrastructure development, resources, hyperlocal process, seasonality, problem solving, personal impact, covid, health initiatives, mandates, comfort, parking, mandate, organizational change, budgets, access, foot transportation, transportation, public health, quality of life, party store, covid-19, affordability, education, availability, leadership, vouchers, system change, system barriers, healthy initiatives, health", "concept_list": ["community health", "positive outcomes", "healthy options", "system improvement", "braiding sweetgrass", "health outcomes", "process management", "healthier options", "walking", "mta", "bike riding", "public transit", "organizational learning", "silos", "market demand", "infrastructure development", "resources", "hyperlocal process", "seasonality", "problem solving", "personal impact", "covid", "health initiatives", "mandates", "comfort", "parking", "mandate", "organizational change", "budgets", "access", "foot transportation", "transportation", "public health", "quality of life", "party store", "covid-19", "affordability", "education", "availability", "leadership", "vouchers", "system change", "system barriers", "healthy initiatives", "health"], "type": "cluster", "node_size": 150, "label": "Community Health Systems"}, "Systemic Challenges": {"concepts": "system challenges, dating system, resource capture, system management, local mandates, critical pillars, botany education, resellers, social connections, educational initiatives, contracts, system transformation, generational change, stakeholder knowledge, communication, seed distribution, united states local, organizational silos, product quality, plant identification, flint, transplants, mission statement, research, leverage points, respect for land, environmental impact, production, system mapping, infrastructure, resource allocation, united states, market access, classroom activities, land connection, circular economy, material recovery, system connections", "concept_list": ["system challenges", "dating system", "resource capture", "system management", "local mandates", "critical pillars", "botany education", "resellers", "social connections", "educational initiatives", "contracts", "system transformation", "generational change", "stakeholder knowledge", "communication", "seed distribution", "united states local", "organizational silos", "product quality", "plant identification", "flint", "transplants", "mission statement", "research", "leverage points", "respect for land", "environmental impact", "production", "system mapping", "infrastructure", "resource allocation", "united states", "market access", "classroom activities", "land connection", "circular economy", "material recovery", "system connections"], "type": "cluster", "node_size": 129, "label": "Systemic Challenges"}, "Collaborative Resource Management": {"concepts": "citywide collaboration, finite resources, soil health, michigan farmers market association, safety", "concept_list": ["citywide collaboration", "finite resources", "soil health", "michigan farmers market association", "safety"], "type": "cluster", "node_size": 30, "label": "Collaborative Resource Management"}, "Food System Development": {"concepts": "food system leverage, food system, food literacy, food knowledge, food system partnerships, food system infrastructure, food understanding, food system growth, local food systems, food model, food hub, food system values, food system opportunities, food systems, food system change", "concept_list": ["food system leverage", "food system", "food literacy", "food knowledge", "food system partnerships", "food system infrastructure", "food understanding", "food system growth", "local food systems", "food model", "food hub", "food system values", "food system opportunities", "food systems", "food system change"], "type": "cluster", "node_size": 60, "label": "Food System Development"}, "Local Food Economy": {"concepts": "food cycle, locally grown food, food utilization, food recovery, food production, food resources, food usage, local food, food economy, food mandates, grocery stores, food cost, local restaurants, food distribution, local foods, food system infrastructure, food buyers, food availability, food options, local food production, food spoilage prevention, secondary food, local food economy, food origin", "concept_list": ["food cycle", "locally grown food", "food utilization", "food recovery", "food production", "food resources", "food usage", "local food", "food economy", "food mandates", "grocery stores", "food cost", "local restaurants", "food distribution", "local foods", "food system infrastructure", "food buyers", "food availability", "food options", "local food production", "food spoilage prevention", "secondary food", "local food economy", "food origin"], "type": "cluster", "node_size": 87, "label": "Local Food Economy"}, "Nutrition Access": {"concepts": "food value, nutrition value, nutrition outcomes, nutritious foods, food choices, cultural foods, food vouchers, food spoilage, food equity, modalities of transport, nutritious food, food security, food quality, food education, nutrition impact, food access, food preparation", "concept_list": ["food value", "nutrition value", "nutrition outcomes", "nutritious foods", "food choices", "cultural foods", "food vouchers", "food spoilage", "food equity", "modalities of transport", "nutritious food", "food security", "food quality", "food education", "nutrition impact", "food access", "food preparation"], "type": "cluster", "node_size": 66, "label": "Nutrition Access"}, "Food Spoilage": {"concepts": "food spoilage, food bank, spoilage, food spoilage prevention", "concept_list": ["food spoilage", "food bank", "spoilage", "food spoilage prevention"], "type": "cluster", "node_size": 27, "label": "Food Spoilage"}, "Food Distribution": {"concepts": "chain restaurants, food partnerships, hierarchy of food, fast food, nutrition, shipping system, convenience stores", "concept_list": ["chain restaurants", "food partnerships", "hierarchy of food", "fast food", "nutrition", "shipping system", "convenience stores"], "type": "cluster", "node_size": 36, "label": "Food Distribution"}, "Food Waste": {"concepts": "food waste, wasted food, food waste hierarchy, waste model", "concept_list": ["food waste", "wasted food", "food waste hierarchy", "waste model"], "type": "cluster", "node_size": 27, "label": "Food Waste"}, "Waste Hierarchy": {"concepts": "waste hierarchy, gas station", "concept_list": ["waste hierarchy", "gas station"], "type": "cluster", "node_size": 21, "label": "Waste Hierarchy"}};
        const conceptData = {};
        const interClusterEdges = [["landfill", "Nutrition Access", {"weight": -1.0, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["landfill", "Food Spoilage", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["landfill", "Waste Hierarchy", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Organic Waste Processing", "Food Spoilage", {"weight": 0.5, "confidence": 0.7875000000000001, "type": "inter_cluster", "style": "solid"}], ["Organic Waste Processing", "Local Agriculture", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Organic Waste Processing", "Community Engagement", {"weight": 1.0, "confidence": 0.95, "type": "inter_cluster", "style": "solid"}], ["Organics Recycling", "Food Waste", {"weight": -0.5, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Organics Recycling", "Collaborative Resource Management", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Organics Recycling", "Waste Hierarchy", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Organics Recycling", "Compost Awareness", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Organics Recycling", "Food Distribution", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food Waste", {"weight": -1.0, "confidence": 0.95, "type": "inter_cluster", "style": "solid"}], ["Local Agriculture", "Organic Waste Processing", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Agriculture", "Food Distribution", {"weight": -1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Local Agriculture", "Collaborative Resource Management", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Compost Awareness", "Community Health Systems", {"weight": 1.0, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Compost Awareness", "Local Agriculture", {"weight": 1.0, "confidence": 0.7875, "type": "inter_cluster", "style": "solid"}], ["Compost Awareness", "Organic Waste Processing", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community Health Systems", "Nutrition Access", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Health Systems", "Food System Development", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Community Health Systems", "Community Engagement", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Systemic Challenges", "Food Waste", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Collaborative Resource Management", "Community Health Systems", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Collaborative Resource Management", "Food Distribution", {"weight": -1.0, "confidence": 0.6375000000000001, "type": "inter_cluster", "style": "solid"}], ["Collaborative Resource Management", "Waste Hierarchy", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Collaborative Resource Management", "Food Waste", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food System Development", "Food Waste", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food System Development", "Systemic Challenges", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Food System Development", "Community Engagement", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Food System Development", "Organic Waste Processing", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Local Agriculture", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Food Waste", {"weight": -1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Community Engagement", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Food Distribution", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Nutrition Access", "Food System Development", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Nutrition Access", "Food Waste", {"weight": -1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Food Spoilage", "Food Distribution", {"weight": 0.3333333333333333, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Spoilage", "Food System Development", {"weight": -1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Food Distribution", "landfill", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Food Distribution", "Local Food Economy", {"weight": -1.0, "confidence": 0.7833333333333332, "type": "inter_cluster", "style": "solid"}], ["Food Distribution", "Systemic Challenges", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Food Waste", "Food Spoilage", {"weight": 0.5, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Food Waste", "Food Distribution", {"weight": 0.5, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Food Waste", "Nutrition Access", {"weight": -1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Waste", "Organics Recycling", {"weight": 1.0, "confidence": 0.925, "type": "inter_cluster", "style": "solid"}], ["Waste Hierarchy", "Compost Awareness", {"weight": -0.3333333333333333, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Waste Hierarchy", "Community Health Systems", {"weight": -0.3333333333333333, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Waste Hierarchy", "Collaborative Resource Management", {"weight": -0.3333333333333333, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Organic Waste Processing": [], "Organics Recycling": [], "Community Engagement": [], "Local Agriculture": [], "Compost Awareness": [], "Community Health Systems": [], "Systemic Challenges": [], "Collaborative Resource Management": [], "Food System Development": [], "Local Food Economy": [], "Nutrition Access": [], "Food Spoilage": [], "Food Distribution": [], "Food Waste": [], "Waste Hierarchy": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
