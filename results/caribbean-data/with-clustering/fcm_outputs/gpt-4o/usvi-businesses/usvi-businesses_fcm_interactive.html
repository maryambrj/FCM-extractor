
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Colorful Fish": {"concepts": "dolphin, manpower, square grouper, degrees, rum factory, congresswoman, vacancies, diving, hurricane hugo, community relationships, fertilizers, flare gun, tuna, global climate, dpnr, relationship, population, eez, species, virgin island laws, sahara dust, gillnets, conch population, cultural changes, noah, science, livelihoods, management people, lobster, director, conflicts, st. thomas, decision makers, global challenges, usvi, local government, buck island monument, water temperature, supermarkets, st. john's, drug testing, pulse, testing, customers, cozumel, tourism protection, conch closure, us territory, christmas dinner, biodegradable doors, tourism, federal government, livelihood, wahoo, directors, customer relationships, dive boat, magnuson-stevens act, clinton, sting rays, collaborative, nature conservancy, gunshots, enforcement, climate change, board, grants, diving experience, lobsters, boat captains, local climate, drug trade, moratorium, refinery, tourists, moorings, white lobster, national park, education, federal laws, farmers, regulations, commissioner, decisions, crisis, researchers", "concept_list": ["dolphin", "manpower", "square grouper", "degrees", "rum factory", "congresswoman", "vacancies", "diving", "hurricane hugo", "community relationships", "fertilizers", "flare gun", "tuna", "global climate", "dpnr", "relationship", "population", "eez", "species", "virgin island laws", "sahara dust", "gillnets", "conch population", "cultural changes", "noah", "science", "livelihoods", "management people", "lobster", "director", "conflicts", "st. thomas", "decision makers", "global challenges", "usvi", "local government", "buck island monument", "water temperature", "supermarkets", "st. john's", "drug testing", "pulse", "testing", "customers", "cozumel", "tourism protection", "conch closure", "us territory", "christmas dinner", "biodegradable doors", "tourism", "federal government", "livelihood", "wahoo", "directors", "customer relationships", "dive boat", "magnuson-stevens act", "clinton", "sting rays", "collaborative", "nature conservancy", "gunshots", "enforcement", "climate change", "board", "grants", "diving experience", "lobsters", "boat captains", "local climate", "drug trade", "moratorium", "refinery", "tourists", "moorings", "white lobster", "national park", "education", "federal laws", "farmers", "regulations", "commissioner", "decisions", "crisis", "researchers"], "type": "cluster", "node_size": 273, "label": "Colorful Fish"}, "Fishing Industry": {"concepts": "parrotfish spawn, bluefish, cleaner fish, yellowtail snapper, parrotfish, overfishing, plate size fish, pelagic fish, colorful fish", "concept_list": ["parrotfish spawn", "bluefish", "cleaner fish", "yellowtail snapper", "parrotfish", "overfishing", "plate size fish", "pelagic fish", "colorful fish"], "type": "cluster", "node_size": 42, "label": "Fishing Industry"}, "Coral Ecosystems": {"concepts": "usvi fisheries, fisheries advisory, usvi fishers, fishermen livelihoods, fishers, lobster fisherman, fishery managers, fishers conflicts, commercial fishing, local fisher, fishing license, fishery management, fishermen", "concept_list": ["usvi fisheries", "fisheries advisory", "usvi fishers", "fishermen livelihoods", "fishers", "lobster fisherman", "fishery managers", "fishers conflicts", "commercial fishing", "local fisher", "fishing license", "fishery management", "fishermen"], "type": "cluster", "node_size": 54, "label": "Coral Ecosystems"}, "Marine Pollution": {"concepts": "coral reefs, reef pressure, sponges, turtle nesting areas, coastal communities, coral life, reef fishing, coral research, coral reef, turtles, coral head", "concept_list": ["coral reefs", "reef pressure", "sponges", "turtle nesting areas", "coastal communities", "coral life", "reef fishing", "coral research", "coral reef", "turtles", "coral head"], "type": "cluster", "node_size": 48, "label": "Marine Pollution"}, "Island Community Issues": {"concepts": "pollution, east end marine park, sewage pollution, director of fish and wildlife, algae growth, lionfish invasion, u.s coast guard, fish and wildlife", "concept_list": ["pollution", "east end marine park", "sewage pollution", "director of fish and wildlife", "algae growth", "lionfish invasion", "u.s coast guard", "fish and wildlife"], "type": "cluster", "node_size": 39, "label": "Island Community Issues"}};
        const conceptData = {};
        const interClusterEdges = [["Colorful Fish", "Marine Pollution", {"weight": -0.4, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Colorful Fish", "Fishing Industry", {"weight": -0.4, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Colorful Fish", "Island Community Issues", {"weight": -0.8, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Colorful Fish", "Coral Ecosystems", {"weight": -0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry", "Coral Ecosystems", {"weight": -1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry", "Marine Pollution", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry", "Colorful Fish", {"weight": -0.6, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry", "Island Community Issues", {"weight": -0.6, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Coral Ecosystems", "Fishing Industry", {"weight": -0.6, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Coral Ecosystems", "Marine Pollution", {"weight": 0.2, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Coral Ecosystems", "Island Community Issues", {"weight": -1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Coral Ecosystems", "Colorful Fish", {"weight": -0.6, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Marine Pollution", "Island Community Issues", {"weight": -1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Marine Pollution", "Fishing Industry", {"weight": -1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Marine Pollution", "Coral Ecosystems", {"weight": 0.6, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Marine Pollution", "Colorful Fish", {"weight": -0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Island Community Issues", "Marine Pollution", {"weight": -1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Island Community Issues", "Coral Ecosystems", {"weight": -1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Island Community Issues", "Fishing Industry", {"weight": -0.6, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Island Community Issues", "Colorful Fish", {"weight": -0.6, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Colorful Fish": [], "Fishing Industry": [], "Coral Ecosystems": [], "Marine Pollution": [], "Island Community Issues": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
