
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Food Systems": {"concepts": "management operations, food purchasing behavior, vegetables, food quality, seniors, customer education, chicken farm, community outcomes, cholesterol, fresh vegetables, obesity, organic foods, food equity, food safety, home cooked meals, food system values, changing norms, flint food system, fertilizers, food co op, food system connections, residential areas, cooking classes, fast food, sugar, connection strength, organizational partnerships, farmers markets, food sectors, menu prices, school system, home ownership, local farmers, diabetes, public transportation, nutritious foods, transportation, neighborhood, community, chain restaurants, food storage, processed food, covid-19, community gardens, snap, food retail management, children, community partnerships, food inventory, public health, competition, nutrition programs, food system, food system management, gardening, food availability, community engagement, education, transportation access, professional farmers, local vendors, member education, co-op, family wellbeing, food co-op, food environment, food accessibility, food policy, quality of life, foodborne illness, food production, leverage points, food affordability, curbside, organizational practices, exercise, nutrition, values, food security, local store, open lots, partnership, suburban access, food literacy, video games, food education, food values, food insecurity, food supply, resourceful food, food preparation, legal accountability, partnerships, food justice, food deserts, store accountability, customer service, affordability, food safety protocols, agriculture, urban gardening, condemned homes, natural foods, water crisis, health outcomes, food purchasing, accountability, urban agriculture, customer experience, food distribution centers, legal compliance, home deliveries, food quality perception, research project, wic, fruits, norms, price gouging, flint residents, agricultural education, land use, food options, food prices, food resources, food system drivers, community room, personal vehicle, distribution centers, food convenience, local restaurants, youth engagement, north flint food market, organizational size, urban food deserts, food sourcing, vegetable gardening, food access barriers, supplemental nutrition programs, community health, food distribution, parking lot maintenance, food standards, physical health, cultural pressures, youth education, food skills, food sector, food access, time constraints, land availability, price differences, heart disease, food safety standards, food retail, food supply chain", "concept_list": ["management operations", "food purchasing behavior", "vegetables", "food quality", "seniors", "customer education", "chicken farm", "community outcomes", "cholesterol", "fresh vegetables", "obesity", "organic foods", "food equity", "food safety", "home cooked meals", "food system values", "changing norms", "flint food system", "fertilizers", "food co op", "food system connections", "residential areas", "cooking classes", "fast food", "sugar", "connection strength", "organizational partnerships", "farmers markets", "food sectors", "menu prices", "school system", "home ownership", "local farmers", "diabetes", "public transportation", "nutritious foods", "transportation", "neighborhood", "community", "chain restaurants", "food storage", "processed food", "covid-19", "community gardens", "snap", "food retail management", "children", "community partnerships", "food inventory", "public health", "competition", "nutrition programs", "food system", "food system management", "gardening", "food availability", "community engagement", "education", "transportation access", "professional farmers", "local vendors", "member education", "co-op", "family wellbeing", "food co-op", "food environment", "food accessibility", "food policy", "quality of life", "foodborne illness", "food production", "leverage points", "food affordability", "curbside", "organizational practices", "exercise", "nutrition", "values", "food security", "local store", "open lots", "partnership", "suburban access", "food literacy", "video games", "food education", "food values", "food insecurity", "food supply", "resourceful food", "food preparation", "legal accountability", "partnerships", "food justice", "food deserts", "store accountability", "customer service", "affordability", "food safety protocols", "agriculture", "urban gardening", "condemned homes", "natural foods", "water crisis", "health outcomes", "food purchasing", "accountability", "urban agriculture", "customer experience", "food distribution centers", "legal compliance", "home deliveries", "food quality perception", "research project", "wic", "fruits", "norms", "price gouging", "flint residents", "agricultural education", "land use", "food options", "food prices", "food resources", "food system drivers", "community room", "personal vehicle", "distribution centers", "food convenience", "local restaurants", "youth engagement", "north flint food market", "organizational size", "urban food deserts", "food sourcing", "vegetable gardening", "food access barriers", "supplemental nutrition programs", "community health", "food distribution", "parking lot maintenance", "food standards", "physical health", "cultural pressures", "youth education", "food skills", "food sector", "food access", "time constraints", "land availability", "price differences", "heart disease", "food safety standards", "food retail", "food supply chain"], "type": "cluster", "node_size": 480, "label": "Community Food Systems"}, "Grocery Store Access": {"concepts": "mom and pop stores, grocery store closures, big box stores, grocery store, store management, convenience stores, grocery stores, supermarket box stores, box stores, store cleanliness, store accessibility, store location", "concept_list": ["mom and pop stores", "grocery store closures", "big box stores", "grocery store", "store management", "convenience stores", "grocery stores", "supermarket box stores", "box stores", "store cleanliness", "store accessibility", "store location"], "type": "cluster", "node_size": 51, "label": "Grocery Store Access"}, "Retail Sector Dynamics": {"concepts": "retail sectors, retail competition, retail use, merchandise, retail affordability, retail management, retail types", "concept_list": ["retail sectors", "retail competition", "retail use", "merchandise", "retail affordability", "retail management", "retail types"], "type": "cluster", "node_size": 36, "label": "Retail Sector Dynamics"}};
        const conceptData = {};
        const interClusterEdges = [["Community Food Systems", "Retail Sector Dynamics", {"weight": 0.8, "confidence": 0.734, "type": "inter_cluster", "style": "solid"}], ["Grocery Store Access", "Retail Sector Dynamics", {"weight": 0.8, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Grocery Store Access", "Community Food Systems", {"weight": 0.6, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Retail Sector Dynamics", "Community Food Systems", {"weight": 0.6, "confidence": 0.54, "type": "inter_cluster", "style": "solid"}], ["Retail Sector Dynamics", "Grocery Store Access", {"weight": 0.2, "confidence": 0.16999999999999998, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Food Systems": [], "Grocery Store Access": [], "Retail Sector Dynamics": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
