
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Fisheries Governance": {"concepts": "ecosystem balance, ecosystem disruption", "concept_list": ["ecosystem balance", "ecosystem disruption"], "type": "cluster", "node_size": 21, "label": "Fisheries Governance"}, "Coral Reef Health": {"concepts": "commissioner, noaa, plate size, board, multiple occupations, tourism, collaborative problem-solving, closures, management decisions, questionnaire, containers, training, sting rays, lobster, decision makers, drug trade, school attendance, tourism value, degrees, rum factory, regulation, diving, researchers, advisers, interference, fairness, court, species, customers, director turnover, social gathering, conch area, science, manpower, grants, education, groupers, market demand, restaurant, dpnr, community, directors, nature conservancy, cozumel, moratorium, conch closure, drug testing, magnuson-stevens act, gillnets, siltation, congresswoman, virgin island laws, conflict resolution, management, refinery, director, social gatherings, usvi, species preference, customer base, collaboration, community relationships, meetings, shootings, vacancies, decision-making, research, us territory, tourists, supermarkets, christmas dinner, eez, crisis, enforcement", "concept_list": ["commissioner", "noaa", "plate size", "board", "multiple occupations", "tourism", "collaborative problem-solving", "closures", "management decisions", "questionnaire", "containers", "training", "sting rays", "lobster", "decision makers", "drug trade", "school attendance", "tourism value", "degrees", "rum factory", "regulation", "diving", "researchers", "advisers", "interference", "fairness", "court", "species", "customers", "director turnover", "social gathering", "conch area", "science", "manpower", "grants", "education", "groupers", "market demand", "restaurant", "dpnr", "community", "directors", "nature conservancy", "cozumel", "moratorium", "conch closure", "drug testing", "magnuson-stevens act", "gillnets", "siltation", "congresswoman", "virgin island laws", "conflict resolution", "management", "refinery", "director", "social gatherings", "usvi", "species preference", "customer base", "collaboration", "community relationships", "meetings", "shootings", "vacancies", "decision-making", "research", "us territory", "tourists", "supermarkets", "christmas dinner", "eez", "crisis", "enforcement"], "type": "cluster", "node_size": 237, "label": "Coral Reef Health"}, "Government Oversight": {"concepts": "coral reefs, reef fishing, coral death, coral life, u.s. coast guard, turtles, reef, east end marine park, coral restoration, yellowtail snapper, sponge decline, reef pressure, coastal communities, grazers, coral head, turtle nesting, sponge encrustation", "concept_list": ["coral reefs", "reef fishing", "coral death", "coral life", "u.s. coast guard", "turtles", "reef", "east end marine park", "coral restoration", "yellowtail snapper", "sponge decline", "reef pressure", "coastal communities", "grazers", "coral head", "turtle nesting", "sponge encrustation"], "type": "cluster", "node_size": 66, "label": "Government Oversight"}, "Fisheries Management": {"concepts": "government regulation, national park, federal waters, federal government, local government, federal laws", "concept_list": ["government regulation", "national park", "federal waters", "federal government", "local government", "federal laws"], "type": "cluster", "node_size": 33, "label": "Fisheries Management"}, "Ecosystem Stability": {"concepts": "fishery management, usvi fisheries, director of fish and wildlife, fishing license, fishers, lobster fisherman, fisheries dependence, fisheries, fishery managers, fisheries advisory board, local fisher, fishermen, fisheries advisory", "concept_list": ["fishery management", "usvi fisheries", "director of fish and wildlife", "fishing license", "fishers", "lobster fisherman", "fisheries dependence", "fisheries", "fishery managers", "fisheries advisory board", "local fisher", "fishermen", "fisheries advisory"], "type": "cluster", "node_size": 54, "label": "Ecosystem Stability"}, "Environmental Challenges": {"concepts": "climate change, environmental change, livelihoods, population decline, ocean warming, cultural attitude, fertilizers, hurricane protection, global challenges, species decline, water temperature, hurricane hugo, farmers, illegal fishing, pollution, ocean acidification, commercial fishing, farming, oil refinery, cultural changes, animal protection", "concept_list": ["climate change", "environmental change", "livelihoods", "population decline", "ocean warming", "cultural attitude", "fertilizers", "hurricane protection", "global challenges", "species decline", "water temperature", "hurricane hugo", "farmers", "illegal fishing", "pollution", "ocean acidification", "commercial fishing", "farming", "oil refinery", "cultural changes", "animal protection"], "type": "cluster", "node_size": 78, "label": "Environmental Challenges"}, "Fish Populations": {"concepts": "pelagic fish, fish size, parrotfish spawn, fish traps, fish and wildlife, parrotfish, lionfish invasion, fish life, cleaner shrimp, fish population, sewage pollution, fish pots, algae growth, overfishing, cleaner fish", "concept_list": ["pelagic fish", "fish size", "parrotfish spawn", "fish traps", "fish and wildlife", "parrotfish", "lionfish invasion", "fish life", "cleaner shrimp", "fish population", "sewage pollution", "fish pots", "algae growth", "overfishing", "cleaner fish"], "type": "cluster", "node_size": 60, "label": "Fish Populations"}, "Livelihood Adaptations": {"concepts": "alternative livelihoods, buck island monument, boat captains, sahara dust, livelihood, biodegradable doors", "concept_list": ["alternative livelihoods", "buck island monument", "boat captains", "sahara dust", "livelihood", "biodegradable doors"], "type": "cluster", "node_size": 33, "label": "Livelihood Adaptations"}};
        const conceptData = {};
        const interClusterEdges = [["Fisheries Governance", "Ecosystem Stability", {"weight": 0.4, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}], ["Fisheries Governance", "Livelihood Adaptations", {"weight": 0.4, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Fisheries Governance", "Environmental Challenges", {"weight": -0.2, "confidence": 0.43999999999999995, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Health", "Fisheries Management", {"weight": 0.6, "confidence": 0.41999999999999993, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Health", "Fish Populations", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Government Oversight", "Fisheries Management", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Government Oversight", {"weight": 0.6666666666666666, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Coral Reef Health", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Fish Populations", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stability", "Fisheries Governance", {"weight": -0.6, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stability", "Coral Reef Health", {"weight": 1.0, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stability", "Livelihood Adaptations", {"weight": 0.4, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Stability", "Fisheries Management", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Environmental Challenges", "Fisheries Management", {"weight": 0.6, "confidence": 0.6100000000000001, "type": "inter_cluster", "style": "solid"}], ["Fish Populations", "Government Oversight", {"weight": -0.6, "confidence": 0.9100000000000001, "type": "inter_cluster", "style": "solid"}], ["Fish Populations", "Environmental Challenges", {"weight": 0.8, "confidence": 0.48, "type": "inter_cluster", "style": "solid"}], ["Livelihood Adaptations", "Government Oversight", {"weight": 0.4, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Livelihood Adaptations", "Ecosystem Stability", {"weight": -0.4, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Fisheries Governance": [], "Coral Reef Health": [], "Government Oversight": [], "Fisheries Management": [], "Ecosystem Stability": [], "Environmental Challenges": [], "Fish Populations": [], "Livelihood Adaptations": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
