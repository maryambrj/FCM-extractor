
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"recreational fishing": {"concepts": "recreational fishing", "concept_list": ["recreational fishing"], "type": "cluster", "node_size": 18, "label": "recreational fishing"}, "Fisheries Research": {"concepts": "fishery management, fisheries, fisheries management, sustainable fisheries", "concept_list": ["fishery management", "fisheries", "fisheries management", "sustainable fisheries"], "type": "cluster", "node_size": 27, "label": "Fisheries Research"}, "Fish Research": {"concepts": "fisheries research, fish productivity", "concept_list": ["fisheries research", "fish productivity"], "type": "cluster", "node_size": 21, "label": "Fish Research"}, "Species Diversity": {"concepts": "endangered species, species diversity, species, invasive species, conservation concern, harmful organisms, biodiversity, marine biodiversity", "concept_list": ["endangered species", "species diversity", "species", "invasive species", "conservation concern", "harmful organisms", "biodiversity", "marine biodiversity"], "type": "cluster", "node_size": 39, "label": "Species Diversity"}, "Key Species": {"concepts": "striped bass, invasive catfish, fish, menhaden, food web species, blue crab, bottlenose dolphins, forage species, forage fish, blue catfish", "concept_list": ["striped bass", "invasive catfish", "fish", "menhaden", "food web species", "blue crab", "bottlenose dolphins", "forage species", "forage fish", "blue catfish"], "type": "cluster", "node_size": 45, "label": "Key Species"}, "Ecosystem Health": {"concepts": "trophic levels, ecosystem services, ecosystem service, habitat, oyster restoration, food web, climate change, wetland mitigation, oysters, habitat forming species, sav beds, aquatic vegetation, ecosystem health, habitat restoration, spawning habitat, water filtration, ecosystem telemetry, food chain, water quality, habitat mapping, eel-grass, reef, habitat linkages, ecosystem, reefs, ecosystem science, trophic level, ecosystem functions, nursery reef, tributary restoration", "concept_list": ["trophic levels", "ecosystem services", "ecosystem service", "habitat", "oyster restoration", "food web", "climate change", "wetland mitigation", "oysters", "habitat forming species", "sav beds", "aquatic vegetation", "ecosystem health", "habitat restoration", "spawning habitat", "water filtration", "ecosystem telemetry", "food chain", "water quality", "habitat mapping", "eel-grass", "reef", "habitat linkages", "ecosystem", "reefs", "ecosystem science", "trophic level", "ecosystem functions", "nursery reef", "tributary restoration"], "type": "cluster", "node_size": 105, "label": "Ecosystem Health"}, "Chesapeake Ecosystem Management": {"concepts": "data management, state federal partnership, chesapeake bay, fishing, science space, system components, staffer program, stakeholders, management questions, chesapeake bay program, stock assessments, work groups, scientific community, mental modeler, plankton, epa, management dynamics, tributary, acoustic telemetry, gulf of mexico, chesapeake program, environmental literacy, ecosystem management, atlantic sturgeon, restoration practitioners, natural mortality, equilibrium, marine invertebrates, resource management, salish sea, citizen science, conservation, noaa, case study, grant programs, public data, marine biology, ecosystem modelers, state departments of education, tourism industry, conservation banking, policy space, environmental education, watershed education", "concept_list": ["data management", "state federal partnership", "chesapeake bay", "fishing", "science space", "system components", "staffer program", "stakeholders", "management questions", "chesapeake bay program", "stock assessments", "work groups", "scientific community", "mental modeler", "plankton", "epa", "management dynamics", "tributary", "acoustic telemetry", "gulf of mexico", "chesapeake program", "environmental literacy", "ecosystem management", "atlantic sturgeon", "restoration practitioners", "natural mortality", "equilibrium", "marine invertebrates", "resource management", "salish sea", "citizen science", "conservation", "noaa", "case study", "grant programs", "public data", "marine biology", "ecosystem modelers", "state departments of education", "tourism industry", "conservation banking", "policy space", "environmental education", "watershed education"], "type": "cluster", "node_size": 147, "label": "Chesapeake Ecosystem Management"}, "Nursery Recruitment": {"concepts": "population recruitment, nursery", "concept_list": ["population recruitment", "nursery"], "type": "cluster", "node_size": 21, "label": "Nursery Recruitment"}};
        const conceptData = {"fishery management": {"concepts": "fishery management", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fishery management"}, "fisheries": {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fisheries"}, "fisheries management": {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fisheries management"}, "sustainable fisheries": {"concepts": "sustainable fisheries", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "sustainable fisheries"}, "fisheries research": {"concepts": "fisheries research", "type": "concept", "cluster": "Fish Research", "node_size": 10, "label": "fisheries research"}, "fish productivity": {"concepts": "fish productivity", "type": "concept", "cluster": "Fish Research", "node_size": 10, "label": "fish productivity"}, "endangered species": {"concepts": "endangered species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "endangered species"}, "species diversity": {"concepts": "species diversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species diversity"}, "species": {"concepts": "species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "invasive species"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "conservation concern"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "harmful organisms"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "biodiversity"}, "marine biodiversity": {"concepts": "marine biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "marine biodiversity"}, "striped bass": {"concepts": "striped bass", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "striped bass"}, "invasive catfish": {"concepts": "invasive catfish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "invasive catfish"}, "fish": {"concepts": "fish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "fish"}, "menhaden": {"concepts": "menhaden", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "menhaden"}, "food web species": {"concepts": "food web species", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "food web species"}, "blue crab": {"concepts": "blue crab", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "blue crab"}, "bottlenose dolphins": {"concepts": "bottlenose dolphins", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "bottlenose dolphins"}, "forage species": {"concepts": "forage species", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "forage species"}, "forage fish": {"concepts": "forage fish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "forage fish"}, "blue catfish": {"concepts": "blue catfish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "blue catfish"}, "trophic levels": {"concepts": "trophic levels", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "trophic levels"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem services"}, "ecosystem service": {"concepts": "ecosystem service", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem service"}, "habitat": {"concepts": "habitat", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat"}, "oyster restoration": {"concepts": "oyster restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "oyster restoration"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "food web"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "climate change"}, "wetland mitigation": {"concepts": "wetland mitigation", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "wetland mitigation"}, "oysters": {"concepts": "oysters", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "oysters"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat forming species"}, "sav beds": {"concepts": "sav beds", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "sav beds"}, "aquatic vegetation": {"concepts": "aquatic vegetation", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "aquatic vegetation"}, "ecosystem health": {"concepts": "ecosystem health", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem health"}, "habitat restoration": {"concepts": "habitat restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat restoration"}, "spawning habitat": {"concepts": "spawning habitat", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "spawning habitat"}, "water filtration": {"concepts": "water filtration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "water filtration"}, "ecosystem telemetry": {"concepts": "ecosystem telemetry", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem telemetry"}, "food chain": {"concepts": "food chain", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "food chain"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "water quality"}, "habitat mapping": {"concepts": "habitat mapping", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat mapping"}, "eel-grass": {"concepts": "eel-grass", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "eel-grass"}, "reef": {"concepts": "reef", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "reef"}, "habitat linkages": {"concepts": "habitat linkages", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat linkages"}, "ecosystem": {"concepts": "ecosystem", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem"}, "reefs": {"concepts": "reefs", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "reefs"}, "ecosystem science": {"concepts": "ecosystem science", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem science"}, "trophic level": {"concepts": "trophic level", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "trophic level"}, "ecosystem functions": {"concepts": "ecosystem functions", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem functions"}, "nursery reef": {"concepts": "nursery reef", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "nursery reef"}, "tributary restoration": {"concepts": "tributary restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "tributary restoration"}, "data management": {"concepts": "data management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "data management"}, "state federal partnership": {"concepts": "state federal partnership", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "state federal partnership"}, "chesapeake bay": {"concepts": "chesapeake bay", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake bay"}, "fishing": {"concepts": "fishing", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "fishing"}, "science space": {"concepts": "science space", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "science space"}, "system components": {"concepts": "system components", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "system components"}, "staffer program": {"concepts": "staffer program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "staffer program"}, "stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "stakeholders"}, "management questions": {"concepts": "management questions", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "management questions"}, "chesapeake bay program": {"concepts": "chesapeake bay program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake bay program"}, "stock assessments": {"concepts": "stock assessments", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "stock assessments"}, "work groups": {"concepts": "work groups", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "work groups"}, "scientific community": {"concepts": "scientific community", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "scientific community"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "mental modeler"}, "plankton": {"concepts": "plankton", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "plankton"}, "epa": {"concepts": "epa", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "epa"}, "management dynamics": {"concepts": "management dynamics", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "management dynamics"}, "tributary": {"concepts": "tributary", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "tributary"}, "acoustic telemetry": {"concepts": "acoustic telemetry", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "acoustic telemetry"}, "gulf of mexico": {"concepts": "gulf of mexico", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "gulf of mexico"}, "chesapeake program": {"concepts": "chesapeake program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake program"}, "environmental literacy": {"concepts": "environmental literacy", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "environmental literacy"}, "ecosystem management": {"concepts": "ecosystem management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "ecosystem management"}, "atlantic sturgeon": {"concepts": "atlantic sturgeon", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "atlantic sturgeon"}, "restoration practitioners": {"concepts": "restoration practitioners", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "restoration practitioners"}, "natural mortality": {"concepts": "natural mortality", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "natural mortality"}, "equilibrium": {"concepts": "equilibrium", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "equilibrium"}, "marine invertebrates": {"concepts": "marine invertebrates", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "marine invertebrates"}, "resource management": {"concepts": "resource management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "resource management"}, "salish sea": {"concepts": "salish sea", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "salish sea"}, "citizen science": {"concepts": "citizen science", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "citizen science"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "conservation"}, "noaa": {"concepts": "noaa", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "noaa"}, "case study": {"concepts": "case study", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "case study"}, "grant programs": {"concepts": "grant programs", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "grant programs"}, "public data": {"concepts": "public data", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "public data"}, "marine biology": {"concepts": "marine biology", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "marine biology"}, "ecosystem modelers": {"concepts": "ecosystem modelers", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "ecosystem modelers"}, "state departments of education": {"concepts": "state departments of education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "state departments of education"}, "tourism industry": {"concepts": "tourism industry", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "tourism industry"}, "conservation banking": {"concepts": "conservation banking", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "conservation banking"}, "policy space": {"concepts": "policy space", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "policy space"}, "environmental education": {"concepts": "environmental education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "environmental education"}, "watershed education": {"concepts": "watershed education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "watershed education"}, "population recruitment": {"concepts": "population recruitment", "type": "concept", "cluster": "Nursery Recruitment", "node_size": 10, "label": "population recruitment"}, "nursery": {"concepts": "nursery", "type": "concept", "cluster": "Nursery Recruitment", "node_size": 10, "label": "nursery"}};
        const interClusterEdges = [["recreational fishing", "Key Species", {"weight": 1.0, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["recreational fishing", "Fisheries Research", {"weight": 0.8, "confidence": 0.28, "type": "inter_cluster", "style": "solid"}], ["Fisheries Research", "Ecosystem Health", {"weight": 1.0, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["Fisheries Research", "Chesapeake Ecosystem Management", {"weight": 1.0, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Fisheries Research", "Nursery Recruitment", {"weight": 0.6, "confidence": 0.24, "type": "inter_cluster", "style": "solid"}], ["Fish Research", "Fisheries Research", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Fish Research", "Key Species", {"weight": 0.6, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Fish Research", "recreational fishing", {"weight": 0.4, "confidence": 0.12, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Ecosystem Health", {"weight": 1.0, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Fisheries Research", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Nursery Recruitment", {"weight": 0.8, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}], ["Key Species", "Ecosystem Health", {"weight": 1.0, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Key Species", "Fisheries Research", {"weight": 1.0, "confidence": 0.38, "type": "inter_cluster", "style": "solid"}], ["Key Species", "Fish Research", {"weight": 0.6, "confidence": 0.22000000000000003, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Nursery Recruitment", {"weight": 1.0, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "recreational fishing", {"weight": 1.0, "confidence": 0.36000000000000004, "type": "inter_cluster", "style": "solid"}], ["Chesapeake Ecosystem Management", "Fisheries Research", {"weight": 1.0, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Chesapeake Ecosystem Management", "Fish Research", {"weight": 1.0, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}], ["Chesapeake Ecosystem Management", "Species Diversity", {"weight": 1.0, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Chesapeake Ecosystem Management", "Key Species", {"weight": 0.6, "confidence": 0.22000000000000003, "type": "inter_cluster", "style": "solid"}], ["Nursery Recruitment", "Key Species", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Nursery Recruitment", "Fish Research", {"weight": 0.6, "confidence": 0.28, "type": "inter_cluster", "style": "solid"}], ["Nursery Recruitment", "Fisheries Research", {"weight": 0.6, "confidence": 0.26, "type": "inter_cluster", "style": "solid"}], ["Nursery Recruitment", "recreational fishing", {"weight": 0.6, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Fisheries Research": [["fishery management", {"concepts": "fishery management", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fishery management"}], ["fisheries", {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fisheries"}], ["fisheries management", {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "fisheries management"}], ["sustainable fisheries", {"concepts": "sustainable fisheries", "type": "concept", "cluster": "Fisheries Research", "node_size": 10, "label": "sustainable fisheries"}]], "Fish Research": [["fisheries research", {"concepts": "fisheries research", "type": "concept", "cluster": "Fish Research", "node_size": 10, "label": "fisheries research"}], ["fish productivity", {"concepts": "fish productivity", "type": "concept", "cluster": "Fish Research", "node_size": 10, "label": "fish productivity"}]], "Species Diversity": [["endangered species", {"concepts": "endangered species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "endangered species"}], ["species diversity", {"concepts": "species diversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species diversity"}], ["species", {"concepts": "species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "invasive species"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "conservation concern"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "harmful organisms"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "biodiversity"}], ["marine biodiversity", {"concepts": "marine biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "marine biodiversity"}]], "Key Species": [["striped bass", {"concepts": "striped bass", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "striped bass"}], ["invasive catfish", {"concepts": "invasive catfish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "invasive catfish"}], ["fish", {"concepts": "fish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "fish"}], ["menhaden", {"concepts": "menhaden", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "menhaden"}], ["food web species", {"concepts": "food web species", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "food web species"}], ["blue crab", {"concepts": "blue crab", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "blue crab"}], ["bottlenose dolphins", {"concepts": "bottlenose dolphins", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "bottlenose dolphins"}], ["forage species", {"concepts": "forage species", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "forage species"}], ["forage fish", {"concepts": "forage fish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "forage fish"}], ["blue catfish", {"concepts": "blue catfish", "type": "concept", "cluster": "Key Species", "node_size": 10, "label": "blue catfish"}]], "Ecosystem Health": [["trophic levels", {"concepts": "trophic levels", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "trophic levels"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem services"}], ["ecosystem service", {"concepts": "ecosystem service", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem service"}], ["habitat", {"concepts": "habitat", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat"}], ["oyster restoration", {"concepts": "oyster restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "oyster restoration"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "food web"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "climate change"}], ["wetland mitigation", {"concepts": "wetland mitigation", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "wetland mitigation"}], ["oysters", {"concepts": "oysters", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "oysters"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat forming species"}], ["sav beds", {"concepts": "sav beds", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "sav beds"}], ["aquatic vegetation", {"concepts": "aquatic vegetation", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "aquatic vegetation"}], ["ecosystem health", {"concepts": "ecosystem health", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem health"}], ["habitat restoration", {"concepts": "habitat restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat restoration"}], ["spawning habitat", {"concepts": "spawning habitat", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "spawning habitat"}], ["water filtration", {"concepts": "water filtration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "water filtration"}], ["ecosystem telemetry", {"concepts": "ecosystem telemetry", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem telemetry"}], ["food chain", {"concepts": "food chain", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "food chain"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "water quality"}], ["habitat mapping", {"concepts": "habitat mapping", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat mapping"}], ["eel-grass", {"concepts": "eel-grass", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "eel-grass"}], ["reef", {"concepts": "reef", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "reef"}], ["habitat linkages", {"concepts": "habitat linkages", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat linkages"}], ["ecosystem", {"concepts": "ecosystem", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem"}], ["reefs", {"concepts": "reefs", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "reefs"}], ["ecosystem science", {"concepts": "ecosystem science", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem science"}], ["trophic level", {"concepts": "trophic level", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "trophic level"}], ["ecosystem functions", {"concepts": "ecosystem functions", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem functions"}], ["nursery reef", {"concepts": "nursery reef", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "nursery reef"}], ["tributary restoration", {"concepts": "tributary restoration", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "tributary restoration"}]], "Chesapeake Ecosystem Management": [["data management", {"concepts": "data management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "data management"}], ["state federal partnership", {"concepts": "state federal partnership", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "state federal partnership"}], ["chesapeake bay", {"concepts": "chesapeake bay", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake bay"}], ["fishing", {"concepts": "fishing", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "fishing"}], ["science space", {"concepts": "science space", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "science space"}], ["system components", {"concepts": "system components", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "system components"}], ["staffer program", {"concepts": "staffer program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "staffer program"}], ["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "stakeholders"}], ["management questions", {"concepts": "management questions", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "management questions"}], ["chesapeake bay program", {"concepts": "chesapeake bay program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake bay program"}], ["stock assessments", {"concepts": "stock assessments", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "stock assessments"}], ["work groups", {"concepts": "work groups", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "work groups"}], ["scientific community", {"concepts": "scientific community", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "scientific community"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "mental modeler"}], ["plankton", {"concepts": "plankton", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "plankton"}], ["epa", {"concepts": "epa", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "epa"}], ["management dynamics", {"concepts": "management dynamics", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "management dynamics"}], ["tributary", {"concepts": "tributary", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "tributary"}], ["acoustic telemetry", {"concepts": "acoustic telemetry", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "acoustic telemetry"}], ["gulf of mexico", {"concepts": "gulf of mexico", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "gulf of mexico"}], ["chesapeake program", {"concepts": "chesapeake program", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "chesapeake program"}], ["environmental literacy", {"concepts": "environmental literacy", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "environmental literacy"}], ["ecosystem management", {"concepts": "ecosystem management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "ecosystem management"}], ["atlantic sturgeon", {"concepts": "atlantic sturgeon", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "atlantic sturgeon"}], ["restoration practitioners", {"concepts": "restoration practitioners", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "restoration practitioners"}], ["natural mortality", {"concepts": "natural mortality", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "natural mortality"}], ["equilibrium", {"concepts": "equilibrium", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "equilibrium"}], ["marine invertebrates", {"concepts": "marine invertebrates", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "marine invertebrates"}], ["resource management", {"concepts": "resource management", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "resource management"}], ["salish sea", {"concepts": "salish sea", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "salish sea"}], ["citizen science", {"concepts": "citizen science", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "citizen science"}], ["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "conservation"}], ["noaa", {"concepts": "noaa", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "noaa"}], ["case study", {"concepts": "case study", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "case study"}], ["grant programs", {"concepts": "grant programs", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "grant programs"}], ["public data", {"concepts": "public data", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "public data"}], ["marine biology", {"concepts": "marine biology", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "marine biology"}], ["ecosystem modelers", {"concepts": "ecosystem modelers", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "ecosystem modelers"}], ["state departments of education", {"concepts": "state departments of education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "state departments of education"}], ["tourism industry", {"concepts": "tourism industry", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "tourism industry"}], ["conservation banking", {"concepts": "conservation banking", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "conservation banking"}], ["policy space", {"concepts": "policy space", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "policy space"}], ["environmental education", {"concepts": "environmental education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "environmental education"}], ["watershed education", {"concepts": "watershed education", "type": "concept", "cluster": "Chesapeake Ecosystem Management", "node_size": 10, "label": "watershed education"}]], "Nursery Recruitment": [["population recruitment", {"concepts": "population recruitment", "type": "concept", "cluster": "Nursery Recruitment", "node_size": 10, "label": "population recruitment"}], ["nursery", {"concepts": "nursery", "type": "concept", "cluster": "Nursery Recruitment", "node_size": 10, "label": "nursery"}]]};
        const clusterEdges = {"Fisheries Research": [], "Fish Research": [], "Species Diversity": [], "Key Species": [], "Ecosystem Health": [], "Chesapeake Ecosystem Management": [], "Nursery Recruitment": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
