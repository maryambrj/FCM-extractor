
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access & Nutrition": {"concepts": "underlying conditions, government policy, staff wellbeing, team structure, crim partnership, service rate, flint community schools, leadership, gardening, supper, snack, recipes, mental state, patient access, masks, employee incentives, projects, partners, organizational values, healthy living, community, classroom, staff, high crime rate, cp district, discrimination, covid-19, physical state, attention, michigan department of education, performance, guidelines, flint schools, social impact, parent perspective, availability, doctor's note, bonuses, staff impact, staff safety, school district, community empowerment, resources, drive up sites, minimum wage, affordability, usda guidelines, creativity, educational efforts, post covid, quality of life, school districts, transportation barriers, apartment complexes, employee hygiene, virus memory, emotional state, presidential award, city of flint, doctors, staff age, accessibility, spring break, staff scheduling, service speed, health, michigan department, funding, staff experience, national school lunch program, usda regulations, portion sizes, usda, hand sanitizer, crime rate, mask wearing, incentives, public health, energy, staffing barriers, school, certification, respect, sense of community, staffing, sites, discrimination policy, partnerships, grain requirements, breakfast, safety, students, transportation, locations, education, unemployment benefits, post-covid, job description, togetherness, unemployment, regulations, academic performance, central workers, development, sodexomagic, virus, school performance, residents, waivers, parents, lunch, news, news channels, community engagement, apartments, work-life balance, high risk, employee retention", "concept_list": ["underlying conditions", "government policy", "staff wellbeing", "team structure", "crim partnership", "service rate", "flint community schools", "leadership", "gardening", "supper", "snack", "recipes", "mental state", "patient access", "masks", "employee incentives", "projects", "partners", "organizational values", "healthy living", "community", "classroom", "staff", "high crime rate", "cp district", "discrimination", "covid-19", "physical state", "attention", "michigan department of education", "performance", "guidelines", "flint schools", "social impact", "parent perspective", "availability", "doctor's note", "bonuses", "staff impact", "staff safety", "school district", "community empowerment", "resources", "drive up sites", "minimum wage", "affordability", "usda guidelines", "creativity", "educational efforts", "post covid", "quality of life", "school districts", "transportation barriers", "apartment complexes", "employee hygiene", "virus memory", "emotional state", "presidential award", "city of flint", "doctors", "staff age", "accessibility", "spring break", "staff scheduling", "service speed", "health", "michigan department", "funding", "staff experience", "national school lunch program", "usda regulations", "portion sizes", "usda", "hand sanitizer", "crime rate", "mask wearing", "incentives", "public health", "energy", "staffing barriers", "school", "certification", "respect", "sense of community", "staffing", "sites", "discrimination policy", "partnerships", "grain requirements", "breakfast", "safety", "students", "transportation", "locations", "education", "unemployment benefits", "post-covid", "job description", "togetherness", "unemployment", "regulations", "academic performance", "central workers", "development", "sodexomagic", "virus", "school performance", "residents", "waivers", "parents", "lunch", "news", "news channels", "community engagement", "apartments", "work-life balance", "high risk", "employee retention"], "type": "cluster", "node_size": 369, "label": "Food Access & Nutrition"}, "School Staff & Community Wellbeing": {"concepts": "food system values, food availability, retail types, meals, food accessibility, prepackaged meals, home meals, healthy eating, national food chains, nutrition guidelines, healthy choices, meal quality, local farmers, youth food access, food producers, vegetables, food sustainability, food service, fresh fruits, food vendors, fat content, meal cost, cooking, fresh meals, fruits, processed meals, food system, food packaging, supply chain, meal distribution, food supply, food access, nutrition, food skills, school food services, nutritious foods, meal limitations, food demand, producers, meal components, nutritious food, nutritional content, sodium content, school food, free meals, retail use", "concept_list": ["food system values", "food availability", "retail types", "meals", "food accessibility", "prepackaged meals", "home meals", "healthy eating", "national food chains", "nutrition guidelines", "healthy choices", "meal quality", "local farmers", "youth food access", "food producers", "vegetables", "food sustainability", "food service", "fresh fruits", "food vendors", "fat content", "meal cost", "cooking", "fresh meals", "fruits", "processed meals", "food system", "food packaging", "supply chain", "meal distribution", "food supply", "food access", "nutrition", "food skills", "school food services", "nutritious foods", "meal limitations", "food demand", "producers", "meal components", "nutritious food", "nutritional content", "sodium content", "school food", "free meals", "retail use"], "type": "cluster", "node_size": 153, "label": "School Staff & Community Wellbeing"}};
        const conceptData = {};
        const interClusterEdges = [["Food Access & Nutrition", "School Staff & Community Wellbeing", {"weight": 1.0, "confidence": 0.9166666666666666, "type": "inter_cluster", "style": "solid"}], ["School Staff & Community Wellbeing", "Food Access & Nutrition", {"weight": 1.0, "confidence": 0.9499999999999998, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access & Nutrition": [], "School Staff & Community Wellbeing": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
