
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"drop down menu": {"concepts": "drop down menu", "concept_list": ["drop down menu"], "type": "cluster", "node_size": 18, "label": "drop down menu"}, "supplier education": {"concepts": "supplier education", "concept_list": ["supplier education"], "type": "cluster", "node_size": 18, "label": "supplier education"}, "convenience stores": {"concepts": "convenience stores", "concept_list": ["convenience stores"], "type": "cluster", "node_size": 18, "label": "convenience stores"}, "Transportation Access": {"concepts": "local produce, producers", "concept_list": ["local produce", "producers"], "type": "cluster", "node_size": 21, "label": "Transportation Access"}, "Market Operations": {"concepts": "phone calls, transportation, bicycle delivery, transportation barriers, transportation issue, transportation access", "concept_list": ["phone calls", "transportation", "bicycle delivery", "transportation barriers", "transportation issue", "transportation access"], "type": "cluster", "node_size": 33, "label": "Market Operations"}, "Funding Sources": {"concepts": "additional charge, buses, insights, mobile market, decision making, suppliers, individual voice, buyer types, older adults, access, formal mechanism, older people, sourcing, consumer base, plot of land, expertise, ownership, charles stewart mott foundation, barriers, consumer understanding, quality of life, price comparison, supplier, wards, resellers, resell, co-op, institutions, crim fitness foundation, system change, price, walmart, distributor, hurley, supplemental, trade, consumer, brain, retail, economic barriers, public health, crim, respect, covid-19, director, ruth mott foundation, understanding, income, residents, catering, edible flint, broccoli, customer ownership, community health, msu, sense of ownership, perspectives, flint, vendors, order deadline, burton, leverage points, ebt, resource sharing, customer distinction, hospitals, decision-making, distributors, department of health and human services, system opportunities, individual buyers, postcard, convenience, flint fresh, resources, retail side, values, outcomes, manpower, market vendors, emergency, covid, city of flint, health, msu extension, co-operative", "concept_list": ["additional charge", "buses", "insights", "mobile market", "decision making", "suppliers", "individual voice", "buyer types", "older adults", "access", "formal mechanism", "older people", "sourcing", "consumer base", "plot of land", "expertise", "ownership", "charles stewart mott foundation", "barriers", "consumer understanding", "quality of life", "price comparison", "supplier", "wards", "resellers", "resell", "co-op", "institutions", "crim fitness foundation", "system change", "price", "walmart", "distributor", "hurley", "supplemental", "trade", "consumer", "brain", "retail", "economic barriers", "public health", "crim", "respect", "covid-19", "director", "ruth mott foundation", "understanding", "income", "residents", "catering", "edible flint", "broccoli", "customer ownership", "community health", "msu", "sense of ownership", "perspectives", "flint", "vendors", "order deadline", "burton", "leverage points", "ebt", "resource sharing", "customer distinction", "hospitals", "decision-making", "distributors", "department of health and human services", "system opportunities", "individual buyers", "postcard", "convenience", "flint fresh", "resources", "retail side", "values", "outcomes", "manpower", "market vendors", "emergency", "covid", "city of flint", "health", "msu extension", "co-operative"], "type": "cluster", "node_size": 273, "label": "Funding Sources"}, "Food Systems": {"concepts": "credit card, funding, land bank, grant, funding organizations, landbank, grant funded, grant funding", "concept_list": ["credit card", "funding", "land bank", "grant", "funding organizations", "landbank", "grant funded", "grant funding"], "type": "cluster", "node_size": 39, "label": "Food Systems"}, "Local Producers": {"concepts": "food vendors, food system, food quality, food environment, food purchasing, food partnerships, food sourcing, food access, food options, food deserts, healthy food choices, food retail, food distribution, food affordability, nutritious food, food events, food bank, flint food system, food availability, food supply, emergency food, food education, double up food bucks, fast food, food system mapping, food hub, local food, food system sectors, food distributor, unhealthy food, local food events, food choices, food price, supplemental food, nutrition, food orders, food insecurity", "concept_list": ["food vendors", "food system", "food quality", "food environment", "food purchasing", "food partnerships", "food sourcing", "food access", "food options", "food deserts", "healthy food choices", "food retail", "food distribution", "food affordability", "nutritious food", "food events", "food bank", "flint food system", "food availability", "food supply", "emergency food", "food education", "double up food bucks", "fast food", "food system mapping", "food hub", "local food", "food system sectors", "food distributor", "unhealthy food", "local food events", "food choices", "food price", "supplemental food", "nutrition", "food orders", "food insecurity"], "type": "cluster", "node_size": 126, "label": "Local Producers"}, "Outdoor Structures": {"concepts": "accessory building, outdoor pavilion, hoop house", "concept_list": ["accessory building", "outdoor pavilion", "hoop house"], "type": "cluster", "node_size": 24, "label": "Outdoor Structures"}, "Vegetable Boxes": {"concepts": "veggie boxes, a la carte box, veggies", "concept_list": ["veggie boxes", "a la carte box", "veggies"], "type": "cluster", "node_size": 24, "label": "Vegetable Boxes"}, "Garden Demonstration": {"concepts": "demonstration garden, neem oil", "concept_list": ["demonstration garden", "neem oil"], "type": "cluster", "node_size": 21, "label": "Garden Demonstration"}, "Consumer Education": {"concepts": "consumer education, peer learning, education, education component", "concept_list": ["consumer education", "peer learning", "education", "education component"], "type": "cluster", "node_size": 27, "label": "Consumer Education"}, "Education Institutions": {"concepts": "michigan department of education, colleges", "concept_list": ["michigan department of education", "colleges"], "type": "cluster", "node_size": 21, "label": "Education Institutions"}, "Restaurant Types": {"concepts": "restaurants, chain restaurants, local restaurants", "concept_list": ["restaurants", "chain restaurants", "local restaurants"], "type": "cluster", "node_size": 24, "label": "Restaurant Types"}, "Grocery Stores": {"concepts": "specialty grocery, grocery stores, grocery store, grocery store closures", "concept_list": ["specialty grocery", "grocery stores", "grocery store", "grocery store closures"], "type": "cluster", "node_size": 27, "label": "Grocery Stores"}, "Organizational Partnerships": {"concepts": "local partners, organizational clients, organizational partnerships, clients, organizational representation", "concept_list": ["local partners", "organizational clients", "organizational partnerships", "clients", "organizational representation"], "type": "cluster", "node_size": 30, "label": "Organizational Partnerships"}, "Vacant Properties": {"concepts": "neighborhoods, vacant land, vacant buildings", "concept_list": ["neighborhoods", "vacant land", "vacant buildings"], "type": "cluster", "node_size": 24, "label": "Vacant Properties"}, "Local Grower Support": {"concepts": "grower education, growers, production, locally grown, fruits, local vendors", "concept_list": ["grower education", "growers", "production", "locally grown", "fruits", "local vendors"], "type": "cluster", "node_size": 33, "label": "Local Grower Support"}, "Local Food Production": {"concepts": "local growers, local production, local producers", "concept_list": ["local growers", "local production", "local producers"], "type": "cluster", "node_size": 24, "label": "Local Food Production"}, "Local Economic Impact": {"concepts": "local economy, local benefits, regional partners, national partners", "concept_list": ["local economy", "local benefits", "regional partners", "national partners"], "type": "cluster", "node_size": 27, "label": "Local Economic Impact"}, "Produce Access": {"concepts": "produce availability, city government", "concept_list": ["produce availability", "city government"], "type": "cluster", "node_size": 21, "label": "Produce Access"}, "Community Engagement": {"concepts": "community empowerment, stakeholder engagement, community engagement", "concept_list": ["community empowerment", "stakeholder engagement", "community engagement"], "type": "cluster", "node_size": 24, "label": "Community Engagement"}, "Community Partnerships": {"concepts": "community foundation, community partnerships, partnerships, positive connection, connection strength, weak relationship, medium relationship, local identification, local connection, positive relationship, negative connection, negative relationship, strong relationship", "concept_list": ["community foundation", "community partnerships", "partnerships", "positive connection", "connection strength", "weak relationship", "medium relationship", "local identification", "local connection", "positive relationship", "negative connection", "negative relationship", "strong relationship"], "type": "cluster", "node_size": 54, "label": "Community Partnerships"}, "Farmers Markets": {"concepts": "farmers market, farmers markets", "concept_list": ["farmers market", "farmers markets"], "type": "cluster", "node_size": 21, "label": "Farmers Markets"}, "Vegetables": {"concepts": "green beans, cabbage", "concept_list": ["green beans", "cabbage"], "type": "cluster", "node_size": 21, "label": "Vegetables"}, "Local Agriculture": {"concepts": "farmers, agriculture, local agriculture", "concept_list": ["farmers", "agriculture", "local agriculture"], "type": "cluster", "node_size": 24, "label": "Local Agriculture"}};
        const conceptData = {};
        const interClusterEdges = [["drop down menu", "Local Producers", {"weight": 0.6666666666666666, "confidence": 0.3833333333333333, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Local Economic Impact", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Consumer Education", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Market Operations", "Local Food Production", {"weight": 0.6, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Market Operations", "Restaurant Types", {"weight": 1.0, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Local Grower Support", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Local Economic Impact", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Local Agriculture", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Vacant Properties", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Garden Demonstration", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Education Institutions", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Local Producers", "Restaurant Types", {"weight": 0.8, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["Outdoor Structures", "Local Agriculture", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Vegetable Boxes", "Market Operations", {"weight": 0.6, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Vegetable Boxes", "Transportation Access", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Vegetable Boxes", "convenience stores", {"weight": 0.75, "confidence": 0.4625, "type": "inter_cluster", "style": "solid"}], ["Garden Demonstration", "Local Food Production", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Transportation Access", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Grocery Stores", {"weight": 1.0, "confidence": 0.68, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Vegetable Boxes", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Local Economic Impact", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Community Engagement", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Vegetables", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "Outdoor Structures", {"weight": 0.6666666666666666, "confidence": 0.3666666666666667, "type": "inter_cluster", "style": "solid"}], ["Consumer Education", "drop down menu", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Local Food Production", {"weight": 1.0, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Grocery Stores", "Local Producers", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Organizational Partnerships", "Vegetable Boxes", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Vacant Properties", "Community Partnerships", {"weight": 1.0, "confidence": 0.6124999999999999, "type": "inter_cluster", "style": "solid"}], ["Vacant Properties", "Consumer Education", {"weight": 1.0, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Vacant Properties", "supplier education", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Local Grower Support", "Organizational Partnerships", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Local Grower Support", "Restaurant Types", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Local Grower Support", "Local Food Production", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Local Food Production", "Local Agriculture", {"weight": 1.0, "confidence": 0.9199999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Food Production", "drop down menu", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Local Food Production", "Restaurant Types", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Local Food Production", "Vegetable Boxes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Local Economic Impact", "Local Grower Support", {"weight": 0.8, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Local Economic Impact", "Market Operations", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Local Economic Impact", "Farmers Markets", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Economic Impact", "Local Agriculture", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Produce Access", "Food Systems", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Funding Sources", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Funding Sources", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Farmers Markets", {"weight": 1.0, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Organizational Partnerships", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Vegetables", "Farmers Markets", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Vegetables", "Vegetable Boxes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Vegetables", "Local Producers", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Local Agriculture", "Local Grower Support", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Local Agriculture", "Vacant Properties", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Transportation Access": [], "Market Operations": [], "Funding Sources": [], "Food Systems": [], "Local Producers": [], "Outdoor Structures": [], "Vegetable Boxes": [], "Garden Demonstration": [], "Consumer Education": [], "Education Institutions": [], "Restaurant Types": [], "Grocery Stores": [], "Organizational Partnerships": [], "Vacant Properties": [], "Local Grower Support": [], "Local Food Production": [], "Local Economic Impact": [], "Produce Access": [], "Community Engagement": [], "Community Partnerships": [], "Farmers Markets": [], "Vegetables": [], "Local Agriculture": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
