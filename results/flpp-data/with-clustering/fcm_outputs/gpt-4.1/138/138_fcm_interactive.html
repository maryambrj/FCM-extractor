
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Nutrition & Food Access": {"concepts": "farmers market, local farmers", "concept_list": ["farmers market", "local farmers"], "type": "cluster", "node_size": 21, "label": "Nutrition & Food Access"}, "Economic Development": {"concepts": "fresh produce, nutrition density, kitchen users, food system, consumer packaged goods, meal budget, cooking classes, food industry, supplemental nutrition, food hub, food skills education, local food business, food desert, food purchases, local food, food businesses, sugar intake, nutritious foods, packaged food, diet, nutrition labels, double up food bucks, wholesome food, food demand, healthy habits, food truck, food pyramid, nutritious food, cooking demonstrations, food system sectors, nutritious breakfast, food foundation, food works, home cooking, hoop houses, nutrition education, flint food system", "concept_list": ["fresh produce", "nutrition density", "kitchen users", "food system", "consumer packaged goods", "meal budget", "cooking classes", "food industry", "supplemental nutrition", "food hub", "food skills education", "local food business", "food desert", "food purchases", "local food", "food businesses", "sugar intake", "nutritious foods", "packaged food", "diet", "nutrition labels", "double up food bucks", "wholesome food", "food demand", "healthy habits", "food truck", "food pyramid", "nutritious food", "cooking demonstrations", "food system sectors", "nutritious breakfast", "food foundation", "food works", "home cooking", "hoop houses", "nutrition education", "flint food system"], "type": "cluster", "node_size": 126, "label": "Economic Development"}, "Community Partnerships": {"concepts": "negotiation, diverse expertise, black market economy, employment, positive influence, marketplace, group dynamics, cohort, michigan state, job creation, hands-on training, barriers, compromise, profit margin, co.starters, accessibility, holistic approach, covid-19 impact, coordination, concentration, math, flint kids cook, flint fresh, genesee career institute, health outcomes, expertise, differing goals, flint foodworks, mobile market, entrepreneurship, youth influence, licensing, income, entrepreneur, foundational development, recess, adulthood, michigan state extension, emergency situation, foundation, transportation access, resistance, culinary skill set, low interest loans, economic enhancement, consensus, scaling up, leverage point, animosity", "concept_list": ["negotiation", "diverse expertise", "black market economy", "employment", "positive influence", "marketplace", "group dynamics", "cohort", "michigan state", "job creation", "hands-on training", "barriers", "compromise", "profit margin", "co.starters", "accessibility", "holistic approach", "covid-19 impact", "coordination", "concentration", "math", "flint kids cook", "flint fresh", "genesee career institute", "health outcomes", "expertise", "differing goals", "flint foodworks", "mobile market", "entrepreneurship", "youth influence", "licensing", "income", "entrepreneur", "foundational development", "recess", "adulthood", "michigan state extension", "emergency situation", "foundation", "transportation access", "resistance", "culinary skill set", "low interest loans", "economic enhancement", "consensus", "scaling up", "leverage point", "animosity"], "type": "cluster", "node_size": 162, "label": "Community Partnerships"}, "Food Retail Outlets": {"concepts": "organizational representation, community benefit, grant writing, grants, catering company, funding, empowerment, coalition building, organizational expertise, outreach efforts, poorer communities, partnership agreement, community empowerment, church program, support program, community organizations, partnerships", "concept_list": ["organizational representation", "community benefit", "grant writing", "grants", "catering company", "funding", "empowerment", "coalition building", "organizational expertise", "outreach efforts", "poorer communities", "partnership agreement", "community empowerment", "church program", "support program", "community organizations", "partnerships"], "type": "cluster", "node_size": 66, "label": "Food Retail Outlets"}, "Local Farmers": {"concepts": "local restaurants, convenience stores, grocery stores, market tours, retail types, corner stores, chain restaurants, grocery store tours, restaurant", "concept_list": ["local restaurants", "convenience stores", "grocery stores", "market tours", "retail types", "corner stores", "chain restaurants", "grocery store tours", "restaurant"], "type": "cluster", "node_size": 42, "label": "Local Farmers"}, "Education Systems": {"concepts": "educational environment, curriculum, school systems, education, literacy, schools, coursework, after school programming, summertime programming, genesee county health department, michigan department of education, flint city schools, lifelong learning, reading lesson, teaching, genesee county intermediate school district, community college", "concept_list": ["educational environment", "curriculum", "school systems", "education", "literacy", "schools", "coursework", "after school programming", "summertime programming", "genesee county health department", "michigan department of education", "flint city schools", "lifelong learning", "reading lesson", "teaching", "genesee county intermediate school district", "community college"], "type": "cluster", "node_size": 66, "label": "Education Systems"}, "Local Food Economy": {"concepts": "facebook sales, youth habits, local produce, culinary program, economic development, snap benefits, siloed organizations, farmers markets, michigan department of agriculture, snap, local agriculture, financial barriers, rental facility, local producers, snap benefit systems, local economy, water crisis", "concept_list": ["facebook sales", "youth habits", "local produce", "culinary program", "economic development", "snap benefits", "siloed organizations", "farmers markets", "michigan department of agriculture", "snap", "local agriculture", "financial barriers", "rental facility", "local producers", "snap benefit systems", "local economy", "water crisis"], "type": "cluster", "node_size": 66, "label": "Local Food Economy"}, "Business Planning": {"concepts": "cost structure, business rules, legitimate business, business counseling, business planning, business structure, startup cost", "concept_list": ["cost structure", "business rules", "legitimate business", "business counseling", "business planning", "business structure", "startup cost"], "type": "cluster", "node_size": 36, "label": "Business Planning"}};
        const conceptData = {};
        const interClusterEdges = [["Nutrition & Food Access", "Education Systems", {"weight": 1.0, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Local Farmers", {"weight": 1.0, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Economic Development", {"weight": 1.0, "confidence": 0.8999999999999999, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Community Partnerships", {"weight": 1.0, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Local Food Economy", {"weight": 1.0, "confidence": 0.6375000000000001, "type": "inter_cluster", "style": "solid"}], ["Nutrition & Food Access", "Business Planning", {"weight": -1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Economic Development", "Education Systems", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Economic Development", "Local Food Economy", {"weight": 1.0, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Economic Development", "Nutrition & Food Access", {"weight": 1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["Economic Development", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.6375000000000001, "type": "inter_cluster", "style": "solid"}], ["Economic Development", "Business Planning", {"weight": -1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Economic Development", {"weight": 1.0, "confidence": 0.7125000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Nutrition & Food Access", {"weight": 1.0, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Business Planning", {"weight": 0.3333333333333333, "confidence": 0.6833333333333335, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Education Systems", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Nutrition & Food Access", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Local Food Economy", {"weight": 1.0, "confidence": 0.6625000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Community Partnerships", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Business Planning", {"weight": 0.3333333333333333, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Economic Development", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Retail Outlets", "Local Farmers", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Community Partnerships", {"weight": 1.0, "confidence": 0.5750000000000001, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Nutrition & Food Access", {"weight": -1.0, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Education Systems", {"weight": 1.0, "confidence": 0.5874999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Economic Development", {"weight": -0.3333333333333333, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Local Food Economy", {"weight": 1.0, "confidence": 0.5666666666666668, "type": "inter_cluster", "style": "solid"}], ["Local Farmers", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Economic Development", {"weight": 1.0, "confidence": 0.8375, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Nutrition & Food Access", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Business Planning", {"weight": -1.0, "confidence": 0.6166666666666666, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Community Partnerships", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Local Food Economy", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Local Farmers", {"weight": 0.75, "confidence": 0.4375, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Local Farmers", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Nutrition & Food Access", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Economic Development", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Food Retail Outlets", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Community Partnerships", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Business Planning", {"weight": 0.3333333333333333, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Local Food Economy", "Education Systems", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Economic Development", {"weight": -1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Local Farmers", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Nutrition & Food Access", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Community Partnerships", {"weight": -0.5, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Local Food Economy", {"weight": -1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Food Retail Outlets", {"weight": -0.3333333333333333, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Business Planning", "Education Systems", {"weight": -1.0, "confidence": 0.5666666666666667, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Nutrition & Food Access": [], "Economic Development": [], "Community Partnerships": [], "Food Retail Outlets": [], "Local Farmers": [], "Education Systems": [], "Local Food Economy": [], "Business Planning": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
