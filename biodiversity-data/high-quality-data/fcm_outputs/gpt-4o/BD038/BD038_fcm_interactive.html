
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Environmental Management": {"concepts": "nonprofit groups, audubon society, citizen scientists, data sharing, public engagement", "concept_list": ["nonprofit groups", "audubon society", "citizen scientists", "data sharing", "public engagement"], "type": "cluster", "node_size": 30, "label": "Environmental Management"}, "Biodiversity and Ecosystems": {"concepts": "waterkeeper alliance, pollution intervention, incentivization, improvement plans, environmental nonprofit, species of conservation concern, mobile baykeeper, public use, visualize thoughts, migrations, habitats, human impacts, mobile bay, mobile bay area, perception of nature, universities, management policies, poster child species, invasive species, conservation science, michigan state, management concepts, preferred state, mobile alabama, mental modeler, mitigation banks", "concept_list": ["waterkeeper alliance", "pollution intervention", "incentivization", "improvement plans", "environmental nonprofit", "species of conservation concern", "mobile baykeeper", "public use", "visualize thoughts", "migrations", "habitats", "human impacts", "mobile bay", "mobile bay area", "perception of nature", "universities", "management policies", "poster child species", "invasive species", "conservation science", "michigan state", "management concepts", "preferred state", "mobile alabama", "mental modeler", "mitigation banks"], "type": "cluster", "node_size": 93, "label": "Biodiversity and Ecosystems"}, "Habitat Protection": {"concepts": "species, protected species, ecosystem functionality, key food web supporting species, species counts, harmful organisms, listed species, ecosystem diversity, biodiversity data, seasonality, keystone species, public species counts, sensitive species, ecosystem function, biodiversity, food web supporting species, food webs", "concept_list": ["species", "protected species", "ecosystem functionality", "key food web supporting species", "species counts", "harmful organisms", "listed species", "ecosystem diversity", "biodiversity data", "seasonality", "keystone species", "public species counts", "sensitive species", "ecosystem function", "biodiversity", "food web supporting species", "food webs"], "type": "cluster", "node_size": 66, "label": "Habitat Protection"}, "Organizational Activities": {"concepts": "habitat forming species, access to habitats, urbanized wildlife interactions, protection of habitat, native vegetation, habitat protection, habitat functionality, habitat production, habitat survey., habitat", "concept_list": ["habitat forming species", "access to habitats", "urbanized wildlife interactions", "protection of habitat", "native vegetation", "habitat protection", "habitat functionality", "habitat production", "habitat survey.", "habitat"], "type": "cluster", "node_size": 45, "label": "Organizational Activities"}, "Public Engagement": {"concepts": "sackett, staff scientist, workshop, alvin, team retreat, password, epa, picasso, username, filtration services, fragmentation, epa enforcement, dali, ai platform, assign weights, army corps, us army corps of engineers, rorschach test, diversity of organisms, army corps of engineers", "concept_list": ["sackett", "staff scientist", "workshop", "alvin", "team retreat", "password", "epa", "picasso", "username", "filtration services", "fragmentation", "epa enforcement", "dali", "ai platform", "assign weights", "army corps", "us army corps of engineers", "rorschach test", "diversity of organisms", "army corps of engineers"], "type": "cluster", "node_size": 75, "label": "Public Engagement"}, "Coastal Ecosystems": {"concepts": "riparian bank, seagrass beds, wetland clearing, coastal waters, us fish and wildlife service, oyster restoration, fish consumption, submerged aquatic vegetation, marine resource management, fish and wildlife propagation, wetlands", "concept_list": ["riparian bank", "seagrass beds", "wetland clearing", "coastal waters", "us fish and wildlife service", "oyster restoration", "fish consumption", "submerged aquatic vegetation", "marine resource management", "fish and wildlife propagation", "wetlands"], "type": "cluster", "node_size": 48, "label": "Coastal Ecosystems"}, "Water Quality Management": {"concepts": "wastewater treatment, water improvement plans, water quality, water quality enforcement., water improvement, water quality enforcement, clean water act, water quality monitoring, effluent, recreational waterways, water quality thresholds, impaired waterways", "concept_list": ["wastewater treatment", "water improvement plans", "water quality", "water quality enforcement.", "water improvement", "water quality enforcement", "clean water act", "water quality monitoring", "effluent", "recreational waterways", "water quality thresholds", "impaired waterways"], "type": "cluster", "node_size": 51, "label": "Water Quality Management"}, "Regulatory Enforcement": {"concepts": "regulatory enforcement, state agencies, federal enforcement, regulatory agencies, local experts, state standards, court, development credits, federal standards, enforcement, litigation", "concept_list": ["regulatory enforcement", "state agencies", "federal enforcement", "regulatory agencies", "local experts", "state standards", "court", "development credits", "federal standards", "enforcement", "litigation"], "type": "cluster", "node_size": 48, "label": "Regulatory Enforcement"}};
        const conceptData = {"nonprofit groups": {"concepts": "nonprofit groups", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "nonprofit groups"}, "audubon society": {"concepts": "audubon society", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "audubon society"}, "citizen scientists": {"concepts": "citizen scientists", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "citizen scientists"}, "data sharing": {"concepts": "data sharing", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "data sharing"}, "public engagement": {"concepts": "public engagement", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "public engagement"}, "waterkeeper alliance": {"concepts": "waterkeeper alliance", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "waterkeeper alliance"}, "pollution intervention": {"concepts": "pollution intervention", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "pollution intervention"}, "incentivization": {"concepts": "incentivization", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "incentivization"}, "improvement plans": {"concepts": "improvement plans", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "improvement plans"}, "environmental nonprofit": {"concepts": "environmental nonprofit", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "environmental nonprofit"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "species of conservation concern"}, "mobile baykeeper": {"concepts": "mobile baykeeper", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile baykeeper"}, "public use": {"concepts": "public use", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "public use"}, "visualize thoughts": {"concepts": "visualize thoughts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "visualize thoughts"}, "migrations": {"concepts": "migrations", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "migrations"}, "habitats": {"concepts": "habitats", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "habitats"}, "human impacts": {"concepts": "human impacts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "human impacts"}, "mobile bay": {"concepts": "mobile bay", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile bay"}, "mobile bay area": {"concepts": "mobile bay area", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile bay area"}, "perception of nature": {"concepts": "perception of nature", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "perception of nature"}, "universities": {"concepts": "universities", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "universities"}, "management policies": {"concepts": "management policies", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "management policies"}, "poster child species": {"concepts": "poster child species", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "poster child species"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "invasive species"}, "conservation science": {"concepts": "conservation science", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "conservation science"}, "michigan state": {"concepts": "michigan state", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "michigan state"}, "management concepts": {"concepts": "management concepts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "management concepts"}, "preferred state": {"concepts": "preferred state", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "preferred state"}, "mobile alabama": {"concepts": "mobile alabama", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile alabama"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mental modeler"}, "mitigation banks": {"concepts": "mitigation banks", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mitigation banks"}, "species": {"concepts": "species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "species"}, "protected species": {"concepts": "protected species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "protected species"}, "ecosystem functionality": {"concepts": "ecosystem functionality", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem functionality"}, "key food web supporting species": {"concepts": "key food web supporting species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "key food web supporting species"}, "species counts": {"concepts": "species counts", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "species counts"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "harmful organisms"}, "listed species": {"concepts": "listed species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "listed species"}, "ecosystem diversity": {"concepts": "ecosystem diversity", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem diversity"}, "biodiversity data": {"concepts": "biodiversity data", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "biodiversity data"}, "seasonality": {"concepts": "seasonality", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "seasonality"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "keystone species"}, "public species counts": {"concepts": "public species counts", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "public species counts"}, "sensitive species": {"concepts": "sensitive species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "sensitive species"}, "ecosystem function": {"concepts": "ecosystem function", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem function"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "biodiversity"}, "food web supporting species": {"concepts": "food web supporting species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "food web supporting species"}, "food webs": {"concepts": "food webs", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "food webs"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat forming species"}, "access to habitats": {"concepts": "access to habitats", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "access to habitats"}, "urbanized wildlife interactions": {"concepts": "urbanized wildlife interactions", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "urbanized wildlife interactions"}, "protection of habitat": {"concepts": "protection of habitat", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "protection of habitat"}, "native vegetation": {"concepts": "native vegetation", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "native vegetation"}, "habitat protection": {"concepts": "habitat protection", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat protection"}, "habitat functionality": {"concepts": "habitat functionality", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat functionality"}, "habitat production": {"concepts": "habitat production", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat production"}, "habitat survey.": {"concepts": "habitat survey.", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat survey."}, "habitat": {"concepts": "habitat", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat"}, "sackett": {"concepts": "sackett", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "sackett"}, "staff scientist": {"concepts": "staff scientist", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "staff scientist"}, "workshop": {"concepts": "workshop", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "workshop"}, "alvin": {"concepts": "alvin", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "alvin"}, "team retreat": {"concepts": "team retreat", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "team retreat"}, "password": {"concepts": "password", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "password"}, "epa": {"concepts": "epa", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "epa"}, "picasso": {"concepts": "picasso", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "picasso"}, "username": {"concepts": "username", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "username"}, "filtration services": {"concepts": "filtration services", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "filtration services"}, "fragmentation": {"concepts": "fragmentation", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "fragmentation"}, "epa enforcement": {"concepts": "epa enforcement", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "epa enforcement"}, "dali": {"concepts": "dali", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "dali"}, "ai platform": {"concepts": "ai platform", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "ai platform"}, "assign weights": {"concepts": "assign weights", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "assign weights"}, "army corps": {"concepts": "army corps", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "army corps"}, "us army corps of engineers": {"concepts": "us army corps of engineers", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "us army corps of engineers"}, "rorschach test": {"concepts": "rorschach test", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "rorschach test"}, "diversity of organisms": {"concepts": "diversity of organisms", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "diversity of organisms"}, "army corps of engineers": {"concepts": "army corps of engineers", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "army corps of engineers"}, "riparian bank": {"concepts": "riparian bank", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "riparian bank"}, "seagrass beds": {"concepts": "seagrass beds", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "seagrass beds"}, "wetland clearing": {"concepts": "wetland clearing", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "wetland clearing"}, "coastal waters": {"concepts": "coastal waters", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "coastal waters"}, "us fish and wildlife service": {"concepts": "us fish and wildlife service", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "us fish and wildlife service"}, "oyster restoration": {"concepts": "oyster restoration", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "oyster restoration"}, "fish consumption": {"concepts": "fish consumption", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "fish consumption"}, "submerged aquatic vegetation": {"concepts": "submerged aquatic vegetation", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "submerged aquatic vegetation"}, "marine resource management": {"concepts": "marine resource management", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "marine resource management"}, "fish and wildlife propagation": {"concepts": "fish and wildlife propagation", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "fish and wildlife propagation"}, "wetlands": {"concepts": "wetlands", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "wetlands"}, "wastewater treatment": {"concepts": "wastewater treatment", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "wastewater treatment"}, "water improvement plans": {"concepts": "water improvement plans", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water improvement plans"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality"}, "water quality enforcement.": {"concepts": "water quality enforcement.", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality enforcement."}, "water improvement": {"concepts": "water improvement", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water improvement"}, "water quality enforcement": {"concepts": "water quality enforcement", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality enforcement"}, "clean water act": {"concepts": "clean water act", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "clean water act"}, "water quality monitoring": {"concepts": "water quality monitoring", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality monitoring"}, "effluent": {"concepts": "effluent", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "effluent"}, "recreational waterways": {"concepts": "recreational waterways", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "recreational waterways"}, "water quality thresholds": {"concepts": "water quality thresholds", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality thresholds"}, "impaired waterways": {"concepts": "impaired waterways", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "impaired waterways"}, "regulatory enforcement": {"concepts": "regulatory enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "regulatory enforcement"}, "state agencies": {"concepts": "state agencies", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "state agencies"}, "federal enforcement": {"concepts": "federal enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "federal enforcement"}, "regulatory agencies": {"concepts": "regulatory agencies", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "regulatory agencies"}, "local experts": {"concepts": "local experts", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "local experts"}, "state standards": {"concepts": "state standards", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "state standards"}, "court": {"concepts": "court", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "court"}, "development credits": {"concepts": "development credits", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "development credits"}, "federal standards": {"concepts": "federal standards", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "federal standards"}, "enforcement": {"concepts": "enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "enforcement"}, "litigation": {"concepts": "litigation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "litigation"}};
        const interClusterEdges = [["Environmental Management", "Water Quality Management", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Environmental Management", "Organizational Activities", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Environmental Management", "Habitat Protection", {"weight": 0.6666666666666666, "confidence": 0.5499999999999999, "type": "inter_cluster", "style": "solid"}], ["Environmental Management", "Public Engagement", {"weight": 0.4, "confidence": 0.33999999999999997, "type": "inter_cluster", "style": "solid"}], ["Environmental Management", "Biodiversity and Ecosystems", {"weight": 0.25, "confidence": 0.1875, "type": "inter_cluster", "style": "solid"}], ["Biodiversity and Ecosystems", "Environmental Management", {"weight": 0.6, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Biodiversity and Ecosystems", "Habitat Protection", {"weight": 0.6, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Biodiversity and Ecosystems", "Coastal Ecosystems", {"weight": 0.4, "confidence": 0.30999999999999994, "type": "inter_cluster", "style": "solid"}], ["Biodiversity and Ecosystems", "Organizational Activities", {"weight": 0.4, "confidence": 0.32999999999999996, "type": "inter_cluster", "style": "solid"}], ["Habitat Protection", "Regulatory Enforcement", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Habitat Protection", "Biodiversity and Ecosystems", {"weight": 0.75, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Habitat Protection", "Environmental Management", {"weight": 0.6666666666666666, "confidence": 0.5166666666666667, "type": "inter_cluster", "style": "solid"}], ["Habitat Protection", "Water Quality Management", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Biodiversity and Ecosystems", {"weight": 0.8, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Water Quality Management", {"weight": 0.8, "confidence": 0.6500000000000001, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Regulatory Enforcement", {"weight": 0.6, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Habitat Protection", {"weight": 0.4, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Environmental Management", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Organizational Activities", "Coastal Ecosystems", {"weight": 0.2, "confidence": 0.16999999999999998, "type": "inter_cluster", "style": "solid"}], ["Public Engagement", "Habitat Protection", {"weight": 0.6, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Public Engagement", "Coastal Ecosystems", {"weight": 0.6666666666666666, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Public Engagement", "Organizational Activities", {"weight": 0.4, "confidence": 0.34, "type": "inter_cluster", "style": "solid"}], ["Public Engagement", "Environmental Management", {"weight": 0.4, "confidence": 0.29000000000000004, "type": "inter_cluster", "style": "solid"}], ["Public Engagement", "Regulatory Enforcement", {"weight": 0.4, "confidence": 0.32999999999999996, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystems", "Environmental Management", {"weight": 0.8, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystems", "Organizational Activities", {"weight": 0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystems", "Habitat Protection", {"weight": 0.5, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Water Quality Management", "Coastal Ecosystems", {"weight": 0.6, "confidence": 0.4800000000000001, "type": "inter_cluster", "style": "solid"}], ["Water Quality Management", "Organizational Activities", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Water Quality Management", "Habitat Protection", {"weight": 0.4, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Water Quality Management", "Regulatory Enforcement", {"weight": 0.2, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Public Engagement", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Environmental Management", {"weight": 0.6, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Water Quality Management", {"weight": 0.6666666666666666, "confidence": 0.5499999999999999, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Biodiversity and Ecosystems", {"weight": 0.4, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Coastal Ecosystems", {"weight": 0.2, "confidence": 0.16999999999999998, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Environmental Management": [["nonprofit groups", {"concepts": "nonprofit groups", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "nonprofit groups"}], ["audubon society", {"concepts": "audubon society", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "audubon society"}], ["citizen scientists", {"concepts": "citizen scientists", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "citizen scientists"}], ["data sharing", {"concepts": "data sharing", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "data sharing"}], ["public engagement", {"concepts": "public engagement", "type": "concept", "cluster": "Environmental Management", "node_size": 10, "label": "public engagement"}]], "Biodiversity and Ecosystems": [["waterkeeper alliance", {"concepts": "waterkeeper alliance", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "waterkeeper alliance"}], ["pollution intervention", {"concepts": "pollution intervention", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "pollution intervention"}], ["incentivization", {"concepts": "incentivization", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "incentivization"}], ["improvement plans", {"concepts": "improvement plans", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "improvement plans"}], ["environmental nonprofit", {"concepts": "environmental nonprofit", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "environmental nonprofit"}], ["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "species of conservation concern"}], ["mobile baykeeper", {"concepts": "mobile baykeeper", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile baykeeper"}], ["public use", {"concepts": "public use", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "public use"}], ["visualize thoughts", {"concepts": "visualize thoughts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "visualize thoughts"}], ["migrations", {"concepts": "migrations", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "migrations"}], ["habitats", {"concepts": "habitats", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "habitats"}], ["human impacts", {"concepts": "human impacts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "human impacts"}], ["mobile bay", {"concepts": "mobile bay", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile bay"}], ["mobile bay area", {"concepts": "mobile bay area", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile bay area"}], ["perception of nature", {"concepts": "perception of nature", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "perception of nature"}], ["universities", {"concepts": "universities", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "universities"}], ["management policies", {"concepts": "management policies", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "management policies"}], ["poster child species", {"concepts": "poster child species", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "poster child species"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "invasive species"}], ["conservation science", {"concepts": "conservation science", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "conservation science"}], ["michigan state", {"concepts": "michigan state", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "michigan state"}], ["management concepts", {"concepts": "management concepts", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "management concepts"}], ["preferred state", {"concepts": "preferred state", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "preferred state"}], ["mobile alabama", {"concepts": "mobile alabama", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mobile alabama"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mental modeler"}], ["mitigation banks", {"concepts": "mitigation banks", "type": "concept", "cluster": "Biodiversity and Ecosystems", "node_size": 10, "label": "mitigation banks"}]], "Habitat Protection": [["species", {"concepts": "species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "species"}], ["protected species", {"concepts": "protected species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "protected species"}], ["ecosystem functionality", {"concepts": "ecosystem functionality", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem functionality"}], ["key food web supporting species", {"concepts": "key food web supporting species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "key food web supporting species"}], ["species counts", {"concepts": "species counts", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "species counts"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "harmful organisms"}], ["listed species", {"concepts": "listed species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "listed species"}], ["ecosystem diversity", {"concepts": "ecosystem diversity", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem diversity"}], ["biodiversity data", {"concepts": "biodiversity data", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "biodiversity data"}], ["seasonality", {"concepts": "seasonality", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "seasonality"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "keystone species"}], ["public species counts", {"concepts": "public species counts", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "public species counts"}], ["sensitive species", {"concepts": "sensitive species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "sensitive species"}], ["ecosystem function", {"concepts": "ecosystem function", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "ecosystem function"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "biodiversity"}], ["food web supporting species", {"concepts": "food web supporting species", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "food web supporting species"}], ["food webs", {"concepts": "food webs", "type": "concept", "cluster": "Habitat Protection", "node_size": 10, "label": "food webs"}]], "Organizational Activities": [["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat forming species"}], ["access to habitats", {"concepts": "access to habitats", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "access to habitats"}], ["urbanized wildlife interactions", {"concepts": "urbanized wildlife interactions", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "urbanized wildlife interactions"}], ["protection of habitat", {"concepts": "protection of habitat", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "protection of habitat"}], ["native vegetation", {"concepts": "native vegetation", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "native vegetation"}], ["habitat protection", {"concepts": "habitat protection", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat protection"}], ["habitat functionality", {"concepts": "habitat functionality", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat functionality"}], ["habitat production", {"concepts": "habitat production", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat production"}], ["habitat survey.", {"concepts": "habitat survey.", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat survey."}], ["habitat", {"concepts": "habitat", "type": "concept", "cluster": "Organizational Activities", "node_size": 10, "label": "habitat"}]], "Public Engagement": [["sackett", {"concepts": "sackett", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "sackett"}], ["staff scientist", {"concepts": "staff scientist", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "staff scientist"}], ["workshop", {"concepts": "workshop", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "workshop"}], ["alvin", {"concepts": "alvin", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "alvin"}], ["team retreat", {"concepts": "team retreat", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "team retreat"}], ["password", {"concepts": "password", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "password"}], ["epa", {"concepts": "epa", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "epa"}], ["picasso", {"concepts": "picasso", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "picasso"}], ["username", {"concepts": "username", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "username"}], ["filtration services", {"concepts": "filtration services", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "filtration services"}], ["fragmentation", {"concepts": "fragmentation", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "fragmentation"}], ["epa enforcement", {"concepts": "epa enforcement", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "epa enforcement"}], ["dali", {"concepts": "dali", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "dali"}], ["ai platform", {"concepts": "ai platform", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "ai platform"}], ["assign weights", {"concepts": "assign weights", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "assign weights"}], ["army corps", {"concepts": "army corps", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "army corps"}], ["us army corps of engineers", {"concepts": "us army corps of engineers", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "us army corps of engineers"}], ["rorschach test", {"concepts": "rorschach test", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "rorschach test"}], ["diversity of organisms", {"concepts": "diversity of organisms", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "diversity of organisms"}], ["army corps of engineers", {"concepts": "army corps of engineers", "type": "concept", "cluster": "Public Engagement", "node_size": 10, "label": "army corps of engineers"}]], "Coastal Ecosystems": [["riparian bank", {"concepts": "riparian bank", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "riparian bank"}], ["seagrass beds", {"concepts": "seagrass beds", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "seagrass beds"}], ["wetland clearing", {"concepts": "wetland clearing", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "wetland clearing"}], ["coastal waters", {"concepts": "coastal waters", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "coastal waters"}], ["us fish and wildlife service", {"concepts": "us fish and wildlife service", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "us fish and wildlife service"}], ["oyster restoration", {"concepts": "oyster restoration", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "oyster restoration"}], ["fish consumption", {"concepts": "fish consumption", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "fish consumption"}], ["submerged aquatic vegetation", {"concepts": "submerged aquatic vegetation", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "submerged aquatic vegetation"}], ["marine resource management", {"concepts": "marine resource management", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "marine resource management"}], ["fish and wildlife propagation", {"concepts": "fish and wildlife propagation", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "fish and wildlife propagation"}], ["wetlands", {"concepts": "wetlands", "type": "concept", "cluster": "Coastal Ecosystems", "node_size": 10, "label": "wetlands"}]], "Water Quality Management": [["wastewater treatment", {"concepts": "wastewater treatment", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "wastewater treatment"}], ["water improvement plans", {"concepts": "water improvement plans", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water improvement plans"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality"}], ["water quality enforcement.", {"concepts": "water quality enforcement.", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality enforcement."}], ["water improvement", {"concepts": "water improvement", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water improvement"}], ["water quality enforcement", {"concepts": "water quality enforcement", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality enforcement"}], ["clean water act", {"concepts": "clean water act", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "clean water act"}], ["water quality monitoring", {"concepts": "water quality monitoring", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality monitoring"}], ["effluent", {"concepts": "effluent", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "effluent"}], ["recreational waterways", {"concepts": "recreational waterways", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "recreational waterways"}], ["water quality thresholds", {"concepts": "water quality thresholds", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "water quality thresholds"}], ["impaired waterways", {"concepts": "impaired waterways", "type": "concept", "cluster": "Water Quality Management", "node_size": 10, "label": "impaired waterways"}]], "Regulatory Enforcement": [["regulatory enforcement", {"concepts": "regulatory enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "regulatory enforcement"}], ["state agencies", {"concepts": "state agencies", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "state agencies"}], ["federal enforcement", {"concepts": "federal enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "federal enforcement"}], ["regulatory agencies", {"concepts": "regulatory agencies", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "regulatory agencies"}], ["local experts", {"concepts": "local experts", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "local experts"}], ["state standards", {"concepts": "state standards", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "state standards"}], ["court", {"concepts": "court", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "court"}], ["development credits", {"concepts": "development credits", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "development credits"}], ["federal standards", {"concepts": "federal standards", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "federal standards"}], ["enforcement", {"concepts": "enforcement", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "enforcement"}], ["litigation", {"concepts": "litigation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "litigation"}]]};
        const clusterEdges = {"Environmental Management": [], "Biodiversity and Ecosystems": [], "Habitat Protection": [], "Organizational Activities": [], "Public Engagement": [], "Coastal Ecosystems": [], "Water Quality Management": [], "Regulatory Enforcement": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
