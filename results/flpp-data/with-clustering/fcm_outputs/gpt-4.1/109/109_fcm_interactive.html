
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"School & Community Support": {"concepts": "food safety, food support, food system, foodcorps, food delivery, gluten free, processed food, food quality, farmer market buying, prison food, food insecurity, farmers markets, food effort, double up food bucks, healthy foods, food freshness, supplemental nutrition programs, local farmers, vegetables, nutritious food, local restaurants, food preparation, food energy, nutritious foods, food desert, food stamps, convenience stores, healthy eating, retail types, food access, local grocer, retail use, lead poisoning, food system map, celiac disease, processed foods, grocery shopping, food site, food improvement, food availability, meal experience, high fructose corn syrup, retail sector, food affordability, food distributions, cooking classes, food distribution, fresh fruits, food policy, food outcomes, food equity, food service, grocery stores, chain restaurants", "concept_list": ["food safety", "food support", "food system", "foodcorps", "food delivery", "gluten free", "processed food", "food quality", "farmer market buying", "prison food", "food insecurity", "farmers markets", "food effort", "double up food bucks", "healthy foods", "food freshness", "supplemental nutrition programs", "local farmers", "vegetables", "nutritious food", "local restaurants", "food preparation", "food energy", "nutritious foods", "food desert", "food stamps", "convenience stores", "healthy eating", "retail types", "food access", "local grocer", "retail use", "lead poisoning", "food system map", "celiac disease", "processed foods", "grocery shopping", "food site", "food improvement", "food availability", "meal experience", "high fructose corn syrup", "retail sector", "food affordability", "food distributions", "cooking classes", "food distribution", "fresh fruits", "food policy", "food outcomes", "food equity", "food service", "grocery stores", "chain restaurants"], "type": "cluster", "node_size": 177, "label": "School & Community Support"}, "Food Access & Quality": {"concepts": "participants, positive relationship, subcontracting, school cafeterias, flint fresh, free school lunches, education nonprofit, high school, sports events, quality of life, questionnaire, cei, americorps, school site, reduced lunch, leverage points, transportation, family responsibility, veggies, inspection standards, community based, school gardens, nonprofit, water crisis, negative relationship, flint students, education, career goals, meijer, budgeting, supplemental help, community, students, distributions, community empowerment, paperwork, aid, kroger, research project, decision makers, candy, flint cei, supplemental sector, school meals, student meals, illnesses, free lunch, education programs, sodexo, outcomes, funders, school lunch, fresh veggies, americorps grant, partnerships, garden scale, pandemic, school board, workers, availability, election, affordability, delivery, building inspection, diagnosis, student health, school lunches, rats, school diet, communication, research, northwestern, school administration, culture, photo research, funding, government assistance, genesee county, walmart, rural schools, covid-19, educational outcomes, school workers, research team, school feeding, school district, garden program, garden management, salad bar, snap, kitchen, united way, cheap labor, urban schools, transportation system, churches, income, protein, student nutrition, ngo, emergency sector, ngos, exit survey, mold, school support, public schools, sustainability, flint school board, after school programming, school facilities", "concept_list": ["participants", "positive relationship", "subcontracting", "school cafeterias", "flint fresh", "free school lunches", "education nonprofit", "high school", "sports events", "quality of life", "questionnaire", "cei", "americorps", "school site", "reduced lunch", "leverage points", "transportation", "family responsibility", "veggies", "inspection standards", "community based", "school gardens", "nonprofit", "water crisis", "negative relationship", "flint students", "education", "career goals", "meijer", "budgeting", "supplemental help", "community", "students", "distributions", "community empowerment", "paperwork", "aid", "kroger", "research project", "decision makers", "candy", "flint cei", "supplemental sector", "school meals", "student meals", "illnesses", "free lunch", "education programs", "sodexo", "outcomes", "funders", "school lunch", "fresh veggies", "americorps grant", "partnerships", "garden scale", "pandemic", "school board", "workers", "availability", "election", "affordability", "delivery", "building inspection", "diagnosis", "student health", "school lunches", "rats", "school diet", "communication", "research", "northwestern", "school administration", "culture", "photo research", "funding", "government assistance", "genesee county", "walmart", "rural schools", "covid-19", "educational outcomes", "school workers", "research team", "school feeding", "school district", "garden program", "garden management", "salad bar", "snap", "kitchen", "united way", "cheap labor", "urban schools", "transportation system", "churches", "income", "protein", "student nutrition", "ngo", "emergency sector", "ngos", "exit survey", "mold", "school support", "public schools", "sustainability", "flint school board", "after school programming", "school facilities"], "type": "cluster", "node_size": 345, "label": "Food Access & Quality"}};
        const conceptData = {};
        const interClusterEdges = [["School & Community Support", "Food Access & Quality", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"School & Community Support": [], "Food Access & Quality": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
