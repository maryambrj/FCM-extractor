
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Wellbeing": {"concepts": "leverage, edible flint, focus, startup costs, outcomes, donating, connection strengths, stress reduction, volunteerism, solo projects, financial equity, human rights, quality of life, availability, clarity, flint, social stressors, corporations, comfort, suburbs, leverage points, doctoral research, group projects, happiness, health equity, environmental psychology, common good, therapeutic value, dignity, system connections, covid-19 impact, neighborhood groups, mental benefits, relationships, turnover, corporate influence, community access, cultural values, mental health, level playing field, affordability, system dynamics, community connections, person of color, snap, neighborhood partnership, community partnership, store closures, physical benefits, choices, values, partnerships, supplemental sector, emotional health, flint community schools, community engagement, social support, community empowerment, safety, mapping, supplemental programs, community support, feedback loops, exposure, financial help, wic, physical health, nature exposure, competitive pricing, lgbt community", "concept_list": ["leverage", "edible flint", "focus", "startup costs", "outcomes", "donating", "connection strengths", "stress reduction", "volunteerism", "solo projects", "financial equity", "human rights", "quality of life", "availability", "clarity", "flint", "social stressors", "corporations", "comfort", "suburbs", "leverage points", "doctoral research", "group projects", "happiness", "health equity", "environmental psychology", "common good", "therapeutic value", "dignity", "system connections", "covid-19 impact", "neighborhood groups", "mental benefits", "relationships", "turnover", "corporate influence", "community access", "cultural values", "mental health", "level playing field", "affordability", "system dynamics", "community connections", "person of color", "snap", "neighborhood partnership", "community partnership", "store closures", "physical benefits", "choices", "values", "partnerships", "supplemental sector", "emotional health", "flint community schools", "community engagement", "social support", "community empowerment", "safety", "mapping", "supplemental programs", "community support", "feedback loops", "exposure", "financial help", "wic", "physical health", "nature exposure", "competitive pricing", "lgbt community"], "type": "cluster", "node_size": 225, "label": "Community Wellbeing"}, "Food Access": {"concepts": "free food, processed foods, seasonal availability, gardening, agriculture groups, nutrition, canned foods, food systems, food knowledge, food system sectors, global food distribution, food quality, taste exposure, fresh foods, urban agriculture, nutritious foods, nutritious food, sensory experience, body awareness, food exposure, food desert, farm space, food values, communal food, backyard gardening, food literacy, vegetables, farmers market, fruits, food system, food security, local economic development, urban agriculture education, food distribution, fresh produce, supplemental nutrition programs, food availability, healthy food options, emergency food, emergency food source", "concept_list": ["free food", "processed foods", "seasonal availability", "gardening", "agriculture groups", "nutrition", "canned foods", "food systems", "food knowledge", "food system sectors", "global food distribution", "food quality", "taste exposure", "fresh foods", "urban agriculture", "nutritious foods", "nutritious food", "sensory experience", "body awareness", "food exposure", "food desert", "farm space", "food values", "communal food", "backyard gardening", "food literacy", "vegetables", "farmers market", "fruits", "food system", "food security", "local economic development", "urban agriculture education", "food distribution", "fresh produce", "supplemental nutrition programs", "food availability", "healthy food options", "emergency food", "emergency food source"], "type": "cluster", "node_size": 135, "label": "Food Access"}, "Food Retail": {"concepts": "global supply chains, grocery chains, consumer deskilling, convenience stores, local restaurants, retailer, retail use, grocery stores, retail types, chain restaurants", "concept_list": ["global supply chains", "grocery chains", "consumer deskilling", "convenience stores", "local restaurants", "retailer", "retail use", "grocery stores", "retail types", "chain restaurants"], "type": "cluster", "node_size": 45, "label": "Food Retail"}, "Youth Education": {"concepts": "education, cognitive development, outdoor activity, school performance, children, science education, youth education, teachers, outdoor education, childhood education, academic achievement, teacher training", "concept_list": ["education", "cognitive development", "outdoor activity", "school performance", "children", "science education", "youth education", "teachers", "outdoor education", "childhood education", "academic achievement", "teacher training"], "type": "cluster", "node_size": 51, "label": "Youth Education"}};
        const conceptData = {};
        const interClusterEdges = [["Community Wellbeing", "Food Access", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Wellbeing", "Youth Education", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Community Wellbeing", "Food Retail", {"weight": 0.6, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Wellbeing", {"weight": 1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Youth Education", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Retail", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Food Access", {"weight": 0.6, "confidence": 0.8200000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Community Wellbeing", {"weight": 0.6, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Youth Education", {"weight": 0.4, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Youth Education", "Food Access", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Youth Education", "Community Wellbeing", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Youth Education", "Food Retail", {"weight": 0.4, "confidence": 0.48, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Wellbeing": [], "Food Access": [], "Food Retail": [], "Youth Education": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
