
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"fishing sustainability": {"concepts": "fishing sustainability", "concept_list": ["fishing sustainability"], "type": "cluster", "node_size": 18, "label": "fishing sustainability"}, "Fishery Conflicts and Fairness": {"concepts": "usvi fisheries, full-time fishermen, fishers, commercial fisherman, fishermen, fishermen involvement, fisher conflicts", "concept_list": ["usvi fisheries", "full-time fishermen", "fishers", "commercial fisherman", "fishermen", "fishermen involvement", "fisher conflicts"], "type": "cluster", "node_size": 36, "label": "Fishery Conflicts and Fairness"}, "Fisher Relationships and Cooperation": {"concepts": "fishery decision-making, fishery conflicts, fishery conflict resolution, fishery management challenges, fishers conflicts, fishery management fairness, fisheries problems, fishery fairness, fisher conflicts", "concept_list": ["fishery decision-making", "fishery conflicts", "fishery conflict resolution", "fishery management challenges", "fishers conflicts", "fishery management fairness", "fisheries problems", "fishery fairness", "fisher conflicts"], "type": "cluster", "node_size": 42, "label": "Fisher Relationships and Cooperation"}, "Fishery Regulations and Species": {"concepts": "fishery organizational structure, caribbean fishery management council, fishery managers, fisheries education, fishers education, fisheries, fisheries advisory committee, fishery resource management, usvi fishery managers, fishery researchers, fishery closures, fishery managers relations, fishery education, fishery resource sustainability, fishery decisions, fishery management, fishery sustainability, fishery resources, fishery regulations, fishery policy, fisher relationships, fishery social dynamics, fishery stakeholders, fishers' relationships, fisherman groups, fisher cooperation, fishers fairness perception, fishery cooperation, fishery stakeholder engagement, fishery advisory committee, fishers cooperation, fishers relationships, fishery community, fishers livelihood, fishery future", "concept_list": ["fishery organizational structure", "caribbean fishery management council", "fishery managers", "fisheries education", "fishers education", "fisheries", "fisheries advisory committee", "fishery resource management", "usvi fishery managers", "fishery researchers", "fishery closures", "fishery managers relations", "fishery education", "fishery resource sustainability", "fishery decisions", "fishery management", "fishery sustainability", "fishery resources", "fishery regulations", "fishery policy", "fisher relationships", "fishery social dynamics", "fishery stakeholders", "fishers' relationships", "fisherman groups", "fisher cooperation", "fishers fairness perception", "fishery cooperation", "fishery stakeholder engagement", "fishery advisory committee", "fishers cooperation", "fishers relationships", "fishery community", "fishers livelihood", "fishery future"], "type": "cluster", "node_size": 120, "label": "Fishery Regulations and Species"}, "Fishermen and Fishing Roles": {"concepts": "conch season, baby conchs, overregulation, snapper closed area, area closures, lobster, sargassum, commercial catch, queen conch, commercial catch reports, regulations, lobster population, safe zones, queen conch closures", "concept_list": ["conch season", "baby conchs", "overregulation", "snapper closed area", "area closures", "lobster", "sargassum", "commercial catch", "queen conch", "commercial catch reports", "regulations", "lobster population", "safe zones", "queen conch closures"], "type": "cluster", "node_size": 57, "label": "Fishermen and Fishing Roles"}, "Community Engagement Challenges": {"concepts": "local meetings, social gatherings, district advisory panels, social conflict, communication issues, written communication, community cookout, town hall meetings, east end, government support, conflict resolution, meeting attendance", "concept_list": ["local meetings", "social gatherings", "district advisory panels", "social conflict", "communication issues", "written communication", "community cookout", "town hall meetings", "east end", "government support", "conflict resolution", "meeting attendance"], "type": "cluster", "node_size": 51, "label": "Community Engagement Challenges"}, "Virgin Islands Governance": {"concepts": "resource stakeholders, federal government, lawmakers, senators, decision-making, resource abuse, lawmaking process, local government, central island, island groups, drug users, usvi, researchers, governor, decision makers, virgin islands, ngo lawsuits, saint croix, boat traffic, saint thomas, cargo vessels, west end, st. croix, nature conservancy, diver safety", "concept_list": ["resource stakeholders", "federal government", "lawmakers", "senators", "decision-making", "resource abuse", "lawmaking process", "local government", "central island", "island groups", "drug users", "usvi", "researchers", "governor", "decision makers", "virgin islands", "ngo lawsuits", "saint croix", "boat traffic", "saint thomas", "cargo vessels", "west end", "st. croix", "nature conservancy", "diver safety"], "type": "cluster", "node_size": 90, "label": "Virgin Islands Governance"}, "Marine Resource Management": {"concepts": "customer loss, long liners, trolling, resource protection, large vessels, safety zones, dolphin migration, overprotection, construction, scalers, ball games, nautical zones", "concept_list": ["customer loss", "long liners", "trolling", "resource protection", "large vessels", "safety zones", "dolphin migration", "overprotection", "construction", "scalers", "ball games", "nautical zones"], "type": "cluster", "node_size": 51, "label": "Marine Resource Management"}, "Fishing Impact Factors": {"concepts": "fishing restrictions, fishing dependence, fishing dependency, fishing reduction, fishing population, fishing economy, fishing income", "concept_list": ["fishing restrictions", "fishing dependence", "fishing dependency", "fishing reduction", "fishing population", "fishing economy", "fishing income"], "type": "cluster", "node_size": 36, "label": "Fishing Impact Factors"}, "Community Meetings": {"concepts": "fishing community, fishing livelihoods, fishing methods, fishing practices, fishing environment", "concept_list": ["fishing community", "fishing livelihoods", "fishing methods", "fishing practices", "fishing environment"], "type": "cluster", "node_size": 30, "label": "Community Meetings"}, "Fishing Regulations": {"concepts": "fishing rules, fishing zones, fishing compliance, illegal fishing, fishing areas closure, fishing enforcement, fishing management, safe fishing zone, fishing closures, fishing safety, fishing regulations, fishing nets", "concept_list": ["fishing rules", "fishing zones", "fishing compliance", "illegal fishing", "fishing areas closure", "fishing enforcement", "fishing management", "safe fishing zone", "fishing closures", "fishing safety", "fishing regulations", "fishing nets"], "type": "cluster", "node_size": 51, "label": "Fishing Regulations"}, "Fishing Regulation & Support": {"concepts": "fishing support, fishing policy, fishing supply, fishing licenses, fishing assistance, fishing impact", "concept_list": ["fishing support", "fishing policy", "fishing supply", "fishing licenses", "fishing assistance", "fishing impact"], "type": "cluster", "node_size": 33, "label": "Fishing Regulation & Support"}, "Climate Change Awareness": {"concepts": "climate change awareness, climate change concern, climate change, environmental problems, environmental changes, environmental education", "concept_list": ["climate change awareness", "climate change concern", "climate change", "environmental problems", "environmental changes", "environmental education"], "type": "cluster", "node_size": 33, "label": "Climate Change Awareness"}, "Climate Impact Factors": {"concepts": "global warming, hurricanes, water temperature, construction impact, seasonal closures, seasonal changes, local climate", "concept_list": ["global warming", "hurricanes", "water temperature", "construction impact", "seasonal closures", "seasonal changes", "local climate"], "type": "cluster", "node_size": 36, "label": "Climate Impact Factors"}, "Fishing Community Insights": {"concepts": "fishing social dynamics, fishing complaints, fishing culture, fishing knowledge, fishing occupation, fishing history, fishing information, fishing adaptation", "concept_list": ["fishing social dynamics", "fishing complaints", "fishing culture", "fishing knowledge", "fishing occupation", "fishing history", "fishing information", "fishing adaptation"], "type": "cluster", "node_size": 39, "label": "Fishing Community Insights"}, "Fishing and Consumption": {"concepts": "fishing seasonality, fishing catch, fishing experience, seafood consumption, fishing seasons", "concept_list": ["fishing seasonality", "fishing catch", "fishing experience", "seafood consumption", "fishing seasons"], "type": "cluster", "node_size": 30, "label": "Fishing and Consumption"}, "Fishing Industry Sales": {"concepts": "commercial fishing, fishing gear, deep water fishing, fish sales, fishing sales, food sales", "concept_list": ["commercial fishing", "fishing gear", "deep water fishing", "fish sales", "fishing sales", "food sales"], "type": "cluster", "node_size": 33, "label": "Fishing Industry Sales"}, "Marine Area Protection": {"concepts": "international waters, east end marine park, shoreline, fishing area closures", "concept_list": ["international waters", "east end marine park", "shoreline", "fishing area closures"], "type": "cluster", "node_size": 27, "label": "Marine Area Protection"}, "Coastal Resource Management": {"concepts": "shoreline protection, fishery enforcement", "concept_list": ["shoreline protection", "fishery enforcement"], "type": "cluster", "node_size": 21, "label": "Coastal Resource Management"}, "Fishing Community Dynamics": {"concepts": "fishing community cooperation, fishing conflict, fishing conflicts", "concept_list": ["fishing community cooperation", "fishing conflict", "fishing conflicts"], "type": "cluster", "node_size": 24, "label": "Fishing Community Dynamics"}, "Fishery Meetings": {"concepts": "fishing meetings, fishers meetings, fishery meetings, fishery meetings attendance, fisher meetings", "concept_list": ["fishing meetings", "fishers meetings", "fishery meetings", "fishery meetings attendance", "fisher meetings"], "type": "cluster", "node_size": 30, "label": "Fishery Meetings"}, "Fisheries Communication": {"concepts": "fishers communication, fishing communication, fisher communication, fishery communication", "concept_list": ["fishers communication", "fishing communication", "fisher communication", "fishery communication"], "type": "cluster", "node_size": 27, "label": "Fisheries Communication"}, "Fishery Communication": {"concepts": "fishers' awareness, fishing collaboration, fishery communication barriers", "concept_list": ["fishers' awareness", "fishing collaboration", "fishery communication barriers"], "type": "cluster", "node_size": 24, "label": "Fishery Communication"}, "Fish Population Ecology": {"concepts": "fish abundance, spawning zones, local fish, fish species, sturgeon fish", "concept_list": ["fish abundance", "spawning zones", "local fish", "fish species", "sturgeon fish"], "type": "cluster", "node_size": 30, "label": "Fish Population Ecology"}, "Coastal Ecosystem Health": {"concepts": "marine ecosystem, sea grass loss, beach erosion, sea grass, atlantic ocean, algae, algae control", "concept_list": ["marine ecosystem", "sea grass loss", "beach erosion", "sea grass", "atlantic ocean", "algae", "algae control"], "type": "cluster", "node_size": 36, "label": "Coastal Ecosystem Health"}, "Marine Wildlife Protection": {"concepts": "puffer fish, white sea urchin, fish pots, poaching", "concept_list": ["puffer fish", "white sea urchin", "fish pots", "poaching"], "type": "cluster", "node_size": 27, "label": "Marine Wildlife Protection"}, "Coastal Environmental Impact": {"concepts": "coastal communities, fish cleaning, soil sediment", "concept_list": ["coastal communities", "fish cleaning", "soil sediment"], "type": "cluster", "node_size": 24, "label": "Coastal Environmental Impact"}, "Coral Reef Care": {"concepts": "coral recovery, reef cleaning, coral health", "concept_list": ["coral recovery", "reef cleaning", "coral health"], "type": "cluster", "node_size": 24, "label": "Coral Reef Care"}, "Coral Reef Damage": {"concepts": "reef destruction, reef bottom, coral reefs", "concept_list": ["reef destruction", "reef bottom", "coral reefs"], "type": "cluster", "node_size": 24, "label": "Coral Reef Damage"}, "Coral Species": {"concepts": "elkhorn corals, staghorn corals", "concept_list": ["elkhorn corals", "staghorn corals"], "type": "cluster", "node_size": 21, "label": "Coral Species"}, "Fishing Issues": {"concepts": "fishing theft, fishing challenges, fishing competition", "concept_list": ["fishing theft", "fishing challenges", "fishing competition"], "type": "cluster", "node_size": 24, "label": "Fishing Issues"}, "Fishing Professions": {"concepts": "lobster fishing, fishing divers, full-time fishing", "concept_list": ["lobster fishing", "fishing divers", "full-time fishing"], "type": "cluster", "node_size": 24, "label": "Fishing Professions"}, "Fishing Operations": {"concepts": "fishing agenda, fishing engines", "concept_list": ["fishing agenda", "fishing engines"], "type": "cluster", "node_size": 21, "label": "Fishing Operations"}};
        const conceptData = {};
        const interClusterEdges = [["fishing sustainability", "Fish Population Ecology", {"weight": 1.0, "confidence": 0.8625, "type": "inter_cluster", "style": "solid"}], ["fishing sustainability", "Coral Reef Care", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Fishery Conflicts and Fairness", "Fishery Meetings", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Fishery Conflicts and Fairness", "Fisheries Communication", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fishery Conflicts and Fairness", "Fishing Industry Sales", {"weight": 1.0, "confidence": 0.8624999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishery Conflicts and Fairness", "Coral Reef Care", {"weight": 0.75, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Fishery Regulations and Species", "Fishery Conflicts and Fairness", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Community Engagement Challenges", "Fishery Communication", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Engagement Challenges", "Fishing and Consumption", {"weight": 0.3333333333333333, "confidence": 0.2333333333333333, "type": "inter_cluster", "style": "solid"}], ["Virgin Islands Governance", "Coastal Ecosystem Health", {"weight": -0.6, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Marine Resource Management", "Fishing Regulations", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Marine Resource Management", "Community Meetings", {"weight": -0.75, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Marine Resource Management", "Coastal Environmental Impact", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fishing Impact Factors", "Coastal Resource Management", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Fishing Impact Factors", "Fishery Communication", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Fishing Regulation & Support", "Fishing Industry Sales", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Fishing Regulation & Support", "Coastal Resource Management", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Climate Change Awareness", "Fishermen and Fishing Roles", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Climate Impact Factors", "Fishery Conflicts and Fairness", {"weight": -1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Climate Impact Factors", "Fishing Impact Factors", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Insights", "Fishing Industry Sales", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Insights", "Fishery Conflicts and Fairness", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Insights", "Fishing Professions", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fishing and Consumption", "Fishing Issues", {"weight": 0.6666666666666666, "confidence": 0.4166666666666667, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry Sales", "Fishing Professions", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Fishing Industry Sales", "fishing sustainability", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Marine Area Protection", "Fishermen and Fishing Roles", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Marine Area Protection", "Fishing Community Insights", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Coastal Resource Management", "Fishing Regulation & Support", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Coastal Resource Management", "Coastal Environmental Impact", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Dynamics", "Fishing Impact Factors", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Dynamics", "Fishing Community Insights", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fishing Community Dynamics", "Coastal Environmental Impact", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Fishery Meetings", "Marine Resource Management", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Fisheries Communication", "Coastal Resource Management", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Fisheries Communication", "Fishing Industry Sales", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Fisheries Communication", "fishing sustainability", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Fisheries Communication", "Community Meetings", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fisheries Communication", "Marine Wildlife Protection", {"weight": -0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Fishery Communication", "Fishing Community Insights", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Fishery Communication", "Marine Resource Management", {"weight": 0.8, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Fishery Communication", "Fishing and Consumption", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Fish Population Ecology", "Fishery Communication", {"weight": 1.0, "confidence": 0.7300000000000001, "type": "inter_cluster", "style": "solid"}], ["Fish Population Ecology", "Fishermen and Fishing Roles", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Fish Population Ecology", "Virgin Islands Governance", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystem Health", "Fishing Operations", {"weight": -1.0, "confidence": 0.6399999999999999, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystem Health", "Marine Wildlife Protection", {"weight": -1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystem Health", "Fishery Regulations and Species", {"weight": 0.3333333333333333, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Coastal Ecosystem Health", "Community Meetings", {"weight": -1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Marine Wildlife Protection", "Fishing Regulation & Support", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Marine Wildlife Protection", "Climate Change Awareness", {"weight": 0.6666666666666666, "confidence": 0.43333333333333335, "type": "inter_cluster", "style": "solid"}], ["Coastal Environmental Impact", "Marine Area Protection", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Care", "Coral Reef Damage", {"weight": -1.0, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Damage", "Coastal Ecosystem Health", {"weight": -1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Damage", "fishing sustainability", {"weight": -1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Coral Species", "Community Meetings", {"weight": 1.0, "confidence": 0.7875, "type": "inter_cluster", "style": "solid"}], ["Coral Species", "Climate Change Awareness", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Fishing Issues", "Marine Wildlife Protection", {"weight": 1.0, "confidence": 0.77, "type": "inter_cluster", "style": "solid"}], ["Fishing Issues", "Fishing Regulation & Support", {"weight": -1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishing Issues", "Coastal Resource Management", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fishing Issues", "Fisher Relationships and Cooperation", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fishing Professions", "Fishing Issues", {"weight": 0.75, "confidence": 0.5125, "type": "inter_cluster", "style": "solid"}], ["Fishing Professions", "Marine Wildlife Protection", {"weight": 0.25, "confidence": 0.1625, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Fishery Conflicts and Fairness": [], "Fisher Relationships and Cooperation": [], "Fishery Regulations and Species": [], "Fishermen and Fishing Roles": [], "Community Engagement Challenges": [], "Virgin Islands Governance": [], "Marine Resource Management": [], "Fishing Impact Factors": [], "Community Meetings": [], "Fishing Regulations": [], "Fishing Regulation & Support": [], "Climate Change Awareness": [], "Climate Impact Factors": [], "Fishing Community Insights": [], "Fishing and Consumption": [], "Fishing Industry Sales": [], "Marine Area Protection": [], "Coastal Resource Management": [], "Fishing Community Dynamics": [], "Fishery Meetings": [], "Fisheries Communication": [], "Fishery Communication": [], "Fish Population Ecology": [], "Coastal Ecosystem Health": [], "Marine Wildlife Protection": [], "Coastal Environmental Impact": [], "Coral Reef Care": [], "Coral Reef Damage": [], "Coral Species": [], "Fishing Issues": [], "Fishing Professions": [], "Fishing Operations": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
