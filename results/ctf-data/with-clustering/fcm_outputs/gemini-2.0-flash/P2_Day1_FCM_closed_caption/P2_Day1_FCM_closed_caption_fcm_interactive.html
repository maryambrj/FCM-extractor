
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Access & Tools": {"concepts": "time, schedules, factors, purpose, progress, needs, system understanding, goals, knowledge beliefs decisions, general knowledge, prior knowledge, understandability, ability, success, failure, challenges, difficulties, steps success, impediments success, negative hindrance, unexpected surprise, distractions, subject matter expert, functional interest, labels, mislabeling, lack documentation, missing data, data availability, information, key items, available list, general list, data, data interpretation, data sheet, data sheets", "concept_list": ["time", "schedules", "factors", "purpose", "progress", "needs", "system understanding", "goals", "knowledge beliefs decisions", "general knowledge", "prior knowledge", "understandability", "ability", "success", "failure", "challenges", "difficulties", "steps success", "impediments success", "negative hindrance", "unexpected surprise", "distractions", "subject matter expert", "functional interest", "labels", "mislabeling", "lack documentation", "missing data", "data availability", "information", "key items", "available list", "general list", "data", "data interpretation", "data sheet", "data sheets"], "type": "cluster", "node_size": 126, "label": "Access & Tools"}, "Firmware Analysis": {"concepts": "hardware access, physical tools, supporting hardware, physical interface, physical requirements, physical interfacing, power filtering, standardized interfaces, interfacing, undocumented system, data protocol, successfully obtained access, access, gaining access, access goals, full access, access need, fail access, file read, partial access, full control, gain access, obtain primitives, necessary primitives, access failure, bespoke system, system, framework, components, software component, software features, tool software, software capabilities, software, firmware software, relationship, avenue, environment, environment data, layout importance, non-functional aid, functionality, social interaction, open-ended questions, semi-structured interview, knowledge repository, strategies, languages, problem solving, intuition, collect data, data collection, undocumented, computer visualization, tool availability", "concept_list": ["hardware access", "physical tools", "supporting hardware", "physical interface", "physical requirements", "physical interfacing", "power filtering", "standardized interfaces", "interfacing", "undocumented system", "data protocol", "successfully obtained access", "access", "gaining access", "access goals", "full access", "access need", "fail access", "file read", "partial access", "full control", "gain access", "obtain primitives", "necessary primitives", "access failure", "bespoke system", "system", "framework", "components", "software component", "software features", "tool software", "software capabilities", "software", "firmware software", "relationship", "avenue", "environment", "environment data", "layout importance", "non-functional aid", "functionality", "social interaction", "open-ended questions", "semi-structured interview", "knowledge repository", "strategies", "languages", "problem solving", "intuition", "collect data", "data collection", "undocumented", "computer visualization", "tool availability"], "type": "cluster", "node_size": 180, "label": "Firmware Analysis"}, "Process & Learning": {"concepts": "firmware security, firmware level, hardware level, software level, firmware, matrix version, reverse engineering, reverse engineered", "concept_list": ["firmware security", "firmware level", "hardware level", "software level", "firmware", "matrix version", "reverse engineering", "reverse engineered"], "type": "cluster", "node_size": 39, "label": "Process & Learning"}, "Testing & Reinforcement": {"concepts": "protocol understanding, capture the flag, new level, directed graph, task diagramming, negative reinforcement, iterative process", "concept_list": ["protocol understanding", "capture the flag", "new level", "directed graph", "task diagramming", "negative reinforcement", "iterative process"], "type": "cluster", "node_size": 36, "label": "Testing & Reinforcement"}, "Data & Understanding": {"concepts": "fuzzy cognitive map, testing device, subcomponents, collecting data, interfacing success, positive reinforcement", "concept_list": ["fuzzy cognitive map", "testing device", "subcomponents", "collecting data", "interfacing success", "positive reinforcement"], "type": "cluster", "node_size": 33, "label": "Data & Understanding"}, "Security & Protections": {"concepts": "security, protections, security measures, security features, security information, layer security, security perspective, specific security, common protections, encryption, privileged access, software security", "concept_list": ["security", "protections", "security measures", "security features", "security information", "layer security", "security perspective", "specific security", "common protections", "encryption", "privileged access", "software security"], "type": "cluster", "node_size": 51, "label": "Security & Protections"}, "Exploit & Security": {"concepts": "exploitation components, exploitations, exploitation, exploit components, identify exploit, identify security, hinder exploit, obfuscation, cyber attacks, countersecurity activities, security mechanisms, security measure", "concept_list": ["exploitation components", "exploitations", "exploitation", "exploit components", "identify exploit", "identify security", "hinder exploit", "obfuscation", "cyber attacks", "countersecurity activities", "security mechanisms", "security measure"], "type": "cluster", "node_size": 51, "label": "Exploit & Security"}};
        const conceptData = {};
        const interClusterEdges = [["Access & Tools", "Exploit & Security", {"weight": 0.6, "confidence": 0.39, "type": "inter_cluster", "style": "solid"}], ["Access & Tools", "Process & Learning", {"weight": 0.25, "confidence": 0.1375, "type": "inter_cluster", "style": "solid"}], ["Access & Tools", "Security & Protections", {"weight": 0.2, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Access & Tools", "Testing & Reinforcement", {"weight": 0.2, "confidence": 0.08, "type": "inter_cluster", "style": "solid"}], ["Firmware Analysis", "Exploit & Security", {"weight": 1.0, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}], ["Firmware Analysis", "Testing & Reinforcement", {"weight": 0.6666666666666666, "confidence": 0.3833333333333333, "type": "inter_cluster", "style": "solid"}], ["Process & Learning", "Exploit & Security", {"weight": 0.4, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}], ["Process & Learning", "Access & Tools", {"weight": 0.3333333333333333, "confidence": 0.16666666666666666, "type": "inter_cluster", "style": "solid"}], ["Testing & Reinforcement", "Firmware Analysis", {"weight": 0.75, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Data & Understanding", "Access & Tools", {"weight": 0.25, "confidence": 0.125, "type": "inter_cluster", "style": "solid"}], ["Security & Protections", "Process & Learning", {"weight": 0.4, "confidence": 0.26, "type": "inter_cluster", "style": "solid"}], ["Security & Protections", "Testing & Reinforcement", {"weight": -0.25, "confidence": 0.1125, "type": "inter_cluster", "style": "solid"}], ["Exploit & Security", "Firmware Analysis", {"weight": 0.6, "confidence": 0.32999999999999996, "type": "inter_cluster", "style": "solid"}], ["Exploit & Security", "Security & Protections", {"weight": -0.25, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Exploit & Security", "Process & Learning", {"weight": 0.25, "confidence": 0.125, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Access & Tools": [], "Firmware Analysis": [], "Process & Learning": [], "Testing & Reinforcement": [], "Data & Understanding": [], "Security & Protections": [], "Exploit & Security": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
