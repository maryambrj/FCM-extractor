
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"waterkeeper alliance": {"concepts": "waterkeeper alliance", "concept_list": ["waterkeeper alliance"], "type": "cluster", "node_size": 18, "label": "waterkeeper alliance"}, "Regulatory Enforcement": {"concepts": "ecosystem function, ecosystem functionality, habitat production, aquatic vegetation, habitat fragmentation, diversity of organisms, habitat forming species, native vegetation, habitat loss, ecosystem, biodiversity, human impacts, ecosystem resources, habitat protection, keystone species, food webs, invasive species, habitat, food web, biodiversity management, conservation concern, species of conservation concern, harmful organisms", "concept_list": ["ecosystem function", "ecosystem functionality", "habitat production", "aquatic vegetation", "habitat fragmentation", "diversity of organisms", "habitat forming species", "native vegetation", "habitat loss", "ecosystem", "biodiversity", "human impacts", "ecosystem resources", "habitat protection", "keystone species", "food webs", "invasive species", "habitat", "food web", "biodiversity management", "conservation concern", "species of conservation concern", "harmful organisms"], "type": "cluster", "node_size": 84, "label": "Regulatory Enforcement"}, "Citizen Science & Engagement": {"concepts": "epa enforcement, regulatory enforcement, enforcement, federal enforcement, court involvement, regulatory agencies, federal standards, state standards, epa", "concept_list": ["epa enforcement", "regulatory enforcement", "enforcement", "federal enforcement", "court involvement", "regulatory agencies", "federal standards", "state standards", "epa"], "type": "cluster", "node_size": 42, "label": "Citizen Science & Engagement"}, "Species & Habitat Management": {"concepts": "staff scientist, workshop, team retreat, citizen scientists, environmental nonprofit, data collection, public species counts, local experts, public engagement", "concept_list": ["staff scientist", "workshop", "team retreat", "citizen scientists", "environmental nonprofit", "data collection", "public species counts", "local experts", "public engagement"], "type": "cluster", "node_size": 42, "label": "Species & Habitat Management"}, "Species & Development": {"concepts": "access habitats, poster child species, litigation, development credits, fish consumption, us army corps of engineers, mitigation banks, improvement plans, urbanized wildlife, protected species, biodiversity data, relationship strength, sensitive species, mobile bay, management policies, rorschach test, visualize thoughts, wildlife, army corps of engineers, species counts, fish, listed species, species protection, mental modeler", "concept_list": ["access habitats", "poster child species", "litigation", "development credits", "fish consumption", "us army corps of engineers", "mitigation banks", "improvement plans", "urbanized wildlife", "protected species", "biodiversity data", "relationship strength", "sensitive species", "mobile bay", "management policies", "rorschach test", "visualize thoughts", "wildlife", "army corps of engineers", "species counts", "fish", "listed species", "species protection", "mental modeler"], "type": "cluster", "node_size": 87, "label": "Species & Development"}, "Wetland Protection": {"concepts": "wetlands, seagrass beds, wetland protection, wetland permits", "concept_list": ["wetlands", "seagrass beds", "wetland protection", "wetland permits"], "type": "cluster", "node_size": 27, "label": "Wetland Protection"}, "Water Quality Control": {"concepts": "water quality thresholds, effluent runoff, water quality, water quality enforcement, water improvement", "concept_list": ["water quality thresholds", "effluent runoff", "water quality", "water quality enforcement", "water improvement"], "type": "cluster", "node_size": 30, "label": "Water Quality Control"}, "Waterway Management": {"concepts": "recreational waterways, waterway designation, coastal waters, impaired waterways", "concept_list": ["recreational waterways", "waterway designation", "coastal waters", "impaired waterways"], "type": "cluster", "node_size": 27, "label": "Waterway Management"}, "Oyster & Water Management": {"concepts": "marine resource management, oyster restoration, clean water act", "concept_list": ["marine resource management", "oyster restoration", "clean water act"], "type": "cluster", "node_size": 24, "label": "Oyster & Water Management"}};
        const conceptData = {"ecosystem function": {"concepts": "ecosystem function", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem function"}, "ecosystem functionality": {"concepts": "ecosystem functionality", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem functionality"}, "habitat production": {"concepts": "habitat production", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat production"}, "aquatic vegetation": {"concepts": "aquatic vegetation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "aquatic vegetation"}, "habitat fragmentation": {"concepts": "habitat fragmentation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat fragmentation"}, "diversity of organisms": {"concepts": "diversity of organisms", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "diversity of organisms"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat forming species"}, "native vegetation": {"concepts": "native vegetation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "native vegetation"}, "habitat loss": {"concepts": "habitat loss", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat loss"}, "ecosystem": {"concepts": "ecosystem", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "biodiversity"}, "human impacts": {"concepts": "human impacts", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "human impacts"}, "ecosystem resources": {"concepts": "ecosystem resources", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem resources"}, "habitat protection": {"concepts": "habitat protection", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat protection"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "keystone species"}, "food webs": {"concepts": "food webs", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "food webs"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "invasive species"}, "habitat": {"concepts": "habitat", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "food web"}, "biodiversity management": {"concepts": "biodiversity management", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "biodiversity management"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "conservation concern"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "species of conservation concern"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "harmful organisms"}, "epa enforcement": {"concepts": "epa enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "epa enforcement"}, "regulatory enforcement": {"concepts": "regulatory enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "regulatory enforcement"}, "enforcement": {"concepts": "enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "enforcement"}, "federal enforcement": {"concepts": "federal enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "federal enforcement"}, "court involvement": {"concepts": "court involvement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "court involvement"}, "regulatory agencies": {"concepts": "regulatory agencies", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "regulatory agencies"}, "federal standards": {"concepts": "federal standards", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "federal standards"}, "state standards": {"concepts": "state standards", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "state standards"}, "epa": {"concepts": "epa", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "epa"}, "staff scientist": {"concepts": "staff scientist", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "staff scientist"}, "workshop": {"concepts": "workshop", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "workshop"}, "team retreat": {"concepts": "team retreat", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "team retreat"}, "citizen scientists": {"concepts": "citizen scientists", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "citizen scientists"}, "environmental nonprofit": {"concepts": "environmental nonprofit", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "environmental nonprofit"}, "data collection": {"concepts": "data collection", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "data collection"}, "public species counts": {"concepts": "public species counts", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "public species counts"}, "local experts": {"concepts": "local experts", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "local experts"}, "public engagement": {"concepts": "public engagement", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "public engagement"}, "access habitats": {"concepts": "access habitats", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "access habitats"}, "poster child species": {"concepts": "poster child species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "poster child species"}, "litigation": {"concepts": "litigation", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "litigation"}, "development credits": {"concepts": "development credits", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "development credits"}, "fish consumption": {"concepts": "fish consumption", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "fish consumption"}, "us army corps of engineers": {"concepts": "us army corps of engineers", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "us army corps of engineers"}, "mitigation banks": {"concepts": "mitigation banks", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mitigation banks"}, "improvement plans": {"concepts": "improvement plans", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "improvement plans"}, "urbanized wildlife": {"concepts": "urbanized wildlife", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "urbanized wildlife"}, "protected species": {"concepts": "protected species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "protected species"}, "biodiversity data": {"concepts": "biodiversity data", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "biodiversity data"}, "relationship strength": {"concepts": "relationship strength", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "relationship strength"}, "sensitive species": {"concepts": "sensitive species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "sensitive species"}, "mobile bay": {"concepts": "mobile bay", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mobile bay"}, "management policies": {"concepts": "management policies", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "management policies"}, "rorschach test": {"concepts": "rorschach test", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "rorschach test"}, "visualize thoughts": {"concepts": "visualize thoughts", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "visualize thoughts"}, "wildlife": {"concepts": "wildlife", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "wildlife"}, "army corps of engineers": {"concepts": "army corps of engineers", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "army corps of engineers"}, "species counts": {"concepts": "species counts", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "species counts"}, "fish": {"concepts": "fish", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "fish"}, "listed species": {"concepts": "listed species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "listed species"}, "species protection": {"concepts": "species protection", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "species protection"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mental modeler"}, "wetlands": {"concepts": "wetlands", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetlands"}, "seagrass beds": {"concepts": "seagrass beds", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "seagrass beds"}, "wetland protection": {"concepts": "wetland protection", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetland protection"}, "wetland permits": {"concepts": "wetland permits", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetland permits"}, "water quality thresholds": {"concepts": "water quality thresholds", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality thresholds"}, "effluent runoff": {"concepts": "effluent runoff", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "effluent runoff"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality"}, "water quality enforcement": {"concepts": "water quality enforcement", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality enforcement"}, "water improvement": {"concepts": "water improvement", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water improvement"}, "recreational waterways": {"concepts": "recreational waterways", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "recreational waterways"}, "waterway designation": {"concepts": "waterway designation", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "waterway designation"}, "coastal waters": {"concepts": "coastal waters", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "coastal waters"}, "impaired waterways": {"concepts": "impaired waterways", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "impaired waterways"}, "marine resource management": {"concepts": "marine resource management", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "marine resource management"}, "oyster restoration": {"concepts": "oyster restoration", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "oyster restoration"}, "clean water act": {"concepts": "clean water act", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "clean water act"}};
        const interClusterEdges = [["waterkeeper alliance", "Species & Habitat Management", {"weight": 1.0, "confidence": 0.77, "type": "inter_cluster", "style": "solid"}], ["waterkeeper alliance", "Regulatory Enforcement", {"weight": 1.0, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["waterkeeper alliance", "Water Quality Control", {"weight": 1.0, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["waterkeeper alliance", "Species & Development", {"weight": 1.0, "confidence": 0.48999999999999994, "type": "inter_cluster", "style": "solid"}], ["waterkeeper alliance", "Oyster & Water Management", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["waterkeeper alliance", "Citizen Science & Engagement", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Water Quality Control", {"weight": 1.0, "confidence": 0.6700000000000002, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Wetland Protection", {"weight": 1.0, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Oyster & Water Management", {"weight": 1.0, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Waterway Management", {"weight": 1.0, "confidence": 0.43, "type": "inter_cluster", "style": "solid"}], ["Regulatory Enforcement", "Species & Habitat Management", {"weight": 0.3333333333333333, "confidence": 0.13333333333333333, "type": "inter_cluster", "style": "solid"}], ["Citizen Science & Engagement", "Wetland Protection", {"weight": 1.0, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Citizen Science & Engagement", "Waterway Management", {"weight": 1.0, "confidence": 0.41, "type": "inter_cluster", "style": "solid"}], ["Citizen Science & Engagement", "Water Quality Control", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Citizen Science & Engagement", "Species & Development", {"weight": 0.3333333333333333, "confidence": 0.13333333333333333, "type": "inter_cluster", "style": "solid"}], ["Citizen Science & Engagement", "Species & Habitat Management", {"weight": 0.25, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Species & Habitat Management", "Regulatory Enforcement", {"weight": 0.8, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Species & Habitat Management", "Species & Development", {"weight": 1.0, "confidence": 0.5125, "type": "inter_cluster", "style": "solid"}], ["Species & Habitat Management", "Water Quality Control", {"weight": 1.0, "confidence": 0.38749999999999996, "type": "inter_cluster", "style": "solid"}], ["Species & Habitat Management", "waterkeeper alliance", {"weight": 0.5, "confidence": 0.3375, "type": "inter_cluster", "style": "solid"}], ["Species & Development", "Water Quality Control", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Species & Development", "Citizen Science & Engagement", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Wetland Protection", "Regulatory Enforcement", {"weight": 1.0, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Wetland Protection", "Water Quality Control", {"weight": 1.0, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Wetland Protection", "Citizen Science & Engagement", {"weight": 1.0, "confidence": 0.5199999999999999, "type": "inter_cluster", "style": "solid"}], ["Wetland Protection", "Waterway Management", {"weight": 0.3333333333333333, "confidence": 0.35000000000000003, "type": "inter_cluster", "style": "solid"}], ["Water Quality Control", "Waterway Management", {"weight": 1.0, "confidence": 0.52, "type": "inter_cluster", "style": "solid"}], ["Water Quality Control", "Citizen Science & Engagement", {"weight": 1.0, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Water Quality Control", "Regulatory Enforcement", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Water Quality Control", "Species & Development", {"weight": 0.3333333333333333, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Water Quality Control", "Species & Habitat Management", {"weight": 0.25, "confidence": 0.1125, "type": "inter_cluster", "style": "solid"}], ["Waterway Management", "Regulatory Enforcement", {"weight": -1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Waterway Management", "Wetland Protection", {"weight": -0.75, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Oyster & Water Management", "Regulatory Enforcement", {"weight": 1.0, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Oyster & Water Management", "Wetland Protection", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Oyster & Water Management", "Citizen Science & Engagement", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Oyster & Water Management", "Species & Development", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Oyster & Water Management", "waterkeeper alliance", {"weight": 0.3333333333333333, "confidence": 0.16666666666666666, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Regulatory Enforcement": [["ecosystem function", {"concepts": "ecosystem function", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem function"}], ["ecosystem functionality", {"concepts": "ecosystem functionality", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem functionality"}], ["habitat production", {"concepts": "habitat production", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat production"}], ["aquatic vegetation", {"concepts": "aquatic vegetation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "aquatic vegetation"}], ["habitat fragmentation", {"concepts": "habitat fragmentation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat fragmentation"}], ["diversity of organisms", {"concepts": "diversity of organisms", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "diversity of organisms"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat forming species"}], ["native vegetation", {"concepts": "native vegetation", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "native vegetation"}], ["habitat loss", {"concepts": "habitat loss", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat loss"}], ["ecosystem", {"concepts": "ecosystem", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "biodiversity"}], ["human impacts", {"concepts": "human impacts", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "human impacts"}], ["ecosystem resources", {"concepts": "ecosystem resources", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "ecosystem resources"}], ["habitat protection", {"concepts": "habitat protection", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat protection"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "keystone species"}], ["food webs", {"concepts": "food webs", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "food webs"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "invasive species"}], ["habitat", {"concepts": "habitat", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "habitat"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "food web"}], ["biodiversity management", {"concepts": "biodiversity management", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "biodiversity management"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "conservation concern"}], ["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "species of conservation concern"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Regulatory Enforcement", "node_size": 10, "label": "harmful organisms"}]], "Citizen Science & Engagement": [["epa enforcement", {"concepts": "epa enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "epa enforcement"}], ["regulatory enforcement", {"concepts": "regulatory enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "regulatory enforcement"}], ["enforcement", {"concepts": "enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "enforcement"}], ["federal enforcement", {"concepts": "federal enforcement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "federal enforcement"}], ["court involvement", {"concepts": "court involvement", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "court involvement"}], ["regulatory agencies", {"concepts": "regulatory agencies", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "regulatory agencies"}], ["federal standards", {"concepts": "federal standards", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "federal standards"}], ["state standards", {"concepts": "state standards", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "state standards"}], ["epa", {"concepts": "epa", "type": "concept", "cluster": "Citizen Science & Engagement", "node_size": 10, "label": "epa"}]], "Species & Habitat Management": [["staff scientist", {"concepts": "staff scientist", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "staff scientist"}], ["workshop", {"concepts": "workshop", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "workshop"}], ["team retreat", {"concepts": "team retreat", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "team retreat"}], ["citizen scientists", {"concepts": "citizen scientists", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "citizen scientists"}], ["environmental nonprofit", {"concepts": "environmental nonprofit", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "environmental nonprofit"}], ["data collection", {"concepts": "data collection", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "data collection"}], ["public species counts", {"concepts": "public species counts", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "public species counts"}], ["local experts", {"concepts": "local experts", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "local experts"}], ["public engagement", {"concepts": "public engagement", "type": "concept", "cluster": "Species & Habitat Management", "node_size": 10, "label": "public engagement"}]], "Species & Development": [["access habitats", {"concepts": "access habitats", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "access habitats"}], ["poster child species", {"concepts": "poster child species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "poster child species"}], ["litigation", {"concepts": "litigation", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "litigation"}], ["development credits", {"concepts": "development credits", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "development credits"}], ["fish consumption", {"concepts": "fish consumption", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "fish consumption"}], ["us army corps of engineers", {"concepts": "us army corps of engineers", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "us army corps of engineers"}], ["mitigation banks", {"concepts": "mitigation banks", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mitigation banks"}], ["improvement plans", {"concepts": "improvement plans", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "improvement plans"}], ["urbanized wildlife", {"concepts": "urbanized wildlife", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "urbanized wildlife"}], ["protected species", {"concepts": "protected species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "protected species"}], ["biodiversity data", {"concepts": "biodiversity data", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "biodiversity data"}], ["relationship strength", {"concepts": "relationship strength", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "relationship strength"}], ["sensitive species", {"concepts": "sensitive species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "sensitive species"}], ["mobile bay", {"concepts": "mobile bay", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mobile bay"}], ["management policies", {"concepts": "management policies", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "management policies"}], ["rorschach test", {"concepts": "rorschach test", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "rorschach test"}], ["visualize thoughts", {"concepts": "visualize thoughts", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "visualize thoughts"}], ["wildlife", {"concepts": "wildlife", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "wildlife"}], ["army corps of engineers", {"concepts": "army corps of engineers", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "army corps of engineers"}], ["species counts", {"concepts": "species counts", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "species counts"}], ["fish", {"concepts": "fish", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "fish"}], ["listed species", {"concepts": "listed species", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "listed species"}], ["species protection", {"concepts": "species protection", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "species protection"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Species & Development", "node_size": 10, "label": "mental modeler"}]], "Wetland Protection": [["wetlands", {"concepts": "wetlands", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetlands"}], ["seagrass beds", {"concepts": "seagrass beds", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "seagrass beds"}], ["wetland protection", {"concepts": "wetland protection", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetland protection"}], ["wetland permits", {"concepts": "wetland permits", "type": "concept", "cluster": "Wetland Protection", "node_size": 10, "label": "wetland permits"}]], "Water Quality Control": [["water quality thresholds", {"concepts": "water quality thresholds", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality thresholds"}], ["effluent runoff", {"concepts": "effluent runoff", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "effluent runoff"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality"}], ["water quality enforcement", {"concepts": "water quality enforcement", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water quality enforcement"}], ["water improvement", {"concepts": "water improvement", "type": "concept", "cluster": "Water Quality Control", "node_size": 10, "label": "water improvement"}]], "Waterway Management": [["recreational waterways", {"concepts": "recreational waterways", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "recreational waterways"}], ["waterway designation", {"concepts": "waterway designation", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "waterway designation"}], ["coastal waters", {"concepts": "coastal waters", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "coastal waters"}], ["impaired waterways", {"concepts": "impaired waterways", "type": "concept", "cluster": "Waterway Management", "node_size": 10, "label": "impaired waterways"}]], "Oyster & Water Management": [["marine resource management", {"concepts": "marine resource management", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "marine resource management"}], ["oyster restoration", {"concepts": "oyster restoration", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "oyster restoration"}], ["clean water act", {"concepts": "clean water act", "type": "concept", "cluster": "Oyster & Water Management", "node_size": 10, "label": "clean water act"}]]};
        const clusterEdges = {"Regulatory Enforcement": [], "Citizen Science & Engagement": [], "Species & Habitat Management": [], "Species & Development": [], "Wetland Protection": [], "Water Quality Control": [], "Waterway Management": [], "Oyster & Water Management": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
