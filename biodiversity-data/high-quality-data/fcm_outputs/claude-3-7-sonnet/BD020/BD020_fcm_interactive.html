
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Species Conservation Threats": {"concepts": "esa, population density, mmpa listed species, predation, regional collaboration, ecosystem influence, direct impacts, historical over-utilization, msa listed species, prey distribution, ship speed, connectivity disruption, marine mammals, community composition, spatial shifts, regime shifts, parrot fish, demographic resilience, water temperature, harmful organisms, species abundance, connectivity, species resilience, reduced abundance, species movement, disease, food base, key food webs, climate adaptation, ecosystem maintenance, regional community composition, stony coral tissue loss disease, poaching, unusual mortality events, categorical weights, weights, population resilience, habitat forming species, qualitative conceptual tool, odds ratios, esa demographic criteria, marine debris, regional communication, observer coverage, introduced species, nassau grouper, listing factors, entanglement risk, local prey abundance, noise pollution, cetaceans, productivity, large predators, fishery ecosystem plans, recovery ability, biodiversity, mortality rates, enforcement, ecosystem plans, esa listed species, threats, fishing pressure, cetacean morbillivirus, climate change, giant manta ray, dynamic management, ecosystem function, coral settlement, recovery plans, mate finding, diversity, poor compliance, knowledge gaps, bioenergetics, species of conservation concern, genetic diversity, historical over utilization, bycatch, semi-quantitative tool, filter feeding species, water pollution, food web supporting species, management measures, ship strikes, illegal fishing, connectivity disruptions, species presence, weighting adjustments, inadequacy of management measures, oil spills, population consequences of multiple stressors, invasive species, resilience, adaptive management, population threshold, habitat destruction, temperature robustness, cumulative effects, gear entanglements, mmpa, vessel strikes, demographic factors, msa, extinction risk, gene flow, multi-stressor effects", "concept_list": ["esa", "population density", "mmpa listed species", "predation", "regional collaboration", "ecosystem influence", "direct impacts", "historical over-utilization", "msa listed species", "prey distribution", "ship speed", "connectivity disruption", "marine mammals", "community composition", "spatial shifts", "regime shifts", "parrot fish", "demographic resilience", "water temperature", "harmful organisms", "species abundance", "connectivity", "species resilience", "reduced abundance", "species movement", "disease", "food base", "key food webs", "climate adaptation", "ecosystem maintenance", "regional community composition", "stony coral tissue loss disease", "poaching", "unusual mortality events", "categorical weights", "weights", "population resilience", "habitat forming species", "qualitative conceptual tool", "odds ratios", "esa demographic criteria", "marine debris", "regional communication", "observer coverage", "introduced species", "nassau grouper", "listing factors", "entanglement risk", "local prey abundance", "noise pollution", "cetaceans", "productivity", "large predators", "fishery ecosystem plans", "recovery ability", "biodiversity", "mortality rates", "enforcement", "ecosystem plans", "esa listed species", "threats", "fishing pressure", "cetacean morbillivirus", "climate change", "giant manta ray", "dynamic management", "ecosystem function", "coral settlement", "recovery plans", "mate finding", "diversity", "poor compliance", "knowledge gaps", "bioenergetics", "species of conservation concern", "genetic diversity", "historical over utilization", "bycatch", "semi-quantitative tool", "filter feeding species", "water pollution", "food web supporting species", "management measures", "ship strikes", "illegal fishing", "connectivity disruptions", "species presence", "weighting adjustments", "inadequacy of management measures", "oil spills", "population consequences of multiple stressors", "invasive species", "resilience", "adaptive management", "population threshold", "habitat destruction", "temperature robustness", "cumulative effects", "gear entanglements", "mmpa", "vessel strikes", "demographic factors", "msa", "extinction risk", "gene flow", "multi-stressor effects"], "type": "cluster", "node_size": 333, "label": "Species Conservation Threats"}, "Reproductive Biology": {"concepts": "reproductive fitness, calving rates, reproductive activity, reproductive output, spawning aggregations, hormonal cycle, reproduction requirements", "concept_list": ["reproductive fitness", "calving rates", "reproductive activity", "reproductive output", "spawning aggregations", "hormonal cycle", "reproduction requirements"], "type": "cluster", "node_size": 36, "label": "Reproductive Biology"}};
        const conceptData = {"esa": {"concepts": "esa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa"}, "population density": {"concepts": "population density", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population density"}, "mmpa listed species": {"concepts": "mmpa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mmpa listed species"}, "predation": {"concepts": "predation", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "predation"}, "regional collaboration": {"concepts": "regional collaboration", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional collaboration"}, "ecosystem influence": {"concepts": "ecosystem influence", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem influence"}, "direct impacts": {"concepts": "direct impacts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "direct impacts"}, "historical over-utilization": {"concepts": "historical over-utilization", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "historical over-utilization"}, "msa listed species": {"concepts": "msa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "msa listed species"}, "prey distribution": {"concepts": "prey distribution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "prey distribution"}, "ship speed": {"concepts": "ship speed", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ship speed"}, "connectivity disruption": {"concepts": "connectivity disruption", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity disruption"}, "marine mammals": {"concepts": "marine mammals", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "marine mammals"}, "community composition": {"concepts": "community composition", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "community composition"}, "spatial shifts": {"concepts": "spatial shifts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "spatial shifts"}, "regime shifts": {"concepts": "regime shifts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regime shifts"}, "parrot fish": {"concepts": "parrot fish", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "parrot fish"}, "demographic resilience": {"concepts": "demographic resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "demographic resilience"}, "water temperature": {"concepts": "water temperature", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "water temperature"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "harmful organisms"}, "species abundance": {"concepts": "species abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species abundance"}, "connectivity": {"concepts": "connectivity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity"}, "species resilience": {"concepts": "species resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species resilience"}, "reduced abundance": {"concepts": "reduced abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "reduced abundance"}, "species movement": {"concepts": "species movement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species movement"}, "disease": {"concepts": "disease", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "disease"}, "food base": {"concepts": "food base", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "food base"}, "key food webs": {"concepts": "key food webs", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "key food webs"}, "climate adaptation": {"concepts": "climate adaptation", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "climate adaptation"}, "ecosystem maintenance": {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem maintenance"}, "regional community composition": {"concepts": "regional community composition", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional community composition"}, "stony coral tissue loss disease": {"concepts": "stony coral tissue loss disease", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "stony coral tissue loss disease"}, "poaching": {"concepts": "poaching", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "poaching"}, "unusual mortality events": {"concepts": "unusual mortality events", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "unusual mortality events"}, "categorical weights": {"concepts": "categorical weights", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "categorical weights"}, "weights": {"concepts": "weights", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "weights"}, "population resilience": {"concepts": "population resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population resilience"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "habitat forming species"}, "qualitative conceptual tool": {"concepts": "qualitative conceptual tool", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "qualitative conceptual tool"}, "odds ratios": {"concepts": "odds ratios", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "odds ratios"}, "esa demographic criteria": {"concepts": "esa demographic criteria", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa demographic criteria"}, "marine debris": {"concepts": "marine debris", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "marine debris"}, "regional communication": {"concepts": "regional communication", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional communication"}, "observer coverage": {"concepts": "observer coverage", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "observer coverage"}, "introduced species": {"concepts": "introduced species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "introduced species"}, "nassau grouper": {"concepts": "nassau grouper", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "nassau grouper"}, "listing factors": {"concepts": "listing factors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "listing factors"}, "entanglement risk": {"concepts": "entanglement risk", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "entanglement risk"}, "local prey abundance": {"concepts": "local prey abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "local prey abundance"}, "noise pollution": {"concepts": "noise pollution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "noise pollution"}, "cetaceans": {"concepts": "cetaceans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cetaceans"}, "productivity": {"concepts": "productivity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "productivity"}, "large predators": {"concepts": "large predators", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "large predators"}, "fishery ecosystem plans": {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "fishery ecosystem plans"}, "recovery ability": {"concepts": "recovery ability", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "recovery ability"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "biodiversity"}, "mortality rates": {"concepts": "mortality rates", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mortality rates"}, "enforcement": {"concepts": "enforcement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "enforcement"}, "ecosystem plans": {"concepts": "ecosystem plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem plans"}, "esa listed species": {"concepts": "esa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa listed species"}, "threats": {"concepts": "threats", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "threats"}, "fishing pressure": {"concepts": "fishing pressure", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "fishing pressure"}, "cetacean morbillivirus": {"concepts": "cetacean morbillivirus", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cetacean morbillivirus"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "climate change"}, "giant manta ray": {"concepts": "giant manta ray", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "giant manta ray"}, "dynamic management": {"concepts": "dynamic management", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "dynamic management"}, "ecosystem function": {"concepts": "ecosystem function", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem function"}, "coral settlement": {"concepts": "coral settlement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "coral settlement"}, "recovery plans": {"concepts": "recovery plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "recovery plans"}, "mate finding": {"concepts": "mate finding", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mate finding"}, "diversity": {"concepts": "diversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "diversity"}, "poor compliance": {"concepts": "poor compliance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "poor compliance"}, "knowledge gaps": {"concepts": "knowledge gaps", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "knowledge gaps"}, "bioenergetics": {"concepts": "bioenergetics", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "bioenergetics"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species of conservation concern"}, "genetic diversity": {"concepts": "genetic diversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "genetic diversity"}, "historical over utilization": {"concepts": "historical over utilization", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "historical over utilization"}, "bycatch": {"concepts": "bycatch", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "bycatch"}, "semi-quantitative tool": {"concepts": "semi-quantitative tool", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "semi-quantitative tool"}, "filter feeding species": {"concepts": "filter feeding species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "filter feeding species"}, "water pollution": {"concepts": "water pollution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "water pollution"}, "food web supporting species": {"concepts": "food web supporting species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "food web supporting species"}, "management measures": {"concepts": "management measures", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "management measures"}, "ship strikes": {"concepts": "ship strikes", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ship strikes"}, "illegal fishing": {"concepts": "illegal fishing", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "illegal fishing"}, "connectivity disruptions": {"concepts": "connectivity disruptions", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity disruptions"}, "species presence": {"concepts": "species presence", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species presence"}, "weighting adjustments": {"concepts": "weighting adjustments", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "weighting adjustments"}, "inadequacy of management measures": {"concepts": "inadequacy of management measures", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "inadequacy of management measures"}, "oil spills": {"concepts": "oil spills", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "oil spills"}, "population consequences of multiple stressors": {"concepts": "population consequences of multiple stressors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population consequences of multiple stressors"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "invasive species"}, "resilience": {"concepts": "resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "resilience"}, "adaptive management": {"concepts": "adaptive management", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "adaptive management"}, "population threshold": {"concepts": "population threshold", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population threshold"}, "habitat destruction": {"concepts": "habitat destruction", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "habitat destruction"}, "temperature robustness": {"concepts": "temperature robustness", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "temperature robustness"}, "cumulative effects": {"concepts": "cumulative effects", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cumulative effects"}, "gear entanglements": {"concepts": "gear entanglements", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "gear entanglements"}, "mmpa": {"concepts": "mmpa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mmpa"}, "vessel strikes": {"concepts": "vessel strikes", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "vessel strikes"}, "demographic factors": {"concepts": "demographic factors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "demographic factors"}, "msa": {"concepts": "msa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "msa"}, "extinction risk": {"concepts": "extinction risk", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "extinction risk"}, "gene flow": {"concepts": "gene flow", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "gene flow"}, "multi-stressor effects": {"concepts": "multi-stressor effects", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "multi-stressor effects"}, "reproductive fitness": {"concepts": "reproductive fitness", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive fitness"}, "calving rates": {"concepts": "calving rates", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "calving rates"}, "reproductive activity": {"concepts": "reproductive activity", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive activity"}, "reproductive output": {"concepts": "reproductive output", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive output"}, "spawning aggregations": {"concepts": "spawning aggregations", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "spawning aggregations"}, "hormonal cycle": {"concepts": "hormonal cycle", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "hormonal cycle"}, "reproduction requirements": {"concepts": "reproduction requirements", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproduction requirements"}};
        const interClusterEdges = [["Species Conservation Threats", "Reproductive Biology", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Reproductive Biology", "Species Conservation Threats", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Species Conservation Threats": [["esa", {"concepts": "esa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa"}], ["population density", {"concepts": "population density", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population density"}], ["mmpa listed species", {"concepts": "mmpa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mmpa listed species"}], ["predation", {"concepts": "predation", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "predation"}], ["regional collaboration", {"concepts": "regional collaboration", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional collaboration"}], ["ecosystem influence", {"concepts": "ecosystem influence", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem influence"}], ["direct impacts", {"concepts": "direct impacts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "direct impacts"}], ["historical over-utilization", {"concepts": "historical over-utilization", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "historical over-utilization"}], ["msa listed species", {"concepts": "msa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "msa listed species"}], ["prey distribution", {"concepts": "prey distribution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "prey distribution"}], ["ship speed", {"concepts": "ship speed", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ship speed"}], ["connectivity disruption", {"concepts": "connectivity disruption", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity disruption"}], ["marine mammals", {"concepts": "marine mammals", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "marine mammals"}], ["community composition", {"concepts": "community composition", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "community composition"}], ["spatial shifts", {"concepts": "spatial shifts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "spatial shifts"}], ["regime shifts", {"concepts": "regime shifts", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regime shifts"}], ["parrot fish", {"concepts": "parrot fish", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "parrot fish"}], ["demographic resilience", {"concepts": "demographic resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "demographic resilience"}], ["water temperature", {"concepts": "water temperature", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "water temperature"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "harmful organisms"}], ["species abundance", {"concepts": "species abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species abundance"}], ["connectivity", {"concepts": "connectivity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity"}], ["species resilience", {"concepts": "species resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species resilience"}], ["reduced abundance", {"concepts": "reduced abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "reduced abundance"}], ["species movement", {"concepts": "species movement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species movement"}], ["disease", {"concepts": "disease", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "disease"}], ["food base", {"concepts": "food base", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "food base"}], ["key food webs", {"concepts": "key food webs", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "key food webs"}], ["climate adaptation", {"concepts": "climate adaptation", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "climate adaptation"}], ["ecosystem maintenance", {"concepts": "ecosystem maintenance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem maintenance"}], ["regional community composition", {"concepts": "regional community composition", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional community composition"}], ["stony coral tissue loss disease", {"concepts": "stony coral tissue loss disease", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "stony coral tissue loss disease"}], ["poaching", {"concepts": "poaching", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "poaching"}], ["unusual mortality events", {"concepts": "unusual mortality events", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "unusual mortality events"}], ["categorical weights", {"concepts": "categorical weights", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "categorical weights"}], ["weights", {"concepts": "weights", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "weights"}], ["population resilience", {"concepts": "population resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population resilience"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "habitat forming species"}], ["qualitative conceptual tool", {"concepts": "qualitative conceptual tool", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "qualitative conceptual tool"}], ["odds ratios", {"concepts": "odds ratios", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "odds ratios"}], ["esa demographic criteria", {"concepts": "esa demographic criteria", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa demographic criteria"}], ["marine debris", {"concepts": "marine debris", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "marine debris"}], ["regional communication", {"concepts": "regional communication", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "regional communication"}], ["observer coverage", {"concepts": "observer coverage", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "observer coverage"}], ["introduced species", {"concepts": "introduced species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "introduced species"}], ["nassau grouper", {"concepts": "nassau grouper", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "nassau grouper"}], ["listing factors", {"concepts": "listing factors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "listing factors"}], ["entanglement risk", {"concepts": "entanglement risk", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "entanglement risk"}], ["local prey abundance", {"concepts": "local prey abundance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "local prey abundance"}], ["noise pollution", {"concepts": "noise pollution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "noise pollution"}], ["cetaceans", {"concepts": "cetaceans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cetaceans"}], ["productivity", {"concepts": "productivity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "productivity"}], ["large predators", {"concepts": "large predators", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "large predators"}], ["fishery ecosystem plans", {"concepts": "fishery ecosystem plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "fishery ecosystem plans"}], ["recovery ability", {"concepts": "recovery ability", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "recovery ability"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "biodiversity"}], ["mortality rates", {"concepts": "mortality rates", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mortality rates"}], ["enforcement", {"concepts": "enforcement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "enforcement"}], ["ecosystem plans", {"concepts": "ecosystem plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem plans"}], ["esa listed species", {"concepts": "esa listed species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "esa listed species"}], ["threats", {"concepts": "threats", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "threats"}], ["fishing pressure", {"concepts": "fishing pressure", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "fishing pressure"}], ["cetacean morbillivirus", {"concepts": "cetacean morbillivirus", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cetacean morbillivirus"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "climate change"}], ["giant manta ray", {"concepts": "giant manta ray", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "giant manta ray"}], ["dynamic management", {"concepts": "dynamic management", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "dynamic management"}], ["ecosystem function", {"concepts": "ecosystem function", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ecosystem function"}], ["coral settlement", {"concepts": "coral settlement", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "coral settlement"}], ["recovery plans", {"concepts": "recovery plans", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "recovery plans"}], ["mate finding", {"concepts": "mate finding", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mate finding"}], ["diversity", {"concepts": "diversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "diversity"}], ["poor compliance", {"concepts": "poor compliance", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "poor compliance"}], ["knowledge gaps", {"concepts": "knowledge gaps", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "knowledge gaps"}], ["bioenergetics", {"concepts": "bioenergetics", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "bioenergetics"}], ["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species of conservation concern"}], ["genetic diversity", {"concepts": "genetic diversity", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "genetic diversity"}], ["historical over utilization", {"concepts": "historical over utilization", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "historical over utilization"}], ["bycatch", {"concepts": "bycatch", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "bycatch"}], ["semi-quantitative tool", {"concepts": "semi-quantitative tool", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "semi-quantitative tool"}], ["filter feeding species", {"concepts": "filter feeding species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "filter feeding species"}], ["water pollution", {"concepts": "water pollution", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "water pollution"}], ["food web supporting species", {"concepts": "food web supporting species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "food web supporting species"}], ["management measures", {"concepts": "management measures", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "management measures"}], ["ship strikes", {"concepts": "ship strikes", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "ship strikes"}], ["illegal fishing", {"concepts": "illegal fishing", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "illegal fishing"}], ["connectivity disruptions", {"concepts": "connectivity disruptions", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "connectivity disruptions"}], ["species presence", {"concepts": "species presence", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "species presence"}], ["weighting adjustments", {"concepts": "weighting adjustments", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "weighting adjustments"}], ["inadequacy of management measures", {"concepts": "inadequacy of management measures", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "inadequacy of management measures"}], ["oil spills", {"concepts": "oil spills", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "oil spills"}], ["population consequences of multiple stressors", {"concepts": "population consequences of multiple stressors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population consequences of multiple stressors"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "invasive species"}], ["resilience", {"concepts": "resilience", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "resilience"}], ["adaptive management", {"concepts": "adaptive management", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "adaptive management"}], ["population threshold", {"concepts": "population threshold", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "population threshold"}], ["habitat destruction", {"concepts": "habitat destruction", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "habitat destruction"}], ["temperature robustness", {"concepts": "temperature robustness", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "temperature robustness"}], ["cumulative effects", {"concepts": "cumulative effects", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "cumulative effects"}], ["gear entanglements", {"concepts": "gear entanglements", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "gear entanglements"}], ["mmpa", {"concepts": "mmpa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "mmpa"}], ["vessel strikes", {"concepts": "vessel strikes", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "vessel strikes"}], ["demographic factors", {"concepts": "demographic factors", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "demographic factors"}], ["msa", {"concepts": "msa", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "msa"}], ["extinction risk", {"concepts": "extinction risk", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "extinction risk"}], ["gene flow", {"concepts": "gene flow", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "gene flow"}], ["multi-stressor effects", {"concepts": "multi-stressor effects", "type": "concept", "cluster": "Species Conservation Threats", "node_size": 10, "label": "multi-stressor effects"}]], "Reproductive Biology": [["reproductive fitness", {"concepts": "reproductive fitness", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive fitness"}], ["calving rates", {"concepts": "calving rates", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "calving rates"}], ["reproductive activity", {"concepts": "reproductive activity", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive activity"}], ["reproductive output", {"concepts": "reproductive output", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproductive output"}], ["spawning aggregations", {"concepts": "spawning aggregations", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "spawning aggregations"}], ["hormonal cycle", {"concepts": "hormonal cycle", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "hormonal cycle"}], ["reproduction requirements", {"concepts": "reproduction requirements", "type": "concept", "cluster": "Reproductive Biology", "node_size": 10, "label": "reproduction requirements"}]]};
        const clusterEdges = {"Species Conservation Threats": [], "Reproductive Biology": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
