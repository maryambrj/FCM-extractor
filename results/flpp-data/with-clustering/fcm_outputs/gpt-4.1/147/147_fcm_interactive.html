
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Support": {"concepts": "healthy food, food giveaways, shelf stable food, mobile feeding, milk distribution, food access, supplemental nutrition programs, emergency feeding sites, hot meal, food safety, produce availability, food system sectors, meal access, household hunger, emergency feeding, food preparation knowledge, frozen food, urban food systems, food preparation, food system, food pickups, food safety knowledge, milk access, food quality, flint food system, supplemental nutrition, meal distribution, farmers market, food shortages, food purchasing, food distribution, food insecurity, purchasing habits, mobile feed", "concept_list": ["healthy food", "food giveaways", "shelf stable food", "mobile feeding", "milk distribution", "food access", "supplemental nutrition programs", "emergency feeding sites", "hot meal", "food safety", "produce availability", "food system sectors", "meal access", "household hunger", "emergency feeding", "food preparation knowledge", "frozen food", "urban food systems", "food preparation", "food system", "food pickups", "food safety knowledge", "milk access", "food quality", "flint food system", "supplemental nutrition", "meal distribution", "farmers market", "food shortages", "food purchasing", "food distribution", "food insecurity", "purchasing habits", "mobile feed"], "type": "cluster", "node_size": 117, "label": "Community Support"}, "Educational Programs": {"concepts": "social support, community organizing, program reach, organization, service delivery, gathering places, advocacy, sense of control, family groupings, community mobilization, sfsp, caregivers, grants, communities, covid regulations, transportation, residents, pandemic, organizational competition, privilege, grassroots efforts, older siblings, funding dependency, funding challenges, socialization, funding restrictions, pillars, organizational partnerships, health coalition, community organizations, staff relationships, lead crisis, organizational funding, ymca, social networks, grant acquisition, local networks, regulatory limitations, detroit, neighborhood residents, urban residents, social services, geographic identity, population targeting, resource access, program accessibility, trust, flint, fundraisers, local-state-federal, human dignity, organizational roles, stigma, nonprofits, organizational silos, mutual aid, kitchen injury, resident engagement, continuum of care, pandemic bonds, partnership, organizational capacity, community pride, community support, neighborhood groups, arts, regulatory balance, sports, resource allocation, frontline workers, shelters, recreation, resident mobility, limited options, community resilience, refuge, burns, suburban residents, community pillars, lynn williams, community engagement, fundraising appeals, site selection, community groups, can opener, transportation issues, service areas, leverage points, neighborhood, dignity, coordination, covid-19, safety, doers, cacfp, pride issue, competitiveness, youth services, program participation, community mapping, anti-corruption, cultural programs, covid-19 impact, residential mobility, child responsibility, community, quality of life, families, child care licensing, partnerships, family, intergenerational care, kitchen fires, organizational collaboration, transportation barriers, fellowship, funding, resource sharing, program regulations, basketball programs, supplemental funds, apartment complexes, neighborhood dynamics, youth, safety issue, hunger", "concept_list": ["social support", "community organizing", "program reach", "organization", "service delivery", "gathering places", "advocacy", "sense of control", "family groupings", "community mobilization", "sfsp", "caregivers", "grants", "communities", "covid regulations", "transportation", "residents", "pandemic", "organizational competition", "privilege", "grassroots efforts", "older siblings", "funding dependency", "funding challenges", "socialization", "funding restrictions", "pillars", "organizational partnerships", "health coalition", "community organizations", "staff relationships", "lead crisis", "organizational funding", "ymca", "social networks", "grant acquisition", "local networks", "regulatory limitations", "detroit", "neighborhood residents", "urban residents", "social services", "geographic identity", "population targeting", "resource access", "program accessibility", "trust", "flint", "fundraisers", "local-state-federal", "human dignity", "organizational roles", "stigma", "nonprofits", "organizational silos", "mutual aid", "kitchen injury", "resident engagement", "continuum of care", "pandemic bonds", "partnership", "organizational capacity", "community pride", "community support", "neighborhood groups", "arts", "regulatory balance", "sports", "resource allocation", "frontline workers", "shelters", "recreation", "resident mobility", "limited options", "community resilience", "refuge", "burns", "suburban residents", "community pillars", "lynn williams", "community engagement", "fundraising appeals", "site selection", "community groups", "can opener", "transportation issues", "service areas", "leverage points", "neighborhood", "dignity", "coordination", "covid-19", "safety", "doers", "cacfp", "pride issue", "competitiveness", "youth services", "program participation", "community mapping", "anti-corruption", "cultural programs", "covid-19 impact", "residential mobility", "child responsibility", "community", "quality of life", "families", "child care licensing", "partnerships", "family", "intergenerational care", "kitchen fires", "organizational collaboration", "transportation barriers", "fellowship", "funding", "resource sharing", "program regulations", "basketball programs", "supplemental funds", "apartment complexes", "neighborhood dynamics", "youth", "safety issue", "hunger"], "type": "cluster", "node_size": 393, "label": "Educational Programs"}, "Food Retailers": {"concepts": "after school program, educational sites, education, after school sites, educational programs, educational access, after school programs", "concept_list": ["after school program", "educational sites", "education", "after school sites", "educational programs", "educational access", "after school programs"], "type": "cluster", "node_size": 36, "label": "Food Retailers"}, "Food Access": {"concepts": "retail types, convenience stores, local restaurants, dollar stores, grocery stores, chain restaurants", "concept_list": ["retail types", "convenience stores", "local restaurants", "dollar stores", "grocery stores", "chain restaurants"], "type": "cluster", "node_size": 33, "label": "Food Access"}};
        const conceptData = {};
        const interClusterEdges = [["Community Support", "Food Access", {"weight": 0.6, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Food Retailers", {"weight": 0.6, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Educational Programs", {"weight": 0.4, "confidence": 0.32999999999999996, "type": "inter_cluster", "style": "solid"}], ["Educational Programs", "Food Retailers", {"weight": 0.8, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Educational Programs", "Community Support", {"weight": 0.4, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Educational Programs", "Food Access", {"weight": 0.2, "confidence": 0.12, "type": "inter_cluster", "style": "solid"}], ["Food Retailers", "Community Support", {"weight": 0.6, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Food Retailers", "Educational Programs", {"weight": 0.6, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Food Retailers", "Food Access", {"weight": 0.4, "confidence": 0.37, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Educational Programs", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Support", {"weight": 0.6, "confidence": 0.52, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Support": [], "Educational Programs": [], "Food Retailers": [], "Food Access": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
