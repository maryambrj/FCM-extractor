
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Brand Influence": {"concepts": "brand, health behavior", "concept_list": ["brand", "health behavior"], "type": "cluster", "node_size": 21, "label": "Brand Influence"}, "Food Access": {"concepts": "food affordability, nutritious foods, fresh foods, vegetarian foods, vegan foods, food insecurity, food marketing, food accessibility, food trends, food stability, food education, food access, food desert, food choices, food availability, lima beans, food bank, fruits, food competition, junk food, specialty meats, food enjoyment, vegetables, food variety, food environment, food resources, farmers market, nut free foods, organic foods, liquor store, food equity, meat selection, food visibility, food-based education, flint food system, food knowledge, food deserts, food culture, food waste, food options, food preferences, supplemental nutrition programs, cooking matters, food preparation, food system, food delivery, health foods, food distribution, food sourcing", "concept_list": ["food affordability", "nutritious foods", "fresh foods", "vegetarian foods", "vegan foods", "food insecurity", "food marketing", "food accessibility", "food trends", "food stability", "food education", "food access", "food desert", "food choices", "food availability", "lima beans", "food bank", "fruits", "food competition", "junk food", "specialty meats", "food enjoyment", "vegetables", "food variety", "food environment", "food resources", "farmers market", "nut free foods", "organic foods", "liquor store", "food equity", "meat selection", "food visibility", "food-based education", "flint food system", "food knowledge", "food deserts", "food culture", "food waste", "food options", "food preferences", "supplemental nutrition programs", "cooking matters", "food preparation", "food system", "food delivery", "health foods", "food distribution", "food sourcing"], "type": "cluster", "node_size": 162, "label": "Food Access"}, "Food Retail": {"concepts": "convenience stores, chain restaurants, local restaurants, grocery stores, retail perspective, franchising, franchised restaurants, big box stores, small shops, retail sector, local grocery stores, pop up shops", "concept_list": ["convenience stores", "chain restaurants", "local restaurants", "grocery stores", "retail perspective", "franchising", "franchised restaurants", "big box stores", "small shops", "retail sector", "local grocery stores", "pop up shops"], "type": "cluster", "node_size": 51, "label": "Food Retail"}, "Neighborhood Factors": {"concepts": "neighborhood disparities, travel barriers, peer influence, social networks, neighborhoods, social influence, transportation, location, emergency sector, local sources, mobility, neighborhood distributions, neighborhood distribution, public perception, public health, social network, urban geography, local populations", "concept_list": ["neighborhood disparities", "travel barriers", "peer influence", "social networks", "neighborhoods", "social influence", "transportation", "location", "emergency sector", "local sources", "mobility", "neighborhood distributions", "neighborhood distribution", "public perception", "public health", "social network", "urban geography", "local populations"], "type": "cluster", "node_size": 69, "label": "Neighborhood Factors"}, "Local Resources": {"concepts": "product availability, pho, flint, stability, resources, double up bucks, iron chef, americorps, snap ed, covid-19, catholic charities, sustainability, manager specials, contest, salt, availability, breakfast place, perks, eastern michigan, pallets, strip steak, butcher, bridge card, vendors, affordability, bulk produce, crim fitness foundation, kale chips, human perspective", "concept_list": ["product availability", "pho", "flint", "stability", "resources", "double up bucks", "iron chef", "americorps", "snap ed", "covid-19", "catholic charities", "sustainability", "manager specials", "contest", "salt", "availability", "breakfast place", "perks", "eastern michigan", "pallets", "strip steak", "butcher", "bridge card", "vendors", "affordability", "bulk produce", "crim fitness foundation", "kale chips", "human perspective"], "type": "cluster", "node_size": 102, "label": "Local Resources"}, "Wellbeing Initiatives": {"concepts": "grants, well being, vacant buildings, health education, supplemental sector, coffee, meal creation, self worth, business perspective, quality of life, advertising, consumer behavior", "concept_list": ["grants", "well being", "vacant buildings", "health education", "supplemental sector", "coffee", "meal creation", "self worth", "business perspective", "quality of life", "advertising", "consumer behavior"], "type": "cluster", "node_size": 51, "label": "Wellbeing Initiatives"}, "Community Development": {"concepts": "community, community resource developers, community empowerment, community communication", "concept_list": ["community", "community resource developers", "community empowerment", "community communication"], "type": "cluster", "node_size": 27, "label": "Community Development"}, "Educational Communication": {"concepts": "education, communication", "concept_list": ["education", "communication"], "type": "cluster", "node_size": 21, "label": "Educational Communication"}};
        const conceptData = {};
        const interClusterEdges = [["Brand Influence", "Food Retail", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Brand Influence", "Educational Communication", {"weight": 1.0, "confidence": 0.6300000000000001, "type": "inter_cluster", "style": "solid"}], ["Brand Influence", "Food Access", {"weight": 1.0, "confidence": 0.6100000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Educational Communication", {"weight": 0.8, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Food Access", {"weight": 1.0, "confidence": 0.86, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Educational Communication", {"weight": 1.0, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Factors", "Food Access", {"weight": 0.6, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Factors", "Food Retail", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Factors", "Community Development", {"weight": 0.8, "confidence": 0.5700000000000001, "type": "inter_cluster", "style": "solid"}], ["Local Resources", "Food Access", {"weight": 1.0, "confidence": 0.8200000000000001, "type": "inter_cluster", "style": "solid"}], ["Local Resources", "Wellbeing Initiatives", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Wellbeing Initiatives", "Brand Influence", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Development", "Wellbeing Initiatives", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Community Development", "Food Retail", {"weight": 1.0, "confidence": 0.6399999999999999, "type": "inter_cluster", "style": "solid"}], ["Educational Communication", "Food Access", {"weight": 1.0, "confidence": 0.8699999999999999, "type": "inter_cluster", "style": "solid"}], ["Educational Communication", "Community Development", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Educational Communication", "Local Resources", {"weight": 1.0, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Educational Communication", "Neighborhood Factors", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Educational Communication", "Wellbeing Initiatives", {"weight": 1.0, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Brand Influence": [], "Food Access": [], "Food Retail": [], "Neighborhood Factors": [], "Local Resources": [], "Wellbeing Initiatives": [], "Community Development": [], "Educational Communication": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
