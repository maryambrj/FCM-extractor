
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Ecosystem Health": {"concepts": "habitat destruction, ecosystem services, healthy ecosystems, ecological indicators, bioassessment, direct habitat destruction, habitat forming species, environmental indicators, bioassessment program, habitat diversity, habitat biodiversity, ecological condition, species of conservation concern, healthy ecosystem, conservation concern, habitat driven, index of biotic integrity, environmental improvement", "concept_list": ["habitat destruction", "ecosystem services", "healthy ecosystems", "ecological indicators", "bioassessment", "direct habitat destruction", "habitat forming species", "environmental indicators", "bioassessment program", "habitat diversity", "habitat biodiversity", "ecological condition", "species of conservation concern", "healthy ecosystem", "conservation concern", "habitat driven", "index of biotic integrity", "environmental improvement"], "type": "cluster", "node_size": 69, "label": "Ecosystem Health"}, "Sewage Management": {"concepts": "sewage, sewage stream., management decisions, decision making tools, decision making, fishes, management approaches, decision makers", "concept_list": ["sewage", "sewage stream.", "management decisions", "decision making tools", "decision making", "fishes", "management approaches", "decision makers"], "type": "cluster", "node_size": 39, "label": "Sewage Management"}, "Environmental Research": {"concepts": "plankton, contract staff, data sets, society, stratification, imaging, regulatory purposes, mental models, decay, cemacs, functional groups, stressors, seafloor, susan jackson, anoxia, cmecs, harmful organisms, research purposes, beauty of nature, seafloor health, framework, camera data, hypoxia, variability, enjoyment of nature, office of research and development, camera systems, causal link, worms, epa, system components, noaa, quantitative assessment, environmental stressors, creeks, taxonomy, fishing, ibis, condition assessment, predicting condition, oxygen, index, wind energy, human effects, nature, dissolved oxygen, mental modeler, cartography, development, research focus, oxygen depletion, contractors, scoring", "concept_list": ["plankton", "contract staff", "data sets", "society", "stratification", "imaging", "regulatory purposes", "mental models", "decay", "cemacs", "functional groups", "stressors", "seafloor", "susan jackson", "anoxia", "cmecs", "harmful organisms", "research purposes", "beauty of nature", "seafloor health", "framework", "camera data", "hypoxia", "variability", "enjoyment of nature", "office of research and development", "camera systems", "causal link", "worms", "epa", "system components", "noaa", "quantitative assessment", "environmental stressors", "creeks", "taxonomy", "fishing", "ibis", "condition assessment", "predicting condition", "oxygen", "index", "wind energy", "human effects", "nature", "dissolved oxygen", "mental modeler", "cartography", "development", "research focus", "oxygen depletion", "contractors", "scoring"], "type": "cluster", "node_size": 174, "label": "Environmental Research"}, "Burrowing Fauna": {"concepts": "tube building fauna, deep-burrowing fauna, surface burrowing fauna, burrowing creatures, small surface burrowing fauna, large deep-burrowing fauna, small tube building fauna", "concept_list": ["tube building fauna", "deep-burrowing fauna", "surface burrowing fauna", "burrowing creatures", "small surface burrowing fauna", "large deep-burrowing fauna", "small tube building fauna"], "type": "cluster", "node_size": 36, "label": "Burrowing Fauna"}, "Nutrient Dynamics": {"concepts": "nutrient runoff, plant growth, nutrient input, plankton growth, sewage stream, nutrient, macroalgae, nutrient input level, nutrient levels, freshwater, sediment", "concept_list": ["nutrient runoff", "plant growth", "nutrient input", "plankton growth", "sewage stream", "nutrient", "macroalgae", "nutrient input level", "nutrient levels", "freshwater", "sediment"], "type": "cluster", "node_size": 48, "label": "Nutrient Dynamics"}, "Marine Ecosystems": {"concepts": "salt marsh, coastal marine ecological classification standard, estuaries, benthic diversity, benthos diversity, estuarine, marine biodiversity, benthic bioassessment, marine setting, salt marshes, invertebrates, seagrass loss", "concept_list": ["salt marsh", "coastal marine ecological classification standard", "estuaries", "benthic diversity", "benthos diversity", "estuarine", "marine biodiversity", "benthic bioassessment", "marine setting", "salt marshes", "invertebrates", "seagrass loss"], "type": "cluster", "node_size": 51, "label": "Marine Ecosystems"}, "Species Diversity": {"concepts": "species tolerances, species, species tolerance indices, species tolerance, functional group biodiversity, species diversity, key food web supporting species, key food web, biodiversity", "concept_list": ["species tolerances", "species", "species tolerance indices", "species tolerance", "functional group biodiversity", "species diversity", "key food web supporting species", "key food web", "biodiversity"], "type": "cluster", "node_size": 42, "label": "Species Diversity"}};
        const conceptData = {"habitat destruction": {"concepts": "habitat destruction", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat destruction"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem services"}, "healthy ecosystems": {"concepts": "healthy ecosystems", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "healthy ecosystems"}, "ecological indicators": {"concepts": "ecological indicators", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological indicators"}, "bioassessment": {"concepts": "bioassessment", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "bioassessment"}, "direct habitat destruction": {"concepts": "direct habitat destruction", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "direct habitat destruction"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat forming species"}, "environmental indicators": {"concepts": "environmental indicators", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "environmental indicators"}, "bioassessment program": {"concepts": "bioassessment program", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "bioassessment program"}, "habitat diversity": {"concepts": "habitat diversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat diversity"}, "habitat biodiversity": {"concepts": "habitat biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat biodiversity"}, "ecological condition": {"concepts": "ecological condition", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological condition"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "species of conservation concern"}, "healthy ecosystem": {"concepts": "healthy ecosystem", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "healthy ecosystem"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "conservation concern"}, "habitat driven": {"concepts": "habitat driven", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat driven"}, "index of biotic integrity": {"concepts": "index of biotic integrity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "index of biotic integrity"}, "environmental improvement": {"concepts": "environmental improvement", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "environmental improvement"}, "sewage": {"concepts": "sewage", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "sewage"}, "sewage stream.": {"concepts": "sewage stream.", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "sewage stream."}, "management decisions": {"concepts": "management decisions", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "management decisions"}, "decision making tools": {"concepts": "decision making tools", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision making tools"}, "decision making": {"concepts": "decision making", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision making"}, "fishes": {"concepts": "fishes", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "fishes"}, "management approaches": {"concepts": "management approaches", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "management approaches"}, "decision makers": {"concepts": "decision makers", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision makers"}, "plankton": {"concepts": "plankton", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "plankton"}, "contract staff": {"concepts": "contract staff", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "contract staff"}, "data sets": {"concepts": "data sets", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "data sets"}, "society": {"concepts": "society", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "society"}, "stratification": {"concepts": "stratification", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "stratification"}, "imaging": {"concepts": "imaging", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "imaging"}, "regulatory purposes": {"concepts": "regulatory purposes", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "regulatory purposes"}, "mental models": {"concepts": "mental models", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "mental models"}, "decay": {"concepts": "decay", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "decay"}, "cemacs": {"concepts": "cemacs", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cemacs"}, "functional groups": {"concepts": "functional groups", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "functional groups"}, "stressors": {"concepts": "stressors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "stressors"}, "seafloor": {"concepts": "seafloor", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "seafloor"}, "susan jackson": {"concepts": "susan jackson", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "susan jackson"}, "anoxia": {"concepts": "anoxia", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "anoxia"}, "cmecs": {"concepts": "cmecs", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cmecs"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "harmful organisms"}, "research purposes": {"concepts": "research purposes", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "research purposes"}, "beauty of nature": {"concepts": "beauty of nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "beauty of nature"}, "seafloor health": {"concepts": "seafloor health", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "seafloor health"}, "framework": {"concepts": "framework", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "framework"}, "camera data": {"concepts": "camera data", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "camera data"}, "hypoxia": {"concepts": "hypoxia", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "hypoxia"}, "variability": {"concepts": "variability", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "variability"}, "enjoyment of nature": {"concepts": "enjoyment of nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "enjoyment of nature"}, "office of research and development": {"concepts": "office of research and development", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "office of research and development"}, "camera systems": {"concepts": "camera systems", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "camera systems"}, "causal link": {"concepts": "causal link", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "causal link"}, "worms": {"concepts": "worms", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "worms"}, "epa": {"concepts": "epa", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "epa"}, "system components": {"concepts": "system components", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "system components"}, "noaa": {"concepts": "noaa", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "noaa"}, "quantitative assessment": {"concepts": "quantitative assessment", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "quantitative assessment"}, "environmental stressors": {"concepts": "environmental stressors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "environmental stressors"}, "creeks": {"concepts": "creeks", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "creeks"}, "taxonomy": {"concepts": "taxonomy", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "taxonomy"}, "fishing": {"concepts": "fishing", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "fishing"}, "ibis": {"concepts": "ibis", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "ibis"}, "condition assessment": {"concepts": "condition assessment", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "condition assessment"}, "predicting condition": {"concepts": "predicting condition", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "predicting condition"}, "oxygen": {"concepts": "oxygen", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "oxygen"}, "index": {"concepts": "index", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "index"}, "wind energy": {"concepts": "wind energy", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "wind energy"}, "human effects": {"concepts": "human effects", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "human effects"}, "nature": {"concepts": "nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "nature"}, "dissolved oxygen": {"concepts": "dissolved oxygen", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "dissolved oxygen"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "mental modeler"}, "cartography": {"concepts": "cartography", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cartography"}, "development": {"concepts": "development", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "development"}, "research focus": {"concepts": "research focus", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "research focus"}, "oxygen depletion": {"concepts": "oxygen depletion", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "oxygen depletion"}, "contractors": {"concepts": "contractors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "contractors"}, "scoring": {"concepts": "scoring", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "scoring"}, "tube building fauna": {"concepts": "tube building fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "tube building fauna"}, "deep-burrowing fauna": {"concepts": "deep-burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "deep-burrowing fauna"}, "surface burrowing fauna": {"concepts": "surface burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "surface burrowing fauna"}, "burrowing creatures": {"concepts": "burrowing creatures", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "burrowing creatures"}, "small surface burrowing fauna": {"concepts": "small surface burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "small surface burrowing fauna"}, "large deep-burrowing fauna": {"concepts": "large deep-burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "large deep-burrowing fauna"}, "small tube building fauna": {"concepts": "small tube building fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "small tube building fauna"}, "nutrient runoff": {"concepts": "nutrient runoff", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient runoff"}, "plant growth": {"concepts": "plant growth", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "plant growth"}, "nutrient input": {"concepts": "nutrient input", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient input"}, "plankton growth": {"concepts": "plankton growth", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "plankton growth"}, "sewage stream": {"concepts": "sewage stream", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "sewage stream"}, "nutrient": {"concepts": "nutrient", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient"}, "macroalgae": {"concepts": "macroalgae", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "macroalgae"}, "nutrient input level": {"concepts": "nutrient input level", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient input level"}, "nutrient levels": {"concepts": "nutrient levels", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient levels"}, "freshwater": {"concepts": "freshwater", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "freshwater"}, "sediment": {"concepts": "sediment", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "sediment"}, "salt marsh": {"concepts": "salt marsh", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "salt marsh"}, "coastal marine ecological classification standard": {"concepts": "coastal marine ecological classification standard", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "coastal marine ecological classification standard"}, "estuaries": {"concepts": "estuaries", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "estuaries"}, "benthic diversity": {"concepts": "benthic diversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthic diversity"}, "benthos diversity": {"concepts": "benthos diversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthos diversity"}, "estuarine": {"concepts": "estuarine", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "estuarine"}, "marine biodiversity": {"concepts": "marine biodiversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "marine biodiversity"}, "benthic bioassessment": {"concepts": "benthic bioassessment", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthic bioassessment"}, "marine setting": {"concepts": "marine setting", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "marine setting"}, "salt marshes": {"concepts": "salt marshes", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "salt marshes"}, "invertebrates": {"concepts": "invertebrates", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "invertebrates"}, "seagrass loss": {"concepts": "seagrass loss", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "seagrass loss"}, "species tolerances": {"concepts": "species tolerances", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerances"}, "species": {"concepts": "species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species"}, "species tolerance indices": {"concepts": "species tolerance indices", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerance indices"}, "species tolerance": {"concepts": "species tolerance", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerance"}, "functional group biodiversity": {"concepts": "functional group biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "functional group biodiversity"}, "species diversity": {"concepts": "species diversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species diversity"}, "key food web supporting species": {"concepts": "key food web supporting species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "key food web supporting species"}, "key food web": {"concepts": "key food web", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "key food web"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "biodiversity"}};
        const interClusterEdges = [["Ecosystem Health", "Nutrient Dynamics", {"weight": -0.4, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Environmental Research", {"weight": -0.6, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Burrowing Fauna", {"weight": 0.4, "confidence": 0.32, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Marine Ecosystems", {"weight": 0.2, "confidence": 0.16999999999999998, "type": "inter_cluster", "style": "solid"}], ["Sewage Management", "Nutrient Dynamics", {"weight": -0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Environmental Research", "Burrowing Fauna", {"weight": -0.2, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Environmental Research", "Marine Ecosystems", {"weight": -0.4, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Burrowing Fauna", "Nutrient Dynamics", {"weight": -0.4, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Burrowing Fauna", "Marine Ecosystems", {"weight": 0.2, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Burrowing Fauna", "Environmental Research", {"weight": -0.4, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Burrowing Fauna", "Species Diversity", {"weight": 0.4, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Environmental Research", {"weight": -0.2, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Burrowing Fauna", {"weight": -0.8, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Species Diversity", {"weight": -0.8, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Ecosystem Health", {"weight": -0.4, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Marine Ecosystems", {"weight": -0.2, "confidence": 0.54, "type": "inter_cluster", "style": "solid"}], ["Nutrient Dynamics", "Sewage Management", {"weight": -0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Marine Ecosystems", "Nutrient Dynamics", {"weight": -0.2, "confidence": 0.8699999999999999, "type": "inter_cluster", "style": "solid"}], ["Marine Ecosystems", "Species Diversity", {"weight": -0.2, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Marine Ecosystems", "Ecosystem Health", {"weight": 0.6666666666666666, "confidence": 0.5166666666666666, "type": "inter_cluster", "style": "solid"}], ["Marine Ecosystems", "Burrowing Fauna", {"weight": 0.2, "confidence": 0.16, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Marine Ecosystems", {"weight": -0.2, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Burrowing Fauna", {"weight": 0.25, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Nutrient Dynamics", {"weight": -0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Species Diversity", "Environmental Research", {"weight": -0.2, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Ecosystem Health": [["habitat destruction", {"concepts": "habitat destruction", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat destruction"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecosystem services"}], ["healthy ecosystems", {"concepts": "healthy ecosystems", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "healthy ecosystems"}], ["ecological indicators", {"concepts": "ecological indicators", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological indicators"}], ["bioassessment", {"concepts": "bioassessment", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "bioassessment"}], ["direct habitat destruction", {"concepts": "direct habitat destruction", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "direct habitat destruction"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat forming species"}], ["environmental indicators", {"concepts": "environmental indicators", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "environmental indicators"}], ["bioassessment program", {"concepts": "bioassessment program", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "bioassessment program"}], ["habitat diversity", {"concepts": "habitat diversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat diversity"}], ["habitat biodiversity", {"concepts": "habitat biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat biodiversity"}], ["ecological condition", {"concepts": "ecological condition", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological condition"}], ["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "species of conservation concern"}], ["healthy ecosystem", {"concepts": "healthy ecosystem", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "healthy ecosystem"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "conservation concern"}], ["habitat driven", {"concepts": "habitat driven", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "habitat driven"}], ["index of biotic integrity", {"concepts": "index of biotic integrity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "index of biotic integrity"}], ["environmental improvement", {"concepts": "environmental improvement", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "environmental improvement"}]], "Sewage Management": [["sewage", {"concepts": "sewage", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "sewage"}], ["sewage stream.", {"concepts": "sewage stream.", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "sewage stream."}], ["management decisions", {"concepts": "management decisions", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "management decisions"}], ["decision making tools", {"concepts": "decision making tools", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision making tools"}], ["decision making", {"concepts": "decision making", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision making"}], ["fishes", {"concepts": "fishes", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "fishes"}], ["management approaches", {"concepts": "management approaches", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "management approaches"}], ["decision makers", {"concepts": "decision makers", "type": "concept", "cluster": "Sewage Management", "node_size": 10, "label": "decision makers"}]], "Environmental Research": [["plankton", {"concepts": "plankton", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "plankton"}], ["contract staff", {"concepts": "contract staff", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "contract staff"}], ["data sets", {"concepts": "data sets", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "data sets"}], ["society", {"concepts": "society", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "society"}], ["stratification", {"concepts": "stratification", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "stratification"}], ["imaging", {"concepts": "imaging", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "imaging"}], ["regulatory purposes", {"concepts": "regulatory purposes", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "regulatory purposes"}], ["mental models", {"concepts": "mental models", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "mental models"}], ["decay", {"concepts": "decay", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "decay"}], ["cemacs", {"concepts": "cemacs", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cemacs"}], ["functional groups", {"concepts": "functional groups", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "functional groups"}], ["stressors", {"concepts": "stressors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "stressors"}], ["seafloor", {"concepts": "seafloor", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "seafloor"}], ["susan jackson", {"concepts": "susan jackson", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "susan jackson"}], ["anoxia", {"concepts": "anoxia", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "anoxia"}], ["cmecs", {"concepts": "cmecs", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cmecs"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "harmful organisms"}], ["research purposes", {"concepts": "research purposes", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "research purposes"}], ["beauty of nature", {"concepts": "beauty of nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "beauty of nature"}], ["seafloor health", {"concepts": "seafloor health", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "seafloor health"}], ["framework", {"concepts": "framework", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "framework"}], ["camera data", {"concepts": "camera data", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "camera data"}], ["hypoxia", {"concepts": "hypoxia", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "hypoxia"}], ["variability", {"concepts": "variability", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "variability"}], ["enjoyment of nature", {"concepts": "enjoyment of nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "enjoyment of nature"}], ["office of research and development", {"concepts": "office of research and development", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "office of research and development"}], ["camera systems", {"concepts": "camera systems", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "camera systems"}], ["causal link", {"concepts": "causal link", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "causal link"}], ["worms", {"concepts": "worms", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "worms"}], ["epa", {"concepts": "epa", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "epa"}], ["system components", {"concepts": "system components", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "system components"}], ["noaa", {"concepts": "noaa", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "noaa"}], ["quantitative assessment", {"concepts": "quantitative assessment", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "quantitative assessment"}], ["environmental stressors", {"concepts": "environmental stressors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "environmental stressors"}], ["creeks", {"concepts": "creeks", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "creeks"}], ["taxonomy", {"concepts": "taxonomy", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "taxonomy"}], ["fishing", {"concepts": "fishing", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "fishing"}], ["ibis", {"concepts": "ibis", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "ibis"}], ["condition assessment", {"concepts": "condition assessment", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "condition assessment"}], ["predicting condition", {"concepts": "predicting condition", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "predicting condition"}], ["oxygen", {"concepts": "oxygen", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "oxygen"}], ["index", {"concepts": "index", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "index"}], ["wind energy", {"concepts": "wind energy", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "wind energy"}], ["human effects", {"concepts": "human effects", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "human effects"}], ["nature", {"concepts": "nature", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "nature"}], ["dissolved oxygen", {"concepts": "dissolved oxygen", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "dissolved oxygen"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "mental modeler"}], ["cartography", {"concepts": "cartography", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "cartography"}], ["development", {"concepts": "development", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "development"}], ["research focus", {"concepts": "research focus", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "research focus"}], ["oxygen depletion", {"concepts": "oxygen depletion", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "oxygen depletion"}], ["contractors", {"concepts": "contractors", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "contractors"}], ["scoring", {"concepts": "scoring", "type": "concept", "cluster": "Environmental Research", "node_size": 10, "label": "scoring"}]], "Burrowing Fauna": [["tube building fauna", {"concepts": "tube building fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "tube building fauna"}], ["deep-burrowing fauna", {"concepts": "deep-burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "deep-burrowing fauna"}], ["surface burrowing fauna", {"concepts": "surface burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "surface burrowing fauna"}], ["burrowing creatures", {"concepts": "burrowing creatures", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "burrowing creatures"}], ["small surface burrowing fauna", {"concepts": "small surface burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "small surface burrowing fauna"}], ["large deep-burrowing fauna", {"concepts": "large deep-burrowing fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "large deep-burrowing fauna"}], ["small tube building fauna", {"concepts": "small tube building fauna", "type": "concept", "cluster": "Burrowing Fauna", "node_size": 10, "label": "small tube building fauna"}]], "Nutrient Dynamics": [["nutrient runoff", {"concepts": "nutrient runoff", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient runoff"}], ["plant growth", {"concepts": "plant growth", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "plant growth"}], ["nutrient input", {"concepts": "nutrient input", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient input"}], ["plankton growth", {"concepts": "plankton growth", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "plankton growth"}], ["sewage stream", {"concepts": "sewage stream", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "sewage stream"}], ["nutrient", {"concepts": "nutrient", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient"}], ["macroalgae", {"concepts": "macroalgae", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "macroalgae"}], ["nutrient input level", {"concepts": "nutrient input level", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient input level"}], ["nutrient levels", {"concepts": "nutrient levels", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "nutrient levels"}], ["freshwater", {"concepts": "freshwater", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "freshwater"}], ["sediment", {"concepts": "sediment", "type": "concept", "cluster": "Nutrient Dynamics", "node_size": 10, "label": "sediment"}]], "Marine Ecosystems": [["salt marsh", {"concepts": "salt marsh", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "salt marsh"}], ["coastal marine ecological classification standard", {"concepts": "coastal marine ecological classification standard", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "coastal marine ecological classification standard"}], ["estuaries", {"concepts": "estuaries", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "estuaries"}], ["benthic diversity", {"concepts": "benthic diversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthic diversity"}], ["benthos diversity", {"concepts": "benthos diversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthos diversity"}], ["estuarine", {"concepts": "estuarine", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "estuarine"}], ["marine biodiversity", {"concepts": "marine biodiversity", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "marine biodiversity"}], ["benthic bioassessment", {"concepts": "benthic bioassessment", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "benthic bioassessment"}], ["marine setting", {"concepts": "marine setting", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "marine setting"}], ["salt marshes", {"concepts": "salt marshes", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "salt marshes"}], ["invertebrates", {"concepts": "invertebrates", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "invertebrates"}], ["seagrass loss", {"concepts": "seagrass loss", "type": "concept", "cluster": "Marine Ecosystems", "node_size": 10, "label": "seagrass loss"}]], "Species Diversity": [["species tolerances", {"concepts": "species tolerances", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerances"}], ["species", {"concepts": "species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species"}], ["species tolerance indices", {"concepts": "species tolerance indices", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerance indices"}], ["species tolerance", {"concepts": "species tolerance", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species tolerance"}], ["functional group biodiversity", {"concepts": "functional group biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "functional group biodiversity"}], ["species diversity", {"concepts": "species diversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "species diversity"}], ["key food web supporting species", {"concepts": "key food web supporting species", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "key food web supporting species"}], ["key food web", {"concepts": "key food web", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "key food web"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Species Diversity", "node_size": 10, "label": "biodiversity"}]]};
        const clusterEdges = {"Ecosystem Health": [], "Sewage Management": [], "Environmental Research": [], "Burrowing Fauna": [], "Nutrient Dynamics": [], "Marine Ecosystems": [], "Species Diversity": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
