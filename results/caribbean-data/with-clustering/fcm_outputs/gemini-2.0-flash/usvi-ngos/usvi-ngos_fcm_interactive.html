
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"mangroves": {"concepts": "mangroves", "concept_list": ["mangroves"], "type": "cluster", "node_size": 18, "label": "mangroves"}, "burnout": {"concepts": "burnout", "concept_list": ["burnout"], "type": "cluster", "node_size": 18, "label": "burnout"}, "usvi fisheries": {"concepts": "usvi fisheries", "concept_list": ["usvi fisheries"], "type": "cluster", "node_size": 18, "label": "usvi fisheries"}, "spawning season": {"concepts": "spawning season", "concept_list": ["spawning season"], "type": "cluster", "node_size": 18, "label": "spawning season"}, "sea level": {"concepts": "sea level", "concept_list": ["sea level"], "type": "cluster", "node_size": 18, "label": "sea level"}, "climate change": {"concepts": "climate change", "concept_list": ["climate change"], "type": "cluster", "node_size": 18, "label": "climate change"}, "coral treatment": {"concepts": "coral treatment", "concept_list": ["coral treatment"], "type": "cluster", "node_size": 18, "label": "coral treatment"}, "coral polyps": {"concepts": "coral polyps", "concept_list": ["coral polyps"], "type": "cluster", "node_size": 18, "label": "coral polyps"}, "fishermen": {"concepts": "fishermen", "concept_list": ["fishermen"], "type": "cluster", "node_size": 18, "label": "fishermen"}, "Coral Disease & Health": {"concepts": "sargassum seaweed, stony coral, algal blooms", "concept_list": ["sargassum seaweed", "stony coral", "algal blooms"], "type": "cluster", "node_size": 24, "label": "Coral Disease & Health"}, "Community & Management": {"concepts": "disease resistance, ciguatera, food chain, grouper predation, viral/bacterial combo, resilient colonies, white plague, food source, pathogens, immune response, dna markers, species targeted, species repopulation, grouper repopulation, accelerated growth, tissue loss, disease outbreak", "concept_list": ["disease resistance", "ciguatera", "food chain", "grouper predation", "viral/bacterial combo", "resilient colonies", "white plague", "food source", "pathogens", "immune response", "dna markers", "species targeted", "species repopulation", "grouper repopulation", "accelerated growth", "tissue loss", "disease outbreak"], "type": "cluster", "node_size": 66, "label": "Community & Management"}, "Development & Culture": {"concepts": "farmers, education, ngo, community immersion, data collection, social media, communication, disinformation, public input, local government, decision making, outreach campaigns, snorkel clinics, noaa, national park, tourism, tourism revenue, population effect, over development, advocacy, public education, grant funding, management decisions, community involvement, collaboration group", "concept_list": ["farmers", "education", "ngo", "community immersion", "data collection", "social media", "communication", "disinformation", "public input", "local government", "decision making", "outreach campaigns", "snorkel clinics", "noaa", "national park", "tourism", "tourism revenue", "population effect", "over development", "advocacy", "public education", "grant funding", "management decisions", "community involvement", "collaboration group"], "type": "cluster", "node_size": 90, "label": "Development & Culture"}, "Restoration & Conservation": {"concepts": "development practices, environmental consulting, cultural differences, political sway, cruise lines, generational differences, island differences, federal government, snappers, cultural component, restrictions, virgin islander identity, human fecal content, livelihoods, conch, generational understanding, resource competition, cultural identity, nassau grouper, french descendants, small groupers, usvi, conflicts", "concept_list": ["development practices", "environmental consulting", "cultural differences", "political sway", "cruise lines", "generational differences", "island differences", "federal government", "snappers", "cultural component", "restrictions", "virgin islander identity", "human fecal content", "livelihoods", "conch", "generational understanding", "resource competition", "cultural identity", "nassau grouper", "french descendants", "small groupers", "usvi", "conflicts"], "type": "cluster", "node_size": 84, "label": "Restoration & Conservation"}, "Seaweed & Blooms": {"concepts": "micro-fragmentation, conservation, wave energy, ecosystems, technical divers, treatment strategies, scientific agenda, rescue restoration, base 2b, ecosystem services, amoxicillin, advanced divers", "concept_list": ["micro-fragmentation", "conservation", "wave energy", "ecosystems", "technical divers", "treatment strategies", "scientific agenda", "rescue restoration", "base 2b", "ecosystem services", "amoxicillin", "advanced divers"], "type": "cluster", "node_size": 51, "label": "Seaweed & Blooms"}, "Local Conflict": {"concepts": "conflict resolution, local politics", "concept_list": ["conflict resolution", "local politics"], "type": "cluster", "node_size": 21, "label": "Local Conflict"}, "Healthy Coral Reefs": {"concepts": "reef program, healthy reefs, reef fish, coral reefs, reef builders", "concept_list": ["reef program", "healthy reefs", "reef fish", "coral reefs", "reef builders"], "type": "cluster", "node_size": 30, "label": "Healthy Coral Reefs"}, "Reef Decline": {"concepts": "reef decline, coral reef decline", "concept_list": ["reef decline", "coral reef decline"], "type": "cluster", "node_size": 21, "label": "Reef Decline"}, "Nutrient Pollution": {"concepts": "seaweed blooms, non-point source pollution, algae, nitrates", "concept_list": ["seaweed blooms", "non-point source pollution", "algae", "nitrates"], "type": "cluster", "node_size": 27, "label": "Nutrient Pollution"}, "[Local Politics]": {"concepts": "lionfish predation, over fishing, subsistence fishing, deep sea fishing, lionfish removal, lionfish invasion, fishing communities, lionfish depletion, commercial fishing, lionfish", "concept_list": ["lionfish predation", "over fishing", "subsistence fishing", "deep sea fishing", "lionfish removal", "lionfish invasion", "fishing communities", "lionfish depletion", "commercial fishing", "lionfish"], "type": "cluster", "node_size": 45, "label": "[Local Politics]"}, "Coral Reef Bleaching": {"concepts": "toxic sunscreens, bleaching event, reef, global stressors, coral head, bleaching events", "concept_list": ["toxic sunscreens", "bleaching event", "reef", "global stressors", "coral head", "bleaching events"], "type": "cluster", "node_size": 33, "label": "Coral Reef Bleaching"}, "Habitat & Water": {"concepts": "habitat degradation, marine environment, marine ecosystem, shorelines, water quality, rivers, habitat loss", "concept_list": ["habitat degradation", "marine environment", "marine ecosystem", "shorelines", "water quality", "rivers", "habitat loss"], "type": "cluster", "node_size": 36, "label": "Habitat & Water"}, "Marine & Wildlife Biology": {"concepts": "marine science, marine biologist, marine biologists, wildlife biologist", "concept_list": ["marine science", "marine biologist", "marine biologists", "wildlife biologist"], "type": "cluster", "node_size": 27, "label": "Marine & Wildlife Biology"}, "Coastal Turtle Conservation": {"concepts": "sea turtles, coastal communities, runoff, territorial waters", "concept_list": ["sea turtles", "coastal communities", "runoff", "territorial waters"], "type": "cluster", "node_size": 27, "label": "Coastal Turtle Conservation"}, "Fisheries Management": {"concepts": "fishery managers, fisheries management, sustainable fisheries, recreational fisheries, fisheries councils, healthy fisheries, fisheries theory, fisheries", "concept_list": ["fishery managers", "fisheries management", "sustainable fisheries", "recreational fisheries", "fisheries councils", "healthy fisheries", "fisheries theory", "fisheries"], "type": "cluster", "node_size": 39, "label": "Fisheries Management"}, "Edible Fish Species": {"concepts": "pelagic fish, seafood, fish species, pot fish, doctor fish", "concept_list": ["pelagic fish", "seafood", "fish species", "pot fish", "doctor fish"], "type": "cluster", "node_size": 30, "label": "Edible Fish Species"}, "Fish Size Decline": {"concepts": "fish size decrease, fish sizes", "concept_list": ["fish size decrease", "fish sizes"], "type": "cluster", "node_size": 21, "label": "Fish Size Decline"}, "Catch Limits": {"concepts": "catch limits, fish stocks", "concept_list": ["catch limits", "fish stocks"], "type": "cluster", "node_size": 21, "label": "Catch Limits"}, "Fish Populations": {"concepts": "spawning aggregation, septic tanks, catch sizes, fish populations, queen triggerfish", "concept_list": ["spawning aggregation", "septic tanks", "catch sizes", "fish populations", "queen triggerfish"], "type": "cluster", "node_size": 30, "label": "Fish Populations"}, "Environmental Stressors": {"concepts": "local stressors, regional stressors, monitoring station", "concept_list": ["local stressors", "regional stressors", "monitoring station"], "type": "cluster", "node_size": 24, "label": "Environmental Stressors"}, "Climate Change Impacts": {"concepts": "climate resistance, global warming, sea level rise, hurricanes, environmental changes", "concept_list": ["climate resistance", "global warming", "sea level rise", "hurricanes", "environmental changes"], "type": "cluster", "node_size": 30, "label": "Climate Change Impacts"}, "Coral Health": {"concepts": "coral resistance, coral health", "concept_list": ["coral resistance", "coral health"], "type": "cluster", "node_size": 21, "label": "Coral Health"}, "Coral Disease": {"concepts": "coral disease, coral tissue loss, stony coral disease, coral bleaching", "concept_list": ["coral disease", "coral tissue loss", "stony coral disease", "coral bleaching"], "type": "cluster", "node_size": 27, "label": "Coral Disease"}, "Coral Health & Loss": {"concepts": "coral treatments, coral fragments, coral ecology, stony coral tissue loss", "concept_list": ["coral treatments", "coral fragments", "coral ecology", "stony coral tissue loss"], "type": "cluster", "node_size": 27, "label": "Coral Health & Loss"}, "Fisher Collaboration": {"concepts": "fisher relationships, fishermen collaboration", "concept_list": ["fisher relationships", "fishermen collaboration"], "type": "cluster", "node_size": 21, "label": "Fisher Collaboration"}, "Fisher Issues": {"concepts": "fishermen involvement, fisher concerns, fisher registration, fishers", "concept_list": ["fishermen involvement", "fisher concerns", "fisher registration", "fishers"], "type": "cluster", "node_size": 27, "label": "Fisher Issues"}};
        const conceptData = {};
        const interClusterEdges = [["mangroves", "Fish Populations", {"weight": -0.3333333333333333, "confidence": 0.06666666666666667, "type": "inter_cluster", "style": "solid"}], ["burnout", "Fisher Collaboration", {"weight": -0.3333333333333333, "confidence": 0.09999999999999999, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "Edible Fish Species", {"weight": 1.0, "confidence": 0.5700000000000001, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "Coral Health", {"weight": 0.2, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "fishermen", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "Catch Limits", {"weight": 0.6666666666666666, "confidence": 0.26666666666666666, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "Community & Management", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["usvi fisheries", "mangroves", {"weight": 0.3333333333333333, "confidence": 0.06666666666666667, "type": "inter_cluster", "style": "solid"}], ["sea level", "Healthy Coral Reefs", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["sea level", "Catch Limits", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["climate change", "Coral Disease & Health", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["climate change", "coral polyps", {"weight": -1.0, "confidence": 0.3499999999999999, "type": "inter_cluster", "style": "solid"}], ["climate change", "Reef Decline", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["climate change", "Catch Limits", {"weight": -1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["climate change", "fishermen", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["coral treatment", "Fisher Collaboration", {"weight": 0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["coral polyps", "Coral Health", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Coral Disease & Health", "usvi fisheries", {"weight": -1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Community & Management", "Coral Disease", {"weight": 0.3333333333333333, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community & Management", "Fisheries Management", {"weight": 0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Development & Culture", "Habitat & Water", {"weight": -0.3333333333333333, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Development & Culture", "Nutrient Pollution", {"weight": 0.75, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Development & Culture", "Coral Health", {"weight": 1.0, "confidence": 0.44999999999999996, "type": "inter_cluster", "style": "solid"}], ["Development & Culture", "[Local Politics]", {"weight": -1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Restoration & Conservation", "Environmental Stressors", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Restoration & Conservation", "usvi fisheries", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Seaweed & Blooms", "Habitat & Water", {"weight": -0.6, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Seaweed & Blooms", "Healthy Coral Reefs", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Seaweed & Blooms", "Development & Culture", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Seaweed & Blooms", "Fish Size Decline", {"weight": -0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Local Conflict", "Environmental Stressors", {"weight": -0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Healthy Coral Reefs", "usvi fisheries", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Healthy Coral Reefs", "fishermen", {"weight": 0.8, "confidence": 0.38, "type": "inter_cluster", "style": "solid"}], ["Reef Decline", "Fisheries Management", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Reef Decline", "burnout", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Nutrient Pollution", "Reef Decline", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Nutrient Pollution", "mangroves", {"weight": -0.75, "confidence": 0.22499999999999998, "type": "inter_cluster", "style": "solid"}], ["Nutrient Pollution", "Healthy Coral Reefs", {"weight": -1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["[Local Politics]", "Fish Size Decline", {"weight": -0.3333333333333333, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["[Local Politics]", "burnout", {"weight": 1.0, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["[Local Politics]", "spawning season", {"weight": -0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Bleaching", "Coral Health", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Bleaching", "Coral Disease & Health", {"weight": 0.6666666666666666, "confidence": 0.2833333333333334, "type": "inter_cluster", "style": "solid"}], ["Habitat & Water", "Restoration & Conservation", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Habitat & Water", "Marine & Wildlife Biology", {"weight": 0.6666666666666666, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}], ["Marine & Wildlife Biology", "Development & Culture", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Marine & Wildlife Biology", "usvi fisheries", {"weight": 1.0, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Marine & Wildlife Biology", "[Local Politics]", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Coastal Turtle Conservation", "Nutrient Pollution", {"weight": 1.0, "confidence": 0.42500000000000004, "type": "inter_cluster", "style": "solid"}], ["Edible Fish Species", "Habitat & Water", {"weight": -1.0, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Edible Fish Species", "mangroves", {"weight": 1.0, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Fish Size Decline", "Development & Culture", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Catch Limits", "coral treatment", {"weight": 1.0, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Fish Populations", "Coral Reef Bleaching", {"weight": -0.25, "confidence": 0.2375, "type": "inter_cluster", "style": "solid"}], ["Fish Populations", "Local Conflict", {"weight": -0.5, "confidence": 0.05, "type": "inter_cluster", "style": "solid"}], ["Environmental Stressors", "Reef Decline", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Environmental Stressors", "climate change", {"weight": 0.6666666666666666, "confidence": 0.16666666666666666, "type": "inter_cluster", "style": "solid"}], ["Environmental Stressors", "Coral Disease", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Environmental Stressors", "Fisheries Management", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Habitat & Water", {"weight": -1.0, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Fish Size Decline", {"weight": -0.6, "confidence": 0.54, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Catch Limits", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Edible Fish Species", {"weight": 1.0, "confidence": 0.43333333333333335, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Fisher Issues", {"weight": 1.0, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "coral polyps", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Coral Disease", "Climate Change Impacts", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Coral Disease", "Coral Reef Bleaching", {"weight": 0.6666666666666666, "confidence": 0.4166666666666667, "type": "inter_cluster", "style": "solid"}], ["Coral Health & Loss", "Marine & Wildlife Biology", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Coral Health & Loss", "Development & Culture", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Fisher Collaboration", "spawning season", {"weight": 0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Coral Disease & Health": [], "Community & Management": [], "Development & Culture": [], "Restoration & Conservation": [], "Seaweed & Blooms": [], "Local Conflict": [], "Healthy Coral Reefs": [], "Reef Decline": [], "Nutrient Pollution": [], "[Local Politics]": [], "Coral Reef Bleaching": [], "Habitat & Water": [], "Marine & Wildlife Biology": [], "Coastal Turtle Conservation": [], "Fisheries Management": [], "Edible Fish Species": [], "Fish Size Decline": [], "Catch Limits": [], "Fish Populations": [], "Environmental Stressors": [], "Climate Change Impacts": [], "Coral Health": [], "Coral Disease": [], "Coral Health & Loss": [], "Fisher Collaboration": [], "Fisher Issues": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
