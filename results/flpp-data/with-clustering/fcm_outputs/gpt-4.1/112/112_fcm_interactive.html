
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access": {"concepts": "peanut allergies, child nutrition, supplemental nutrition programs, nut allergies, food allergies, student nutrition, supplemental nutrition", "concept_list": ["peanut allergies", "child nutrition", "supplemental nutrition programs", "nut allergies", "food allergies", "student nutrition", "supplemental nutrition"], "type": "cluster", "node_size": 36, "label": "Food Access"}, "Community Support": {"concepts": "food security, food system sectors, food distributions, fast food, food outsourcing, canned goods, food safety, food desert, convenience stores, food delivery, prison food, food waste, food insecurity, food bank, farmers market, food access, food availability, healthy eating, food system, food distribution, drug addiction, food preparation, green foods, food stamps, chain restaurants, liquor stores, food bank of michigan, food production, grocery stores, retail use, local restaurants, energy drinks, fresh produce, food quality, green food, double up food bucks, unhealthy food, halal food, food packing, healthy food, religious dietary needs", "concept_list": ["food security", "food system sectors", "food distributions", "fast food", "food outsourcing", "canned goods", "food safety", "food desert", "convenience stores", "food delivery", "prison food", "food waste", "food insecurity", "food bank", "farmers market", "food access", "food availability", "healthy eating", "food system", "food distribution", "drug addiction", "food preparation", "green foods", "food stamps", "chain restaurants", "liquor stores", "food bank of michigan", "food production", "grocery stores", "retail use", "local restaurants", "energy drinks", "fresh produce", "food quality", "green food", "double up food bucks", "unhealthy food", "halal food", "food packing", "healthy food", "religious dietary needs"], "type": "cluster", "node_size": 138, "label": "Community Support"}, "Health Services": {"concepts": "accessibility, men's shelter, social connection, building community, capitalism, personal greed, minimum wage, collaboration, cold weather, social media, family support, nourishment, school, mlk day, drive through events, systemic issues, cultural accommodation, children, school facilities, supplemental programs, exercise, rat poison, worker treatment, direct democracy, support staff, attention deficits, lunch ladies, sodexo, social support, lead exposure, work hours, event center, workers unions, systems of oppression, building maintenance, rent affordability, leverage points, process streamlining, families, church, flint schools, contaminants, availability, outreach, outsourcing companies, partnerships, bedridden, facebook live, education system, surgery, gentrification, unemployment, flik schools, pay cuts, sixth grade, packaging, community engagement, attention disorders, americorps, community volunteers, community empowerment, communalization, dumpster diving, transportation, volunteer turnout, direct aid, community response, government responsibility, rent, personal visits, profit maximization, drive-throughs, generational issue, corruption, weather impact, donors, education, backpack program, snap, community building, carpooling, free labor, community support, crim fitness foundation, shelters, covid-19, advocacy, community school directors, disabilities, flint, janitorial work, pandemic, mta, school staff, criminal charges, system evaluation, wic, flint community education initiative, nonprofit, volunteers", "concept_list": ["accessibility", "men's shelter", "social connection", "building community", "capitalism", "personal greed", "minimum wage", "collaboration", "cold weather", "social media", "family support", "nourishment", "school", "mlk day", "drive through events", "systemic issues", "cultural accommodation", "children", "school facilities", "supplemental programs", "exercise", "rat poison", "worker treatment", "direct democracy", "support staff", "attention deficits", "lunch ladies", "sodexo", "social support", "lead exposure", "work hours", "event center", "workers unions", "systems of oppression", "building maintenance", "rent affordability", "leverage points", "process streamlining", "families", "church", "flint schools", "contaminants", "availability", "outreach", "outsourcing companies", "partnerships", "bedridden", "facebook live", "education system", "surgery", "gentrification", "unemployment", "flik schools", "pay cuts", "sixth grade", "packaging", "community engagement", "attention disorders", "americorps", "community volunteers", "community empowerment", "communalization", "dumpster diving", "transportation", "volunteer turnout", "direct aid", "community response", "government responsibility", "rent", "personal visits", "profit maximization", "drive-throughs", "generational issue", "corruption", "weather impact", "donors", "education", "backpack program", "snap", "community building", "carpooling", "free labor", "community support", "crim fitness foundation", "shelters", "covid-19", "advocacy", "community school directors", "disabilities", "flint", "janitorial work", "pandemic", "mta", "school staff", "criminal charges", "system evaluation", "wic", "flint community education initiative", "nonprofit", "volunteers"], "type": "cluster", "node_size": 315, "label": "Health Services"}, "Allergy Nutrition": {"concepts": "sanitization, health disparities, hurley hospital, care provision, child health, emergency sector, mental health, holistic wellness, public health, homelessness, medical doctors", "concept_list": ["sanitization", "health disparities", "hurley hospital", "care provision", "child health", "emergency sector", "mental health", "holistic wellness", "public health", "homelessness", "medical doctors"], "type": "cluster", "node_size": 48, "label": "Allergy Nutrition"}};
        const conceptData = {};
        const interClusterEdges = [["Food Access", "Community Support", {"weight": 0.8, "confidence": 0.5399999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Allergy Nutrition", {"weight": 0.6, "confidence": 0.42000000000000004, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Health Services", {"weight": 0.6, "confidence": 0.41999999999999993, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Food Access", {"weight": 1.0, "confidence": 0.7300000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Health Services", {"weight": 0.8, "confidence": 0.68, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Allergy Nutrition", {"weight": 0.6, "confidence": 0.43000000000000005, "type": "inter_cluster", "style": "solid"}], ["Health Services", "Food Access", {"weight": 0.8, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["Health Services", "Community Support", {"weight": 0.6, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Health Services", "Allergy Nutrition", {"weight": 0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Allergy Nutrition", "Food Access", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Allergy Nutrition", "Health Services", {"weight": 0.8, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Allergy Nutrition", "Community Support", {"weight": 0.4, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access": [], "Community Support": [], "Health Services": [], "Allergy Nutrition": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
