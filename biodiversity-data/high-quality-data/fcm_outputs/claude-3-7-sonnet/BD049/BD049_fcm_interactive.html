
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"nesting": {"concepts": "nesting", "concept_list": ["nesting"], "type": "cluster", "node_size": 18, "label": "nesting"}, "Shoreline Protection Strategies": {"concepts": "water quality, shoreline hardening, shoreline alterations, migratory waterfowl, living shoreline law, shallow water habitat, living shoreline, living shorelines", "concept_list": ["water quality", "shoreline hardening", "shoreline alterations", "migratory waterfowl", "living shoreline law", "shallow water habitat", "living shoreline", "living shorelines"], "type": "cluster", "node_size": 39, "label": "Shoreline Protection Strategies"}, "Environmental Permitting Factors": {"concepts": "salinity changes, growing season, nutrient storage, sediment trapping, sediment dynamics, land-water connection, environmental law, permitters, permitting process, storms", "concept_list": ["salinity changes", "growing season", "nutrient storage", "sediment trapping", "sediment dynamics", "land-water connection", "environmental law", "permitters", "permitting process", "storms"], "type": "cluster", "node_size": 45, "label": "Environmental Permitting Factors"}, "Marsh Adaptation Dynamics": {"concepts": "marsh sediment dynamics, low marsh, marsh dynamics, climate change, marsh migration, marsh sustainability, salt tolerance, marsh plants, salt marsh sparrow, sea level rise, bio-geo-chemical processes, natural marsh, erosion mitigation, high marsh, marsh restoration, sediment supply, coastal communities", "concept_list": ["marsh sediment dynamics", "low marsh", "marsh dynamics", "climate change", "marsh migration", "marsh sustainability", "salt tolerance", "marsh plants", "salt marsh sparrow", "sea level rise", "bio-geo-chemical processes", "natural marsh", "erosion mitigation", "high marsh", "marsh restoration", "sediment supply", "coastal communities"], "type": "cluster", "node_size": 66, "label": "Marsh Adaptation Dynamics"}, "Coastal Management Challenges": {"concepts": "dredging, sav, food web, resource managers, bacteria, property owners, sav beds, marsh drowning, mucus, elevation building, diverse community, customer satisfaction, natural recruitment, chesapeake bay, maintenance costs, practitioners, diversity, biological organisms, high energy environment, dnr, marsh platform, meso-haline bay, stressors, non-profits, temperature, elevation, cost, thin layer placement", "concept_list": ["dredging", "sav", "food web", "resource managers", "bacteria", "property owners", "sav beds", "marsh drowning", "mucus", "elevation building", "diverse community", "customer satisfaction", "natural recruitment", "chesapeake bay", "maintenance costs", "practitioners", "diversity", "biological organisms", "high energy environment", "dnr", "marsh platform", "meso-haline bay", "stressors", "non-profits", "temperature", "elevation", "cost", "thin layer placement"], "type": "cluster", "node_size": 99, "label": "Coastal Management Challenges"}, "Biodiversity Benefits": {"concepts": "plant diversity, species diversity, facilitator species, biodiversity components, ecosystem services, ecosystem resilience, plant communities, ecological benefit, wildlife conservation, diversity of plant species, species recruitment, ecological resilience, ecological considerations, keystone species, biodiversity, system resilience, resilience, conservation concern, ecosystem benefits", "concept_list": ["plant diversity", "species diversity", "facilitator species", "biodiversity components", "ecosystem services", "ecosystem resilience", "plant communities", "ecological benefit", "wildlife conservation", "diversity of plant species", "species recruitment", "ecological resilience", "ecological considerations", "keystone species", "biodiversity", "system resilience", "resilience", "conservation concern", "ecosystem benefits"], "type": "cluster", "node_size": 72, "label": "Biodiversity Benefits"}, "Adjacent Habitats": {"concepts": "habitat, adjacent habitat, adjacent habitats", "concept_list": ["habitat", "adjacent habitat", "adjacent habitats"], "type": "cluster", "node_size": 24, "label": "Adjacent Habitats"}, "Habitat Connectivity": {"concepts": "habitat forming species, habitat connectivity, habitat restoration", "concept_list": ["habitat forming species", "habitat connectivity", "habitat restoration"], "type": "cluster", "node_size": 24, "label": "Habitat Connectivity"}};
        const conceptData = {"water quality": {"concepts": "water quality", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "water quality"}, "shoreline hardening": {"concepts": "shoreline hardening", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shoreline hardening"}, "shoreline alterations": {"concepts": "shoreline alterations", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shoreline alterations"}, "migratory waterfowl": {"concepts": "migratory waterfowl", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "migratory waterfowl"}, "living shoreline law": {"concepts": "living shoreline law", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shoreline law"}, "shallow water habitat": {"concepts": "shallow water habitat", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shallow water habitat"}, "living shoreline": {"concepts": "living shoreline", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shoreline"}, "living shorelines": {"concepts": "living shorelines", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shorelines"}, "salinity changes": {"concepts": "salinity changes", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "salinity changes"}, "growing season": {"concepts": "growing season", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "growing season"}, "nutrient storage": {"concepts": "nutrient storage", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "nutrient storage"}, "sediment trapping": {"concepts": "sediment trapping", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "sediment trapping"}, "sediment dynamics": {"concepts": "sediment dynamics", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "sediment dynamics"}, "land-water connection": {"concepts": "land-water connection", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "land-water connection"}, "environmental law": {"concepts": "environmental law", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "environmental law"}, "permitters": {"concepts": "permitters", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "permitters"}, "permitting process": {"concepts": "permitting process", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "permitting process"}, "storms": {"concepts": "storms", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "storms"}, "marsh sediment dynamics": {"concepts": "marsh sediment dynamics", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh sediment dynamics"}, "low marsh": {"concepts": "low marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "low marsh"}, "marsh dynamics": {"concepts": "marsh dynamics", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh dynamics"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "climate change"}, "marsh migration": {"concepts": "marsh migration", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh migration"}, "marsh sustainability": {"concepts": "marsh sustainability", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh sustainability"}, "salt tolerance": {"concepts": "salt tolerance", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "salt tolerance"}, "marsh plants": {"concepts": "marsh plants", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh plants"}, "salt marsh sparrow": {"concepts": "salt marsh sparrow", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "salt marsh sparrow"}, "sea level rise": {"concepts": "sea level rise", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "sea level rise"}, "bio-geo-chemical processes": {"concepts": "bio-geo-chemical processes", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "bio-geo-chemical processes"}, "natural marsh": {"concepts": "natural marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "natural marsh"}, "erosion mitigation": {"concepts": "erosion mitigation", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "erosion mitigation"}, "high marsh": {"concepts": "high marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "high marsh"}, "marsh restoration": {"concepts": "marsh restoration", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh restoration"}, "sediment supply": {"concepts": "sediment supply", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "sediment supply"}, "coastal communities": {"concepts": "coastal communities", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "coastal communities"}, "dredging": {"concepts": "dredging", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "dredging"}, "sav": {"concepts": "sav", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "sav"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "food web"}, "resource managers": {"concepts": "resource managers", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "resource managers"}, "bacteria": {"concepts": "bacteria", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "bacteria"}, "property owners": {"concepts": "property owners", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "property owners"}, "sav beds": {"concepts": "sav beds", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "sav beds"}, "marsh drowning": {"concepts": "marsh drowning", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "marsh drowning"}, "mucus": {"concepts": "mucus", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "mucus"}, "elevation building": {"concepts": "elevation building", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "elevation building"}, "diverse community": {"concepts": "diverse community", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "diverse community"}, "customer satisfaction": {"concepts": "customer satisfaction", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "customer satisfaction"}, "natural recruitment": {"concepts": "natural recruitment", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "natural recruitment"}, "chesapeake bay": {"concepts": "chesapeake bay", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "chesapeake bay"}, "maintenance costs": {"concepts": "maintenance costs", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "maintenance costs"}, "practitioners": {"concepts": "practitioners", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "practitioners"}, "diversity": {"concepts": "diversity", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "diversity"}, "biological organisms": {"concepts": "biological organisms", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "biological organisms"}, "high energy environment": {"concepts": "high energy environment", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "high energy environment"}, "dnr": {"concepts": "dnr", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "dnr"}, "marsh platform": {"concepts": "marsh platform", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "marsh platform"}, "meso-haline bay": {"concepts": "meso-haline bay", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "meso-haline bay"}, "stressors": {"concepts": "stressors", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "stressors"}, "non-profits": {"concepts": "non-profits", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "non-profits"}, "temperature": {"concepts": "temperature", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "temperature"}, "elevation": {"concepts": "elevation", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "elevation"}, "cost": {"concepts": "cost", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "cost"}, "thin layer placement": {"concepts": "thin layer placement", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "thin layer placement"}, "plant diversity": {"concepts": "plant diversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "plant diversity"}, "species diversity": {"concepts": "species diversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "species diversity"}, "facilitator species": {"concepts": "facilitator species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "facilitator species"}, "biodiversity components": {"concepts": "biodiversity components", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "biodiversity components"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem services"}, "ecosystem resilience": {"concepts": "ecosystem resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem resilience"}, "plant communities": {"concepts": "plant communities", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "plant communities"}, "ecological benefit": {"concepts": "ecological benefit", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological benefit"}, "wildlife conservation": {"concepts": "wildlife conservation", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "wildlife conservation"}, "diversity of plant species": {"concepts": "diversity of plant species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "diversity of plant species"}, "species recruitment": {"concepts": "species recruitment", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "species recruitment"}, "ecological resilience": {"concepts": "ecological resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological resilience"}, "ecological considerations": {"concepts": "ecological considerations", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological considerations"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "keystone species"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "biodiversity"}, "system resilience": {"concepts": "system resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "system resilience"}, "resilience": {"concepts": "resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "resilience"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "conservation concern"}, "ecosystem benefits": {"concepts": "ecosystem benefits", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem benefits"}, "habitat": {"concepts": "habitat", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "habitat"}, "adjacent habitat": {"concepts": "adjacent habitat", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "adjacent habitat"}, "adjacent habitats": {"concepts": "adjacent habitats", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "adjacent habitats"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat forming species"}, "habitat connectivity": {"concepts": "habitat connectivity", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat connectivity"}, "habitat restoration": {"concepts": "habitat restoration", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat restoration"}};
        const interClusterEdges = [["nesting", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.7200000000000001, "type": "inter_cluster", "style": "solid"}], ["nesting", "Marsh Adaptation Dynamics", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["nesting", "Biodiversity Benefits", {"weight": 0.8, "confidence": 0.52, "type": "inter_cluster", "style": "solid"}], ["nesting", "Shoreline Protection Strategies", {"weight": 0.4, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["nesting", "Coastal Management Challenges", {"weight": 0.25, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Marsh Adaptation Dynamics", {"weight": 1.0, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Habitat Connectivity", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Biodiversity Benefits", {"weight": 1.0, "confidence": 0.8099999999999999, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Environmental Permitting Factors", {"weight": 0.8, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "Coastal Management Challenges", {"weight": 0.8, "confidence": 0.6200000000000001, "type": "inter_cluster", "style": "solid"}], ["Shoreline Protection Strategies", "nesting", {"weight": 0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Shoreline Protection Strategies", {"weight": 0.2, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Marsh Adaptation Dynamics", {"weight": 0.2, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Biodiversity Benefits", {"weight": -0.2, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Habitat Connectivity", {"weight": 0.6, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Coastal Management Challenges", {"weight": 0.4, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Environmental Permitting Factors", "Adjacent Habitats", {"weight": 0.5, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Coastal Management Challenges", {"weight": -0.2, "confidence": 0.8800000000000001, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Biodiversity Benefits", {"weight": 1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Shoreline Protection Strategies", {"weight": 1.0, "confidence": 0.8699999999999999, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Habitat Connectivity", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "nesting", {"weight": 1.0, "confidence": 0.7099999999999999, "type": "inter_cluster", "style": "solid"}], ["Marsh Adaptation Dynamics", "Environmental Permitting Factors", {"weight": 0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Coastal Management Challenges", "Biodiversity Benefits", {"weight": 1.0, "confidence": 0.8800000000000001, "type": "inter_cluster", "style": "solid"}], ["Coastal Management Challenges", "Marsh Adaptation Dynamics", {"weight": 0.6, "confidence": 0.8899999999999999, "type": "inter_cluster", "style": "solid"}], ["Coastal Management Challenges", "Shoreline Protection Strategies", {"weight": 1.0, "confidence": 0.8399999999999999, "type": "inter_cluster", "style": "solid"}], ["Coastal Management Challenges", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Coastal Management Challenges", "Habitat Connectivity", {"weight": 1.0, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "Marsh Adaptation Dynamics", {"weight": 1.0, "confidence": 0.8799999999999999, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "Habitat Connectivity", {"weight": 1.0, "confidence": 0.8099999999999999, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "Shoreline Protection Strategies", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "nesting", {"weight": 1.0, "confidence": 0.6399999999999999, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Benefits", "Environmental Permitting Factors", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "nesting", {"weight": 1.0, "confidence": 0.86, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "Biodiversity Benefits", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "Habitat Connectivity", {"weight": 1.0, "confidence": 0.8200000000000001, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "Marsh Adaptation Dynamics", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "Shoreline Protection Strategies", {"weight": 1.0, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Adjacent Habitats", "Coastal Management Challenges", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Adjacent Habitats", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Biodiversity Benefits", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Shoreline Protection Strategies", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Marsh Adaptation Dynamics", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "nesting", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Coastal Management Challenges", {"weight": 0.8, "confidence": 0.62, "type": "inter_cluster", "style": "solid"}], ["Habitat Connectivity", "Environmental Permitting Factors", {"weight": 0.5, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Shoreline Protection Strategies": [["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "water quality"}], ["shoreline hardening", {"concepts": "shoreline hardening", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shoreline hardening"}], ["shoreline alterations", {"concepts": "shoreline alterations", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shoreline alterations"}], ["migratory waterfowl", {"concepts": "migratory waterfowl", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "migratory waterfowl"}], ["living shoreline law", {"concepts": "living shoreline law", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shoreline law"}], ["shallow water habitat", {"concepts": "shallow water habitat", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "shallow water habitat"}], ["living shoreline", {"concepts": "living shoreline", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shoreline"}], ["living shorelines", {"concepts": "living shorelines", "type": "concept", "cluster": "Shoreline Protection Strategies", "node_size": 10, "label": "living shorelines"}]], "Environmental Permitting Factors": [["salinity changes", {"concepts": "salinity changes", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "salinity changes"}], ["growing season", {"concepts": "growing season", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "growing season"}], ["nutrient storage", {"concepts": "nutrient storage", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "nutrient storage"}], ["sediment trapping", {"concepts": "sediment trapping", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "sediment trapping"}], ["sediment dynamics", {"concepts": "sediment dynamics", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "sediment dynamics"}], ["land-water connection", {"concepts": "land-water connection", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "land-water connection"}], ["environmental law", {"concepts": "environmental law", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "environmental law"}], ["permitters", {"concepts": "permitters", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "permitters"}], ["permitting process", {"concepts": "permitting process", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "permitting process"}], ["storms", {"concepts": "storms", "type": "concept", "cluster": "Environmental Permitting Factors", "node_size": 10, "label": "storms"}]], "Marsh Adaptation Dynamics": [["marsh sediment dynamics", {"concepts": "marsh sediment dynamics", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh sediment dynamics"}], ["low marsh", {"concepts": "low marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "low marsh"}], ["marsh dynamics", {"concepts": "marsh dynamics", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh dynamics"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "climate change"}], ["marsh migration", {"concepts": "marsh migration", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh migration"}], ["marsh sustainability", {"concepts": "marsh sustainability", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh sustainability"}], ["salt tolerance", {"concepts": "salt tolerance", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "salt tolerance"}], ["marsh plants", {"concepts": "marsh plants", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh plants"}], ["salt marsh sparrow", {"concepts": "salt marsh sparrow", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "salt marsh sparrow"}], ["sea level rise", {"concepts": "sea level rise", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "sea level rise"}], ["bio-geo-chemical processes", {"concepts": "bio-geo-chemical processes", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "bio-geo-chemical processes"}], ["natural marsh", {"concepts": "natural marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "natural marsh"}], ["erosion mitigation", {"concepts": "erosion mitigation", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "erosion mitigation"}], ["high marsh", {"concepts": "high marsh", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "high marsh"}], ["marsh restoration", {"concepts": "marsh restoration", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "marsh restoration"}], ["sediment supply", {"concepts": "sediment supply", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "sediment supply"}], ["coastal communities", {"concepts": "coastal communities", "type": "concept", "cluster": "Marsh Adaptation Dynamics", "node_size": 10, "label": "coastal communities"}]], "Coastal Management Challenges": [["dredging", {"concepts": "dredging", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "dredging"}], ["sav", {"concepts": "sav", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "sav"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "food web"}], ["resource managers", {"concepts": "resource managers", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "resource managers"}], ["bacteria", {"concepts": "bacteria", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "bacteria"}], ["property owners", {"concepts": "property owners", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "property owners"}], ["sav beds", {"concepts": "sav beds", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "sav beds"}], ["marsh drowning", {"concepts": "marsh drowning", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "marsh drowning"}], ["mucus", {"concepts": "mucus", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "mucus"}], ["elevation building", {"concepts": "elevation building", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "elevation building"}], ["diverse community", {"concepts": "diverse community", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "diverse community"}], ["customer satisfaction", {"concepts": "customer satisfaction", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "customer satisfaction"}], ["natural recruitment", {"concepts": "natural recruitment", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "natural recruitment"}], ["chesapeake bay", {"concepts": "chesapeake bay", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "chesapeake bay"}], ["maintenance costs", {"concepts": "maintenance costs", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "maintenance costs"}], ["practitioners", {"concepts": "practitioners", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "practitioners"}], ["diversity", {"concepts": "diversity", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "diversity"}], ["biological organisms", {"concepts": "biological organisms", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "biological organisms"}], ["high energy environment", {"concepts": "high energy environment", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "high energy environment"}], ["dnr", {"concepts": "dnr", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "dnr"}], ["marsh platform", {"concepts": "marsh platform", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "marsh platform"}], ["meso-haline bay", {"concepts": "meso-haline bay", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "meso-haline bay"}], ["stressors", {"concepts": "stressors", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "stressors"}], ["non-profits", {"concepts": "non-profits", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "non-profits"}], ["temperature", {"concepts": "temperature", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "temperature"}], ["elevation", {"concepts": "elevation", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "elevation"}], ["cost", {"concepts": "cost", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "cost"}], ["thin layer placement", {"concepts": "thin layer placement", "type": "concept", "cluster": "Coastal Management Challenges", "node_size": 10, "label": "thin layer placement"}]], "Biodiversity Benefits": [["plant diversity", {"concepts": "plant diversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "plant diversity"}], ["species diversity", {"concepts": "species diversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "species diversity"}], ["facilitator species", {"concepts": "facilitator species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "facilitator species"}], ["biodiversity components", {"concepts": "biodiversity components", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "biodiversity components"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem services"}], ["ecosystem resilience", {"concepts": "ecosystem resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem resilience"}], ["plant communities", {"concepts": "plant communities", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "plant communities"}], ["ecological benefit", {"concepts": "ecological benefit", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological benefit"}], ["wildlife conservation", {"concepts": "wildlife conservation", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "wildlife conservation"}], ["diversity of plant species", {"concepts": "diversity of plant species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "diversity of plant species"}], ["species recruitment", {"concepts": "species recruitment", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "species recruitment"}], ["ecological resilience", {"concepts": "ecological resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological resilience"}], ["ecological considerations", {"concepts": "ecological considerations", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecological considerations"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "keystone species"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "biodiversity"}], ["system resilience", {"concepts": "system resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "system resilience"}], ["resilience", {"concepts": "resilience", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "resilience"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "conservation concern"}], ["ecosystem benefits", {"concepts": "ecosystem benefits", "type": "concept", "cluster": "Biodiversity Benefits", "node_size": 10, "label": "ecosystem benefits"}]], "Adjacent Habitats": [["habitat", {"concepts": "habitat", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "habitat"}], ["adjacent habitat", {"concepts": "adjacent habitat", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "adjacent habitat"}], ["adjacent habitats", {"concepts": "adjacent habitats", "type": "concept", "cluster": "Adjacent Habitats", "node_size": 10, "label": "adjacent habitats"}]], "Habitat Connectivity": [["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat forming species"}], ["habitat connectivity", {"concepts": "habitat connectivity", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat connectivity"}], ["habitat restoration", {"concepts": "habitat restoration", "type": "concept", "cluster": "Habitat Connectivity", "node_size": 10, "label": "habitat restoration"}]]};
        const clusterEdges = {"Shoreline Protection Strategies": [], "Environmental Permitting Factors": [], "Marsh Adaptation Dynamics": [], "Coastal Management Challenges": [], "Biodiversity Benefits": [], "Adjacent Habitats": [], "Habitat Connectivity": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
