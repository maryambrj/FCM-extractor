
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access": {"concepts": "retail quality, corner stores, grocery store, convenience stores, grocery stores, store options, asian grocery store, retail use, retail types, local grocery stores", "concept_list": ["retail quality", "corner stores", "grocery store", "convenience stores", "grocery stores", "store options", "asian grocery store", "retail use", "retail types", "local grocery stores"], "type": "cluster", "node_size": 45, "label": "Food Access"}, "Community Barriers": {"concepts": "consumption patterns, food availability, appetite, culturally irrelevant foods, processed foods, liquor stores, food system sectors, free food, culturally relevant foods, food pantries, food security, junk food, food safety, food consumption, food pantry, unhealthy foods, latin american food, nutrition, food desert, sweets, cultural foods, healthy food, mexican food, supplemental nutrition programs, food purchasing, food system, food inventory, fresh produce, food culture, farmers market, food sources, unhealthy options, healthy diet, liquor store, emergency food systems, food quality, diet, produce quality, plant-based diet, vegan diet, staple foods, farmer's markets, food scarcity, balanced meal, food systems, nutrition class, food quantity, food affordability, food access, local food system, nutritious foods, canned foods, fast food, emergency foods, culturally relevant food", "concept_list": ["consumption patterns", "food availability", "appetite", "culturally irrelevant foods", "processed foods", "liquor stores", "food system sectors", "free food", "culturally relevant foods", "food pantries", "food security", "junk food", "food safety", "food consumption", "food pantry", "unhealthy foods", "latin american food", "nutrition", "food desert", "sweets", "cultural foods", "healthy food", "mexican food", "supplemental nutrition programs", "food purchasing", "food system", "food inventory", "fresh produce", "food culture", "farmers market", "food sources", "unhealthy options", "healthy diet", "liquor store", "emergency food systems", "food quality", "diet", "produce quality", "plant-based diet", "vegan diet", "staple foods", "farmer's markets", "food scarcity", "balanced meal", "food systems", "nutrition class", "food quantity", "food affordability", "food access", "local food system", "nutritious foods", "canned foods", "fast food", "emergency foods", "culturally relevant food"], "type": "cluster", "node_size": 180, "label": "Community Barriers"}, "Restaurant Types": {"concepts": "sidewalks, price, pontiac, frustration, bridge card, positive outcomes, mobility issues, cultural community center, emergency sectors, mcdonald's, diabetes, neighborhoods, leverage points, program awareness, personal experience, pandemic increase, inspiration, racism, health, trust issue, older adults, price barriers, cultural representation, social experience, health and well-being, community impact, bloomfield hills, quality of life, flint water crisis, brand recognition, arizona tea, researcher bias, social life, economic opportunity, water crisis, price disparity, public transportation, exclusion, snap, immigrants, representation, accessibility, affluent populations, trust, transportation, wic, well-being, genesee county, hot cheetos, hierarchy of human value, sugar, support, social determinants, communities of color, emergency sector, heart disease, research, elderly, flint, socioeconomic status, tortillas, pedestrians, authenticity, availability, cultural appropriation, education, walmart, culturally relevant items, southwest detroit, safety, cultural markets, hierarchy, neighborhood safety, lunch meetings, environment, flint fresh, well being, markets, neighborhood institutions, residents, pharmacies, logo, affluent communities, economic suppression, chips, health disparities, human value, professional experience, affordability, nonprofits, spanish speaking community, meijer, system change, standard of quality, affluent community, economic crisis, expressway, low income communities, ebt, detroit, blood pressure, community members, travel, hurley hospital, dominant culture, cultural relevance, community function, lansing, relevant markets, organizational context, local community, cultural identity, covid-19 impact, public infrastructure, community center, systemic racism, systemic disenfranchisement", "concept_list": ["sidewalks", "price", "pontiac", "frustration", "bridge card", "positive outcomes", "mobility issues", "cultural community center", "emergency sectors", "mcdonald's", "diabetes", "neighborhoods", "leverage points", "program awareness", "personal experience", "pandemic increase", "inspiration", "racism", "health", "trust issue", "older adults", "price barriers", "cultural representation", "social experience", "health and well-being", "community impact", "bloomfield hills", "quality of life", "flint water crisis", "brand recognition", "arizona tea", "researcher bias", "social life", "economic opportunity", "water crisis", "price disparity", "public transportation", "exclusion", "snap", "immigrants", "representation", "accessibility", "affluent populations", "trust", "transportation", "wic", "well-being", "genesee county", "hot cheetos", "hierarchy of human value", "sugar", "support", "social determinants", "communities of color", "emergency sector", "heart disease", "research", "elderly", "flint", "socioeconomic status", "tortillas", "pedestrians", "authenticity", "availability", "cultural appropriation", "education", "walmart", "culturally relevant items", "southwest detroit", "safety", "cultural markets", "hierarchy", "neighborhood safety", "lunch meetings", "environment", "flint fresh", "well being", "markets", "neighborhood institutions", "residents", "pharmacies", "logo", "affluent communities", "economic suppression", "chips", "health disparities", "human value", "professional experience", "affordability", "nonprofits", "spanish speaking community", "meijer", "system change", "standard of quality", "affluent community", "economic crisis", "expressway", "low income communities", "ebt", "detroit", "blood pressure", "community members", "travel", "hurley hospital", "dominant culture", "cultural relevance", "community function", "lansing", "relevant markets", "organizational context", "local community", "cultural identity", "covid-19 impact", "public infrastructure", "community center", "systemic racism", "systemic disenfranchisement"], "type": "cluster", "node_size": 366, "label": "Restaurant Types"}, "Small Businesses": {"concepts": "chain restaurants, vegan restaurants, mexican american restaurant, vegetarian restaurants, local restaurants, downtown restaurants", "concept_list": ["chain restaurants", "vegan restaurants", "mexican american restaurant", "vegetarian restaurants", "local restaurants", "downtown restaurants"], "type": "cluster", "node_size": 33, "label": "Small Businesses"}, "Retail Options": {"concepts": "small businesses, businesses, brown businesses, business barriers, black businesses, business closure", "concept_list": ["small businesses", "businesses", "brown businesses", "business barriers", "black businesses", "business closure"], "type": "cluster", "node_size": 33, "label": "Retail Options"}};
        const conceptData = {};
        const interClusterEdges = [["Food Access", "Retail Options", {"weight": 0.8, "confidence": 0.54, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Restaurant Types", {"weight": 0.6, "confidence": 0.43, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Small Businesses", {"weight": -0.3333333333333333, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}], ["Community Barriers", "Small Businesses", {"weight": 0.4, "confidence": 0.6200000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Barriers", "Food Access", {"weight": 0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Community Barriers", "Retail Options", {"weight": 0.25, "confidence": 0.5125, "type": "inter_cluster", "style": "solid"}], ["Community Barriers", "Restaurant Types", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Small Businesses", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Retail Options", {"weight": 0.5, "confidence": 0.38749999999999996, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Food Access", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Community Barriers", {"weight": 0.25, "confidence": 0.2125, "type": "inter_cluster", "style": "solid"}], ["Small Businesses", "Food Access", {"weight": 0.5, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Small Businesses", "Restaurant Types", {"weight": 0.4, "confidence": 0.54, "type": "inter_cluster", "style": "solid"}], ["Small Businesses", "Community Barriers", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Food Access", {"weight": 0.6, "confidence": 0.48, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Community Barriers", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Retail Options", "Restaurant Types", {"weight": 0.6666666666666666, "confidence": 0.48333333333333334, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access": [], "Community Barriers": [], "Restaurant Types": [], "Small Businesses": [], "Retail Options": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
