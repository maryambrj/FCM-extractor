
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"governmental programs": {"concepts": "governmental programs", "concept_list": ["governmental programs"], "type": "cluster", "node_size": 18, "label": "governmental programs"}, "farmers markets": {"concepts": "farmers markets", "concept_list": ["farmers markets"], "type": "cluster", "node_size": 18, "label": "farmers markets"}, "Food Access & Education": {"concepts": "raised beds, price barriers, economic situation, funding, local sourcing, nonprofit organizations, restructuring, social benefit, free lunch, pandemic impact, participation, business promotion, effective partnerships, sourcing, programming evaluation, barriers, decision-making, organizational tools, environmental toxins, connection strengths, conceptual learning, produce knowledge, community field, item restrictions, transportation barriers, fiber, consistency, program evaluation, community empowerment, resources, failsafe program, meijer, locally sourced, plant care, organizational support, wic system, partnership models, affordability, grants, trust, resident engagement, homelessness, accessibility, bottom-up approach, community support, consumption, community outreach, community involvement, beneficiary engagement, wic program, produce preparation, grant funding, employment, innovation, supplemental sector, problem acknowledgment, partnership, gentrification, program availability, economic wealth, seed giveaways, transportation, resource allocation, oxygen production, income, stakeholder participation, past experiences, emergency sector, lack of understanding, walmart, seasonality, volunteering", "concept_list": ["raised beds", "price barriers", "economic situation", "funding", "local sourcing", "nonprofit organizations", "restructuring", "social benefit", "free lunch", "pandemic impact", "participation", "business promotion", "effective partnerships", "sourcing", "programming evaluation", "barriers", "decision-making", "organizational tools", "environmental toxins", "connection strengths", "conceptual learning", "produce knowledge", "community field", "item restrictions", "transportation barriers", "fiber", "consistency", "program evaluation", "community empowerment", "resources", "failsafe program", "meijer", "locally sourced", "plant care", "organizational support", "wic system", "partnership models", "affordability", "grants", "trust", "resident engagement", "homelessness", "accessibility", "bottom-up approach", "community support", "consumption", "community outreach", "community involvement", "beneficiary engagement", "wic program", "produce preparation", "grant funding", "employment", "innovation", "supplemental sector", "problem acknowledgment", "partnership", "gentrification", "program availability", "economic wealth", "seed giveaways", "transportation", "resource allocation", "oxygen production", "income", "stakeholder participation", "past experiences", "emergency sector", "lack of understanding", "walmart", "seasonality", "volunteering"], "type": "cluster", "node_size": 231, "label": "Food Access & Education"}, "Urban Agriculture Spaces": {"concepts": "food choices, food system, nutritional foods, food model, frozen food, food safety, flint food system, food sourcing, supplemental nutrition programs, nutrition education, nutrition supplement programs, food education, privilege, food items, food purchasing, food waste, food programs, nutritious foods, food choice, food regulations, nutritional food, food stamps, food giveaways, fresh food, food hoarding, food privilege, food program, food accessibility, food drives, nutritional value", "concept_list": ["food choices", "food system", "nutritional foods", "food model", "frozen food", "food safety", "flint food system", "food sourcing", "supplemental nutrition programs", "nutrition education", "nutrition supplement programs", "food education", "privilege", "food items", "food purchasing", "food waste", "food programs", "nutritious foods", "food choice", "food regulations", "nutritional food", "food stamps", "food giveaways", "fresh food", "food hoarding", "food privilege", "food program", "food accessibility", "food drives", "nutritional value"], "type": "cluster", "node_size": 105, "label": "Urban Agriculture Spaces"}, "Food Retail Landscape": {"concepts": "housing structures, urban agriculture, community plots, home gardens, city limits, greenhouses, communal greenhouses, residential areas, apartment complex, community gardens, downtown area, negative lands, housing density, home gardening, sustainable housing, outdoor experiences, farmers market", "concept_list": ["housing structures", "urban agriculture", "community plots", "home gardens", "city limits", "greenhouses", "communal greenhouses", "residential areas", "apartment complex", "community gardens", "downtown area", "negative lands", "housing density", "home gardening", "sustainable housing", "outdoor experiences", "farmers market"], "type": "cluster", "node_size": 66, "label": "Food Retail Landscape"}, "Food System Sustainability": {"concepts": "convenience stores, local restaurants, retail types, chain restaurants, grocery store, retail use, retail stores, grocery stores", "concept_list": ["convenience stores", "local restaurants", "retail types", "chain restaurants", "grocery store", "retail use", "retail stores", "grocery stores"], "type": "cluster", "node_size": 39, "label": "Food System Sustainability"}, "Community Access & Support": {"concepts": "food insecurity, sustainable products, program sustainability, food system resilience, sustainability, democratic food systems, food sovereignty, food system sustainability, water purification, household health, resilience, water access", "concept_list": ["food insecurity", "sustainable products", "program sustainability", "food system resilience", "sustainability", "democratic food systems", "food sovereignty", "food system sustainability", "water purification", "household health", "resilience", "water access"], "type": "cluster", "node_size": 51, "label": "Community Access & Support"}, "Education Systems": {"concepts": "education, educational programs, educational portion, school systems", "concept_list": ["education", "educational programs", "educational portion", "school systems"], "type": "cluster", "node_size": 27, "label": "Education Systems"}, "Rice Varieties": {"concepts": "brown rice, white rice, black rice", "concept_list": ["brown rice", "white rice", "black rice"], "type": "cluster", "node_size": 24, "label": "Rice Varieties"}};
        const conceptData = {};
        const interClusterEdges = [["governmental programs", "Food Retail Landscape", {"weight": 1.0, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Urban Agriculture Spaces", {"weight": 0.5, "confidence": 0.8375, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Community Access & Support", {"weight": 0.8, "confidence": 0.61, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Education Systems", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Food Access & Education", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Food System Sustainability", {"weight": 0.75, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "farmers markets", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["governmental programs", "Rice Varieties", {"weight": 0.75, "confidence": 0.46249999999999997, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "Food Retail Landscape", {"weight": 0.6, "confidence": 0.7100000000000001, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "Urban Agriculture Spaces", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "Community Access & Support", {"weight": 0.8, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "Education Systems", {"weight": 0.8, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "governmental programs", {"weight": 0.75, "confidence": 0.44999999999999996, "type": "inter_cluster", "style": "solid"}], ["farmers markets", "Food System Sustainability", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "Community Access & Support", {"weight": 1.0, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "farmers markets", {"weight": 0.8, "confidence": 0.5499999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "Urban Agriculture Spaces", {"weight": 0.75, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "Education Systems", {"weight": 0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "Rice Varieties", {"weight": 0.5, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Food Access & Education", "Food System Sustainability", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture Spaces", "Rice Varieties", {"weight": 1.0, "confidence": 0.77, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture Spaces", "Community Access & Support", {"weight": 0.2, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture Spaces", "farmers markets", {"weight": 0.75, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture Spaces", "Food Retail Landscape", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Food Retail Landscape", "Urban Agriculture Spaces", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Food Retail Landscape", "Education Systems", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Retail Landscape", "farmers markets", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Food Retail Landscape", "governmental programs", {"weight": 0.75, "confidence": 0.42500000000000004, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "Urban Agriculture Spaces", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "Rice Varieties", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "Community Access & Support", {"weight": -0.5, "confidence": 0.6749999999999999, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "farmers markets", {"weight": -0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "governmental programs", {"weight": 0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "Food Retail Landscape", {"weight": -0.25, "confidence": 0.4375, "type": "inter_cluster", "style": "solid"}], ["Food System Sustainability", "Education Systems", {"weight": 0.6666666666666666, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Community Access & Support", "Food System Sustainability", {"weight": -0.4, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Access & Support", "Education Systems", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Community Access & Support", "governmental programs", {"weight": 0.75, "confidence": 0.48750000000000004, "type": "inter_cluster", "style": "solid"}], ["Community Access & Support", "farmers markets", {"weight": 0.75, "confidence": 0.4625, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Urban Agriculture Spaces", {"weight": 1.0, "confidence": 0.9200000000000002, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Food Retail Landscape", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Food System Sustainability", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Community Access & Support", {"weight": 1.0, "confidence": 0.8250000000000001, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "governmental programs", {"weight": 1.0, "confidence": 0.6100000000000001, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Food Access & Education", {"weight": 0.5, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Rice Varieties", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Rice Varieties", "Urban Agriculture Spaces", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Rice Varieties", "Community Access & Support", {"weight": 0.25, "confidence": 0.44999999999999996, "type": "inter_cluster", "style": "solid"}], ["Rice Varieties", "Food System Sustainability", {"weight": 0.6, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access & Education": [], "Urban Agriculture Spaces": [], "Food Retail Landscape": [], "Food System Sustainability": [], "Community Access & Support": [], "Education Systems": [], "Rice Varieties": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
