
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Resources": {"concepts": "healthy food choices, grocery stores, type 2 diabetes, healthy food, food pharmacy, vitamin b-12, food education, type 1 diabetes, food banks, double up food bucks, nutritious choices, cooking skills, food preparation, raw ingredients, nutrition, food options, food skills, vitamin c, processed foods, food, food system, food access, food assistance, nutritious foods, food loss, food pantry, packaged foods, food bank, food waste, food system values, food systems, canned goods, food quality, convenience stores", "concept_list": ["healthy food choices", "grocery stores", "type 2 diabetes", "healthy food", "food pharmacy", "vitamin b-12", "food education", "type 1 diabetes", "food banks", "double up food bucks", "nutritious choices", "cooking skills", "food preparation", "raw ingredients", "nutrition", "food options", "food skills", "vitamin c", "processed foods", "food", "food system", "food access", "food assistance", "nutritious foods", "food loss", "food pantry", "packaged foods", "food bank", "food waste", "food system values", "food systems", "canned goods", "food quality", "convenience stores"], "type": "cluster", "node_size": 117, "label": "Community Resources"}, "Urban Agriculture": {"concepts": "information access, input, opportunity, pride, knowledge, undercover gardening, financial resources, learning, resident input, connections, csa, grants, flint community, map, system, learning curve, flint, financial side, detroit, preservation, collaboration, social connection, ascension, leadership, revenue, edible flint, youth, biology classes, educational programs, kale, health, expertise, michigan, community engagement, flint water crisis, relationship strength, shop class, conscious consumer, personal growth, organizational processes, life skills, career development, perpetuation, focus groups, education standpoint, community members, self sustainability, social connections, trust, sew, grant writing, tools, volunteers, soup kitchen, resident income, skill development, liaison activities, dependency, challenges, organizational goals, safety standards, social stigma, help-seeking, economic opportunities, access, mentorship, high tunnels, organizations, sanctuary, training, addiction, early exposure, water shut offs, facilities, educational training, preparation, news media, humility, sustainability, ethnic groups, common understanding, judgment, choices, partnerships, affordability, community support, solutions, maintenance, cultural values, donation, red lines, community resources, availability, comfort, production, ministry, accessibility, shame, resource distribution, social support, organizational challenges, system integration, church, prejudice, news, leverage points, abuse, residents, greenhouse management, outcome, communication, webbing, habits, greenhouse, spinach, greenhouse operation, compassion, gardening, canning, solar, home-ec, resources, distance barriers, social evolution, remote learning, empowerment, funding, problem solving, negative circumstances, education, nonprofit status, grade school, exposure education, transportation, discounted resources, newspaper, central greenhouse, impacts, snap, data, dignity, lead exposure, networking, seven year olds, modeling process, harvesting, creativity, community empowerment, quality of life, nonprofits, exposure, b-12, community, human trafficking, staffing, mentor, safety, packaging standards, stitch, support, support resources, resourcefulness, home, stove, common good, utilities, self-sustaining, manager, upbringing, phd, social challenges, at risk residents, evolution, sustainable systems, elementary schools, community benefit, technical solutions, traffic, harvest, recovery, combined effort, project", "concept_list": ["information access", "input", "opportunity", "pride", "knowledge", "undercover gardening", "financial resources", "learning", "resident input", "connections", "csa", "grants", "flint community", "map", "system", "learning curve", "flint", "financial side", "detroit", "preservation", "collaboration", "social connection", "ascension", "leadership", "revenue", "edible flint", "youth", "biology classes", "educational programs", "kale", "health", "expertise", "michigan", "community engagement", "flint water crisis", "relationship strength", "shop class", "conscious consumer", "personal growth", "organizational processes", "life skills", "career development", "perpetuation", "focus groups", "education standpoint", "community members", "self sustainability", "social connections", "trust", "sew", "grant writing", "tools", "volunteers", "soup kitchen", "resident income", "skill development", "liaison activities", "dependency", "challenges", "organizational goals", "safety standards", "social stigma", "help-seeking", "economic opportunities", "access", "mentorship", "high tunnels", "organizations", "sanctuary", "training", "addiction", "early exposure", "water shut offs", "facilities", "educational training", "preparation", "news media", "humility", "sustainability", "ethnic groups", "common understanding", "judgment", "choices", "partnerships", "affordability", "community support", "solutions", "maintenance", "cultural values", "donation", "red lines", "community resources", "availability", "comfort", "production", "ministry", "accessibility", "shame", "resource distribution", "social support", "organizational challenges", "system integration", "church", "prejudice", "news", "leverage points", "abuse", "residents", "greenhouse management", "outcome", "communication", "webbing", "habits", "greenhouse", "spinach", "greenhouse operation", "compassion", "gardening", "canning", "solar", "home-ec", "resources", "distance barriers", "social evolution", "remote learning", "empowerment", "funding", "problem solving", "negative circumstances", "education", "nonprofit status", "grade school", "exposure education", "transportation", "discounted resources", "newspaper", "central greenhouse", "impacts", "snap", "data", "dignity", "lead exposure", "networking", "seven year olds", "modeling process", "harvesting", "creativity", "community empowerment", "quality of life", "nonprofits", "exposure", "b-12", "community", "human trafficking", "staffing", "mentor", "safety", "packaging standards", "stitch", "support", "support resources", "resourcefulness", "home", "stove", "common good", "utilities", "self-sustaining", "manager", "upbringing", "phd", "social challenges", "at risk residents", "evolution", "sustainable systems", "elementary schools", "community benefit", "technical solutions", "traffic", "harvest", "recovery", "combined effort", "project"], "type": "cluster", "node_size": 561, "label": "Urban Agriculture"}, "Fruits and Vegetables": {"concepts": "public transportation, agriculture, women, inner city, farm managers, women's farm, women's shelter, soil, urban women farmers, urban women, land access, urban agriculture, farmers, local economic development, roadside stand, flint farmers market, farmers market, farm, genesee county, spatial access, local farmers", "concept_list": ["public transportation", "agriculture", "women", "inner city", "farm managers", "women's farm", "women's shelter", "soil", "urban women farmers", "urban women", "land access", "urban agriculture", "farmers", "local economic development", "roadside stand", "flint farmers market", "farmers market", "farm", "genesee county", "spatial access", "local farmers"], "type": "cluster", "node_size": 78, "label": "Fruits and Vegetables"}, "Healthy Food Access": {"concepts": "root vegetable, seed germination, root cellar, leaf lettuce, vegetables, seeds, fruits", "concept_list": ["root vegetable", "seed germination", "root cellar", "leaf lettuce", "vegetables", "seeds", "fruits"], "type": "cluster", "node_size": 36, "label": "Healthy Food Access"}};
        const conceptData = {};
        const interClusterEdges = [["Community Resources", "Urban Agriculture", {"weight": 0.8, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Resources", "Healthy Food Access", {"weight": 0.8, "confidence": 0.62, "type": "inter_cluster", "style": "solid"}], ["Community Resources", "Fruits and Vegetables", {"weight": 0.4, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Community Resources", {"weight": 0.8, "confidence": 0.61, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Healthy Food Access", {"weight": 0.6, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Fruits and Vegetables", {"weight": 0.3333333333333333, "confidence": 0.2833333333333333, "type": "inter_cluster", "style": "solid"}], ["Fruits and Vegetables", "Healthy Food Access", {"weight": 0.6, "confidence": 0.5199999999999999, "type": "inter_cluster", "style": "solid"}], ["Fruits and Vegetables", "Community Resources", {"weight": 0.6, "confidence": 0.42000000000000004, "type": "inter_cluster", "style": "solid"}], ["Fruits and Vegetables", "Urban Agriculture", {"weight": 0.2, "confidence": 0.16999999999999998, "type": "inter_cluster", "style": "solid"}], ["Healthy Food Access", "Fruits and Vegetables", {"weight": 0.8, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Healthy Food Access", "Urban Agriculture", {"weight": 0.6, "confidence": 0.52, "type": "inter_cluster", "style": "solid"}], ["Healthy Food Access", "Community Resources", {"weight": 0.4, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Resources": [], "Urban Agriculture": [], "Fruits and Vegetables": [], "Healthy Food Access": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
