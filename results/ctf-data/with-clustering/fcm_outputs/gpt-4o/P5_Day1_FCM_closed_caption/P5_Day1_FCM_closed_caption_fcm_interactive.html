
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Causal Relationships": {"concepts": "causal assertions, positive causal relationship, causal mechanisms, researcher's ability, negative causal effect, negative causal relationship, theorizing", "concept_list": ["causal assertions", "positive causal relationship", "causal mechanisms", "researcher's ability", "negative causal effect", "negative causal relationship", "theorizing"], "type": "cluster", "node_size": 36, "label": "Causal Relationships"}, "Target Analysis": {"concepts": "factors, assumptions, standard, solutions, psychological, static analysis, restricted access, prior knowledge, pure state, fuzzy cognitive map, poor implementation, tool set, environmental variables, experiences, intricacy, decompiler, information, target interaction, understanding functionalities, inherent variables, identification, at rest, functionalities, familiarity, target access, expertise, information gain, target learning, computer visualization, learning, local versus remote, environment, target influence, modified target, process, static process analysis, target characteristic, mitigations, tools, target understanding, errors, guess and check, enumeration, point value, challenge enumeration, target, granular effects, strategy, challenge, control, toolset, step four, feedback loops, modify target, source code, trial and error, task diagram, variables, success, quick solutions, inaccessible dependencies, robustness, feedback loop, file formats, accurate understanding, functionality, inexperienced, execution, full picture, right tool, organizational, quality of development, decisions, risk, ranking, convention, strace, critical changes, open-ended, protocol familiarity, fuzzer, target process analysis, binaries, conventions, static, abnormal results, code review, memory management, weaknesses, educational, process outline, dynamic analysis, capabilities, fcm, targets, success factors, reverse engineering, target binary, design facets, critical fault, penalization, beliefs, judgment call, pattern matching, unsuccessful interaction, outputs, understanding, kernel interaction, interaction, ctf player, target specific, general expertise, code smell, target process, code complexity, likelihood, target discovery, compiled binary, kernel, target control, protocols, standards, hypotheses, environment alteration, implementation, design patterns, dynamic, process analysis, additional functionality, graph, environmental mistake, workable state, progress disruption, iterative, dynamically analyze, valid inputs, inputs, alternate paths, outside resources, jeopardy challenges, complexity, testing weaknesses, rabbit holes, specialized tools, proprietary, environmental condition, network connections, testing, memory mismanagement, interrogate, ctf, abstraction, modifying target, knowledge, access, semi-structured, assertions, reversing, implementation changes, ctf challenge, target response, target characteristics, code, effects, target obscurity, quality, stability, success or failure, dependencies, interrogation, internal processes", "concept_list": ["factors", "assumptions", "standard", "solutions", "psychological", "static analysis", "restricted access", "prior knowledge", "pure state", "fuzzy cognitive map", "poor implementation", "tool set", "environmental variables", "experiences", "intricacy", "decompiler", "information", "target interaction", "understanding functionalities", "inherent variables", "identification", "at rest", "functionalities", "familiarity", "target access", "expertise", "information gain", "target learning", "computer visualization", "learning", "local versus remote", "environment", "target influence", "modified target", "process", "static process analysis", "target characteristic", "mitigations", "tools", "target understanding", "errors", "guess and check", "enumeration", "point value", "challenge enumeration", "target", "granular effects", "strategy", "challenge", "control", "toolset", "step four", "feedback loops", "modify target", "source code", "trial and error", "task diagram", "variables", "success", "quick solutions", "inaccessible dependencies", "robustness", "feedback loop", "file formats", "accurate understanding", "functionality", "inexperienced", "execution", "full picture", "right tool", "organizational", "quality of development", "decisions", "risk", "ranking", "convention", "strace", "critical changes", "open-ended", "protocol familiarity", "fuzzer", "target process analysis", "binaries", "conventions", "static", "abnormal results", "code review", "memory management", "weaknesses", "educational", "process outline", "dynamic analysis", "capabilities", "fcm", "targets", "success factors", "reverse engineering", "target binary", "design facets", "critical fault", "penalization", "beliefs", "judgment call", "pattern matching", "unsuccessful interaction", "outputs", "understanding", "kernel interaction", "interaction", "ctf player", "target specific", "general expertise", "code smell", "target process", "code complexity", "likelihood", "target discovery", "compiled binary", "kernel", "target control", "protocols", "standards", "hypotheses", "environment alteration", "implementation", "design patterns", "dynamic", "process analysis", "additional functionality", "graph", "environmental mistake", "workable state", "progress disruption", "iterative", "dynamically analyze", "valid inputs", "inputs", "alternate paths", "outside resources", "jeopardy challenges", "complexity", "testing weaknesses", "rabbit holes", "specialized tools", "proprietary", "environmental condition", "network connections", "testing", "memory mismanagement", "interrogate", "ctf", "abstraction", "modifying target", "knowledge", "access", "semi-structured", "assertions", "reversing", "implementation changes", "ctf challenge", "target response", "target characteristics", "code", "effects", "target obscurity", "quality", "stability", "success or failure", "dependencies", "interrogation", "internal processes"], "type": "cluster", "node_size": 528, "label": "Target Analysis"}, "Vulnerability Assessment": {"concepts": "vulnerability, cyber attacks, attack surface, vulnerabilities, vulnerable patterns, attack surfaces, potential vulnerabilities, rank vulnerabilities, cyber attackers, fake flag, identify vulnerabilities, ranking vulnerabilities", "concept_list": ["vulnerability", "cyber attacks", "attack surface", "vulnerabilities", "vulnerable patterns", "attack surfaces", "potential vulnerabilities", "rank vulnerabilities", "cyber attackers", "fake flag", "identify vulnerabilities", "ranking vulnerabilities"], "type": "cluster", "node_size": 51, "label": "Vulnerability Assessment"}, "Behavioral Patterns": {"concepts": "intended behavior, behavior pattern, behavior matching, behavior, target behavior, disruptive behaviors, abnormal behavior, mock behavior, behaviors", "concept_list": ["intended behavior", "behavior pattern", "behavior matching", "behavior", "target behavior", "disruptive behaviors", "abnormal behavior", "mock behavior", "behaviors"], "type": "cluster", "node_size": 42, "label": "Behavioral Patterns"}, "Emulated Behavior": {"concepts": "emulated, unsafe code practices, unsafe behavior, emulating behavior, emulated target", "concept_list": ["emulated", "unsafe code practices", "unsafe behavior", "emulating behavior", "emulated target"], "type": "cluster", "node_size": 30, "label": "Emulated Behavior"}};
        const conceptData = {};
        const interClusterEdges = [["Causal Relationships", "Behavioral Patterns", {"weight": 1.0, "confidence": 0.7700000000000001, "type": "inter_cluster", "style": "solid"}], ["Causal Relationships", "Vulnerability Assessment", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Causal Relationships", "Target Analysis", {"weight": 0.4, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Causal Relationships", "Emulated Behavior", {"weight": 0.3333333333333333, "confidence": 0.2333333333333333, "type": "inter_cluster", "style": "solid"}], ["Target Analysis", "Causal Relationships", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Target Analysis", "Behavioral Patterns", {"weight": 0.8, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Target Analysis", "Vulnerability Assessment", {"weight": 0.5, "confidence": 0.3875, "type": "inter_cluster", "style": "solid"}], ["Target Analysis", "Emulated Behavior", {"weight": 0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Assessment", "Target Analysis", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Assessment", "Behavioral Patterns", {"weight": 0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Assessment", "Emulated Behavior", {"weight": 0.25, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Assessment", "Causal Relationships", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Behavioral Patterns", "Vulnerability Assessment", {"weight": 0.75, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Behavioral Patterns", "Causal Relationships", {"weight": 0.75, "confidence": 0.5249999999999999, "type": "inter_cluster", "style": "solid"}], ["Behavioral Patterns", "Target Analysis", {"weight": 0.4, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Behavioral Patterns", "Emulated Behavior", {"weight": 0.3333333333333333, "confidence": 0.2333333333333333, "type": "inter_cluster", "style": "solid"}], ["Emulated Behavior", "Causal Relationships", {"weight": 0.3333333333333333, "confidence": 0.2333333333333333, "type": "inter_cluster", "style": "solid"}], ["Emulated Behavior", "Behavioral Patterns", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Emulated Behavior", "Target Analysis", {"weight": 0.25, "confidence": 0.1625, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Causal Relationships": [], "Target Analysis": [], "Vulnerability Assessment": [], "Behavioral Patterns": [], "Emulated Behavior": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
