
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"livelihoods": {"concepts": "livelihoods", "concept_list": ["livelihoods"], "type": "cluster", "node_size": 18, "label": "livelihoods"}, "coral survival": {"concepts": "coral survival", "concept_list": ["coral survival"], "type": "cluster", "node_size": 18, "label": "coral survival"}, "Resource Management": {"concepts": "communication, safety zone, commercial catch reports, ngo, commercial license, usvi, snapper closed area, radio, commissioner, saint thomas, food parties, senators, area closures, license, construction, conflicts, resource abuse, sargassum, international waters, lobster, cultural dependence, decisions, conch season, stakeholders, virgin islands, nautic zones, safe zone, new generations, senator, boat traffic, education, healthy food, st. croix, cargo vessels, decision makers, world players, researchers, district advisory panels, queen conch, director, fishing, local meetings, town hall meeting, commercial catch, ball games, billboard, spawning, cookout, resources, nature conservancy, income, big vessels, lobster numbers, responsibility, resource protection, rescue, scalers, clients, long liners, fairness, relationships, social changes, divers, closing areas, processed food, agenda, meetings", "concept_list": ["communication", "safety zone", "commercial catch reports", "ngo", "commercial license", "usvi", "snapper closed area", "radio", "commissioner", "saint thomas", "food parties", "senators", "area closures", "license", "construction", "conflicts", "resource abuse", "sargassum", "international waters", "lobster", "cultural dependence", "decisions", "conch season", "stakeholders", "virgin islands", "nautic zones", "safe zone", "new generations", "senator", "boat traffic", "education", "healthy food", "st. croix", "cargo vessels", "decision makers", "world players", "researchers", "district advisory panels", "queen conch", "director", "fishing", "local meetings", "town hall meeting", "commercial catch", "ball games", "billboard", "spawning", "cookout", "resources", "nature conservancy", "income", "big vessels", "lobster numbers", "responsibility", "resource protection", "rescue", "scalers", "clients", "long liners", "fairness", "relationships", "social changes", "divers", "closing areas", "processed food", "agenda", "meetings"], "type": "cluster", "node_size": 216, "label": "Resource Management"}, "Fishing Practices": {"concepts": "fishing income, fishing community, white sea urchin, fishing smart, deep water fishing, seafood, future in fishing, soil sediment, fish and wildlife, coastal communities, east end marine park, safe fishing zone, fishing zones, poaching, algaes, puffer fish, sturgeon fish, fishing experience, fish pots, sea grass, shoreline, local fish", "concept_list": ["fishing income", "fishing community", "white sea urchin", "fishing smart", "deep water fishing", "seafood", "future in fishing", "soil sediment", "fish and wildlife", "coastal communities", "east end marine park", "safe fishing zone", "fishing zones", "poaching", "algaes", "puffer fish", "sturgeon fish", "fishing experience", "fish pots", "sea grass", "shoreline", "local fish"], "type": "cluster", "node_size": 81, "label": "Fishing Practices"}, "Climate Impact": {"concepts": "global warming, hurricanes, environmental changes, major hurricanes, seasonal closures, climate change, seasonal changes", "concept_list": ["global warming", "hurricanes", "environmental changes", "major hurricanes", "seasonal closures", "climate change", "seasonal changes"], "type": "cluster", "node_size": 36, "label": "Climate Impact"}, "Government Regulations": {"concepts": "rules and regulations, government support, government regulations, regulations, agricultural facilities, lawmaking, lawmakers, local government, mandate, pollution, federal government", "concept_list": ["rules and regulations", "government support", "government regulations", "regulations", "agricultural facilities", "lawmaking", "lawmakers", "local government", "mandate", "pollution", "federal government"], "type": "cluster", "node_size": 48, "label": "Government Regulations"}, "Fishery Relations": {"concepts": "fishers relationships, fishermen, fisherman conflict, registered fishermen, fishery advisory committee, fisheries, commercial fisherman, caribbean fishery management council, fishers, usvi fisheries, fishery managers, fishery managers conflict, fisheries advisory committee, fishery management", "concept_list": ["fishers relationships", "fishermen", "fisherman conflict", "registered fishermen", "fishery advisory committee", "fisheries", "commercial fisherman", "caribbean fishery management council", "fishers", "usvi fisheries", "fishery managers", "fishery managers conflict", "fisheries advisory committee", "fishery management"], "type": "cluster", "node_size": 57, "label": "Fishery Relations"}, "Coral Reefs": {"concepts": "reef bottom, reefs, coral reefs", "concept_list": ["reef bottom", "reefs", "coral reefs"], "type": "cluster", "node_size": 24, "label": "Coral Reefs"}, "Coral Types": {"concepts": "elkhorn corals, staghorn corals", "concept_list": ["elkhorn corals", "staghorn corals"], "type": "cluster", "node_size": 21, "label": "Coral Types"}};
        const conceptData = {};
        const interClusterEdges = [["livelihoods", "Fishery Relations", {"weight": 1.0, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["livelihoods", "Resource Management", {"weight": 0.5, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["livelihoods", "Coral Types", {"weight": 0.8, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["livelihoods", "Government Regulations", {"weight": 0.75, "confidence": 0.5249999999999999, "type": "inter_cluster", "style": "solid"}], ["coral survival", "livelihoods", {"weight": 0.6, "confidence": 0.7799999999999999, "type": "inter_cluster", "style": "solid"}], ["coral survival", "Climate Impact", {"weight": -0.5, "confidence": 0.8375, "type": "inter_cluster", "style": "solid"}], ["coral survival", "Coral Reefs", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["coral survival", "Fishery Relations", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "coral survival", {"weight": 0.4, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Coral Types", {"weight": 0.2, "confidence": 0.41999999999999993, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Government Regulations", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "coral survival", {"weight": 1.0, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Fishery Relations", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Coral Reefs", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Government Regulations", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Climate Impact", "coral survival", {"weight": -0.6, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Climate Impact", "Government Regulations", {"weight": 0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Government Regulations", "Resource Management", {"weight": 0.8, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Government Regulations", "coral survival", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Government Regulations", "Fishing Practices", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Government Regulations", "Climate Impact", {"weight": 0.3333333333333333, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Fishery Relations", "Coral Reefs", {"weight": -0.2, "confidence": 0.41, "type": "inter_cluster", "style": "solid"}], ["Fishery Relations", "Climate Impact", {"weight": -0.6666666666666666, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Fishery Relations", "Fishing Practices", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Fishery Relations", "Government Regulations", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Coral Reefs", "coral survival", {"weight": 0.75, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}], ["Coral Reefs", "Resource Management", {"weight": 0.4, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Coral Reefs", "Climate Impact", {"weight": -0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Coral Reefs", "livelihoods", {"weight": 0.5, "confidence": 0.425, "type": "inter_cluster", "style": "solid"}], ["Coral Types", "Coral Reefs", {"weight": 0.5, "confidence": 0.8375, "type": "inter_cluster", "style": "solid"}], ["Coral Types", "Climate Impact", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Resource Management": [], "Fishing Practices": [], "Climate Impact": [], "Government Regulations": [], "Fishery Relations": [], "Coral Reefs": [], "Coral Types": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
