
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Biodiversity Management": {"concepts": "food web supporting, food chain, food web, key food web", "concept_list": ["food web supporting", "food chain", "food web", "key food web"], "type": "cluster", "label": "Biodiversity Management"}, "Fishing Industry": {"concepts": "no take areas, species range, relationships., policymakers, ecosystem, species richness, conservation concern., storms, edna research, channel islands sanctuary, transmission cable, shipping vessels, diversity components, regulation change, keystone species, stakeholders, cultural species, hypoxia, species lists, habitat use, evenness, increased temperatures, noise pollution, national sanctuary, management actions, kelp, medium impact, species evenness, temperature, military., channel sanctuary, increased storm frequency, plankton, herrings, upwelling, stressors, sanctuary advisory council, increased temperature, protected areas, ecosystem services, university of houston, climate, biodiversity, system components, species of conservation, diversity components., stressor, stakeholder engagement, advisory council., edna, science, channel islands national, biodiversity indices., biodiversity metrics, resource managers, ship strikes, concept mapping, military, educators, species diversity, tribal, cultural engagement, floor mapping, public engagement, keystone species., cultural interest, species of commercial, mpas, microplastics, biodiversity indices, hotspots, services, software, threatened species, decision making, biodiversity hotspots, high impact., harmful organisms, negative impact, place-based management, shipping industry, habitat forming species, diversity indices., education, semi quantitative, species distribution, bottom-up effect, area-based management, oa, shannon diversity indices, wind farm, research management, cold spots, research, kelp forests, mental modeling, commercial interest, biogeography, positive impact, stakeholders., resource management, low impact, resistance, biodiversity services, species of cultural, relationships, renewable energy, management, community user groups, spatial temporal patterns, shipping lanes, research opportunities, indigenous population, conservation concern, diving, critical organisms, high impact, storm frequency, science and education, biodiversity coldspots, climate change, invasive species, foundation species, area-based tools, observation network, no-take zone, cultural importance, resilience, indigenous populations, arrows, sanctuary condition reports, outreach, top-down effect, anchovies, advisory council, oil and gas, sanctuaries, multi-use management, gas limitations, wind farms, biogeographic break, noaa, endangered species, place-based management., educational opportunities, research and science, management approaches, decision making., human use, commercial species, navy, ecosystem-based management, carbon sequestration, connections", "concept_list": ["no take areas", "species range", "relationships.", "policymakers", "ecosystem", "species richness", "conservation concern.", "storms", "edna research", "channel islands sanctuary", "transmission cable", "shipping vessels", "diversity components", "regulation change", "keystone species", "stakeholders", "cultural species", "hypoxia", "species lists", "habitat use", "evenness", "increased temperatures", "noise pollution", "national sanctuary", "management actions", "kelp", "medium impact", "species evenness", "temperature", "military.", "channel sanctuary", "increased storm frequency", "plankton", "herrings", "upwelling", "stressors", "sanctuary advisory council", "increased temperature", "protected areas", "ecosystem services", "university of houston", "climate", "biodiversity", "system components", "species of conservation", "diversity components.", "stressor", "stakeholder engagement", "advisory council.", "edna", "science", "channel islands national", "biodiversity indices.", "biodiversity metrics", "resource managers", "ship strikes", "concept mapping", "military", "educators", "species diversity", "tribal", "cultural engagement", "floor mapping", "public engagement", "keystone species.", "cultural interest", "species of commercial", "mpas", "microplastics", "biodiversity indices", "hotspots", "services", "software", "threatened species", "decision making", "biodiversity hotspots", "high impact.", "harmful organisms", "negative impact", "place-based management", "shipping industry", "habitat forming species", "diversity indices.", "education", "semi quantitative", "species distribution", "bottom-up effect", "area-based management", "oa", "shannon diversity indices", "wind farm", "research management", "cold spots", "research", "kelp forests", "mental modeling", "commercial interest", "biogeography", "positive impact", "stakeholders.", "resource management", "low impact", "resistance", "biodiversity services", "species of cultural", "relationships", "renewable energy", "management", "community user groups", "spatial temporal patterns", "shipping lanes", "research opportunities", "indigenous population", "conservation concern", "diving", "critical organisms", "high impact", "storm frequency", "science and education", "biodiversity coldspots", "climate change", "invasive species", "foundation species", "area-based tools", "observation network", "no-take zone", "cultural importance", "resilience", "indigenous populations", "arrows", "sanctuary condition reports", "outreach", "top-down effect", "anchovies", "advisory council", "oil and gas", "sanctuaries", "multi-use management", "gas limitations", "wind farms", "biogeographic break", "noaa", "endangered species", "place-based management.", "educational opportunities", "research and science", "management approaches", "decision making.", "human use", "commercial species", "navy", "ecosystem-based management", "carbon sequestration", "connections"], "type": "cluster", "label": "Fishing Industry"}, "Marine Ecosystems": {"concepts": "fishery, fishing gear, derelict fish gear, marine fishery service, commercial fishing, fishing industry, recreational fishing, derelict fishing gear, baitfish", "concept_list": ["fishery", "fishing gear", "derelict fish gear", "marine fishery service", "commercial fishing", "fishing industry", "recreational fishing", "derelict fishing gear", "baitfish"], "type": "cluster", "label": "Marine Ecosystems"}, "Recreational Activities": {"concepts": "deep ocean, sponges, invertebrates, marine resource management, benthic disturbance., nutrient water, marine biodiversity observation, benthic habitats, sanctuary waters, marine biodiversity, oceanographic habitats, whale cetaceans, ocean acidification, benthic disturbance, deep sea corals, no-take marine protected, marine science, mexican waters, bureau of ocean, whale watching, cetaceans, shallow water, marine protected area, oysters, coral reefs, marine sanctuary program, marine sanctuary, marine debris, seagrass communities, sea stars, harmful algal bloom", "concept_list": ["deep ocean", "sponges", "invertebrates", "marine resource management", "benthic disturbance.", "nutrient water", "marine biodiversity observation", "benthic habitats", "sanctuary waters", "marine biodiversity", "oceanographic habitats", "whale cetaceans", "ocean acidification", "benthic disturbance", "deep sea corals", "no-take marine protected", "marine science", "mexican waters", "bureau of ocean", "whale watching", "cetaceans", "shallow water", "marine protected area", "oysters", "coral reefs", "marine sanctuary program", "marine sanctuary", "marine debris", "seagrass communities", "sea stars", "harmful algal bloom"], "type": "cluster", "label": "Recreational Activities"}, "Food Web Dynamics": {"concepts": "water recreation, species of recreational, recreational use, recreational boating, recreational interest, recreational opportunities, recreational species", "concept_list": ["water recreation", "species of recreational", "recreational use", "recreational boating", "recreational interest", "recreational opportunities", "recreational species"], "type": "cluster", "label": "Food Web Dynamics"}};
        const conceptData = {};
        const interClusterEdges = [["Biodiversity Management", "Marine Ecosystems", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster"}], ["Biodiversity Management", "Fishing Industry", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster"}], ["Biodiversity Management", "Food Web Dynamics", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster"}], ["Biodiversity Management", "Recreational Activities", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster"}], ["Fishing Industry", "Marine Ecosystems", {"weight": -1.0, "confidence": 0.775, "type": "inter_cluster"}], ["Fishing Industry", "Biodiversity Management", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster"}], ["Fishing Industry", "Food Web Dynamics", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster"}], ["Fishing Industry", "Recreational Activities", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster"}], ["Marine Ecosystems", "Biodiversity Management", {"weight": -1.0, "confidence": 0.74, "type": "inter_cluster"}], ["Marine Ecosystems", "Fishing Industry", {"weight": -1.0, "confidence": 0.7375, "type": "inter_cluster"}], ["Marine Ecosystems", "Food Web Dynamics", {"weight": -1.0, "confidence": 0.6875, "type": "inter_cluster"}], ["Marine Ecosystems", "Recreational Activities", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster"}], ["Recreational Activities", "Biodiversity Management", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster"}], ["Recreational Activities", "Food Web Dynamics", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster"}], ["Recreational Activities", "Fishing Industry", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster"}], ["Food Web Dynamics", "Biodiversity Management", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster"}], ["Food Web Dynamics", "Marine Ecosystems", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster"}], ["Food Web Dynamics", "Fishing Industry", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster"}], ["Food Web Dynamics", "Recreational Activities", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster"}]];
        const clusterConcepts = {};
        const clusterEdges = {};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
