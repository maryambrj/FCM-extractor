
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"commercial fishers": {"concepts": "commercial fishers", "concept_list": ["commercial fishers"], "type": "cluster", "node_size": 18, "label": "commercial fishers"}, "Forage Fish Dynamics": {"concepts": "oyster rebuilding, spawning opportunity, shellfish beds, habitat restoration, habitat forming species, stable ecosystem, habitat management, stock restoration, oyster reefs, artificial reef, estuary health", "concept_list": ["oyster rebuilding", "spawning opportunity", "shellfish beds", "habitat restoration", "habitat forming species", "stable ecosystem", "habitat management", "stock restoration", "oyster reefs", "artificial reef", "estuary health"], "type": "cluster", "node_size": 48, "label": "Forage Fish Dynamics"}, "Invasive Species Impacts": {"concepts": "harvest doubled, key food species, forage base, anchovies, keystone species, anchovy harvesting, food web, food source, menhaden, forage species, forage species management, blue crabs, striped bass", "concept_list": ["harvest doubled", "key food species", "forage base", "anchovies", "keystone species", "anchovy harvesting", "food web", "food source", "menhaden", "forage species", "forage species management", "blue crabs", "striped bass"], "type": "cluster", "node_size": 54, "label": "Invasive Species Impacts"}, "Ecosystem Management Strategies": {"concepts": "eradication, ecological changes, ecosystem harm, endangered species, observer program, introduced species, total removal, overfishing, invasive species, shifting species, exotic species, blue catfish, blue cats, ecological impact, population control, harmful species, species shifts, harmful organisms, winners losers", "concept_list": ["eradication", "ecological changes", "ecosystem harm", "endangered species", "observer program", "introduced species", "total removal", "overfishing", "invasive species", "shifting species", "exotic species", "blue catfish", "blue cats", "ecological impact", "population control", "harmful species", "species shifts", "harmful organisms", "winners losers"], "type": "cluster", "node_size": 72, "label": "Ecosystem Management Strategies"}, "Fisheries Management": {"concepts": "atlantic states marine fisheries commission, new fisheries, fishery surveys", "concept_list": ["atlantic states marine fisheries commission", "new fisheries", "fishery surveys"], "type": "cluster", "node_size": 24, "label": "Fisheries Management"}, "Oyster Reef Restoration": {"concepts": "fisheries management, commercial fishery, fisheries habitat, viable fishery", "concept_list": ["fisheries management", "commercial fishery", "fisheries habitat", "viable fishery"], "type": "cluster", "node_size": 27, "label": "Oyster Reef Restoration"}, "Recreational Fishing": {"concepts": "marine recreational information program, recreational issue, recreational harvest, recreational fishery, recreational fishers, recreational", "concept_list": ["marine recreational information program", "recreational issue", "recreational harvest", "recreational fishery", "recreational fishers", "recreational"], "type": "cluster", "node_size": 33, "label": "Recreational Fishing"}};
        const conceptData = {"oyster rebuilding": {"concepts": "oyster rebuilding", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "oyster rebuilding"}, "spawning opportunity": {"concepts": "spawning opportunity", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "spawning opportunity"}, "shellfish beds": {"concepts": "shellfish beds", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "shellfish beds"}, "habitat restoration": {"concepts": "habitat restoration", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat restoration"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat forming species"}, "stable ecosystem": {"concepts": "stable ecosystem", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "stable ecosystem"}, "habitat management": {"concepts": "habitat management", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat management"}, "stock restoration": {"concepts": "stock restoration", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "stock restoration"}, "oyster reefs": {"concepts": "oyster reefs", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "oyster reefs"}, "artificial reef": {"concepts": "artificial reef", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "artificial reef"}, "estuary health": {"concepts": "estuary health", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "estuary health"}, "harvest doubled": {"concepts": "harvest doubled", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "harvest doubled"}, "key food species": {"concepts": "key food species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "key food species"}, "forage base": {"concepts": "forage base", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage base"}, "anchovies": {"concepts": "anchovies", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "anchovies"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "keystone species"}, "anchovy harvesting": {"concepts": "anchovy harvesting", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "anchovy harvesting"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "food web"}, "food source": {"concepts": "food source", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "food source"}, "menhaden": {"concepts": "menhaden", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "menhaden"}, "forage species": {"concepts": "forage species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage species"}, "forage species management": {"concepts": "forage species management", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage species management"}, "blue crabs": {"concepts": "blue crabs", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "blue crabs"}, "striped bass": {"concepts": "striped bass", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "striped bass"}, "eradication": {"concepts": "eradication", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "eradication"}, "ecological changes": {"concepts": "ecological changes", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecological changes"}, "ecosystem harm": {"concepts": "ecosystem harm", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecosystem harm"}, "endangered species": {"concepts": "endangered species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "endangered species"}, "observer program": {"concepts": "observer program", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "observer program"}, "introduced species": {"concepts": "introduced species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "introduced species"}, "total removal": {"concepts": "total removal", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "total removal"}, "overfishing": {"concepts": "overfishing", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "overfishing"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "invasive species"}, "shifting species": {"concepts": "shifting species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "shifting species"}, "exotic species": {"concepts": "exotic species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "exotic species"}, "blue catfish": {"concepts": "blue catfish", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "blue catfish"}, "blue cats": {"concepts": "blue cats", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "blue cats"}, "ecological impact": {"concepts": "ecological impact", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecological impact"}, "population control": {"concepts": "population control", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "population control"}, "harmful species": {"concepts": "harmful species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "harmful species"}, "species shifts": {"concepts": "species shifts", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "species shifts"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "harmful organisms"}, "winners losers": {"concepts": "winners losers", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "winners losers"}, "atlantic states marine fisheries commission": {"concepts": "atlantic states marine fisheries commission", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "atlantic states marine fisheries commission"}, "new fisheries": {"concepts": "new fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "new fisheries"}, "fishery surveys": {"concepts": "fishery surveys", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fishery surveys"}, "fisheries management": {"concepts": "fisheries management", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "fisheries management"}, "commercial fishery": {"concepts": "commercial fishery", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "commercial fishery"}, "fisheries habitat": {"concepts": "fisheries habitat", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "fisheries habitat"}, "viable fishery": {"concepts": "viable fishery", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "viable fishery"}, "marine recreational information program": {"concepts": "marine recreational information program", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "marine recreational information program"}, "recreational issue": {"concepts": "recreational issue", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational issue"}, "recreational harvest": {"concepts": "recreational harvest", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational harvest"}, "recreational fishery": {"concepts": "recreational fishery", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational fishery"}, "recreational fishers": {"concepts": "recreational fishers", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational fishers"}, "recreational": {"concepts": "recreational", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational"}};
        const interClusterEdges = [["commercial fishers", "Oyster Reef Restoration", {"weight": 1.0, "confidence": 0.62, "type": "inter_cluster", "style": "solid"}], ["commercial fishers", "Invasive Species Impacts", {"weight": -0.2, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}], ["commercial fishers", "Ecosystem Management Strategies", {"weight": 0.75, "confidence": 0.2375, "type": "inter_cluster", "style": "solid"}], ["commercial fishers", "Fisheries Management", {"weight": 0.5, "confidence": 0.21250000000000002, "type": "inter_cluster", "style": "solid"}], ["Forage Fish Dynamics", "Oyster Reef Restoration", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Forage Fish Dynamics", "Recreational Fishing", {"weight": 1.0, "confidence": 0.32, "type": "inter_cluster", "style": "solid"}], ["Forage Fish Dynamics", "commercial fishers", {"weight": 1.0, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Forage Fish Dynamics", "Fisheries Management", {"weight": 0.75, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Forage Fish Dynamics", "Invasive Species Impacts", {"weight": 1.0, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "Recreational Fishing", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "Oyster Reef Restoration", {"weight": 0.6, "confidence": 0.39, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "Fisheries Management", {"weight": 1.0, "confidence": 0.37, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "Ecosystem Management Strategies", {"weight": 1.0, "confidence": 0.38, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "commercial fishers", {"weight": 0.6, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Invasive Species Impacts", "Forage Fish Dynamics", {"weight": -0.4, "confidence": 0.24, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Management Strategies", "Forage Fish Dynamics", {"weight": -1.0, "confidence": 0.48999999999999994, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Management Strategies", "Invasive Species Impacts", {"weight": -0.8, "confidence": 0.38, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Management Strategies", "Oyster Reef Restoration", {"weight": -0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Management Strategies", "Fisheries Management", {"weight": 1.0, "confidence": 0.36249999999999993, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Oyster Reef Restoration", {"weight": 1.0, "confidence": 0.6749999999999999, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "commercial fishers", {"weight": 0.6, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Ecosystem Management Strategies", {"weight": 0.75, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Recreational Fishing", {"weight": 0.5, "confidence": 0.16249999999999998, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Invasive Species Impacts", {"weight": 0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Oyster Reef Restoration", "commercial fishers", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Oyster Reef Restoration", "Fisheries Management", {"weight": 1.0, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Oyster Reef Restoration", "Ecosystem Management Strategies", {"weight": 0.6, "confidence": 0.33999999999999997, "type": "inter_cluster", "style": "solid"}], ["Oyster Reef Restoration", "Recreational Fishing", {"weight": 0.8, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Recreational Fishing", "Invasive Species Impacts", {"weight": 0.2, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["Recreational Fishing", "Fisheries Management", {"weight": 1.0, "confidence": 0.42000000000000004, "type": "inter_cluster", "style": "solid"}], ["Recreational Fishing", "Oyster Reef Restoration", {"weight": 0.6, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Forage Fish Dynamics": [["oyster rebuilding", {"concepts": "oyster rebuilding", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "oyster rebuilding"}], ["spawning opportunity", {"concepts": "spawning opportunity", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "spawning opportunity"}], ["shellfish beds", {"concepts": "shellfish beds", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "shellfish beds"}], ["habitat restoration", {"concepts": "habitat restoration", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat restoration"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat forming species"}], ["stable ecosystem", {"concepts": "stable ecosystem", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "stable ecosystem"}], ["habitat management", {"concepts": "habitat management", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "habitat management"}], ["stock restoration", {"concepts": "stock restoration", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "stock restoration"}], ["oyster reefs", {"concepts": "oyster reefs", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "oyster reefs"}], ["artificial reef", {"concepts": "artificial reef", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "artificial reef"}], ["estuary health", {"concepts": "estuary health", "type": "concept", "cluster": "Forage Fish Dynamics", "node_size": 10, "label": "estuary health"}]], "Invasive Species Impacts": [["harvest doubled", {"concepts": "harvest doubled", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "harvest doubled"}], ["key food species", {"concepts": "key food species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "key food species"}], ["forage base", {"concepts": "forage base", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage base"}], ["anchovies", {"concepts": "anchovies", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "anchovies"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "keystone species"}], ["anchovy harvesting", {"concepts": "anchovy harvesting", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "anchovy harvesting"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "food web"}], ["food source", {"concepts": "food source", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "food source"}], ["menhaden", {"concepts": "menhaden", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "menhaden"}], ["forage species", {"concepts": "forage species", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage species"}], ["forage species management", {"concepts": "forage species management", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "forage species management"}], ["blue crabs", {"concepts": "blue crabs", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "blue crabs"}], ["striped bass", {"concepts": "striped bass", "type": "concept", "cluster": "Invasive Species Impacts", "node_size": 10, "label": "striped bass"}]], "Ecosystem Management Strategies": [["eradication", {"concepts": "eradication", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "eradication"}], ["ecological changes", {"concepts": "ecological changes", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecological changes"}], ["ecosystem harm", {"concepts": "ecosystem harm", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecosystem harm"}], ["endangered species", {"concepts": "endangered species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "endangered species"}], ["observer program", {"concepts": "observer program", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "observer program"}], ["introduced species", {"concepts": "introduced species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "introduced species"}], ["total removal", {"concepts": "total removal", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "total removal"}], ["overfishing", {"concepts": "overfishing", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "overfishing"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "invasive species"}], ["shifting species", {"concepts": "shifting species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "shifting species"}], ["exotic species", {"concepts": "exotic species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "exotic species"}], ["blue catfish", {"concepts": "blue catfish", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "blue catfish"}], ["blue cats", {"concepts": "blue cats", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "blue cats"}], ["ecological impact", {"concepts": "ecological impact", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "ecological impact"}], ["population control", {"concepts": "population control", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "population control"}], ["harmful species", {"concepts": "harmful species", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "harmful species"}], ["species shifts", {"concepts": "species shifts", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "species shifts"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "harmful organisms"}], ["winners losers", {"concepts": "winners losers", "type": "concept", "cluster": "Ecosystem Management Strategies", "node_size": 10, "label": "winners losers"}]], "Fisheries Management": [["atlantic states marine fisheries commission", {"concepts": "atlantic states marine fisheries commission", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "atlantic states marine fisheries commission"}], ["new fisheries", {"concepts": "new fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "new fisheries"}], ["fishery surveys", {"concepts": "fishery surveys", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fishery surveys"}]], "Oyster Reef Restoration": [["fisheries management", {"concepts": "fisheries management", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "fisheries management"}], ["commercial fishery", {"concepts": "commercial fishery", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "commercial fishery"}], ["fisheries habitat", {"concepts": "fisheries habitat", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "fisheries habitat"}], ["viable fishery", {"concepts": "viable fishery", "type": "concept", "cluster": "Oyster Reef Restoration", "node_size": 10, "label": "viable fishery"}]], "Recreational Fishing": [["marine recreational information program", {"concepts": "marine recreational information program", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "marine recreational information program"}], ["recreational issue", {"concepts": "recreational issue", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational issue"}], ["recreational harvest", {"concepts": "recreational harvest", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational harvest"}], ["recreational fishery", {"concepts": "recreational fishery", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational fishery"}], ["recreational fishers", {"concepts": "recreational fishers", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational fishers"}], ["recreational", {"concepts": "recreational", "type": "concept", "cluster": "Recreational Fishing", "node_size": 10, "label": "recreational"}]]};
        const clusterEdges = {"Forage Fish Dynamics": [], "Invasive Species Impacts": [], "Ecosystem Management Strategies": [], "Fisheries Management": [], "Oyster Reef Restoration": [], "Recreational Fishing": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
