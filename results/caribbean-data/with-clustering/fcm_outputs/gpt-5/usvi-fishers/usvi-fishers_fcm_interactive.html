
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Area Closures": {"concepts": "accountability, responsibility", "concept_list": ["accountability", "responsibility"], "type": "cluster", "node_size": 21, "label": "Area Closures"}, "Governance & Economy": {"concepts": "safe zones, snapper closed area, high end closed area, nautic zones, area closures, safety zone, closed areas, closures, boat registration, boat traffic, safe zone", "concept_list": ["safe zones", "snapper closed area", "high end closed area", "nautic zones", "area closures", "safety zone", "closed areas", "closures", "boat registration", "boat traffic", "safe zone"], "type": "cluster", "node_size": 48, "label": "Governance & Economy"}, "Environmental Impacts": {"concepts": "decision-making, researchers, customer loss, external threats, awareness, new recruits, frustration, economic vulnerability, customers, customer relations, local consumption, post-hurricane impact, authority, overfishing, customer disputes, governance, institutional responsibility, technical language, commercial licenses, occupation, misunderstanding, licenses, occupational identity, scientific terminology, markets, resilience, knowledge gap, workforce reduction, government, senators, commercial catch reports, lobster holes, surgeonfish, fish scalers, dependency, written letters, regulatory system, collaboration, license system, commercial catch, cultural background, client relations, scientific language, market dynamics, experience", "concept_list": ["decision-making", "researchers", "customer loss", "external threats", "awareness", "new recruits", "frustration", "economic vulnerability", "customers", "customer relations", "local consumption", "post-hurricane impact", "authority", "overfishing", "customer disputes", "governance", "institutional responsibility", "technical language", "commercial licenses", "occupation", "misunderstanding", "licenses", "occupational identity", "scientific terminology", "markets", "resilience", "knowledge gap", "workforce reduction", "government", "senators", "commercial catch reports", "lobster holes", "surgeonfish", "fish scalers", "dependency", "written letters", "regulatory system", "collaboration", "license system", "commercial catch", "cultural background", "client relations", "scientific language", "market dynamics", "experience"], "type": "cluster", "node_size": 150, "label": "Environmental Impacts"}, "Community Dynamics": {"concepts": "surgeon fish, soil erosion, seafood, sediment control, fish pots, poaching, soil sediment", "concept_list": ["surgeon fish", "soil erosion", "seafood", "sediment control", "fish pots", "poaching", "soil sediment"], "type": "cluster", "node_size": 36, "label": "Community Dynamics"}, "Accountability": {"concepts": "social gatherings, violence, group norms, labor shifts, social cohesion, participation levels, town hall meeting, authority structures, relationships, community, management processes, outreach, ignorance, social impact, income stability, community events, local meetings, trust building, income dependence, resource protection, intergroup relations, resource management, trust, organizational roles, drug users, meetings, community dependence, social dynamics, peer relationships, social relationships, betrayal, resource use, collective identity, organizational processes, social changes, community impact, role structures, interpersonal conflict, social interaction, social relations, community relations, management process, organizational trust, community identity, resource abuse, community support", "concept_list": ["social gatherings", "violence", "group norms", "labor shifts", "social cohesion", "participation levels", "town hall meeting", "authority structures", "relationships", "community", "management processes", "outreach", "ignorance", "social impact", "income stability", "community events", "local meetings", "trust building", "income dependence", "resource protection", "intergroup relations", "resource management", "trust", "organizational roles", "drug users", "meetings", "community dependence", "social dynamics", "peer relationships", "social relationships", "betrayal", "resource use", "collective identity", "organizational processes", "social changes", "community impact", "role structures", "interpersonal conflict", "social interaction", "social relations", "community relations", "management process", "organizational trust", "community identity", "resource abuse", "community support"], "type": "cluster", "node_size": 153, "label": "Accountability"}, "Conch Conservation": {"concepts": "baby conchs, greed, governor, rescue norms, hard work, conch season, saint thomas, radio, resolution, fairness, nature conservancy, leadership, overregulation, spawning, central island, new generations, senator, virgin islands, fac, dolphin migration, fishing, scalers, birthdays, ball games, quick dollar, local autonomy, billboard, cookout, agenda, international waters, conservation, spawning closures, director, adaptation, west end, beaches, adaptive strategies, ngo pressure, east end, sargassum, queen conch, diving, construction, usvi, health, reproduction, st. croix, divers, expression, competition, st. thomas, adaptation strategies, future generations, education, power dynamics, economic survival, longliners", "concept_list": ["baby conchs", "greed", "governor", "rescue norms", "hard work", "conch season", "saint thomas", "radio", "resolution", "fairness", "nature conservancy", "leadership", "overregulation", "spawning", "central island", "new generations", "senator", "virgin islands", "fac", "dolphin migration", "fishing", "scalers", "birthdays", "ball games", "quick dollar", "local autonomy", "billboard", "cookout", "agenda", "international waters", "conservation", "spawning closures", "director", "adaptation", "west end", "beaches", "adaptive strategies", "ngo pressure", "east end", "sargassum", "queen conch", "diving", "construction", "usvi", "health", "reproduction", "st. croix", "divers", "expression", "competition", "st. thomas", "adaptation strategies", "future generations", "education", "power dynamics", "economic survival", "longliners"], "type": "cluster", "node_size": 186, "label": "Conch Conservation"}, "Regulatory Compliance": {"concepts": "mandates, regulatory misinterpretation, mandate, regulatory compliance, safety concerns, regulation compliance, government regulations, regulations, compliance", "concept_list": ["mandates", "regulatory misinterpretation", "mandate", "regulatory compliance", "safety concerns", "regulation compliance", "government regulations", "regulations", "compliance"], "type": "cluster", "node_size": 42, "label": "Regulatory Compliance"}, "Cultural Livelihoods": {"concepts": "livelihood dependence, livelihood, cultural diversity, traditional practices, livelihoods, cultural practices", "concept_list": ["livelihood dependence", "livelihood", "cultural diversity", "traditional practices", "livelihoods", "cultural practices"], "type": "cluster", "node_size": 33, "label": "Cultural Livelihoods"}, "Environmental Change": {"concepts": "agriculture, hurricanes, sustainable practices, seasonal changes, natural disasters, population decline, global warming, hurricane impact, environmental change, species decline, climate change, pollution, sustainability, ecosystem impact, ecological damage, environmental changes, seasonal closures", "concept_list": ["agriculture", "hurricanes", "sustainable practices", "seasonal changes", "natural disasters", "population decline", "global warming", "hurricane impact", "environmental change", "species decline", "climate change", "pollution", "sustainability", "ecosystem impact", "ecological damage", "environmental changes", "seasonal closures"], "type": "cluster", "node_size": 66, "label": "Environmental Change"}, "Fisheries Management": {"concepts": "fishermen knowledge, registered fishermen, fisheries advisory committee, fisherman, fisheries chair, fish sales, fisher involvement, fishery managers relationship, fisheries, fisher relationships, fisher knowledge, caribbean fishery management council, fishery management, fishery advisory committee, fishermen, fishers, fisherman groups, fishery managers, usvi fisheries, fish sellers", "concept_list": ["fishermen knowledge", "registered fishermen", "fisheries advisory committee", "fisherman", "fisheries chair", "fish sales", "fisher involvement", "fishery managers relationship", "fisheries", "fisher relationships", "fisher knowledge", "caribbean fishery management council", "fishery management", "fishery advisory committee", "fishermen", "fishers", "fisherman groups", "fishery managers", "usvi fisheries", "fish sellers"], "type": "cluster", "node_size": 75, "label": "Fisheries Management"}, "Policy & Enforcement": {"concepts": "lawmakers, enforcement, policy implementation., policy enforcement, rule enforcement, lawmaking, policy implementation, lawmaking process", "concept_list": ["lawmakers", "enforcement", "policy implementation.", "policy enforcement", "rule enforcement", "lawmaking", "policy implementation", "lawmaking process"], "type": "cluster", "node_size": 39, "label": "Policy & Enforcement"}, "**Maritime Conflict Resolution**": {"concepts": "misinterpretation, conflicts, conflict, vessel conflicts, external vessels, dispute resolution, conflict resolution, disagreement, cargo vessels", "concept_list": ["misinterpretation", "conflicts", "conflict", "vessel conflicts", "external vessels", "dispute resolution", "conflict resolution", "disagreement", "cargo vessels"], "type": "cluster", "node_size": 42, "label": "**Maritime Conflict Resolution**"}, "**Government & Local Economy**": {"concepts": "federal-local relations, local government, federal government, government support, local markets, local economy", "concept_list": ["federal-local relations", "local government", "federal government", "government support", "local markets", "local economy"], "type": "cluster", "node_size": 33, "label": "**Government & Local Economy**"}, "**Marine Conservation**": {"concepts": "marine environment, marine conservation, algae, fish migration, marine closures, fish and wildlife, atlantic ocean, shoreline, algae cleaning, puffer fish, sea grass, east end marine park, white sea urchin, ocean currents, marine resources, coastal communities, marine ecosystems, shoreline protection, seagrass", "concept_list": ["marine environment", "marine conservation", "algae", "fish migration", "marine closures", "fish and wildlife", "atlantic ocean", "shoreline", "algae cleaning", "puffer fish", "sea grass", "east end marine park", "white sea urchin", "ocean currents", "marine resources", "coastal communities", "marine ecosystems", "shoreline protection", "seagrass"], "type": "cluster", "node_size": 72, "label": "**Marine Conservation**"}, "**Collaborative Communication**": {"concepts": "cooperation, information access, information exchange, mutual aid, patience, information sharing, communication", "concept_list": ["cooperation", "information access", "information exchange", "mutual aid", "patience", "information sharing", "communication"], "type": "cluster", "node_size": 36, "label": "**Collaborative Communication**"}, "**Fishing Management**": {"concepts": "fishing groups, fishing license, fishing regulations, fishing abilities, safe fishing zones, fishing occupation, fishing closures, subsistence fishing, fishing zones, deep water fishing, fishing practices, fishing future, fishing community, fishing areas, commercial fishing, fishing gear", "concept_list": ["fishing groups", "fishing license", "fishing regulations", "fishing abilities", "safe fishing zones", "fishing occupation", "fishing closures", "subsistence fishing", "fishing zones", "deep water fishing", "fishing practices", "fishing future", "fishing community", "fishing areas", "commercial fishing", "fishing gear"], "type": "cluster", "node_size": 63, "label": "**Fishing Management**"}, "**Food & Nutrition**": {"concepts": "food choice, healthy food, restaurants, processed food, food preference, food security, food sales", "concept_list": ["food choice", "healthy food", "restaurants", "processed food", "food preference", "food security", "food sales"], "type": "cluster", "node_size": 36, "label": "**Food & Nutrition**"}, "Coral Reef Recovery": {"concepts": "reef cleaning, staghorn coral, coral recovery, reefs, coral reefs, elkhorn coral, coral health, coral reef, reef bottom", "concept_list": ["reef cleaning", "staghorn coral", "coral recovery", "reefs", "coral reefs", "elkhorn coral", "coral health", "coral reef", "reef bottom"], "type": "cluster", "node_size": 42, "label": "Coral Reef Recovery"}, "Fisheries Governance": {"concepts": "commissioner, district advisory panels, lobster, decision making, agenda setting, decision makers, committee decisions, advocacy", "concept_list": ["commissioner", "district advisory panels", "lobster", "decision making", "agenda setting", "decision makers", "committee decisions", "advocacy"], "type": "cluster", "node_size": 39, "label": "Fisheries Governance"}, "Stakeholder Management": {"concepts": "stakeholder input, stakeholder group, stakeholder conflicts, stakeholder involvement, resource stakeholders, stakeholders, stakeholder engagement", "concept_list": ["stakeholder input", "stakeholder group", "stakeholder conflicts", "stakeholder involvement", "resource stakeholders", "stakeholders", "stakeholder engagement"], "type": "cluster", "node_size": 36, "label": "Stakeholder Management"}};
        const conceptData = {};
        const interClusterEdges = [["Area Closures", "**Fishing Management**", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Area Closures", "**Marine Conservation**", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Area Closures", "**Government & Local Economy**", {"weight": 1.0, "confidence": 0.6533333333333333, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "Policy & Enforcement", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "**Fishing Management**", {"weight": -0.3333333333333333, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "Community Dynamics", {"weight": -0.3333333333333333, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "**Government & Local Economy**", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "Accountability", {"weight": -1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Governance & Economy", "Fisheries Management", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "Accountability", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "Governance & Economy", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "**Government & Local Economy**", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "Community Dynamics", {"weight": 1.0, "confidence": 0.6266666666666667, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "**Fishing Management**", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Dynamics", "Policy & Enforcement", {"weight": 1.0, "confidence": 0.6566666666666666, "type": "inter_cluster", "style": "solid"}], ["Community Dynamics", "Regulatory Compliance", {"weight": 1.0, "confidence": 0.6566666666666667, "type": "inter_cluster", "style": "solid"}], ["Accountability", "**Marine Conservation**", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Accountability", "Fisheries Governance", {"weight": 1.0, "confidence": 0.645, "type": "inter_cluster", "style": "solid"}], ["Accountability", "**Fishing Management**", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Conch Conservation", "Governance & Economy", {"weight": 1.0, "confidence": 0.7475, "type": "inter_cluster", "style": "solid"}], ["Conch Conservation", "Policy & Enforcement", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Conch Conservation", "**Maritime Conflict Resolution**", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Conch Conservation", "Area Closures", {"weight": 1.0, "confidence": 0.6566666666666666, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "Stakeholder Management", {"weight": 1.0, "confidence": 0.734, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "Environmental Impacts", {"weight": 1.0, "confidence": 0.7399999999999999, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "**Collaborative Communication**", {"weight": 1.0, "confidence": 0.6166666666666666, "type": "inter_cluster", "style": "solid"}], ["Regulatory Compliance", "Accountability", {"weight": -0.75, "confidence": 0.46249999999999997, "type": "inter_cluster", "style": "solid"}], ["Cultural Livelihoods", "Coral Reef Recovery", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Environmental Change", "Governance & Economy", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Environmental Change", "Coral Reef Recovery", {"weight": -1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Environmental Impacts", {"weight": 1.0, "confidence": 0.844, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Fisheries Governance", {"weight": 1.0, "confidence": 0.8624999999999999, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "**Food & Nutrition**", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Coral Reef Recovery", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Policy & Enforcement", "**Fishing Management**", {"weight": 1.0, "confidence": 0.8933333333333334, "type": "inter_cluster", "style": "solid"}], ["**Maritime Conflict Resolution**", "Stakeholder Management", {"weight": -0.5, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["**Marine Conservation**", "Governance & Economy", {"weight": 0.8, "confidence": 0.616, "type": "inter_cluster", "style": "solid"}], ["**Collaborative Communication**", "Cultural Livelihoods", {"weight": 1.0, "confidence": 0.756, "type": "inter_cluster", "style": "solid"}], ["**Collaborative Communication**", "Accountability", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["**Collaborative Communication**", "Coral Reef Recovery", {"weight": 1.0, "confidence": 0.68, "type": "inter_cluster", "style": "solid"}], ["**Fishing Management**", "Conch Conservation", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["**Fishing Management**", "Cultural Livelihoods", {"weight": 1.0, "confidence": 0.915, "type": "inter_cluster", "style": "solid"}], ["**Fishing Management**", "Policy & Enforcement", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["**Food & Nutrition**", "Stakeholder Management", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["**Food & Nutrition**", "**Fishing Management**", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["**Food & Nutrition**", "Coral Reef Recovery", {"weight": 0.3333333333333333, "confidence": 0.5666666666666667, "type": "inter_cluster", "style": "solid"}], ["**Food & Nutrition**", "**Maritime Conflict Resolution**", {"weight": -0.3333333333333333, "confidence": 0.17333333333333334, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Recovery", "Policy & Enforcement", {"weight": 1.0, "confidence": 0.744, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Recovery", "Environmental Impacts", {"weight": 1.0, "confidence": 0.6950000000000001, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Recovery", "Conch Conservation", {"weight": 1.0, "confidence": 0.7175, "type": "inter_cluster", "style": "solid"}], ["Fisheries Governance", "Conch Conservation", {"weight": 1.0, "confidence": 0.805, "type": "inter_cluster", "style": "solid"}], ["Fisheries Governance", "Coral Reef Recovery", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Stakeholder Management", "Fisheries Governance", {"weight": 1.0, "confidence": 0.8925000000000001, "type": "inter_cluster", "style": "solid"}], ["Stakeholder Management", "Community Dynamics", {"weight": 0.3333333333333333, "confidence": 0.6166666666666666, "type": "inter_cluster", "style": "solid"}], ["Stakeholder Management", "Accountability", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Area Closures": [], "Governance & Economy": [], "Environmental Impacts": [], "Community Dynamics": [], "Accountability": [], "Conch Conservation": [], "Regulatory Compliance": [], "Cultural Livelihoods": [], "Environmental Change": [], "Fisheries Management": [], "Policy & Enforcement": [], "**Maritime Conflict Resolution**": [], "**Government & Local Economy**": [], "**Marine Conservation**": [], "**Collaborative Communication**": [], "**Fishing Management**": [], "**Food & Nutrition**": [], "Coral Reef Recovery": [], "Fisheries Governance": [], "Stakeholder Management": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
