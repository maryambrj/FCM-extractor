
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"federal-state partnership": {"concepts": "federal-state partnership", "concept_list": ["federal-state partnership"], "type": "cluster", "node_size": 18, "label": "federal-state partnership"}, "stewardship fund": {"concepts": "stewardship fund", "concept_list": ["stewardship fund"], "type": "cluster", "node_size": 18, "label": "stewardship fund"}, "Estuary Water Quality": {"concepts": "estuary, water quality", "concept_list": ["estuary", "water quality"], "type": "cluster", "node_size": 21, "label": "Estuary Water Quality"}, "Fisheries Management": {"concepts": "fisheries, aquaculture, fisheries management", "concept_list": ["fisheries", "aquaculture", "fisheries management"], "type": "cluster", "node_size": 24, "label": "Fisheries Management"}, "Oyster & Marine Restoration": {"concepts": "oyster restoration, sediment dynamics, marine resources", "concept_list": ["oyster restoration", "sediment dynamics", "marine resources"], "type": "cluster", "node_size": 24, "label": "Oyster & Marine Restoration"}, "Conservation Goals": {"concepts": "conservation, ecological goals, conservation goals", "concept_list": ["conservation", "ecological goals", "conservation goals"], "type": "cluster", "node_size": 24, "label": "Conservation Goals"}, "Ecosystem Health": {"concepts": "ecological conditions, system dynamics, biodiversity, keystone species", "concept_list": ["ecological conditions", "system dynamics", "biodiversity", "keystone species"], "type": "cluster", "node_size": 27, "label": "Ecosystem Health"}, "Resource Impacts": {"concepts": "recreational users, resource users, stakeholders, economic impacts", "concept_list": ["recreational users", "resource users", "stakeholders", "economic impacts"], "type": "cluster", "node_size": 27, "label": "Resource Impacts"}, "Bay Restoration": {"concepts": "management approaches, restoration priorities, communities, habitat, nfwf, chesapeake bay program, environmental agencies, ecosystem services, epa, mental model, ecosystem management, chesapeake bay, habitat forming species, habitat loss, consensus, resource management, restoration", "concept_list": ["management approaches", "restoration priorities", "communities", "habitat", "nfwf", "chesapeake bay program", "environmental agencies", "ecosystem services", "epa", "mental model", "ecosystem management", "chesapeake bay", "habitat forming species", "habitat loss", "consensus", "resource management", "restoration"], "type": "cluster", "node_size": 66, "label": "Bay Restoration"}, "Ecosystem Restoration": {"concepts": "case studies, species diversity, restoration goals, stakeholder engagement", "concept_list": ["case studies", "species diversity", "restoration goals", "stakeholder engagement"], "type": "cluster", "node_size": 27, "label": "Ecosystem Restoration"}, "Grant Funding": {"concepts": "funding, grant funding, grants programs", "concept_list": ["funding", "grant funding", "grants programs"], "type": "cluster", "node_size": 24, "label": "Grant Funding"}, "Resource Users": {"concepts": "social capital, grant programs, federal government", "concept_list": ["social capital", "grant programs", "federal government"], "type": "cluster", "node_size": 24, "label": "Resource Users"}};
        const conceptData = {"estuary": {"concepts": "estuary", "type": "concept", "cluster": "Estuary Water Quality", "node_size": 10, "label": "estuary"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Estuary Water Quality", "node_size": 10, "label": "water quality"}, "fisheries": {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries"}, "aquaculture": {"concepts": "aquaculture", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "aquaculture"}, "fisheries management": {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries management"}, "oyster restoration": {"concepts": "oyster restoration", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "oyster restoration"}, "sediment dynamics": {"concepts": "sediment dynamics", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "sediment dynamics"}, "marine resources": {"concepts": "marine resources", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "marine resources"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "conservation"}, "ecological goals": {"concepts": "ecological goals", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "ecological goals"}, "conservation goals": {"concepts": "conservation goals", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "conservation goals"}, "ecological conditions": {"concepts": "ecological conditions", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological conditions"}, "system dynamics": {"concepts": "system dynamics", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "system dynamics"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "biodiversity"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "keystone species"}, "recreational users": {"concepts": "recreational users", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "recreational users"}, "resource users": {"concepts": "resource users", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "resource users"}, "stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "stakeholders"}, "economic impacts": {"concepts": "economic impacts", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "economic impacts"}, "management approaches": {"concepts": "management approaches", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "management approaches"}, "restoration priorities": {"concepts": "restoration priorities", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "restoration priorities"}, "communities": {"concepts": "communities", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "communities"}, "habitat": {"concepts": "habitat", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat"}, "nfwf": {"concepts": "nfwf", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "nfwf"}, "chesapeake bay program": {"concepts": "chesapeake bay program", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "chesapeake bay program"}, "environmental agencies": {"concepts": "environmental agencies", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "environmental agencies"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "ecosystem services"}, "epa": {"concepts": "epa", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "epa"}, "mental model": {"concepts": "mental model", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "mental model"}, "ecosystem management": {"concepts": "ecosystem management", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "ecosystem management"}, "chesapeake bay": {"concepts": "chesapeake bay", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "chesapeake bay"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat forming species"}, "habitat loss": {"concepts": "habitat loss", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat loss"}, "consensus": {"concepts": "consensus", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "consensus"}, "resource management": {"concepts": "resource management", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "resource management"}, "restoration": {"concepts": "restoration", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "restoration"}, "case studies": {"concepts": "case studies", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "case studies"}, "species diversity": {"concepts": "species diversity", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "species diversity"}, "restoration goals": {"concepts": "restoration goals", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "restoration goals"}, "stakeholder engagement": {"concepts": "stakeholder engagement", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "stakeholder engagement"}, "funding": {"concepts": "funding", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "funding"}, "grant funding": {"concepts": "grant funding", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "grant funding"}, "grants programs": {"concepts": "grants programs", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "grants programs"}, "social capital": {"concepts": "social capital", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "social capital"}, "grant programs": {"concepts": "grant programs", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "grant programs"}, "federal government": {"concepts": "federal government", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "federal government"}};
        const interClusterEdges = [["federal-state partnership", "Bay Restoration", {"weight": 1.0, "confidence": 0.9099999999999999, "type": "inter_cluster", "style": "solid"}], ["federal-state partnership", "Grant Funding", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["federal-state partnership", "Fisheries Management", {"weight": 1.0, "confidence": 0.7799999999999999, "type": "inter_cluster", "style": "solid"}], ["federal-state partnership", "Resource Impacts", {"weight": 1.0, "confidence": 0.7875, "type": "inter_cluster", "style": "solid"}], ["federal-state partnership", "Ecosystem Restoration", {"weight": 0.3333333333333333, "confidence": 0.26666666666666666, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Conservation Goals", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Estuary Water Quality", {"weight": 1.0, "confidence": 0.8799999999999999, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Resource Impacts", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Fisheries Management", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Ecosystem Restoration", {"weight": 0.8, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "federal-state partnership", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Resource Users", {"weight": 0.75, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["stewardship fund", "Oyster & Marine Restoration", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Oyster & Marine Restoration", {"weight": 1.0, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Conservation Goals", {"weight": 1.0, "confidence": 0.86, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Bay Restoration", {"weight": 0.8, "confidence": 0.7300000000000001, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Resource Users", {"weight": 0.8, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Ecosystem Restoration", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Grant Funding", {"weight": 0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Estuary Water Quality", "Resource Impacts", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Estuary Water Quality", {"weight": 0.6, "confidence": 0.7200000000000001, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Grant Funding", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Oyster & Marine Restoration", "stewardship fund", {"weight": 1.0, "confidence": 0.8700000000000001, "type": "inter_cluster", "style": "solid"}], ["Oyster & Marine Restoration", "Bay Restoration", {"weight": 0.8, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Oyster & Marine Restoration", "Resource Users", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Oyster & Marine Restoration", "Grant Funding", {"weight": 1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["Conservation Goals", "Oyster & Marine Restoration", {"weight": 1.0, "confidence": 0.8600000000000001, "type": "inter_cluster", "style": "solid"}], ["Conservation Goals", "Fisheries Management", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Conservation Goals", "Resource Users", {"weight": 1.0, "confidence": 0.79, "type": "inter_cluster", "style": "solid"}], ["Conservation Goals", "Resource Impacts", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Conservation Goals", "federal-state partnership", {"weight": 0.5, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Estuary Water Quality", {"weight": 1.0, "confidence": 0.8799999999999999, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Resource Impacts", {"weight": 1.0, "confidence": 0.8200000000000001, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Grant Funding", {"weight": 1.0, "confidence": 0.7200000000000001, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Resource Users", {"weight": 1.0, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Health", "Fisheries Management", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Resource Impacts", "Conservation Goals", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Resource Impacts", "Fisheries Management", {"weight": 1.0, "confidence": 0.8375, "type": "inter_cluster", "style": "solid"}], ["Resource Impacts", "Ecosystem Health", {"weight": 0.8, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}], ["Resource Impacts", "Ecosystem Restoration", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Resource Impacts", "Bay Restoration", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Bay Restoration", "Conservation Goals", {"weight": 1.0, "confidence": 0.9460000000000001, "type": "inter_cluster", "style": "solid"}], ["Bay Restoration", "federal-state partnership", {"weight": 1.0, "confidence": 0.8699999999999999, "type": "inter_cluster", "style": "solid"}], ["Bay Restoration", "Resource Impacts", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Bay Restoration", "Estuary Water Quality", {"weight": 1.0, "confidence": 0.9166666666666666, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Restoration", "Oyster & Marine Restoration", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Restoration", "Fisheries Management", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Restoration", "federal-state partnership", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Conservation Goals", {"weight": 1.0, "confidence": 0.8799999999999999, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Bay Restoration", {"weight": 1.0, "confidence": 0.9375, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Resource Users", {"weight": 0.8, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "Bay Restoration", {"weight": 1.0, "confidence": 0.8299999999999998, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "Fisheries Management", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "Estuary Water Quality", {"weight": 1.0, "confidence": 0.7500000000000001, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "federal-state partnership", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "Conservation Goals", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Resource Users", "Oyster & Marine Restoration", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Estuary Water Quality": [["estuary", {"concepts": "estuary", "type": "concept", "cluster": "Estuary Water Quality", "node_size": 10, "label": "estuary"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Estuary Water Quality", "node_size": 10, "label": "water quality"}]], "Fisheries Management": [["fisheries", {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries"}], ["aquaculture", {"concepts": "aquaculture", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "aquaculture"}], ["fisheries management", {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries management"}]], "Oyster & Marine Restoration": [["oyster restoration", {"concepts": "oyster restoration", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "oyster restoration"}], ["sediment dynamics", {"concepts": "sediment dynamics", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "sediment dynamics"}], ["marine resources", {"concepts": "marine resources", "type": "concept", "cluster": "Oyster & Marine Restoration", "node_size": 10, "label": "marine resources"}]], "Conservation Goals": [["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "conservation"}], ["ecological goals", {"concepts": "ecological goals", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "ecological goals"}], ["conservation goals", {"concepts": "conservation goals", "type": "concept", "cluster": "Conservation Goals", "node_size": 10, "label": "conservation goals"}]], "Ecosystem Health": [["ecological conditions", {"concepts": "ecological conditions", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "ecological conditions"}], ["system dynamics", {"concepts": "system dynamics", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "system dynamics"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "biodiversity"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Ecosystem Health", "node_size": 10, "label": "keystone species"}]], "Resource Impacts": [["recreational users", {"concepts": "recreational users", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "recreational users"}], ["resource users", {"concepts": "resource users", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "resource users"}], ["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "stakeholders"}], ["economic impacts", {"concepts": "economic impacts", "type": "concept", "cluster": "Resource Impacts", "node_size": 10, "label": "economic impacts"}]], "Bay Restoration": [["management approaches", {"concepts": "management approaches", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "management approaches"}], ["restoration priorities", {"concepts": "restoration priorities", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "restoration priorities"}], ["communities", {"concepts": "communities", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "communities"}], ["habitat", {"concepts": "habitat", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat"}], ["nfwf", {"concepts": "nfwf", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "nfwf"}], ["chesapeake bay program", {"concepts": "chesapeake bay program", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "chesapeake bay program"}], ["environmental agencies", {"concepts": "environmental agencies", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "environmental agencies"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "ecosystem services"}], ["epa", {"concepts": "epa", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "epa"}], ["mental model", {"concepts": "mental model", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "mental model"}], ["ecosystem management", {"concepts": "ecosystem management", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "ecosystem management"}], ["chesapeake bay", {"concepts": "chesapeake bay", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "chesapeake bay"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat forming species"}], ["habitat loss", {"concepts": "habitat loss", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "habitat loss"}], ["consensus", {"concepts": "consensus", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "consensus"}], ["resource management", {"concepts": "resource management", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "resource management"}], ["restoration", {"concepts": "restoration", "type": "concept", "cluster": "Bay Restoration", "node_size": 10, "label": "restoration"}]], "Ecosystem Restoration": [["case studies", {"concepts": "case studies", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "case studies"}], ["species diversity", {"concepts": "species diversity", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "species diversity"}], ["restoration goals", {"concepts": "restoration goals", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "restoration goals"}], ["stakeholder engagement", {"concepts": "stakeholder engagement", "type": "concept", "cluster": "Ecosystem Restoration", "node_size": 10, "label": "stakeholder engagement"}]], "Grant Funding": [["funding", {"concepts": "funding", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "funding"}], ["grant funding", {"concepts": "grant funding", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "grant funding"}], ["grants programs", {"concepts": "grants programs", "type": "concept", "cluster": "Grant Funding", "node_size": 10, "label": "grants programs"}]], "Resource Users": [["social capital", {"concepts": "social capital", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "social capital"}], ["grant programs", {"concepts": "grant programs", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "grant programs"}], ["federal government", {"concepts": "federal government", "type": "concept", "cluster": "Resource Users", "node_size": 10, "label": "federal government"}]]};
        const clusterEdges = {"Estuary Water Quality": [], "Fisheries Management": [], "Oyster & Marine Restoration": [], "Conservation Goals": [], "Ecosystem Health": [], "Resource Impacts": [], "Bay Restoration": [], "Ecosystem Restoration": [], "Grant Funding": [], "Resource Users": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
