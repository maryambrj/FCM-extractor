
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Transit & Development": {"concepts": "fruits, cooking", "concept_list": ["fruits", "cooking"], "type": "cluster", "node_size": 21, "label": "Transit & Development"}, "Food Systems": {"concepts": "bus routes, economic development, transportation, regional differences, north end, south end, project maps, third world city, metropolitan transit authority", "concept_list": ["bus routes", "economic development", "transportation", "regional differences", "north end", "south end", "project maps", "third world city", "metropolitan transit authority"], "type": "cluster", "node_size": 42, "label": "Food Systems"}, "Community Partnerships": {"concepts": "food planning, farmers markets, fresh produce, food provision, food intervention, food impact, seasonality, food community, food system maturity, food strategy, food insecurity, food seasonality, food collaboration, food system sectors, food market, food participation, food progress, nutrition, food solutions, food revitalization, food security, food assistance, food barriers, food utilization, food equity, food values, food suppliers, food development, food investment, nutritious foods, food improvement, secondary food sources, food quantity, double up food cards, food resources, food services, eating habits, retail food environment, farmers market, supplemental nutrition programs, obesity, food awareness, food disparities, food habits, healthy food access, food access, price of food, food skills, food renewal, food desert, food enhancement, food policy, food leadership, local consumers, food literacy, food capacity, food availability, food knowledge, double up food bucks, food distribution, food empowerment, food partnerships, free food, food change, food bank, food stamps, food management, food outreach, food engagement, healthy food, food initiatives, non-nutritious foods, food infrastructure, food organization, food rehabilitation, food types, food support, fresh food, winter produce, food advocacy, food affordability, food consumption, food education, community food system, seasonal extension, local food system, food transformation, food system, food needs, food opportunity, food outcomes, food innovation, food sources, food programs, food sustainability, food growth, local farmers, food challenges, food potential", "concept_list": ["food planning", "farmers markets", "fresh produce", "food provision", "food intervention", "food impact", "seasonality", "food community", "food system maturity", "food strategy", "food insecurity", "food seasonality", "food collaboration", "food system sectors", "food market", "food participation", "food progress", "nutrition", "food solutions", "food revitalization", "food security", "food assistance", "food barriers", "food utilization", "food equity", "food values", "food suppliers", "food development", "food investment", "nutritious foods", "food improvement", "secondary food sources", "food quantity", "double up food cards", "food resources", "food services", "eating habits", "retail food environment", "farmers market", "supplemental nutrition programs", "obesity", "food awareness", "food disparities", "food habits", "healthy food access", "food access", "price of food", "food skills", "food renewal", "food desert", "food enhancement", "food policy", "food leadership", "local consumers", "food literacy", "food capacity", "food availability", "food knowledge", "double up food bucks", "food distribution", "food empowerment", "food partnerships", "free food", "food change", "food bank", "food stamps", "food management", "food outreach", "food engagement", "healthy food", "food initiatives", "non-nutritious foods", "food infrastructure", "food organization", "food rehabilitation", "food types", "food support", "fresh food", "winter produce", "food advocacy", "food affordability", "food consumption", "food education", "community food system", "seasonal extension", "local food system", "food transformation", "food system", "food needs", "food opportunity", "food outcomes", "food innovation", "food sources", "food programs", "food sustainability", "food growth", "local farmers", "food challenges", "food potential"], "type": "cluster", "node_size": 312, "label": "Community Partnerships"}, "Education Systems": {"concepts": "sodexo, technical assistance, mta, brussel sprouts, informed parents, consumer, vg's, summer market, michigan, collaboration, partnerships, detroit, residents, quality of life, supplemental sector, shocks, trust, vendors, accessibility, vacant lots, consumer behavior, research, service sector, senior centers, expertise, ppp project, cross conversations, resistance, rides to market, leverage points, flint, hospitals, researchers, support, common good, rides to doctor, market, covid-19, dignity, closure, health, diabetes, operator's voice, secondary providers, problem solving, undergrads, leadership, modeling, comfort, drive by pickup, market closure, covid, meijer, technical topics, safety, outside resources, kroger, system impact, income, flint fresh, portion size, michigan state, bars, communication, patient care, participation, flint market, wic, recovery, masks, affordability, produce, habits, demand side", "concept_list": ["sodexo", "technical assistance", "mta", "brussel sprouts", "informed parents", "consumer", "vg's", "summer market", "michigan", "collaboration", "partnerships", "detroit", "residents", "quality of life", "supplemental sector", "shocks", "trust", "vendors", "accessibility", "vacant lots", "consumer behavior", "research", "service sector", "senior centers", "expertise", "ppp project", "cross conversations", "resistance", "rides to market", "leverage points", "flint", "hospitals", "researchers", "support", "common good", "rides to doctor", "market", "covid-19", "dignity", "closure", "health", "diabetes", "operator's voice", "secondary providers", "problem solving", "undergrads", "leadership", "modeling", "comfort", "drive by pickup", "market closure", "covid", "meijer", "technical topics", "safety", "outside resources", "kroger", "system impact", "income", "flint fresh", "portion size", "michigan state", "bars", "communication", "patient care", "participation", "flint market", "wic", "recovery", "masks", "affordability", "produce", "habits", "demand side"], "type": "cluster", "node_size": 237, "label": "Education Systems"}, "Fruit Cooking": {"concepts": "educational practices, schools, classroom modeling, educational advantage, retired teacher, classroom, educators, educational disparity, educational initiatives, lunch programs, education system, education, middle class, school groups, school systems, upper middle class, better educated, curriculum, course sessions, educational system, school lunch", "concept_list": ["educational practices", "schools", "classroom modeling", "educational advantage", "retired teacher", "classroom", "educators", "educational disparity", "educational initiatives", "lunch programs", "education system", "education", "middle class", "school groups", "school systems", "upper middle class", "better educated", "curriculum", "course sessions", "educational system", "school lunch"], "type": "cluster", "node_size": 78, "label": "Fruit Cooking"}, "Community Engagement": {"concepts": "community leaders, rides to church, community empowerment, community health, community impact, community members, patrons", "concept_list": ["community leaders", "rides to church", "community empowerment", "community health", "community impact", "community members", "patrons"], "type": "cluster", "node_size": 36, "label": "Community Engagement"}, "Social Dynamics": {"concepts": "cultural values, social support, social advantage, culture change, social perspective, change work, organizational structures, social influence, social disparity, social dynamics, process work, social disadvantage, organizational structure, social inequality, culture shift, social perspectives", "concept_list": ["cultural values", "social support", "social advantage", "culture change", "social perspective", "change work", "organizational structures", "social influence", "social disparity", "social dynamics", "process work", "social disadvantage", "organizational structure", "social inequality", "culture shift", "social perspectives"], "type": "cluster", "node_size": 63, "label": "Social Dynamics"}, "Food Access": {"concepts": "hoop house, additives, bridge card, local gardens, produce distribution, hoop houses, access, botany professor, availability, senior citizens homes, gardening, government, undergraduates, vegetables, universities, emergency sector, neighborhood groups, preservatives, bridge cards, botany, resident transportation, resident income, economic resources, local neighborhoods, subsidizing, produce dealers, neighborhoods, barn raising, weekend package", "concept_list": ["hoop house", "additives", "bridge card", "local gardens", "produce distribution", "hoop houses", "access", "botany professor", "availability", "senior citizens homes", "gardening", "government", "undergraduates", "vegetables", "universities", "emergency sector", "neighborhood groups", "preservatives", "bridge cards", "botany", "resident transportation", "resident income", "economic resources", "local neighborhoods", "subsidizing", "produce dealers", "neighborhoods", "barn raising", "weekend package"], "type": "cluster", "node_size": 102, "label": "Food Access"}, "Retail Environment": {"concepts": "grocery store closures, grocery stores, online shopping, chain restaurants, local restaurants, retail sector, convenience stores, retail, big box stores, restaurants", "concept_list": ["grocery store closures", "grocery stores", "online shopping", "chain restaurants", "local restaurants", "retail sector", "convenience stores", "retail", "big box stores", "restaurants"], "type": "cluster", "node_size": 45, "label": "Retail Environment"}};
        const conceptData = {};
        const interClusterEdges = [["Transit & Development", "Community Partnerships", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Transit & Development", "Education Systems", {"weight": 0.75, "confidence": 0.4375, "type": "inter_cluster", "style": "solid"}], ["Transit & Development", "Community Engagement", {"weight": 0.5, "confidence": 0.2625, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Food Access", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Retail Environment", {"weight": 0.5, "confidence": 0.7250000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Education Systems", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Community Partnerships", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Community Engagement", {"weight": 1.0, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Social Dynamics", {"weight": 0.8, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Fruit Cooking", {"weight": 0.6666666666666666, "confidence": 0.3666666666666667, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Food Access", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Retail Environment", {"weight": 0.5, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Education Systems", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Social Dynamics", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Community Engagement", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Food Systems", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Community Partnerships", {"weight": 1.0, "confidence": 0.8125, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Food Access", {"weight": 0.6, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Community Engagement", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Retail Environment", {"weight": 1.0, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Community Partnerships", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Social Dynamics", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Community Engagement", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Food Access", {"weight": 0.8, "confidence": 0.6199999999999999, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Transit & Development", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Education Systems", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Retail Environment", {"weight": 0.2, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Fruit Cooking", "Food Systems", {"weight": 0.6, "confidence": 0.33999999999999997, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Community Partnerships", {"weight": 1.0, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Social Dynamics", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Fruit Cooking", {"weight": 0.8, "confidence": 0.5399999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Education Systems", {"weight": 1.0, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food Access", {"weight": 0.8, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food Systems", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Transit & Development", {"weight": 0.5, "confidence": 0.275, "type": "inter_cluster", "style": "solid"}], ["Social Dynamics", "Fruit Cooking", {"weight": 1.0, "confidence": 0.7700000000000001, "type": "inter_cluster", "style": "solid"}], ["Social Dynamics", "Food Access", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Social Dynamics", "Community Engagement", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Social Dynamics", "Community Partnerships", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Partnerships", {"weight": 0.8, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Education Systems", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Systems", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Retail Environment", {"weight": 0.2, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Fruit Cooking", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Community Partnerships", {"weight": 0.6, "confidence": 0.8799999999999999, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Fruit Cooking", {"weight": -0.2, "confidence": 0.62, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Social Dynamics", {"weight": -0.5, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Food Access", {"weight": -0.5, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Food Systems", {"weight": 0.75, "confidence": 0.5375000000000001, "type": "inter_cluster", "style": "solid"}], ["Retail Environment", "Community Engagement", {"weight": -0.2, "confidence": 0.37, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Transit & Development": [], "Food Systems": [], "Community Partnerships": [], "Education Systems": [], "Fruit Cooking": [], "Community Engagement": [], "Social Dynamics": [], "Food Access": [], "Retail Environment": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
