
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Well-being": {"concepts": "food insecurity, cooking, food aggregation, food system, food programs, food access, food deserts, nutrition, food bank, supplemental nutrition program, healthy food access, food system navigation, food offerings, food skills, nutritious foods, fresh food, healthy food, flint food system, food availability, childhood food insecurity", "concept_list": ["food insecurity", "cooking", "food aggregation", "food system", "food programs", "food access", "food deserts", "nutrition", "food bank", "supplemental nutrition program", "healthy food access", "food system navigation", "food offerings", "food skills", "nutritious foods", "fresh food", "healthy food", "flint food system", "food availability", "childhood food insecurity"], "type": "cluster", "node_size": 75, "label": "Community Well-being"}, "Food Retail": {"concepts": "disengagement, quality of life, confidential data, community resources, resolution adoption, health, underserved areas, participatory modeling, emergency, local produce, community well-being, local investment, community benefit, sectoral benefits, individualism, partnerships, barriers, emergency sector, incentive programs, supplemental sector, community mapping, race, collective good, economic development, partnership benefits, network creation, covid, community trust, research outcomes, resource expansion, community impact, systems thinking, affordability, social pressures, common good, producer support, problem solving, cultural values, partnership, leadership, workshops, focus groups, access, biological factors, creativity, resource distribution, career development, survey, community advisory committee, social dynamics, availability, partnership barriers, support, community development, social systems, vacant land, trust, inequity, social capital, producer-consumer, educational attainment, incentives, interviews, dignity, economic opportunity, decision making, economic decline, poverty traps, communication, disinvestment, local economy, flint, wic, nonprofit community, leverage points, basic needs, research participation, violence, social determinants, structural barriers, connection strengths, collaboration, community engagement, systems impact, community needs, racism, local hiring, economic hardship, social networks, community resilience, profit motive, equitable participation, partnership challenges, education, covid-19, stakeholder engagement, powerlessness, brain development, choices, social impact, detroit, disparity, safety, direct producers, inequalities, job opportunities, snap, hunger, workforce training, resources, diabetes, community empowerment, value added products, grant making, resource access, covid-19 taskforce, causal loop diagrams, income, comfort, vacant space, residents, public health crisis, shared goals, community partnerships, community challenges, portions, stakeholder relationships, community based organizations, community, aggression, pandemic, shared agenda, crime, innovation, anchor institutions, youth, navigator role, collaborative action, public awareness, vacancy, blight, data collection", "concept_list": ["disengagement", "quality of life", "confidential data", "community resources", "resolution adoption", "health", "underserved areas", "participatory modeling", "emergency", "local produce", "community well-being", "local investment", "community benefit", "sectoral benefits", "individualism", "partnerships", "barriers", "emergency sector", "incentive programs", "supplemental sector", "community mapping", "race", "collective good", "economic development", "partnership benefits", "network creation", "covid", "community trust", "research outcomes", "resource expansion", "community impact", "systems thinking", "affordability", "social pressures", "common good", "producer support", "problem solving", "cultural values", "partnership", "leadership", "workshops", "focus groups", "access", "biological factors", "creativity", "resource distribution", "career development", "survey", "community advisory committee", "social dynamics", "availability", "partnership barriers", "support", "community development", "social systems", "vacant land", "trust", "inequity", "social capital", "producer-consumer", "educational attainment", "incentives", "interviews", "dignity", "economic opportunity", "decision making", "economic decline", "poverty traps", "communication", "disinvestment", "local economy", "flint", "wic", "nonprofit community", "leverage points", "basic needs", "research participation", "violence", "social determinants", "structural barriers", "connection strengths", "collaboration", "community engagement", "systems impact", "community needs", "racism", "local hiring", "economic hardship", "social networks", "community resilience", "profit motive", "equitable participation", "partnership challenges", "education", "covid-19", "stakeholder engagement", "powerlessness", "brain development", "choices", "social impact", "detroit", "disparity", "safety", "direct producers", "inequalities", "job opportunities", "snap", "hunger", "workforce training", "resources", "diabetes", "community empowerment", "value added products", "grant making", "resource access", "covid-19 taskforce", "causal loop diagrams", "income", "comfort", "vacant space", "residents", "public health crisis", "shared goals", "community partnerships", "community challenges", "portions", "stakeholder relationships", "community based organizations", "community", "aggression", "pandemic", "shared agenda", "crime", "innovation", "anchor institutions", "youth", "navigator role", "collaborative action", "public awareness", "vacancy", "blight", "data collection"], "type": "cluster", "node_size": 441, "label": "Food Retail"}, "Systems Mapping": {"concepts": "retail, restaurants, neighborhood stores, grocery store closures, convenience stores, retailers, local stores, store closures, local restaurants, chain restaurants, stores, retail sector, small stores, grocery stores", "concept_list": ["retail", "restaurants", "neighborhood stores", "grocery store closures", "convenience stores", "retailers", "local stores", "store closures", "local restaurants", "chain restaurants", "stores", "retail sector", "small stores", "grocery stores"], "type": "cluster", "node_size": 57, "label": "Systems Mapping"}, "Organizational Capacity": {"concepts": "modeling conference, map, systems modeling, network mapping, aggregation, system mapping, modeling, neighborhoods", "concept_list": ["modeling conference", "map", "systems modeling", "network mapping", "aggregation", "system mapping", "modeling", "neighborhoods"], "type": "cluster", "node_size": 39, "label": "Organizational Capacity"}, "Food Access": {"concepts": "organizational capacity, organizational collaboration, organizational resources, organizational trust, organizational change, organizational networks, organizational dynamics", "concept_list": ["organizational capacity", "organizational collaboration", "organizational resources", "organizational trust", "organizational change", "organizational networks", "organizational dynamics"], "type": "cluster", "node_size": 36, "label": "Food Access"}, "Local Growers": {"concepts": "growers, local growers, local farmers", "concept_list": ["growers", "local growers", "local farmers"], "type": "cluster", "node_size": 24, "label": "Local Growers"}, "Urban Agriculture": {"concepts": "neighborhood hoop houses, farmers market, community agriculture, urban agriculture, hoop houses, urban farming, urban gardens, gardening, community gardens", "concept_list": ["neighborhood hoop houses", "farmers market", "community agriculture", "urban agriculture", "hoop houses", "urban farming", "urban gardens", "gardening", "community gardens"], "type": "cluster", "node_size": 42, "label": "Urban Agriculture"}, "Food Additives": {"concepts": "additives, preservatives, waste management", "concept_list": ["additives", "preservatives", "waste management"], "type": "cluster", "node_size": 24, "label": "Food Additives"}};
        const conceptData = {};
        const interClusterEdges = [["Community Well-being", "Food Retail", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Community Well-being", "Food Access", {"weight": 0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Community Well-being", "Urban Agriculture", {"weight": 0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Urban Agriculture", {"weight": 0.6, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Local Growers", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Systems Mapping", "Community Well-being", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Organizational Capacity", "Food Access", {"weight": 0.6, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Organizational Capacity", "Local Growers", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Organizational Capacity", "Systems Mapping", {"weight": 0.25, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Organizational Capacity", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Local Growers", {"weight": 0.75, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Retail", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Well-being", {"weight": 0.6666666666666666, "confidence": 0.48333333333333334, "type": "inter_cluster", "style": "solid"}], ["Local Growers", "Urban Agriculture", {"weight": 1.0, "confidence": 0.8875, "type": "inter_cluster", "style": "solid"}], ["Local Growers", "Food Retail", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Local Growers", "Food Additives", {"weight": -0.3333333333333333, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Local Growers", "Community Well-being", {"weight": 0.6666666666666666, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Community Well-being", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Local Growers", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Additives", "Urban Agriculture", {"weight": -0.5, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Additives", "Community Well-being", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Additives", "Systems Mapping", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Food Additives", "Food Retail", {"weight": -0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Well-being": [], "Food Retail": [], "Systems Mapping": [], "Organizational Capacity": [], "Food Access": [], "Local Growers": [], "Urban Agriculture": [], "Food Additives": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
