
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"general expertise": {"concepts": "general expertise", "concept_list": ["general expertise"], "type": "cluster", "node_size": 18, "label": "general expertise"}, "Software Functionality & Quality": {"concepts": "analysis, ranking, static analysis, code review, pattern matching, static process analysis, source code, dynamic analysis, process analysis, static, dynamically analyze", "concept_list": ["analysis", "ranking", "static analysis", "code review", "pattern matching", "static process analysis", "source code", "dynamic analysis", "process analysis", "static", "dynamically analyze"], "type": "cluster", "node_size": 48, "label": "Software Functionality & Quality"}, "System Dependencies & Access": {"concepts": "success factors, internal processes, functionalities, design patterns, structure, functions, output, robustness, maintained, inputs, actual state, valid inputs, functionality understanding, causal mechanisms, computer visualization, full picture, workable state, convention, functionality, execution, process, additional functionality, assertions, standard, feedback loop, file formats, implementation, quality", "concept_list": ["success factors", "internal processes", "functionalities", "design patterns", "structure", "functions", "output", "robustness", "maintained", "inputs", "actual state", "valid inputs", "functionality understanding", "causal mechanisms", "computer visualization", "full picture", "workable state", "convention", "functionality", "execution", "process", "additional functionality", "assertions", "standard", "feedback loop", "file formats", "implementation", "quality"], "type": "cluster", "node_size": 99, "label": "System Dependencies & Access"}, "Challenge Solving & Exploitation": {"concepts": "network connections, inaccessible dependencies, kernel, restricted access, kernel interaction, dependencies", "concept_list": ["network connections", "inaccessible dependencies", "kernel", "restricted access", "kernel interaction", "dependencies"], "type": "cluster", "node_size": 33, "label": "Challenge Solving & Exploitation"}, "CTF Challenge Analysis": {"concepts": "negative causality, code smell, poorly implemented, full control, ctf challenge, effects, prior knowledge, ctf player ability, capabilities, target characteristic, controllable, outside resources, iterative process, target obscurity, familiarity, enumeration, pitfalls, implementation board, proprietary, target interaction, pure state, risk, interacting, target, challenge enumeration, modify target, expectation, disruptions, ctf games, intentionality, success degree, expertise, target binary, alternate paths, semi-structured, emulated target, unsuccessful interaction, weaknesses, fake flag, guess and check, tool set, mitigations, underlying factor, essence, basic steps, challenge, accurate understanding, inherent variables, exploitation, quick solutions, fuzzer, errors, target access, stability, misunderstood, missing check, rabbit holes, granular, beliefs, knowledge, ability, target process analysis, solutions, challenges, initial hypotheses, wrong answers, dynamic, protocol familiarity, interrogate, modified target, researcher ability, modifying target, potential solution, time wasters, judgment call, understanding, success enumeration, memory mismanagement, disrupt, faults, solution, exploring, open-ended questions, remote, causal assertions, decisions, learning, local, intricacy, enabling factors, flag, decompiler, likelihood, code complexity, strategy, point deduction, jeopardy, assumptions, memory management, right tool, success, inaccurate understanding, rabbit hole, toolset, decent understanding, inexperienced", "concept_list": ["negative causality", "code smell", "poorly implemented", "full control", "ctf challenge", "effects", "prior knowledge", "ctf player ability", "capabilities", "target characteristic", "controllable", "outside resources", "iterative process", "target obscurity", "familiarity", "enumeration", "pitfalls", "implementation board", "proprietary", "target interaction", "pure state", "risk", "interacting", "target", "challenge enumeration", "modify target", "expectation", "disruptions", "ctf games", "intentionality", "success degree", "expertise", "target binary", "alternate paths", "semi-structured", "emulated target", "unsuccessful interaction", "weaknesses", "fake flag", "guess and check", "tool set", "mitigations", "underlying factor", "essence", "basic steps", "challenge", "accurate understanding", "inherent variables", "exploitation", "quick solutions", "fuzzer", "errors", "target access", "stability", "misunderstood", "missing check", "rabbit holes", "granular", "beliefs", "knowledge", "ability", "target process analysis", "solutions", "challenges", "initial hypotheses", "wrong answers", "dynamic", "protocol familiarity", "interrogate", "modified target", "researcher ability", "modifying target", "potential solution", "time wasters", "judgment call", "understanding", "success enumeration", "memory mismanagement", "disrupt", "faults", "solution", "exploring", "open-ended questions", "remote", "causal assertions", "decisions", "learning", "local", "intricacy", "enabling factors", "flag", "decompiler", "likelihood", "code complexity", "strategy", "point deduction", "jeopardy", "assumptions", "memory management", "right tool", "success", "inaccurate understanding", "rabbit hole", "toolset", "decent understanding", "inexperienced"], "type": "cluster", "node_size": 333, "label": "CTF Challenge Analysis"}, "Operating Environments": {"concepts": "environments, environment, altered environment, environmental condition, fuzzy cognitive map, environmental variables", "concept_list": ["environments", "environment", "altered environment", "environmental condition", "fuzzy cognitive map", "environmental variables"], "type": "cluster", "node_size": 33, "label": "Operating Environments"}, "Vulnerability Ranking": {"concepts": "vulnerability complexity, ranking vulnerabilities, vulnerability, vulnerabilities", "concept_list": ["vulnerability complexity", "ranking vulnerabilities", "vulnerability", "vulnerabilities"], "type": "cluster", "node_size": 27, "label": "Vulnerability Ranking"}, "Vulnerability Identification": {"concepts": "introduced vulnerabilities, vulnerable patterns, vulnerable behaviors, vulnerable behavior, identify vulnerabilities", "concept_list": ["introduced vulnerabilities", "vulnerable patterns", "vulnerable behaviors", "vulnerable behavior", "identify vulnerabilities"], "type": "cluster", "node_size": 30, "label": "Vulnerability Identification"}, "Attack Surface": {"concepts": "exploitable, attack surface, attack surfaces, cyber attacks, cyber attackers", "concept_list": ["exploitable", "attack surface", "attack surfaces", "cyber attacks", "cyber attackers"], "type": "cluster", "node_size": 30, "label": "Attack Surface"}, "Normal Behavior": {"concepts": "normal behavior, behavior", "concept_list": ["normal behavior", "behavior"], "type": "cluster", "node_size": 21, "label": "Normal Behavior"}, "Abnormal Behavior": {"concepts": "disruptive behaviors, abnormal behavior, abnormal results, unexpected behavior", "concept_list": ["disruptive behaviors", "abnormal behavior", "abnormal results", "unexpected behavior"], "type": "cluster", "node_size": 27, "label": "Abnormal Behavior"}, "Unsafe Practices": {"concepts": "unsafe code practices, unsafe behavior", "concept_list": ["unsafe code practices", "unsafe behavior"], "type": "cluster", "node_size": 21, "label": "Unsafe Practices"}, "Intended Behavior": {"concepts": "behaviors, mock behavior, target behavior, emulating behavior, intended behavior", "concept_list": ["behaviors", "mock behavior", "target behavior", "emulating behavior", "intended behavior"], "type": "cluster", "node_size": 30, "label": "Intended Behavior"}};
        const conceptData = {};
        const interClusterEdges = [["general expertise", "Vulnerability Identification", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["general expertise", "Attack Surface", {"weight": 0.6, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Software Functionality & Quality", "Abnormal Behavior", {"weight": -0.2, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}], ["System Dependencies & Access", "Operating Environments", {"weight": 0.8, "confidence": 0.27, "type": "inter_cluster", "style": "solid"}], ["System Dependencies & Access", "Normal Behavior", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["CTF Challenge Analysis", "Abnormal Behavior", {"weight": 0.6, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["CTF Challenge Analysis", "Operating Environments", {"weight": 0.25, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Operating Environments", "general expertise", {"weight": -0.75, "confidence": 0.2375, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Ranking", "CTF Challenge Analysis", {"weight": 1.0, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Identification", "Attack Surface", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Identification", "Software Functionality & Quality", {"weight": 0.2, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}], ["Vulnerability Identification", "Abnormal Behavior", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Attack Surface", "Vulnerability Identification", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Attack Surface", "Unsafe Practices", {"weight": 0.8, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Attack Surface", "Vulnerability Ranking", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Normal Behavior", "Intended Behavior", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Normal Behavior", "CTF Challenge Analysis", {"weight": 0.2, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Normal Behavior", "Challenge Solving & Exploitation", {"weight": 0.25, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Abnormal Behavior", "System Dependencies & Access", {"weight": -0.6666666666666666, "confidence": 0.3666666666666667, "type": "inter_cluster", "style": "solid"}], ["Abnormal Behavior", "CTF Challenge Analysis", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Unsafe Practices", "Vulnerability Identification", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Unsafe Practices", "Operating Environments", {"weight": 0.25, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Intended Behavior", "Normal Behavior", {"weight": 0.75, "confidence": 0.5125, "type": "inter_cluster", "style": "solid"}], ["Intended Behavior", "CTF Challenge Analysis", {"weight": 0.6666666666666666, "confidence": 0.3333333333333333, "type": "inter_cluster", "style": "solid"}], ["Intended Behavior", "Challenge Solving & Exploitation", {"weight": 0.5, "confidence": 0.1875, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Software Functionality & Quality": [], "System Dependencies & Access": [], "Challenge Solving & Exploitation": [], "CTF Challenge Analysis": [], "Operating Environments": [], "Vulnerability Ranking": [], "Vulnerability Identification": [], "Attack Surface": [], "Normal Behavior": [], "Abnormal Behavior": [], "Unsafe Practices": [], "Intended Behavior": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
