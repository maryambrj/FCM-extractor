
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"recreational fishermen": {"concepts": "recreational fishermen", "concept_list": ["recreational fishermen"], "type": "cluster", "node_size": 18, "label": "recreational fishermen"}, "Stakeholder Engagement": {"concepts": "participatory modeling, commercial fishermen, community engagement, social ecological dynamics, community members, oyster farmers, stakeholder alignment, resource users, tribal community members, management approaches, stakeholder engagement, access to biodiversity, decision making, resource managers, workshop facilitation, waterfront homeowners, ecosystem services", "concept_list": ["participatory modeling", "commercial fishermen", "community engagement", "social ecological dynamics", "community members", "oyster farmers", "stakeholder alignment", "resource users", "tribal community members", "management approaches", "stakeholder engagement", "access to biodiversity", "decision making", "resource managers", "workshop facilitation", "waterfront homeowners", "ecosystem services"], "type": "cluster", "node_size": 66, "label": "Stakeholder Engagement"}, "Regional Model Alignment": {"concepts": "ecotourism operators, mental models, commonalities, regional comparison, model validation, conservation, conceptual models, local values, differences, trade-offs, collaborative modeling, value alignment, scenario simulations, regional differences, regional commonalities", "concept_list": ["ecotourism operators", "mental models", "commonalities", "regional comparison", "model validation", "conservation", "conceptual models", "local values", "differences", "trade-offs", "collaborative modeling", "value alignment", "scenario simulations", "regional differences", "regional commonalities"], "type": "cluster", "node_size": 60, "label": "Regional Model Alignment"}};
        const conceptData = {"participatory modeling": {"concepts": "participatory modeling", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "participatory modeling"}, "commercial fishermen": {"concepts": "commercial fishermen", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "commercial fishermen"}, "community engagement": {"concepts": "community engagement", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "community engagement"}, "social ecological dynamics": {"concepts": "social ecological dynamics", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "social ecological dynamics"}, "community members": {"concepts": "community members", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "community members"}, "oyster farmers": {"concepts": "oyster farmers", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "oyster farmers"}, "stakeholder alignment": {"concepts": "stakeholder alignment", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "stakeholder alignment"}, "resource users": {"concepts": "resource users", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "resource users"}, "tribal community members": {"concepts": "tribal community members", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "tribal community members"}, "management approaches": {"concepts": "management approaches", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "management approaches"}, "stakeholder engagement": {"concepts": "stakeholder engagement", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "stakeholder engagement"}, "access to biodiversity": {"concepts": "access to biodiversity", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "access to biodiversity"}, "decision making": {"concepts": "decision making", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "decision making"}, "resource managers": {"concepts": "resource managers", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "resource managers"}, "workshop facilitation": {"concepts": "workshop facilitation", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "workshop facilitation"}, "waterfront homeowners": {"concepts": "waterfront homeowners", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "waterfront homeowners"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "ecosystem services"}, "ecotourism operators": {"concepts": "ecotourism operators", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "ecotourism operators"}, "mental models": {"concepts": "mental models", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "mental models"}, "commonalities": {"concepts": "commonalities", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "commonalities"}, "regional comparison": {"concepts": "regional comparison", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional comparison"}, "model validation": {"concepts": "model validation", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "model validation"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "conservation"}, "conceptual models": {"concepts": "conceptual models", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "conceptual models"}, "local values": {"concepts": "local values", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "local values"}, "differences": {"concepts": "differences", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "differences"}, "trade-offs": {"concepts": "trade-offs", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "trade-offs"}, "collaborative modeling": {"concepts": "collaborative modeling", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "collaborative modeling"}, "value alignment": {"concepts": "value alignment", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "value alignment"}, "scenario simulations": {"concepts": "scenario simulations", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "scenario simulations"}, "regional differences": {"concepts": "regional differences", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional differences"}, "regional commonalities": {"concepts": "regional commonalities", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional commonalities"}};
        const interClusterEdges = [["recreational fishermen", "Stakeholder Engagement", {"weight": 0.6, "confidence": 0.41, "type": "inter_cluster", "style": "solid"}], ["recreational fishermen", "Regional Model Alignment", {"weight": 0.6, "confidence": 0.41999999999999993, "type": "inter_cluster", "style": "solid"}], ["Stakeholder Engagement", "Regional Model Alignment", {"weight": 0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Regional Model Alignment", "recreational fishermen", {"weight": 0.6, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Regional Model Alignment", "Stakeholder Engagement", {"weight": 0.4, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Stakeholder Engagement": [["participatory modeling", {"concepts": "participatory modeling", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "participatory modeling"}], ["commercial fishermen", {"concepts": "commercial fishermen", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "commercial fishermen"}], ["community engagement", {"concepts": "community engagement", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "community engagement"}], ["social ecological dynamics", {"concepts": "social ecological dynamics", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "social ecological dynamics"}], ["community members", {"concepts": "community members", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "community members"}], ["oyster farmers", {"concepts": "oyster farmers", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "oyster farmers"}], ["stakeholder alignment", {"concepts": "stakeholder alignment", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "stakeholder alignment"}], ["resource users", {"concepts": "resource users", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "resource users"}], ["tribal community members", {"concepts": "tribal community members", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "tribal community members"}], ["management approaches", {"concepts": "management approaches", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "management approaches"}], ["stakeholder engagement", {"concepts": "stakeholder engagement", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "stakeholder engagement"}], ["access to biodiversity", {"concepts": "access to biodiversity", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "access to biodiversity"}], ["decision making", {"concepts": "decision making", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "decision making"}], ["resource managers", {"concepts": "resource managers", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "resource managers"}], ["workshop facilitation", {"concepts": "workshop facilitation", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "workshop facilitation"}], ["waterfront homeowners", {"concepts": "waterfront homeowners", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "waterfront homeowners"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Stakeholder Engagement", "node_size": 10, "label": "ecosystem services"}]], "Regional Model Alignment": [["ecotourism operators", {"concepts": "ecotourism operators", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "ecotourism operators"}], ["mental models", {"concepts": "mental models", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "mental models"}], ["commonalities", {"concepts": "commonalities", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "commonalities"}], ["regional comparison", {"concepts": "regional comparison", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional comparison"}], ["model validation", {"concepts": "model validation", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "model validation"}], ["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "conservation"}], ["conceptual models", {"concepts": "conceptual models", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "conceptual models"}], ["local values", {"concepts": "local values", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "local values"}], ["differences", {"concepts": "differences", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "differences"}], ["trade-offs", {"concepts": "trade-offs", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "trade-offs"}], ["collaborative modeling", {"concepts": "collaborative modeling", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "collaborative modeling"}], ["value alignment", {"concepts": "value alignment", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "value alignment"}], ["scenario simulations", {"concepts": "scenario simulations", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "scenario simulations"}], ["regional differences", {"concepts": "regional differences", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional differences"}], ["regional commonalities", {"concepts": "regional commonalities", "type": "concept", "cluster": "Regional Model Alignment", "node_size": 10, "label": "regional commonalities"}]]};
        const clusterEdges = {"Stakeholder Engagement": [], "Regional Model Alignment": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
