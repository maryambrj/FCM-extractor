
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"fiscal crisis": {"concepts": "fiscal crisis", "concept_list": ["fiscal crisis"], "type": "cluster", "node_size": 18, "label": "fiscal crisis"}, "job opportunities": {"concepts": "job opportunities", "concept_list": ["job opportunities"], "type": "cluster", "node_size": 18, "label": "job opportunities"}, "Government Involvement": {"concepts": "coral reefs, black corals, coral life, coral bleaching", "concept_list": ["coral reefs", "black corals", "coral life", "coral bleaching"], "type": "cluster", "node_size": 27, "label": "Government Involvement"}, "Government Perspective": {"concepts": "government, local government, government collaboration, government support", "concept_list": ["government", "local government", "government collaboration", "government support"], "type": "cluster", "node_size": 27, "label": "Government Perspective"}, "Public Policy": {"concepts": "government employee attitude, government concerns", "concept_list": ["government employee attitude", "government concerns"], "type": "cluster", "node_size": 21, "label": "Public Policy"}, "Foreign Bureaucracy": {"concepts": "public hearings, public policy", "concept_list": ["public hearings", "public policy"], "type": "cluster", "node_size": 21, "label": "Foreign Bureaucracy"}, "Coral Reef Health": {"concepts": "foreign investments, bureaucratic, bureaucracy", "concept_list": ["foreign investments", "bureaucratic", "bureaucracy"], "type": "cluster", "node_size": 24, "label": "Coral Reef Health"}, "Decision Implementation": {"concepts": "decision making, data reporting, decision-makers, implementation, oversight board, monitoring", "concept_list": ["decision making", "data reporting", "decision-makers", "implementation", "oversight board", "monitoring"], "type": "cluster", "node_size": 33, "label": "Decision Implementation"}, "Enforcement Issues": {"concepts": "enforcement lack, enforcement, system violation, enforcement officers, lack of enforcement", "concept_list": ["enforcement lack", "enforcement", "system violation", "enforcement officers", "lack of enforcement"], "type": "cluster", "node_size": 30, "label": "Enforcement Issues"}, "Vieques Grouper": {"concepts": "nassau grouper, vieques island, puerto rico", "concept_list": ["nassau grouper", "vieques island", "puerto rico"], "type": "cluster", "node_size": 24, "label": "Vieques Grouper"}, "Community Resource Management": {"concepts": "community action, best available science, researchers, stakeholder, stakeholder involvement, trust, cultural issues, community dependency, regulations, distrust, perspectives, livelihood dependency, environmental concerns, lack of awareness, livelihood, resource dependency, community problems, arguments, conflict resolution, communication lack, diving practices", "concept_list": ["community action", "best available science", "researchers", "stakeholder", "stakeholder involvement", "trust", "cultural issues", "community dependency", "regulations", "distrust", "perspectives", "livelihood dependency", "environmental concerns", "lack of awareness", "livelihood", "resource dependency", "community problems", "arguments", "conflict resolution", "communication lack", "diving practices"], "type": "cluster", "node_size": 78, "label": "Community Resource Management"}, "Diving Safety": {"concepts": "management actions, decompression sickness", "concept_list": ["management actions", "decompression sickness"], "type": "cluster", "node_size": 21, "label": "Diving Safety"}, "Coastal Vulnerability": {"concepts": "coastal communities, coastal defenses, coastal erosion, water surges", "concept_list": ["coastal communities", "coastal defenses", "coastal erosion", "water surges"], "type": "cluster", "node_size": 27, "label": "Coastal Vulnerability"}, "Climate Change PR": {"concepts": "climate change, pr climate change council", "concept_list": ["climate change", "pr climate change council"], "type": "cluster", "node_size": 21, "label": "Climate Change PR"}, "Aquatic Environment Changes": {"concepts": "spawning periods, acidification, water temperatures, water temperature, sea level", "concept_list": ["spawning periods", "acidification", "water temperatures", "water temperature", "sea level"], "type": "cluster", "node_size": 30, "label": "Aquatic Environment Changes"}, "Environmental Degradation": {"concepts": "coast erosion, land pollution", "concept_list": ["coast erosion", "land pollution"], "type": "cluster", "node_size": 21, "label": "Environmental Degradation"}, "Education & Learning": {"concepts": "formal education, education program, intergenerational learning, education", "concept_list": ["formal education", "education program", "intergenerational learning", "education"], "type": "cluster", "node_size": 27, "label": "Education & Learning"}, "Education Access": {"concepts": "education problem, lack of education", "concept_list": ["education problem", "lack of education"], "type": "cluster", "node_size": 21, "label": "Education Access"}, "Fisher Community": {"concepts": "fishers, fishermen collaboration, fishers' health, commercial fishermen, recreational fishermen, fishing communities, fishermen concerns, fisher conflicts, fisher's forums, commercial fishers, recreational sector, fisher education", "concept_list": ["fishers", "fishermen collaboration", "fishers' health", "commercial fishermen", "recreational fishermen", "fishing communities", "fishermen concerns", "fisher conflicts", "fisher's forums", "commercial fishers", "recreational sector", "fisher education"], "type": "cluster", "node_size": 51, "label": "Fisher Community"}, "Marine Sustainability": {"concepts": "marine conservation, fisheries, sustainable fishery, marine resources protection, fishery ecosystem plan, sustainable fishing, marine resources, natural resources", "concept_list": ["marine conservation", "fisheries", "sustainable fishery", "marine resources protection", "fishery ecosystem plan", "sustainable fishing", "marine resources", "natural resources"], "type": "cluster", "node_size": 39, "label": "Marine Sustainability"}, "Illegal Fishing": {"concepts": "fishery managers, illegal fishing", "concept_list": ["fishery managers", "illegal fishing"], "type": "cluster", "node_size": 21, "label": "Illegal Fishing"}, "Habitat Management": {"concepts": "fishery management, loss of habitat", "concept_list": ["fishery management", "loss of habitat"], "type": "cluster", "node_size": 21, "label": "Habitat Management"}};
        const conceptData = {};
        const interClusterEdges = [["fiscal crisis", "Enforcement Issues", {"weight": 1.0, "confidence": 0.62, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Decision Implementation", {"weight": -1.0, "confidence": 0.48, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Community Resource Management", {"weight": -1.0, "confidence": 0.43333333333333335, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Education Access", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Marine Sustainability", {"weight": -1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Public Policy", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["fiscal crisis", "Diving Safety", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["job opportunities", "Government Perspective", {"weight": 1.0, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Government Involvement", "Environmental Degradation", {"weight": 0.3333333333333333, "confidence": 0.4333333333333333, "type": "inter_cluster", "style": "solid"}], ["Government Involvement", "Public Policy", {"weight": 0.6, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Government Perspective", "Enforcement Issues", {"weight": -0.3333333333333333, "confidence": 0.4833333333333334, "type": "inter_cluster", "style": "solid"}], ["Government Perspective", "Diving Safety", {"weight": 0.8, "confidence": 0.24, "type": "inter_cluster", "style": "solid"}], ["Government Perspective", "Public Policy", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Public Policy", "Climate Change PR", {"weight": 1.0, "confidence": 0.47500000000000003, "type": "inter_cluster", "style": "solid"}], ["Public Policy", "Habitat Management", {"weight": 1.0, "confidence": 0.30000000000000004, "type": "inter_cluster", "style": "solid"}], ["Coral Reef Health", "Community Resource Management", {"weight": -1.0, "confidence": 0.4375, "type": "inter_cluster", "style": "solid"}], ["Enforcement Issues", "Illegal Fishing", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Enforcement Issues", "Decision Implementation", {"weight": -1.0, "confidence": 0.43333333333333335, "type": "inter_cluster", "style": "solid"}], ["Vieques Grouper", "Marine Sustainability", {"weight": 1.0, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Vieques Grouper", "Government Perspective", {"weight": 0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Vieques Grouper", "Diving Safety", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Resource Management", "Education Access", {"weight": -1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Community Resource Management", "Fisher Community", {"weight": 1.0, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Community Resource Management", "Decision Implementation", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Community Resource Management", "Government Involvement", {"weight": 1.0, "confidence": 0.3625, "type": "inter_cluster", "style": "solid"}], ["Diving Safety", "job opportunities", {"weight": -0.6, "confidence": 0.18000000000000002, "type": "inter_cluster", "style": "solid"}], ["Diving Safety", "Government Perspective", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Diving Safety", "Community Resource Management", {"weight": -0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Diving Safety", "Illegal Fishing", {"weight": -0.3333333333333333, "confidence": 0.09999999999999999, "type": "inter_cluster", "style": "solid"}], ["Coastal Vulnerability", "Government Involvement", {"weight": -1.0, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Coastal Vulnerability", "Habitat Management", {"weight": 0.75, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Aquatic Environment Changes", "Foreign Bureaucracy", {"weight": 1.0, "confidence": 0.27499999999999997, "type": "inter_cluster", "style": "solid"}], ["Aquatic Environment Changes", "Public Policy", {"weight": 1.0, "confidence": 0.30000000000000004, "type": "inter_cluster", "style": "solid"}], ["Environmental Degradation", "Government Involvement", {"weight": -0.6, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Environmental Degradation", "Vieques Grouper", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Environmental Degradation", "Fisher Community", {"weight": -1.0, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Education & Learning", "Coastal Vulnerability", {"weight": 0.2, "confidence": 0.16, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Community Resource Management", {"weight": -1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Government Perspective", {"weight": -1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Environmental Degradation", {"weight": 0.75, "confidence": 0.42500000000000004, "type": "inter_cluster", "style": "solid"}], ["Fisher Community", "Foreign Bureaucracy", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Fisher Community", "Coastal Vulnerability", {"weight": -0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Fisher Community", "Diving Safety", {"weight": 1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Fisher Community", "Illegal Fishing", {"weight": 0.5, "confidence": 0.175, "type": "inter_cluster", "style": "solid"}], ["Fisher Community", "Coral Reef Health", {"weight": -1.0, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Marine Sustainability", "Education & Learning", {"weight": 1.0, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Marine Sustainability", "Foreign Bureaucracy", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Illegal Fishing", "Enforcement Issues", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Illegal Fishing", "Marine Sustainability", {"weight": -1.0, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Illegal Fishing", "job opportunities", {"weight": -0.5, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Habitat Management", "Government Perspective", {"weight": 1.0, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Government Involvement": [], "Government Perspective": [], "Public Policy": [], "Foreign Bureaucracy": [], "Coral Reef Health": [], "Decision Implementation": [], "Enforcement Issues": [], "Vieques Grouper": [], "Community Resource Management": [], "Diving Safety": [], "Coastal Vulnerability": [], "Climate Change PR": [], "Aquatic Environment Changes": [], "Environmental Degradation": [], "Education & Learning": [], "Education Access": [], "Fisher Community": [], "Marine Sustainability": [], "Illegal Fishing": [], "Habitat Management": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
