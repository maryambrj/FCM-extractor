
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"abandoned houses": {"concepts": "abandoned houses", "concept_list": ["abandoned houses"], "type": "cluster", "node_size": 18, "label": "abandoned houses"}, "Food Access": {"concepts": "food system improvement, food insecurity, cooking demonstrations, vegetable demand, food variety, food preparation, food preferences, local food systems, healthy foods, food system, food quality, food assistance, dietary needs, food desert, cooking classes, cooking samples, cultural foods, food production, supplemental nutrition programs, food availability, free vegetables, food system sectors, nutrition, food system values, nutritious food, vegetable distribution, food security, nutrition knowledge, vegetable education, nutrition education, food affordability, corn meal, fast food, food equity, food distribution, food access", "concept_list": ["food system improvement", "food insecurity", "cooking demonstrations", "vegetable demand", "food variety", "food preparation", "food preferences", "local food systems", "healthy foods", "food system", "food quality", "food assistance", "dietary needs", "food desert", "cooking classes", "cooking samples", "cultural foods", "food production", "supplemental nutrition programs", "food availability", "free vegetables", "food system sectors", "nutrition", "food system values", "nutritious food", "vegetable distribution", "food security", "nutrition knowledge", "vegetable education", "nutrition education", "food affordability", "corn meal", "fast food", "food equity", "food distribution", "food access"], "type": "cluster", "node_size": 123, "label": "Food Access"}, "Resource Availability": {"concepts": "hurley hospital, resources, financial resources, public health, board, vendors, transportation, affordability, local vendors, south end, neighborhood, resource access, educational piece, resource availability, covid-19, north end, project goals, programs, technical advice, program development, edible flint, vaccine hesitancy, full time, demand, recipes, comfort level, service capacity, availability, local residents, population segment, clients, budget, help-seeking, expertise, flint, hiring practices, outdoor classroom, professional class, distance, chemical dependency, employment, resource allocation, population clusters, outcomes, accessibility, part time, supplemental sector, education, leverage points, coach, partnership, residents, skill development", "concept_list": ["hurley hospital", "resources", "financial resources", "public health", "board", "vendors", "transportation", "affordability", "local vendors", "south end", "neighborhood", "resource access", "educational piece", "resource availability", "covid-19", "north end", "project goals", "programs", "technical advice", "program development", "edible flint", "vaccine hesitancy", "full time", "demand", "recipes", "comfort level", "service capacity", "availability", "local residents", "population segment", "clients", "budget", "help-seeking", "expertise", "flint", "hiring practices", "outdoor classroom", "professional class", "distance", "chemical dependency", "employment", "resource allocation", "population clusters", "outcomes", "accessibility", "part time", "supplemental sector", "education", "leverage points", "coach", "partnership", "residents", "skill development"], "type": "cluster", "node_size": 174, "label": "Resource Availability"}, "Social Connections": {"concepts": "social influence, cultural connection, resilience, social determinants, social relationships, social connection, social inclusion, social experience, social support", "concept_list": ["social influence", "cultural connection", "resilience", "social determinants", "social relationships", "social connection", "social inclusion", "social experience", "social support"], "type": "cluster", "node_size": 42, "label": "Social Connections"}, "Community Engagement": {"concepts": "sense of belonging, neighborhood support, community benefit, neighborhood engagement hub, neighborhood engagement, quality of life", "concept_list": ["sense of belonging", "neighborhood support", "community benefit", "neighborhood engagement hub", "neighborhood engagement", "quality of life"], "type": "cluster", "node_size": 33, "label": "Community Engagement"}, "Organizational Trust": {"concepts": "trust building, organizational partners, organizational trust, organizational relationships, organizational outreach, organizational engagement, organizational disconnect, organizational support, mistrust, organizational influence, established organizations", "concept_list": ["trust building", "organizational partners", "organizational trust", "organizational relationships", "organizational outreach", "organizational engagement", "organizational disconnect", "organizational support", "mistrust", "organizational influence", "established organizations"], "type": "cluster", "node_size": 48, "label": "Organizational Trust"}, "Herb Gardening": {"concepts": "herb garden, gardening, organic gardening", "concept_list": ["herb garden", "gardening", "organic gardening"], "type": "cluster", "node_size": 24, "label": "Herb Gardening"}, "Community Gardening": {"concepts": "neighborhood garden, community gardens, community garden, urban gardening", "concept_list": ["neighborhood garden", "community gardens", "community garden", "urban gardening"], "type": "cluster", "node_size": 27, "label": "Community Gardening"}, "Farm Operations": {"concepts": "farm location, plot of land, farm expansion, farm management", "concept_list": ["farm location", "plot of land", "farm expansion", "farm management"], "type": "cluster", "node_size": 27, "label": "Farm Operations"}, "Collaborative Farming": {"concepts": "collaborative farming, farmers, agricultural support, community farm", "concept_list": ["collaborative farming", "farmers", "agricultural support", "community farm"], "type": "cluster", "node_size": 27, "label": "Collaborative Farming"}, "Agricultural Education": {"concepts": "agricultural education, crop selection, local agriculture", "concept_list": ["agricultural education", "crop selection", "local agriculture"], "type": "cluster", "node_size": 24, "label": "Agricultural Education"}, "Farmers Markets": {"concepts": "farmers market, farmers markets", "concept_list": ["farmers market", "farmers markets"], "type": "cluster", "node_size": 21, "label": "Farmers Markets"}, "Retail Types": {"concepts": "retail use, retail types", "concept_list": ["retail use", "retail types"], "type": "cluster", "node_size": 21, "label": "Retail Types"}, "Restaurant Options": {"concepts": "chain restaurants, local restaurants, restaurant experience", "concept_list": ["chain restaurants", "local restaurants", "restaurant experience"], "type": "cluster", "node_size": 24, "label": "Restaurant Options"}, "Grocery Access": {"concepts": "grocery store closure, convenience stores, grocery stores", "concept_list": ["grocery store closure", "convenience stores", "grocery stores"], "type": "cluster", "node_size": 24, "label": "Grocery Access"}, "Racial Inequality": {"concepts": "race dynamics, low income, black communities, brown communities", "concept_list": ["race dynamics", "low income", "black communities", "brown communities"], "type": "cluster", "node_size": 27, "label": "Racial Inequality"}, "Urban Agriculture": {"concepts": "sustainability, gardening initiatives, urban farming, urban agriculture", "concept_list": ["sustainability", "gardening initiatives", "urban farming", "urban agriculture"], "type": "cluster", "node_size": 27, "label": "Urban Agriculture"}, "Community Outreach": {"concepts": "outreach, outreach programs, health benefits, land access, land donation", "concept_list": ["outreach", "outreach programs", "health benefits", "land access", "land donation"], "type": "cluster", "node_size": 30, "label": "Community Outreach"}};
        const conceptData = {};
        const interClusterEdges = [["abandoned houses", "Urban Agriculture", {"weight": -0.6, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Farm Operations", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Collaborative Farming", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Outreach", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Resource Availability", "Racial Inequality", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Resource Availability", "abandoned houses", {"weight": -0.5, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Resource Availability", "Organizational Trust", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Resource Availability", "Grocery Access", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Social Connections", "Community Gardening", {"weight": 1.0, "confidence": 0.8099999999999999, "type": "inter_cluster", "style": "solid"}], ["Social Connections", "Herb Gardening", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Social Connections", "abandoned houses", {"weight": -1.0, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Community Gardening", {"weight": 1.0, "confidence": 0.8125, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "abandoned houses", {"weight": -1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Agricultural Education", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Organizational Trust", "Farm Operations", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Organizational Trust", "Resource Availability", {"weight": 0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Herb Gardening", "Urban Agriculture", {"weight": 0.8, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Herb Gardening", "Community Engagement", {"weight": 1.0, "confidence": 0.8375000000000001, "type": "inter_cluster", "style": "solid"}], ["Herb Gardening", "Farm Operations", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Herb Gardening", "Organizational Trust", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "Food Access", {"weight": 1.0, "confidence": 0.9374999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "abandoned houses", {"weight": -0.6, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "Agricultural Education", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Farm Operations", "Community Engagement", {"weight": 1.0, "confidence": 0.7700000000000001, "type": "inter_cluster", "style": "solid"}], ["Farm Operations", "Herb Gardening", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Farm Operations", "Racial Inequality", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Collaborative Farming", "Social Connections", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Collaborative Farming", "Community Gardening", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Collaborative Farming", "Community Outreach", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Collaborative Farming", "Organizational Trust", {"weight": 0.6666666666666666, "confidence": 0.5166666666666667, "type": "inter_cluster", "style": "solid"}], ["Agricultural Education", "Community Outreach", {"weight": 1.0, "confidence": 0.6874999999999999, "type": "inter_cluster", "style": "solid"}], ["Agricultural Education", "Racial Inequality", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Agricultural Education", "Restaurant Options", {"weight": -0.25, "confidence": 0.47500000000000003, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Food Access", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Herb Gardening", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Social Connections", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Collaborative Farming", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Retail Types", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Retail Types", "Farmers Markets", {"weight": 1.0, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Retail Types", "Social Connections", {"weight": 0.75, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Retail Types", "Grocery Access", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Retail Types", "Organizational Trust", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Restaurant Options", "Social Connections", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Restaurant Options", "Racial Inequality", {"weight": 0.8, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Restaurant Options", "Farmers Markets", {"weight": -0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Restaurant Options", "Organizational Trust", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Restaurant Options", "Urban Agriculture", {"weight": -0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Grocery Access", "abandoned houses", {"weight": 0.8, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Grocery Access", "Collaborative Farming", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Racial Inequality", "Community Engagement", {"weight": -0.3333333333333333, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["Racial Inequality", "Restaurant Options", {"weight": 0.6666666666666666, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Racial Inequality", "Community Outreach", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Racial Inequality", "Grocery Access", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Food Access", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Urban Agriculture", "Farm Operations", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Community Outreach", "Farm Operations", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access": [], "Resource Availability": [], "Social Connections": [], "Community Engagement": [], "Organizational Trust": [], "Herb Gardening": [], "Community Gardening": [], "Farm Operations": [], "Collaborative Farming": [], "Agricultural Education": [], "Farmers Markets": [], "Retail Types": [], "Restaurant Options": [], "Grocery Access": [], "Racial Inequality": [], "Urban Agriculture": [], "Community Outreach": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
