
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"food preservation": {"concepts": "food preservation", "concept_list": ["food preservation"], "type": "cluster", "node_size": 18, "label": "food preservation"}, "food system preservatives": {"concepts": "food system preservatives", "concept_list": ["food system preservatives"], "type": "cluster", "node_size": 18, "label": "food system preservatives"}, "supplemental nutrition programs": {"concepts": "supplemental nutrition programs", "concept_list": ["supplemental nutrition programs"], "type": "cluster", "node_size": 18, "label": "supplemental nutrition programs"}, "food empowerment": {"concepts": "food empowerment", "concept_list": ["food empowerment"], "type": "cluster", "node_size": 18, "label": "food empowerment"}, "Single Parenthood": {"concepts": "food purchasing, food shopping", "concept_list": ["food purchasing", "food shopping"], "type": "cluster", "node_size": 21, "label": "Single Parenthood"}, "Food Access": {"concepts": "single parenting, single parenthood, dignity", "concept_list": ["single parenting", "single parenthood", "dignity"], "type": "cluster", "node_size": 24, "label": "Food Access"}, "Food System Challenges": {"concepts": "food system access, unhealthy food, food choices, food affordability, food quantity, food system grocery, food distribution, food habits, food access, food consumption, food options, food values, food availability, food system affordability, food system availability", "concept_list": ["food system access", "unhealthy food", "food choices", "food affordability", "food quantity", "food system grocery", "food distribution", "food habits", "food access", "food consumption", "food options", "food values", "food availability", "food system affordability", "food system availability"], "type": "cluster", "node_size": 60, "label": "Food System Challenges"}, "Resource Access": {"concepts": "food health, school, food sector, farmers markets, raw milk, food system communication, food marketing, communication, resident needs, food creativity, juices, bulk buying, food purchasing power, gay rights, consumer level, food benefits, consumer choices, food system convenience, intergenerational perspective, police department, resident priorities, food system portion size, food system safety, social disparity, buy nothing, food insecurity, stability, double up food bucks, food security, trust building, collaboration, mutual aid, profit generation, creativity, partnerships, food retail, cultural factors, food safety, food deserts, trust issues, canning equipment, food system creativity, social stigma, women's rights, canning, food system empowerment, food supplements, cultural values, housing safety, neighborhood engagement, bereavement, distrust, organizations, meat, food career development, pop tarts, food system supplemental programs, junk food, stakeholder mapping, food leadership, market increases, cooking, caseworker, food system improvement, food sectors, social trust, caregiving, neighborhood interaction, medical assistance, stigma reduction, purchasing power, bereavement support, food preparation, food system snap, youth engagement, family support, food quality, resilience, program eligibility, food storage, snap, trust, profit models, career development, food system double up food bucks, food programs, informed choices, food assistance, vandalism prevention, civil rights, food system farmers market, stigma, food swaps, cultural relevance", "concept_list": ["food health", "school", "food sector", "farmers markets", "raw milk", "food system communication", "food marketing", "communication", "resident needs", "food creativity", "juices", "bulk buying", "food purchasing power", "gay rights", "consumer level", "food benefits", "consumer choices", "food system convenience", "intergenerational perspective", "police department", "resident priorities", "food system portion size", "food system safety", "social disparity", "buy nothing", "food insecurity", "stability", "double up food bucks", "food security", "trust building", "collaboration", "mutual aid", "profit generation", "creativity", "partnerships", "food retail", "cultural factors", "food safety", "food deserts", "trust issues", "canning equipment", "food system creativity", "social stigma", "women's rights", "canning", "food system empowerment", "food supplements", "cultural values", "housing safety", "neighborhood engagement", "bereavement", "distrust", "organizations", "meat", "food career development", "pop tarts", "food system supplemental programs", "junk food", "stakeholder mapping", "food leadership", "market increases", "cooking", "caseworker", "food system improvement", "food sectors", "social trust", "caregiving", "neighborhood interaction", "medical assistance", "stigma reduction", "purchasing power", "bereavement support", "food preparation", "food system snap", "youth engagement", "family support", "food quality", "resilience", "program eligibility", "food storage", "snap", "trust", "profit models", "career development", "food system double up food bucks", "food programs", "informed choices", "food assistance", "vandalism prevention", "civil rights", "food system farmers market", "stigma", "food swaps", "cultural relevance"], "type": "cluster", "node_size": 297, "label": "Resource Access"}, "Food Shopping": {"concepts": "studies, self-sufficiency, resource sharing, portion size, phd student, hand up approach, skill transfer, systemic change, social psychology, local produce, eligibility requirements, resource accessibility, research continuity, supplemental programs, resource access, residents, family, psychology, fruit, covid-19, availability, systemic problems, income, canning classes, virus, recipe knowledge, attention span, flu, cooking classes, social judgment, complacency, common good, ciders, recipes, judgment, culture, time constraints, bias, negative feedback, pamphlets, covid-19 impacts, canning skills, candy counter, convenience, employment, layout, produce, disparity, respect, resources, universities, recipe, problem solving, affordability, comfort, mobility limitations, support, wic, flint, physical presence, free produce, supplemental sector, demographics, classes", "concept_list": ["studies", "self-sufficiency", "resource sharing", "portion size", "phd student", "hand up approach", "skill transfer", "systemic change", "social psychology", "local produce", "eligibility requirements", "resource accessibility", "research continuity", "supplemental programs", "resource access", "residents", "family", "psychology", "fruit", "covid-19", "availability", "systemic problems", "income", "canning classes", "virus", "recipe knowledge", "attention span", "flu", "cooking classes", "social judgment", "complacency", "common good", "ciders", "recipes", "judgment", "culture", "time constraints", "bias", "negative feedback", "pamphlets", "covid-19 impacts", "canning skills", "candy counter", "convenience", "employment", "layout", "produce", "disparity", "respect", "resources", "universities", "recipe", "problem solving", "affordability", "comfort", "mobility limitations", "support", "wic", "flint", "physical presence", "free produce", "supplemental sector", "demographics", "classes"], "type": "cluster", "node_size": 207, "label": "Food Shopping"}, "Food Culture": {"concepts": "food portion, food communication, food labeling, ethnic foods, staple foods, food, food comfort, food system comfort, food cultural values, field vegetables, nutritious food, food sources, dietary staples, food labels, fast food, food culture, vegetables, nutritious foods", "concept_list": ["food portion", "food communication", "food labeling", "ethnic foods", "staple foods", "food", "food comfort", "food system comfort", "food cultural values", "field vegetables", "nutritious food", "food sources", "dietary staples", "food labels", "fast food", "food culture", "vegetables", "nutritious foods"], "type": "cluster", "node_size": 69, "label": "Food Culture"}, "Political Leadership": {"concepts": "political system, presidential administration, leadership, politics", "concept_list": ["political system", "presidential administration", "leadership", "politics"], "type": "cluster", "node_size": 27, "label": "Political Leadership"}, "Crisis Events": {"concepts": "crisis response, war impact, pandemic, pandemic impact", "concept_list": ["crisis response", "war impact", "pandemic", "pandemic impact"], "type": "cluster", "node_size": 27, "label": "Crisis Events"}, "Advocacy & Activism": {"concepts": "advocacy movements, political stress", "concept_list": ["advocacy movements", "political stress"], "type": "cluster", "node_size": 21, "label": "Advocacy & Activism"}, "Community Engagement": {"concepts": "community activity, collective action, community members, volunteerism, community organizations, community programs", "concept_list": ["community activity", "collective action", "community members", "volunteerism", "community organizations", "community programs"], "type": "cluster", "node_size": 33, "label": "Community Engagement"}, "Community Support": {"concepts": "community protection, social services, community resilience, community support", "concept_list": ["community protection", "social services", "community resilience", "community support"], "type": "cluster", "node_size": 27, "label": "Community Support"}, "Community Empowerment": {"concepts": "community empowerment, empowerment, community mindset", "concept_list": ["community empowerment", "empowerment", "community mindset"], "type": "cluster", "node_size": 24, "label": "Community Empowerment"}, "Faith and Education": {"concepts": "churches, community education", "concept_list": ["churches", "community education"], "type": "cluster", "node_size": 21, "label": "Faith and Education"}, "Food Outlets": {"concepts": "chain restaurants, grocery stores, convenience stores, local restaurants, shopping skills, store layout", "concept_list": ["chain restaurants", "grocery stores", "convenience stores", "local restaurants", "shopping skills", "store layout"], "type": "cluster", "node_size": 33, "label": "Food Outlets"}, "Retail Sector": {"concepts": "retail, retail sector, food system retail", "concept_list": ["retail", "retail sector", "food system retail"], "type": "cluster", "node_size": 24, "label": "Retail Sector"}, "Funding Sources": {"concepts": "funding mechanisms, government funding, funding", "concept_list": ["funding mechanisms", "government funding", "funding"], "type": "cluster", "node_size": 24, "label": "Funding Sources"}, "Financial Instability": {"concepts": "financial hardship, financial instability", "concept_list": ["financial hardship", "financial instability"], "type": "cluster", "node_size": 21, "label": "Financial Instability"}, "Retail Leverage Points": {"concepts": "leverage points, cash register", "concept_list": ["leverage points", "cash register"], "type": "cluster", "node_size": 21, "label": "Retail Leverage Points"}, "Food Additives": {"concepts": "food system additives, food additives, additives", "concept_list": ["food system additives", "food additives", "additives"], "type": "cluster", "node_size": 24, "label": "Food Additives"}, "Food Preservatives": {"concepts": "food preservatives, preservatives", "concept_list": ["food preservatives", "preservatives"], "type": "cluster", "node_size": 21, "label": "Food Preservatives"}, "Community Stability": {"concepts": "community dynamics, community stability, microcommunity impact", "concept_list": ["community dynamics", "community stability", "microcommunity impact"], "type": "cluster", "node_size": 24, "label": "Community Stability"}, "Social Cohesion": {"concepts": "community cohesion, community values, social cohesion", "concept_list": ["community cohesion", "community values", "social cohesion"], "type": "cluster", "node_size": 24, "label": "Social Cohesion"}, "Social Networks": {"concepts": "social connections, social networks, community connections, neighborhood connections, community networks", "concept_list": ["social connections", "social networks", "community connections", "neighborhood connections", "community networks"], "type": "cluster", "node_size": 30, "label": "Social Networks"}, "Social Support": {"concepts": "connection strengths, support networks", "concept_list": ["connection strengths", "support networks"], "type": "cluster", "node_size": 21, "label": "Social Support"}, "Health Issues": {"concepts": "illness, health complaints, chronic illness, health challenges", "concept_list": ["illness", "health complaints", "chronic illness", "health challenges"], "type": "cluster", "node_size": 27, "label": "Health Issues"}, "Health Outcomes Access": {"concepts": "public health, health care access, health outcomes, medical outcomes, health", "concept_list": ["public health", "health care access", "health outcomes", "medical outcomes", "health"], "type": "cluster", "node_size": 30, "label": "Health Outcomes Access"}, "Emergency Safety Quality": {"concepts": "safety, quality of life, emergency sector", "concept_list": ["safety", "quality of life", "emergency sector"], "type": "cluster", "node_size": 24, "label": "Emergency Safety Quality"}, "Health Inequities": {"concepts": "health barriers, health disparities", "concept_list": ["health barriers", "health disparities"], "type": "cluster", "node_size": 21, "label": "Health Inequities"}, "Nutritional Content": {"concepts": "food system nutritional content, nutritional content", "concept_list": ["food system nutritional content", "nutritional content"], "type": "cluster", "node_size": 21, "label": "Nutritional Content"}, "Food Nutrition": {"concepts": "nutrition, food nutrition", "concept_list": ["nutrition", "food nutrition"], "type": "cluster", "node_size": 21, "label": "Food Nutrition"}, "Food Trust": {"concepts": "food system trust, food trust", "concept_list": ["food system trust", "food trust"], "type": "cluster", "node_size": 21, "label": "Food Trust"}, "Food Dignity": {"concepts": "food dignity, food system dignity, food respect, food system respect", "concept_list": ["food dignity", "food system dignity", "food respect", "food system respect"], "type": "cluster", "node_size": 27, "label": "Food Dignity"}, "Food Support": {"concepts": "food support, food system support, food system wic, food system", "concept_list": ["food support", "food system support", "food system wic", "food system"], "type": "cluster", "node_size": 27, "label": "Food Support"}, "Food Problem Solving": {"concepts": "food system problem solving, food problem solving", "concept_list": ["food system problem solving", "food problem solving"], "type": "cluster", "node_size": 21, "label": "Food Problem Solving"}, "Food System Education": {"concepts": "nutrition education, food education, food system education", "concept_list": ["nutrition education", "food education", "food system education"], "type": "cluster", "node_size": 24, "label": "Food System Education"}, "Food Literacy Skills": {"concepts": "food literacy, food skills", "concept_list": ["food literacy", "food skills"], "type": "cluster", "node_size": 21, "label": "Food Literacy Skills"}, "Food System Economics": {"concepts": "food cost, food system values, produce sourcing, food policy, food system mapping, food income, food surplus, food system quality, food economic development, food system price, food system quantity, food sovereignty, food system options, food system health, food system map, farm produce, food system produce, food price, food budgeting, resident incomes, household stability, local economic development, welfare system, poverty, social capital, social progress, tax policy, tax dollars, urban agriculture, clean water access, sustainable resources, poverty threshold, economic resources, water crisis, economic development, gifting economy, household costs, income generation, poverty level", "concept_list": ["food cost", "food system values", "produce sourcing", "food policy", "food system mapping", "food income", "food surplus", "food system quality", "food economic development", "food system price", "food system quantity", "food sovereignty", "food system options", "food system health", "food system map", "farm produce", "food system produce", "food price", "food budgeting", "resident incomes", "household stability", "local economic development", "welfare system", "poverty", "social capital", "social progress", "tax policy", "tax dollars", "urban agriculture", "clean water access", "sustainable resources", "poverty threshold", "economic resources", "water crisis", "economic development", "gifting economy", "household costs", "income generation", "poverty level"], "type": "cluster", "node_size": 132, "label": "Food System Economics"}, "Education Access": {"concepts": "medical education, lack of education, education, high school education, education access, peer support, educational resources, peer education", "concept_list": ["medical education", "lack of education", "education", "high school education", "education access", "peer support", "educational resources", "peer education"], "type": "cluster", "node_size": 39, "label": "Education Access"}, "Food System Collaboration": {"concepts": "food system partnerships, food community, food system stakeholders, food system collaboration, food system organizations, food system leadership, food system residents, food collaboration, food partnerships, food system community", "concept_list": ["food system partnerships", "food community", "food system stakeholders", "food system collaboration", "food system organizations", "food system leadership", "food system residents", "food collaboration", "food partnerships", "food system community"], "type": "cluster", "node_size": 45, "label": "Food System Collaboration"}, "Group Dynamics": {"concepts": "online gifting groups, group formation, group stability, online groups, focus groups, social groups, group relations", "concept_list": ["online gifting groups", "group formation", "group stability", "online groups", "focus groups", "social groups", "group relations"], "type": "cluster", "node_size": 36, "label": "Group Dynamics"}, "Community Gardening": {"concepts": "gardening, community gardeners, community gardens, neighborhood gardens, park maintenance, victory gardens", "concept_list": ["gardening", "community gardeners", "community gardens", "neighborhood gardens", "park maintenance", "victory gardens"], "type": "cluster", "node_size": 33, "label": "Community Gardening"}};
        const conceptData = {};
        const interClusterEdges = [["food preservation", "Community Engagement", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["food preservation", "Social Networks", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["food system preservatives", "Food System Challenges", {"weight": -1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["food system preservatives", "supplemental nutrition programs", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["food system preservatives", "Food Shopping", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["food empowerment", "Food Trust", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Single Parenthood", "Community Support", {"weight": 0.75, "confidence": 0.4625, "type": "inter_cluster", "style": "solid"}], ["Single Parenthood", "Health Inequities", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Food Access", "supplemental nutrition programs", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food System Challenges", "Food System Economics", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Resource Access", "Social Cohesion", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Resource Access", "food empowerment", {"weight": 0.5, "confidence": 0.425, "type": "inter_cluster", "style": "solid"}], ["Food Shopping", "supplemental nutrition programs", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Culture", "Health Issues", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Food Culture", "Social Cohesion", {"weight": 0.6666666666666666, "confidence": 0.5166666666666666, "type": "inter_cluster", "style": "solid"}], ["Food Culture", "Food Literacy Skills", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Culture", "Retail Sector", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Food Culture", "Food Access", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Political Leadership", "Community Stability", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Political Leadership", "Food System Education", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Political Leadership", "Food System Challenges", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Advocacy & Activism", "Food System Challenges", {"weight": -1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Resource Access", {"weight": 0.8, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Food System Economics", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Community Empowerment", "Food Culture", {"weight": 0.6666666666666666, "confidence": 0.5166666666666667, "type": "inter_cluster", "style": "solid"}], ["Faith and Education", "Food Nutrition", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Faith and Education", "Community Stability", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Faith and Education", "Retail Sector", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Outlets", "Funding Sources", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Outlets", "Faith and Education", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Food System Collaboration", {"weight": 0.6666666666666666, "confidence": 0.4333333333333333, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Health Issues", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Group Dynamics", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Education Access", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Political Leadership", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Financial Instability", "Social Cohesion", {"weight": -0.75, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["Financial Instability", "Crisis Events", {"weight": 0.6666666666666666, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Financial Instability", "Food Additives", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Retail Leverage Points", "Food Culture", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Retail Leverage Points", "Advocacy & Activism", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Preservatives", "Food Additives", {"weight": 0.75, "confidence": 0.7124999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Preservatives", "Health Outcomes Access", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Social Cohesion", "Faith and Education", {"weight": 1.0, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}], ["Social Networks", "Retail Sector", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Social Networks", "Emergency Safety Quality", {"weight": 1.0, "confidence": 0.95, "type": "inter_cluster", "style": "solid"}], ["Social Support", "Food Shopping", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Social Support", "food preservation", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Health Issues", "Food Culture", {"weight": -0.6666666666666666, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Health Issues", "Food Additives", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Health Outcomes Access", "Crisis Events", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Emergency Safety Quality", "Political Leadership", {"weight": 0.6666666666666666, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Health Inequities", "Food System Economics", {"weight": -0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Health Inequities", "Food System Education", {"weight": -0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Health Inequities", "Food Literacy Skills", {"weight": -1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Food Nutrition", "Health Issues", {"weight": -1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Food Nutrition", "Group Dynamics", {"weight": 1.0, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food Trust", "Education Access", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Food Trust", "Food Culture", {"weight": 0.6666666666666666, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Food Trust", "Community Gardening", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Dignity", "Emergency Safety Quality", {"weight": 1.0, "confidence": 0.8200000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Dignity", "Advocacy & Activism", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Problem Solving", "Social Cohesion", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Food Problem Solving", "Health Inequities", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food System Education", "Group Dynamics", {"weight": 0.5, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Food System Education", "Food Dignity", {"weight": 0.6666666666666666, "confidence": 0.5666666666666667, "type": "inter_cluster", "style": "solid"}], ["Food System Education", "Resource Access", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Food System Education", "Community Engagement", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Food Literacy Skills", "Food Trust", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food System Collaboration", "Community Engagement", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Group Dynamics", "Nutritional Content", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "Food Additives", {"weight": -0.5, "confidence": 0.7250000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "food empowerment", {"weight": 1.0, "confidence": 0.95, "type": "inter_cluster", "style": "solid"}], ["Community Gardening", "Food Support", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Single Parenthood": [], "Food Access": [], "Food System Challenges": [], "Resource Access": [], "Food Shopping": [], "Food Culture": [], "Political Leadership": [], "Crisis Events": [], "Advocacy & Activism": [], "Community Engagement": [], "Community Support": [], "Community Empowerment": [], "Faith and Education": [], "Food Outlets": [], "Retail Sector": [], "Funding Sources": [], "Financial Instability": [], "Retail Leverage Points": [], "Food Additives": [], "Food Preservatives": [], "Community Stability": [], "Social Cohesion": [], "Social Networks": [], "Social Support": [], "Health Issues": [], "Health Outcomes Access": [], "Emergency Safety Quality": [], "Health Inequities": [], "Nutritional Content": [], "Food Nutrition": [], "Food Trust": [], "Food Dignity": [], "Food Support": [], "Food Problem Solving": [], "Food System Education": [], "Food Literacy Skills": [], "Food System Economics": [], "Education Access": [], "Food System Collaboration": [], "Group Dynamics": [], "Community Gardening": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
