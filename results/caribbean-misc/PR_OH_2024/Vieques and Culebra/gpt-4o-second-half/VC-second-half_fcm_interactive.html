
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"dock": {"concepts": "dock", "concept_list": ["dock"], "type": "cluster", "node_size": 18, "label": "dock"}, "stench": {"concepts": "stench", "concept_list": ["stench"], "type": "cluster", "node_size": 18, "label": "stench"}, "outdoor activities": {"concepts": "outdoor activities", "concept_list": ["outdoor activities"], "type": "cluster", "node_size": 18, "label": "outdoor activities"}, "artisanal fishing": {"concepts": "artisanal fishing", "concept_list": ["artisanal fishing"], "type": "cluster", "node_size": 18, "label": "artisanal fishing"}, "moorings": {"concepts": "moorings", "concept_list": ["moorings"], "type": "cluster", "node_size": 18, "label": "moorings"}, "constructions.": {"concepts": "constructions.", "concept_list": ["constructions."], "type": "cluster", "node_size": 18, "label": "constructions."}, "wooden houses": {"concepts": "wooden houses", "concept_list": ["wooden houses"], "type": "cluster", "node_size": 18, "label": "wooden houses"}, "guidance": {"concepts": "guidance", "concept_list": ["guidance"], "type": "cluster", "node_size": 18, "label": "guidance"}, "fishing bag": {"concepts": "fishing bag", "concept_list": ["fishing bag"], "type": "cluster", "node_size": 18, "label": "fishing bag"}, "sierra": {"concepts": "sierra", "concept_list": ["sierra"], "type": "cluster", "node_size": 18, "label": "sierra"}, "good boats": {"concepts": "good boats", "concept_list": ["good boats"], "type": "cluster", "node_size": 18, "label": "good boats"}, "ocean comfort": {"concepts": "ocean comfort", "concept_list": ["ocean comfort"], "type": "cluster", "node_size": 18, "label": "ocean comfort"}, "limitations": {"concepts": "limitations", "concept_list": ["limitations"], "type": "cluster", "node_size": 18, "label": "limitations"}, "canal de la reserva": {"concepts": "canal de la reserva", "concept_list": ["canal de la reserva"], "type": "cluster", "node_size": 18, "label": "canal de la reserva"}, "fishing expertise": {"concepts": "fishing expertise", "concept_list": ["fishing expertise"], "type": "cluster", "node_size": 18, "label": "fishing expertise"}, "military impacts": {"concepts": "military impacts", "concept_list": ["military impacts"], "type": "cluster", "node_size": 18, "label": "military impacts"}, "tentacles": {"concepts": "tentacles", "concept_list": ["tentacles"], "type": "cluster", "node_size": 18, "label": "tentacles"}, "sardines": {"concepts": "sardines", "concept_list": ["sardines"], "type": "cluster", "node_size": 18, "label": "sardines"}, "craftsmanship": {"concepts": "craftsmanship", "concept_list": ["craftsmanship"], "type": "cluster", "node_size": 18, "label": "craftsmanship"}, "expropriation": {"concepts": "expropriation", "concept_list": ["expropriation"], "type": "cluster", "node_size": 18, "label": "expropriation"}, "son": {"concepts": "son", "concept_list": ["son"], "type": "cluster", "node_size": 18, "label": "son"}, "erosion": {"concepts": "erosion", "concept_list": ["erosion"], "type": "cluster", "node_size": 18, "label": "erosion"}, "seabeds": {"concepts": "seabeds", "concept_list": ["seabeds"], "type": "cluster", "node_size": 18, "label": "seabeds"}, "educational": {"concepts": "educational", "concept_list": ["educational"], "type": "cluster", "node_size": 18, "label": "educational"}, "fishing outcomes": {"concepts": "fishing outcomes", "concept_list": ["fishing outcomes"], "type": "cluster", "node_size": 18, "label": "fishing outcomes"}, "fishing tools": {"concepts": "fishing tools", "concept_list": ["fishing tools"], "type": "cluster", "node_size": 18, "label": "fishing tools"}, "perseverance": {"concepts": "perseverance", "concept_list": ["perseverance"], "type": "cluster", "node_size": 18, "label": "perseverance"}, "redfish": {"concepts": "redfish", "concept_list": ["redfish"], "type": "cluster", "node_size": 18, "label": "redfish"}, "land plots": {"concepts": "land plots", "concept_list": ["land plots"], "type": "cluster", "node_size": 18, "label": "land plots"}, "pelagic species": {"concepts": "pelagic species", "concept_list": ["pelagic species"], "type": "cluster", "node_size": 18, "label": "pelagic species"}, "trawling": {"concepts": "trawling", "concept_list": ["trawling"], "type": "cluster", "node_size": 18, "label": "trawling"}, "survival": {"concepts": "survival", "concept_list": ["survival"], "type": "cluster", "node_size": 18, "label": "survival"}, "financial support": {"concepts": "financial support", "concept_list": ["financial support"], "type": "cluster", "node_size": 18, "label": "financial support"}, "fishing changes": {"concepts": "fishing changes", "concept_list": ["fishing changes"], "type": "cluster", "node_size": 18, "label": "fishing changes"}, "antennas": {"concepts": "antennas", "concept_list": ["antennas"], "type": "cluster", "node_size": 18, "label": "antennas"}, "tradition": {"concepts": "tradition", "concept_list": ["tradition"], "type": "cluster", "node_size": 18, "label": "tradition"}, "puerto rican meatpacking plants": {"concepts": "puerto rican meatpacking plants", "concept_list": ["puerto rican meatpacking plants"], "type": "cluster", "node_size": 18, "label": "puerto rican meatpacking plants"}, "stainless steel": {"concepts": "stainless steel", "concept_list": ["stainless steel"], "type": "cluster", "node_size": 18, "label": "stainless steel"}, "strombus gigas": {"concepts": "strombus gigas", "concept_list": ["strombus gigas"], "type": "cluster", "node_size": 18, "label": "strombus gigas"}, "weather": {"concepts": "weather", "concept_list": ["weather"], "type": "cluster", "node_size": 18, "label": "weather"}, "cayo norte": {"concepts": "cayo norte", "concept_list": ["cayo norte"], "type": "cluster", "node_size": 18, "label": "cayo norte"}, "pride and joy": {"concepts": "pride and joy", "concept_list": ["pride and joy"], "type": "cluster", "node_size": 18, "label": "pride and joy"}, "hurricane hugo": {"concepts": "hurricane hugo", "concept_list": ["hurricane hugo"], "type": "cluster", "node_size": 18, "label": "hurricane hugo"}, "coast": {"concepts": "coast", "concept_list": ["coast"], "type": "cluster", "node_size": 18, "label": "coast"}, "pollution impact": {"concepts": "pollution impact", "concept_list": ["pollution impact"], "type": "cluster", "node_size": 18, "label": "pollution impact"}, "hurricane irma": {"concepts": "hurricane irma", "concept_list": ["hurricane irma"], "type": "cluster", "node_size": 18, "label": "hurricane irma"}, "hunger": {"concepts": "hunger", "concept_list": ["hunger"], "type": "cluster", "node_size": 18, "label": "hunger"}, "concentration": {"concepts": "concentration", "concept_list": ["concentration"], "type": "cluster", "node_size": 18, "label": "concentration"}, "maritime-terrestrial zone": {"concepts": "maritime-terrestrial zone", "concept_list": ["maritime-terrestrial zone"], "type": "cluster", "node_size": 18, "label": "maritime-terrestrial zone"}, "local market": {"concepts": "local market", "concept_list": ["local market"], "type": "cluster", "node_size": 18, "label": "local market"}, "friends": {"concepts": "friends", "concept_list": ["friends"], "type": "cluster", "node_size": 18, "label": "friends"}, "human error": {"concepts": "human error", "concept_list": ["human error"], "type": "cluster", "node_size": 18, "label": "human error"}, "reserve": {"concepts": "reserve", "concept_list": ["reserve"], "type": "cluster", "node_size": 18, "label": "reserve"}, "security": {"concepts": "security", "concept_list": ["security"], "type": "cluster", "node_size": 18, "label": "security"}, "military pollution": {"concepts": "military pollution", "concept_list": ["military pollution"], "type": "cluster", "node_size": 18, "label": "military pollution"}, "agriculture analogy": {"concepts": "agriculture analogy", "concept_list": ["agriculture analogy"], "type": "cluster", "node_size": 18, "label": "agriculture analogy"}, "fisheries management": {"concepts": "fisheries management", "concept_list": ["fisheries management"], "type": "cluster", "node_size": 18, "label": "fisheries management"}, "fishing culture": {"concepts": "fishing culture", "concept_list": ["fishing culture"], "type": "cluster", "node_size": 18, "label": "fishing culture"}, "shore fishing": {"concepts": "shore fishing", "concept_list": ["shore fishing"], "type": "cluster", "node_size": 18, "label": "shore fishing"}, "power outage": {"concepts": "power outage", "concept_list": ["power outage"], "type": "cluster", "node_size": 18, "label": "power outage"}, "life": {"concepts": "life", "concept_list": ["life"], "type": "cluster", "node_size": 18, "label": "life"}, "lifestyle": {"concepts": "lifestyle", "concept_list": ["lifestyle"], "type": "cluster", "node_size": 18, "label": "lifestyle"}, "navy": {"concepts": "navy", "concept_list": ["navy"], "type": "cluster", "node_size": 18, "label": "navy"}, "fishing strategies": {"concepts": "fishing strategies", "concept_list": ["fishing strategies"], "type": "cluster", "node_size": 18, "label": "fishing strategies"}, "ciguatera": {"concepts": "ciguatera", "concept_list": ["ciguatera"], "type": "cluster", "node_size": 18, "label": "ciguatera"}, "bombing": {"concepts": "bombing", "concept_list": ["bombing"], "type": "cluster", "node_size": 18, "label": "bombing"}, "locals": {"concepts": "locals", "concept_list": ["locals"], "type": "cluster", "node_size": 18, "label": "locals"}, "effects": {"concepts": "effects", "concept_list": ["effects"], "type": "cluster", "node_size": 18, "label": "effects"}, "mangroves": {"concepts": "mangroves", "concept_list": ["mangroves"], "type": "cluster", "node_size": 18, "label": "mangroves"}, "practice of fishing": {"concepts": "practice of fishing", "concept_list": ["practice of fishing"], "type": "cluster", "node_size": 18, "label": "practice of fishing"}, "gasoline": {"concepts": "gasoline", "concept_list": ["gasoline"], "type": "cluster", "node_size": 18, "label": "gasoline"}, "seabed changes": {"concepts": "seabed changes", "concept_list": ["seabed changes"], "type": "cluster", "node_size": 18, "label": "seabed changes"}, "culebra": {"concepts": "culebra", "concept_list": ["culebra"], "type": "cluster", "node_size": 18, "label": "culebra"}, "bomb storage": {"concepts": "bomb storage", "concept_list": ["bomb storage"], "type": "cluster", "node_size": 18, "label": "bomb storage"}, "accident": {"concepts": "accident", "concept_list": ["accident"], "type": "cluster", "node_size": 18, "label": "accident"}, "abdiel": {"concepts": "abdiel", "concept_list": ["abdiel"], "type": "cluster", "node_size": 18, "label": "abdiel"}, "intelligence agency": {"concepts": "intelligence agency", "concept_list": ["intelligence agency"], "type": "cluster", "node_size": 18, "label": "intelligence agency"}, "university students": {"concepts": "university students", "concept_list": ["university students"], "type": "cluster", "node_size": 18, "label": "university students"}, "fishing depth": {"concepts": "fishing depth", "concept_list": ["fishing depth"], "type": "cluster", "node_size": 18, "label": "fishing depth"}, "west": {"concepts": "west", "concept_list": ["west"], "type": "cluster", "node_size": 18, "label": "west"}, "dolphins": {"concepts": "dolphins", "concept_list": ["dolphins"], "type": "cluster", "node_size": 18, "label": "dolphins"}, "wisdom": {"concepts": "wisdom", "concept_list": ["wisdom"], "type": "cluster", "node_size": 18, "label": "wisdom"}, "fishing mind": {"concepts": "fishing mind", "concept_list": ["fishing mind"], "type": "cluster", "node_size": 18, "label": "fishing mind"}, "pressure": {"concepts": "pressure", "concept_list": ["pressure"], "type": "cluster", "node_size": 18, "label": "pressure"}, "education": {"concepts": "education", "concept_list": ["education"], "type": "cluster", "node_size": 18, "label": "education"}, "techniques": {"concepts": "techniques", "concept_list": ["techniques"], "type": "cluster", "node_size": 18, "label": "techniques"}, "coral reseeding": {"concepts": "coral reseeding", "concept_list": ["coral reseeding"], "type": "cluster", "node_size": 18, "label": "coral reseeding"}, "port authority": {"concepts": "port authority", "concept_list": ["port authority"], "type": "cluster", "node_size": 18, "label": "port authority"}, "ocean": {"concepts": "ocean", "concept_list": ["ocean"], "type": "cluster", "node_size": 18, "label": "ocean"}, "skills": {"concepts": "skills", "concept_list": ["skills"], "type": "cluster", "node_size": 18, "label": "skills"}, "fishing process": {"concepts": "fishing process", "concept_list": ["fishing process"], "type": "cluster", "node_size": 18, "label": "fishing process"}, "overexploited": {"concepts": "overexploited", "concept_list": ["overexploited"], "type": "cluster", "node_size": 18, "label": "overexploited"}, "punta soldado": {"concepts": "punta soldado", "concept_list": ["punta soldado"], "type": "cluster", "node_size": 18, "label": "punta soldado"}, "sanctions": {"concepts": "sanctions", "concept_list": ["sanctions"], "type": "cluster", "node_size": 18, "label": "sanctions"}, "coral reefs": {"concepts": "coral reefs", "concept_list": ["coral reefs"], "type": "cluster", "node_size": 18, "label": "coral reefs"}, "food chain": {"concepts": "food chain", "concept_list": ["food chain"], "type": "cluster", "node_size": 18, "label": "food chain"}, "hawksbill": {"concepts": "hawksbill", "concept_list": ["hawksbill"], "type": "cluster", "node_size": 18, "label": "hawksbill"}, "fishing challenges": {"concepts": "fishing challenges", "concept_list": ["fishing challenges"], "type": "cluster", "node_size": 18, "label": "fishing challenges"}, "sustenance": {"concepts": "sustenance", "concept_list": ["sustenance"], "type": "cluster", "node_size": 18, "label": "sustenance"}, "boat size": {"concepts": "boat size", "concept_list": ["boat size"], "type": "cluster", "node_size": 18, "label": "boat size"}, "fishing divers": {"concepts": "fishing divers", "concept_list": ["fishing divers"], "type": "cluster", "node_size": 18, "label": "fishing divers"}, "fishing mentorship": {"concepts": "fishing mentorship", "concept_list": ["fishing mentorship"], "type": "cluster", "node_size": 18, "label": "fishing mentorship"}, "government help": {"concepts": "government help", "concept_list": ["government help"], "type": "cluster", "node_size": 18, "label": "government help"}, "mentorship": {"concepts": "mentorship", "concept_list": ["mentorship"], "type": "cluster", "node_size": 18, "label": "mentorship"}, "practice area": {"concepts": "practice area", "concept_list": ["practice area"], "type": "cluster", "node_size": 18, "label": "practice area"}, "quality": {"concepts": "quality", "concept_list": ["quality"], "type": "cluster", "node_size": 18, "label": "quality"}, "community programs": {"concepts": "community programs", "concept_list": ["community programs"], "type": "cluster", "node_size": 18, "label": "community programs"}};
        const conceptData = {};
        const interClusterEdges = [["dock", "erosion", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["stench", "west", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["artisanal fishing", "cayo norte", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["constructions.", "sardines", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["wooden houses", "overexploited", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["guidance", "land plots", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["fishing bag", "concentration", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["sierra", "fishing outcomes", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["good boats", "reserve", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["limitations", "university students", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["canal de la reserva", "locals", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["military impacts", "fishing expertise", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["craftsmanship", "fishing tools", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["expropriation", "practice of fishing", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["son", "fisheries management", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["educational", "abdiel", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["redfish", "power outage", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["land plots", "hurricane hugo", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["pelagic species", "boat size", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["financial support", "gasoline", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["antennas", "seabeds", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["puerto rican meatpacking plants", "lifestyle", {"weight": -1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["stainless steel", "fishing changes", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["strombus gigas", "ocean comfort", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["weather", "wooden houses", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["pride and joy", "perseverance", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["coast", "education", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["hurricane irma", "fishing strategies", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["hunger", "fishing mind", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["local market", "skills", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["friends", "security", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["human error", "port authority", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["agriculture analogy", "shore fishing", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["fishing culture", "outdoor activities", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["life", "fisheries management", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["navy", "intelligence agency", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["bombing", "trawling", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["mangroves", "pollution impact", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["culebra", "fishing depth", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["bomb storage", "pressure", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["accident", "mentorship", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["dolphins", "food chain", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["wisdom", "effects", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["techniques", "survival", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["coral reseeding", "moorings", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["ocean", "tentacles", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["fishing process", "ciguatera", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["coral reefs", "maritime-terrestrial zone", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["hawksbill", "tradition", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["sustenance", "seabed changes", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["fishing divers", "punta soldado", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["fishing mentorship", "practice area", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["government help", "military pollution", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["quality", "sanctions", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["community programs", "fishing challenges", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
