
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Environmental Impacts": {"concepts": "government policies, closures, government staff, decision-makers, control of effort, government leaders, accountability, advisory council, decision-making, protection laws, agency disconnect, regulations, enforcement, government trust, dner, climate change, government subsidies, top down approach, government, management, compliance, decision-making process, recommendations", "concept_list": ["government policies", "closures", "government staff", "decision-makers", "control of effort", "government leaders", "accountability", "advisory council", "decision-making", "protection laws", "agency disconnect", "regulations", "enforcement", "government trust", "dner", "climate change", "government subsidies", "top down approach", "government", "management", "compliance", "decision-making process", "recommendations"], "type": "cluster", "node_size": 84, "label": "Environmental Impacts"}, "Community Dynamics": {"concepts": "weather patterns, storm surges, terrestrial impacts, global warming, habitat loss, environment, hurricanes, port sampling, pollution, warming waters, sedimentation, environmental impacts, drought, water temperature, heavy rains, sahara dust, weather changes, habitat degradation, water quality", "concept_list": ["weather patterns", "storm surges", "terrestrial impacts", "global warming", "habitat loss", "environment", "hurricanes", "port sampling", "pollution", "warming waters", "sedimentation", "environmental impacts", "drought", "water temperature", "heavy rains", "sahara dust", "weather changes", "habitat degradation", "water quality"], "type": "cluster", "node_size": 72, "label": "Community Dynamics"}, "Marine Research": {"concepts": "self-sustenance, coastal communities, local level, cohesion, myths, institutional vision, third party facilitation, community outreach, noaa, reproduction gatherings, participatory action, economic growth, social system, gear subsidies, livelihood, knowledge, environmentalists, family traditions, conflict resolution, ice sellers, restaurants, conflicts, welfare, tourism, community problems, associations, tourism industry, tourism sector, research, perception, tourist development, community collaboration, tourism culture, market decentralization, middle man, public realm, inconsistencies, researchers, cooperation, individualists, bi-monthly meetings, agricultural sector, work opportunities", "concept_list": ["self-sustenance", "coastal communities", "local level", "cohesion", "myths", "institutional vision", "third party facilitation", "community outreach", "noaa", "reproduction gatherings", "participatory action", "economic growth", "social system", "gear subsidies", "livelihood", "knowledge", "environmentalists", "family traditions", "conflict resolution", "ice sellers", "restaurants", "conflicts", "welfare", "tourism", "community problems", "associations", "tourism industry", "tourism sector", "research", "perception", "tourist development", "community collaboration", "tourism culture", "market decentralization", "middle man", "public realm", "inconsistencies", "researchers", "cooperation", "individualists", "bi-monthly meetings", "agricultural sector", "work opportunities"], "type": "cluster", "node_size": 144, "label": "Marine Research"}, "Regional Advisory Groups": {"concepts": "landings, landing data, species, biologists, octopus, chemical analysis, market, ports, habitat restoration, advisory committee, behavior monitoring, drones, underground market, health issues, top-down management, local knowledge, hogfish, hind, university of puerto rico, scientific effort, acoustics, boat subsidies, press coverage, conch, resources, grouper species, sound science, managers, lobster traps, snapper, zika, illegal catch, cold fronts, lobster, courtship calls, fuel providers, stressor, boat repair, drug users, natural resources, tarpon, federal waters, sargassum, noaa ranger, conch regulations, peer-reviewed, state waters, trip tickets, grouper, pit tagging, academia, engine repair, declining stocks, transparency, scientists, sea grant", "concept_list": ["landings", "landing data", "species", "biologists", "octopus", "chemical analysis", "market", "ports", "habitat restoration", "advisory committee", "behavior monitoring", "drones", "underground market", "health issues", "top-down management", "local knowledge", "hogfish", "hind", "university of puerto rico", "scientific effort", "acoustics", "boat subsidies", "press coverage", "conch", "resources", "grouper species", "sound science", "managers", "lobster traps", "snapper", "zika", "illegal catch", "cold fronts", "lobster", "courtship calls", "fuel providers", "stressor", "boat repair", "drug users", "natural resources", "tarpon", "federal waters", "sargassum", "noaa ranger", "conch regulations", "peer-reviewed", "state waters", "trip tickets", "grouper", "pit tagging", "academia", "engine repair", "declining stocks", "transparency", "scientists", "sea grant"], "type": "cluster", "node_size": 183, "label": "Regional Advisory Groups"}, "Government Policies": {"concepts": "virgin islands, puerto rico, scientific advisory groups", "concept_list": ["virgin islands", "puerto rico", "scientific advisory groups"], "type": "cluster", "node_size": 24, "label": "Government Policies"}, "Coral Health": {"concepts": "bleaching, underwater habitats, coral diseases, coral restoration, coral bleaching, coral reefs, coral reef habitats, coral reef monitoring", "concept_list": ["bleaching", "underwater habitats", "coral diseases", "coral restoration", "coral bleaching", "coral reefs", "coral reef habitats", "coral reef monitoring"], "type": "cluster", "node_size": 39, "label": "Coral Health"}, "Fish Species": {"concepts": "parrotfish, deep water fish, triggerfish, spawning, boxfish, game fish, juvenile fish, spawning seasons, fish distribution, imported fish, fish stocks, fish species, lionfish, sea turtles, catch numbers, spawning changes", "concept_list": ["parrotfish", "deep water fish", "triggerfish", "spawning", "boxfish", "game fish", "juvenile fish", "spawning seasons", "fish distribution", "imported fish", "fish stocks", "fish species", "lionfish", "sea turtles", "catch numbers", "spawning changes"], "type": "cluster", "node_size": 63, "label": "Fish Species"}, "Marine Threats": {"concepts": "sponge populations, invasive lionfish, lionfish removal, algal blooms, lionfish removal., overfishing, algae blooms, sea monitoring, ocean bounty, green algae", "concept_list": ["sponge populations", "invasive lionfish", "lionfish removal", "algal blooms", "lionfish removal.", "overfishing", "algae blooms", "sea monitoring", "ocean bounty", "green algae"], "type": "cluster", "node_size": 45, "label": "Marine Threats"}, "Fishery Management": {"concepts": "fishery managers, fishery management, fishery closings, fishery, fishery management council, fishery problems", "concept_list": ["fishery managers", "fishery management", "fishery closings", "fishery", "fishery management council", "fishery problems"], "type": "cluster", "node_size": 33, "label": "Fishery Management"}, "Fisheries Industry": {"concepts": "fisheries, commercial fishers, puerto rican fisheries, fisheries industry, recreational fishermen, fishers, unlicensed fishermen", "concept_list": ["fisheries", "commercial fishers", "puerto rican fisheries", "fisheries industry", "recreational fishermen", "fishers", "unlicensed fishermen"], "type": "cluster", "node_size": 36, "label": "Fisheries Industry"}, "Fishing Practices": {"concepts": "recreational fishing, subsistence fishing, illegal fishing practices", "concept_list": ["recreational fishing", "subsistence fishing", "illegal fishing practices"], "type": "cluster", "node_size": 24, "label": "Fishing Practices"}, "Fishing Communities": {"concepts": "fishing industry, fishing villages, fishing spots", "concept_list": ["fishing industry", "fishing villages", "fishing spots"], "type": "cluster", "node_size": 24, "label": "Fishing Communities"}};
        const conceptData = {};
        const interClusterEdges = [["Environmental Impacts", "Fisheries Industry", {"weight": -0.8, "confidence": 0.61, "type": "inter_cluster", "style": "solid"}], ["Environmental Impacts", "Fish Species", {"weight": -0.2, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Community Dynamics", "Fish Species", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Community Dynamics", "Fisheries Industry", {"weight": -0.6, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Community Dynamics", "Environmental Impacts", {"weight": 0.6666666666666666, "confidence": 0.5666666666666668, "type": "inter_cluster", "style": "solid"}], ["Marine Research", "Fishery Management", {"weight": 0.4, "confidence": 0.57, "type": "inter_cluster", "style": "solid"}], ["Marine Research", "Regional Advisory Groups", {"weight": 0.25, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Marine Research", "Coral Health", {"weight": -0.25, "confidence": 0.2125, "type": "inter_cluster", "style": "solid"}], ["Marine Research", "Community Dynamics", {"weight": -0.3333333333333333, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}], ["Regional Advisory Groups", "Fishing Practices", {"weight": -0.2, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Government Policies", "Fishery Management", {"weight": -0.4, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Government Policies", "Marine Research", {"weight": 0.4, "confidence": 0.31, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Fishery Management", {"weight": 0.75, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Coral Health", "Community Dynamics", {"weight": -0.2, "confidence": 0.43, "type": "inter_cluster", "style": "solid"}], ["Fish Species", "Government Policies", {"weight": 0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Fishing Communities", {"weight": 0.5, "confidence": 0.38749999999999996, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Regional Advisory Groups", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Marine Threats", "Marine Research", {"weight": -0.3333333333333333, "confidence": 0.26666666666666666, "type": "inter_cluster", "style": "solid"}], ["Fishery Management", "Environmental Impacts", {"weight": 0.2, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["Fishery Management", "Government Policies", {"weight": 0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Fishery Management", "Marine Threats", {"weight": -0.2, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Fishery Management", "Fisheries Industry", {"weight": -0.4, "confidence": 0.36, "type": "inter_cluster", "style": "solid"}], ["Fishery Management", "Regional Advisory Groups", {"weight": -0.5, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Fisheries Industry", "Government Policies", {"weight": 0.25, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Fisheries Industry", "Marine Research", {"weight": 0.2, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Government Policies", {"weight": -0.5, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Fish Species", {"weight": -0.3333333333333333, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Fishing Practices", "Fisheries Industry", {"weight": 0.3333333333333333, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Fishing Communities", "Fishing Practices", {"weight": -0.2, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Fishing Communities", "Fisheries Industry", {"weight": 0.4, "confidence": 0.27999999999999997, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Environmental Impacts": [], "Community Dynamics": [], "Marine Research": [], "Regional Advisory Groups": [], "Government Policies": [], "Coral Health": [], "Fish Species": [], "Marine Threats": [], "Fishery Management": [], "Fisheries Industry": [], "Fishing Practices": [], "Fishing Communities": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
