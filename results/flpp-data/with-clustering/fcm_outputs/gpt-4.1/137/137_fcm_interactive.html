
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"bulk purchasing": {"concepts": "bulk purchasing", "concept_list": ["bulk purchasing"], "type": "cluster", "node_size": 18, "label": "bulk purchasing"}, "growing kits": {"concepts": "growing kits", "concept_list": ["growing kits"], "type": "cluster", "node_size": 18, "label": "growing kits"}, "Food Access": {"concepts": "problem solving, quantity, office access, community members, partnerships, caseworker, city hall, quality of life, flint recovery, snap benefits, north side hub, covenant community, south side, water vouchers, covid, video calls, connection strengths, applications, social circle, eastside mission, computers, supplemental sector, program promotion, wic office, red cross, choice, signage, traffic, privilege, hispanic center, electric bills, freedom, research, safety, communication, zoom calls, vehicle access, basic needs, funding limitations, family nutrition, water bills, community partners, dhhs, collaboration, office closures, safe drinking water, stores, edible flint, system, racial issues, government phones, emergency programs, outreach, wic program, families, medicaid, document translation, outreach programs, price, technological barriers, americorps, grubhub, empowerment, program utilization, wic, flint fresh, transportation, program expansion, non-english speakers, supplemental programs, map, assistance programs, ebt, impact, computer access, economic development, trust, family needs, effective programming, dignity, program awareness, comfort, resources, accessibility, partnership, people, barriers, flint, leverage points, water distribution, gardening, community navigator, access problems, quality, affordability, transportation barriers, bilingual support, knowledge gaps, community support, outcomes, technology barriers, organizations, creativity, online access, programs, latinx technology and community center, caseworker access, east side, cultural values, independence, smartphones, leadership, health, sector, availability, healthier choices, resource distribution, community, community engagement, common good, healthy choices, access, bus passes, covid-19, benefits, spanish signage, community empowerment", "concept_list": ["problem solving", "quantity", "office access", "community members", "partnerships", "caseworker", "city hall", "quality of life", "flint recovery", "snap benefits", "north side hub", "covenant community", "south side", "water vouchers", "covid", "video calls", "connection strengths", "applications", "social circle", "eastside mission", "computers", "supplemental sector", "program promotion", "wic office", "red cross", "choice", "signage", "traffic", "privilege", "hispanic center", "electric bills", "freedom", "research", "safety", "communication", "zoom calls", "vehicle access", "basic needs", "funding limitations", "family nutrition", "water bills", "community partners", "dhhs", "collaboration", "office closures", "safe drinking water", "stores", "edible flint", "system", "racial issues", "government phones", "emergency programs", "outreach", "wic program", "families", "medicaid", "document translation", "outreach programs", "price", "technological barriers", "americorps", "grubhub", "empowerment", "program utilization", "wic", "flint fresh", "transportation", "program expansion", "non-english speakers", "supplemental programs", "map", "assistance programs", "ebt", "impact", "computer access", "economic development", "trust", "family needs", "effective programming", "dignity", "program awareness", "comfort", "resources", "accessibility", "partnership", "people", "barriers", "flint", "leverage points", "water distribution", "gardening", "community navigator", "access problems", "quality", "affordability", "transportation barriers", "bilingual support", "knowledge gaps", "community support", "outcomes", "technology barriers", "organizations", "creativity", "online access", "programs", "latinx technology and community center", "caseworker access", "east side", "cultural values", "independence", "smartphones", "leadership", "health", "sector", "availability", "healthier choices", "resource distribution", "community", "community engagement", "common good", "healthy choices", "access", "bus passes", "covid-19", "benefits", "spanish signage", "community empowerment"], "type": "cluster", "node_size": 396, "label": "Food Access"}, "Food Retail": {"concepts": "pre-made food, hot foods, food pantry, luxury foods, food skills, food price, cooking programs, food prices, food delivery, food system values, delivery system, nutritious foods, fruits and vegetables, double up food bucks, cooking skills, food accessibility, food insecurity, food stamps, food boxes, cultural foods, food, unprepared foods, food access, food system, food pantries, flint food system, pre-made foods", "concept_list": ["pre-made food", "hot foods", "food pantry", "luxury foods", "food skills", "food price", "cooking programs", "food prices", "food delivery", "food system values", "delivery system", "nutritious foods", "fruits and vegetables", "double up food bucks", "cooking skills", "food accessibility", "food insecurity", "food stamps", "food boxes", "cultural foods", "food", "unprepared foods", "food access", "food system", "food pantries", "flint food system", "pre-made foods"], "type": "cluster", "node_size": 96, "label": "Food Retail"}, "Education Opportunities": {"concepts": "retail locations, chain restaurants, local restaurants, groceries, convenience stores, grocery stores, restaurants", "concept_list": ["retail locations", "chain restaurants", "local restaurants", "groceries", "convenience stores", "grocery stores", "restaurants"], "type": "cluster", "node_size": 36, "label": "Education Opportunities"}, "Farmers Markets": {"concepts": "children, connexus education, education programs, career development, education, educational opportunities", "concept_list": ["children", "connexus education", "education programs", "career development", "education", "educational opportunities"], "type": "cluster", "node_size": 33, "label": "Farmers Markets"}, "Community Access": {"concepts": "farmers markets, local farmers, farmers market, flint farmers market, delivery services, flint farmers markets, nutrition", "concept_list": ["farmers markets", "local farmers", "farmers market", "flint farmers market", "delivery services", "flint farmers markets", "nutrition"], "type": "cluster", "node_size": 36, "label": "Community Access"}, "Food Banks": {"concepts": "martha luna food bank, st mary's food bank, food banks, food bank", "concept_list": ["martha luna food bank", "st mary's food bank", "food banks", "food bank"], "type": "cluster", "node_size": 27, "label": "Food Banks"}, "Cashier Roles": {"concepts": "cashier participation, cashiers", "concept_list": ["cashier participation", "cashiers"], "type": "cluster", "node_size": 21, "label": "Cashier Roles"}};
        const conceptData = {};
        const interClusterEdges = [["bulk purchasing", "Food Retail", {"weight": 1.0, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["bulk purchasing", "Food Access", {"weight": 1.0, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["bulk purchasing", "Education Opportunities", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["bulk purchasing", "Food Banks", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["growing kits", "Food Retail", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["growing kits", "Food Access", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["growing kits", "Community Access", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Farmers Markets", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Food Access", "growing kits", {"weight": 0.8, "confidence": 0.5199999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Banks", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Access", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Cashier Roles", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Food Retail", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Education Opportunities", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Community Access", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Farmers Markets", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Food Banks", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Cashier Roles", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "growing kits", {"weight": 1.0, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Food Access", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Education Opportunities", "Food Retail", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["Education Opportunities", "bulk purchasing", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Education Opportunities", "Cashier Roles", {"weight": 0.6666666666666666, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Education Opportunities", "Food Access", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Education Opportunities", "Community Access", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "growing kits", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Community Access", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Food Banks", {"weight": 1.0, "confidence": 0.5666666666666667, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Food Retail", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Farmers Markets", "Education Opportunities", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Community Access", "Farmers Markets", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Community Access", "growing kits", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Community Access", "Food Retail", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Community Access", "Food Access", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Access", "Food Banks", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Food Banks", "Food Access", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Food Banks", "growing kits", {"weight": 0.75, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Food Banks", "Farmers Markets", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food Banks", "Community Access", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Cashier Roles", "Food Access", {"weight": 0.8, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Cashier Roles", "Education Opportunities", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Cashier Roles", "Food Retail", {"weight": 1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access": [], "Food Retail": [], "Education Opportunities": [], "Farmers Markets": [], "Community Access": [], "Food Banks": [], "Cashier Roles": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
