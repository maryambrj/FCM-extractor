
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access & Choices": {"concepts": "remote learning, student enrollment, delivery apps, affordability", "concept_list": ["remote learning", "student enrollment", "delivery apps", "affordability"], "type": "cluster", "node_size": 27, "label": "Food Access & Choices"}, "Healthy Consumer Preferences": {"concepts": "food convenience, food sources, food purchasing community, food purchasing, food quality, food-related decision making, meat, nutritious food, food purchasing health, food freshness, food price, food purchasing constraints, food supply, food culture, food environment, food retail environment, fresh produce, vegetables, convenience factor, food purchasing quality, farmers market, food system map, seasonal availability, healthy lunch, food research, food insecurity, food purchasing support, food sector, food availability, farmers, fast food, vending machines, food purchasing locations, food system values, food preferences, food quality perception, food vendors, food purchasing affordability, food purchasing behavior, food consumption, food market, food choices, farmers markets, food preparation, food purchasing empowerment, food system, food purchasing access, ready-to-go meals, food access barriers, food retail access, food access, food purchasing convenience, food purchasing location, food options, food deserts, food retail types, food purchasing experience, food purchasing motivation, food recognition, food variety, food purchasing patterns, food provision, affordable food, supplemental nutrition programs, milk, lunch options, food service, nutritious foods, dining experience, food outlets, food delivery, fresh food, food purchasing preferences, food distribution, food purchasing options, food affordability, food purchasing decisions, food security", "concept_list": ["food convenience", "food sources", "food purchasing community", "food purchasing", "food quality", "food-related decision making", "meat", "nutritious food", "food purchasing health", "food freshness", "food price", "food purchasing constraints", "food supply", "food culture", "food environment", "food retail environment", "fresh produce", "vegetables", "convenience factor", "food purchasing quality", "farmers market", "food system map", "seasonal availability", "healthy lunch", "food research", "food insecurity", "food purchasing support", "food sector", "food availability", "farmers", "fast food", "vending machines", "food purchasing locations", "food system values", "food preferences", "food quality perception", "food vendors", "food purchasing affordability", "food purchasing behavior", "food consumption", "food market", "food choices", "farmers markets", "food preparation", "food purchasing empowerment", "food system", "food purchasing access", "ready-to-go meals", "food access barriers", "food retail access", "food access", "food purchasing convenience", "food purchasing location", "food options", "food deserts", "food retail types", "food purchasing experience", "food purchasing motivation", "food recognition", "food variety", "food purchasing patterns", "food provision", "affordable food", "supplemental nutrition programs", "milk", "lunch options", "food service", "nutritious foods", "dining experience", "food outlets", "food delivery", "fresh food", "food purchasing preferences", "food distribution", "food purchasing options", "food affordability", "food purchasing decisions", "food security"], "type": "cluster", "node_size": 249, "label": "Healthy Consumer Preferences"}, "Local Business Challenges": {"concepts": "healthy options, consumer choice, quality of life, health outcomes, health consciousness, consumer preferences, healthy choices, consumer base", "concept_list": ["healthy options", "consumer choice", "quality of life", "health outcomes", "health consciousness", "consumer preferences", "healthy choices", "consumer base"], "type": "cluster", "node_size": 39, "label": "Local Business Challenges"}, "Community Change Factors": {"concepts": "business competition, business risk, market entry, business survival, price margins, leverage points, profitability, family-owned business, local business support, local economy, local businesses, small business, sales, rent, business sustainability, price increase, margins, business challenges, local business, profit margin", "concept_list": ["business competition", "business risk", "market entry", "business survival", "price margins", "leverage points", "profitability", "family-owned business", "local business support", "local economy", "local businesses", "small business", "sales", "rent", "business sustainability", "price increase", "margins", "business challenges", "local business", "profit margin"], "type": "cluster", "node_size": 75, "label": "Community Change Factors"}, "Remote Access & Affordability": {"concepts": "reinvestment, pick up, um flint, time constraints, workforce, michigan football, doordash, legacy, covid-19, evolving community, enrollment, grubhub, flint, food court, downtown flint, pandemic impact, ubereats, positive outcomes, research", "concept_list": ["reinvestment", "pick up", "um flint", "time constraints", "workforce", "michigan football", "doordash", "legacy", "covid-19", "evolving community", "enrollment", "grubhub", "flint", "food court", "downtown flint", "pandemic impact", "ubereats", "positive outcomes", "research"], "type": "cluster", "node_size": 72, "label": "Remote Access & Affordability"}, "Restaurant Competition": {"concepts": "convenience stores, restaurant competition, local restaurants, restaurant success, grocery stores, local restaurant, retail sector, chain restaurants, restaurants, retail use", "concept_list": ["convenience stores", "restaurant competition", "local restaurants", "restaurant success", "grocery stores", "local restaurant", "retail sector", "chain restaurants", "restaurants", "retail use"], "type": "cluster", "node_size": 45, "label": "Restaurant Competition"}, "Community Support": {"concepts": "community investment, community empowerment, community support, community health", "concept_list": ["community investment", "community empowerment", "community support", "community health"], "type": "cluster", "node_size": 27, "label": "Community Support"}, "Social Environment": {"concepts": "community environment, building community, social support", "concept_list": ["community environment", "building community", "social support"], "type": "cluster", "node_size": 24, "label": "Social Environment"}, "Student Housing": {"concepts": "dorms, college town, dormitory housing", "concept_list": ["dorms", "college town", "dormitory housing"], "type": "cluster", "node_size": 24, "label": "Student Housing"}, "Workplace Dynamics": {"concepts": "work environment, owner presence", "concept_list": ["work environment", "owner presence"], "type": "cluster", "node_size": 21, "label": "Workplace Dynamics"}, "Customer Base": {"concepts": "clientele, customer base", "concept_list": ["clientele", "customer base"], "type": "cluster", "node_size": 21, "label": "Customer Base"}, "Customer Loyalty": {"concepts": "customer loyalty, customer service, customer experience", "concept_list": ["customer loyalty", "customer service", "customer experience"], "type": "cluster", "node_size": 24, "label": "Customer Loyalty"}, "Service Quality": {"concepts": "delivery services, service quality", "concept_list": ["delivery services", "service quality"], "type": "cluster", "node_size": 21, "label": "Service Quality"}};
        const conceptData = {};
        const interClusterEdges = [["Food Access & Choices", "Customer Base", {"weight": 0.3333333333333333, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access & Choices", "Local Business Challenges", {"weight": 0.3333333333333333, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Food Access & Choices", "Community Support", {"weight": 0.3333333333333333, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Access & Choices", "Service Quality", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Access & Choices", "Customer Loyalty", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Food Access & Choices", "Workplace Dynamics", {"weight": -0.5, "confidence": 0.275, "type": "inter_cluster", "style": "solid"}], ["Healthy Consumer Preferences", "Restaurant Competition", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Healthy Consumer Preferences", "Local Business Challenges", {"weight": 1.0, "confidence": 0.8833333333333333, "type": "inter_cluster", "style": "solid"}], ["Healthy Consumer Preferences", "Community Support", {"weight": 0.6666666666666666, "confidence": 0.5166666666666666, "type": "inter_cluster", "style": "solid"}], ["Healthy Consumer Preferences", "Student Housing", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Local Business Challenges", "Customer Loyalty", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Local Business Challenges", "Healthy Consumer Preferences", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Local Business Challenges", "Community Support", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Local Business Challenges", "Student Housing", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Change Factors", "Customer Loyalty", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Community Change Factors", "Customer Base", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Community Change Factors", "Social Environment", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Community Change Factors", "Community Support", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Remote Access & Affordability", "Healthy Consumer Preferences", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Remote Access & Affordability", "Community Support", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Remote Access & Affordability", "Customer Base", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Remote Access & Affordability", "Service Quality", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Remote Access & Affordability", "Local Business Challenges", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Restaurant Competition", "Social Environment", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Restaurant Competition", "Service Quality", {"weight": 1.0, "confidence": 0.6749999999999999, "type": "inter_cluster", "style": "solid"}], ["Restaurant Competition", "Student Housing", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Restaurant Competition", "Customer Loyalty", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Restaurant Competition", "Workplace Dynamics", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Remote Access & Affordability", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Healthy Consumer Preferences", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Community Support", "Restaurant Competition", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Social Environment", "Customer Loyalty", {"weight": 1.0, "confidence": 0.9166666666666666, "type": "inter_cluster", "style": "solid"}], ["Social Environment", "Workplace Dynamics", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Student Housing", "Customer Base", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Student Housing", "Restaurant Competition", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Student Housing", "Local Business Challenges", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Student Housing", "Social Environment", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Workplace Dynamics", "Customer Base", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Workplace Dynamics", "Local Business Challenges", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Workplace Dynamics", "Remote Access & Affordability", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Customer Base", "Community Change Factors", {"weight": 1.0, "confidence": 0.8800000000000001, "type": "inter_cluster", "style": "solid"}], ["Customer Loyalty", "Community Change Factors", {"weight": 1.0, "confidence": 0.8624999999999999, "type": "inter_cluster", "style": "solid"}], ["Customer Loyalty", "Restaurant Competition", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Customer Loyalty", "Healthy Consumer Preferences", {"weight": 1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Service Quality", "Customer Loyalty", {"weight": 0.2, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["Service Quality", "Healthy Consumer Preferences", {"weight": 1.0, "confidence": 0.7875000000000001, "type": "inter_cluster", "style": "solid"}], ["Service Quality", "Local Business Challenges", {"weight": -1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Service Quality", "Remote Access & Affordability", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access & Choices": [], "Healthy Consumer Preferences": [], "Local Business Challenges": [], "Community Change Factors": [], "Remote Access & Affordability": [], "Restaurant Competition": [], "Community Support": [], "Social Environment": [], "Student Housing": [], "Workplace Dynamics": [], "Customer Base": [], "Customer Loyalty": [], "Service Quality": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
