
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"ecotourism sector": {"concepts": "ecotourism sector", "concept_list": ["ecotourism sector"], "type": "cluster", "node_size": 18, "label": "ecotourism sector"}, "habitat forming": {"concepts": "habitat forming", "concept_list": ["habitat forming"], "type": "cluster", "node_size": 18, "label": "habitat forming"}, "waterfront homeowners": {"concepts": "waterfront homeowners", "concept_list": ["waterfront homeowners"], "type": "cluster", "node_size": 18, "label": "waterfront homeowners"}, "ecotourism": {"concepts": "ecotourism", "concept_list": ["ecotourism"], "type": "cluster", "node_size": 18, "label": "ecotourism"}, "recreational benefits": {"concepts": "recreational benefits", "concept_list": ["recreational benefits"], "type": "cluster", "node_size": 18, "label": "recreational benefits"}, "environmental changes": {"concepts": "environmental changes", "concept_list": ["environmental changes"], "type": "cluster", "node_size": 18, "label": "environmental changes"}, "ecosystem": {"concepts": "ecosystem", "concept_list": ["ecosystem"], "type": "cluster", "node_size": 18, "label": "ecosystem"}, "Food Security": {"concepts": "anthropogenic stressors, climate change, habitat forming species", "concept_list": ["anthropogenic stressors", "climate change", "habitat forming species"], "type": "cluster", "node_size": 24, "label": "Food Security"}, "Fisheries Management": {"concepts": "food benefits, food web, food web supporting, nutritional benefits, food web supporting species, food security, nutrition", "concept_list": ["food benefits", "food web", "food web supporting", "nutritional benefits", "food web supporting species", "food security", "nutrition"], "type": "cluster", "node_size": 36, "label": "Fisheries Management"}, "Biodiversity Impacts": {"concepts": "single species fisheries management, seabirds, seabird management, small-scale fisheries, fisheries, fishermen, fisheries economics, nearby fisheries, marine resource management, fishing sector, fishing biomass, oyster farmers, marine mammals, fisheries access", "concept_list": ["single species fisheries management", "seabirds", "seabird management", "small-scale fisheries", "fisheries", "fishermen", "fisheries economics", "nearby fisheries", "marine resource management", "fishing sector", "fishing biomass", "oyster farmers", "marine mammals", "fisheries access"], "type": "cluster", "node_size": 57, "label": "Biodiversity Impacts"}, "Endangered Species Conservation": {"concepts": "number of species, lake victoria, wellbeing, harmful organisms, unintended consequences, adjacency matrix, hippos, mental modeling, thesis chapter, cambodia, data collecting, tonle sap, flooding, invasive species, thematic coding framework, researchers, variety of traits, mental modeler, regional managers, human wellbeing, health, cultural benefits, diversity of functions, resource users, economics, upstate new york, variety of species traits, diverse functions, qualitative binning, stakeholders, kenya, species, ngos, stressors, east africa, species-specific management, species increasing, contaminants, biodiversity", "concept_list": ["number of species", "lake victoria", "wellbeing", "harmful organisms", "unintended consequences", "adjacency matrix", "hippos", "mental modeling", "thesis chapter", "cambodia", "data collecting", "tonle sap", "flooding", "invasive species", "thematic coding framework", "researchers", "variety of traits", "mental modeler", "regional managers", "human wellbeing", "health", "cultural benefits", "diversity of functions", "resource users", "economics", "upstate new york", "variety of species traits", "diverse functions", "qualitative binning", "stakeholders", "kenya", "species", "ngos", "stressors", "east africa", "species-specific management", "species increasing", "contaminants", "biodiversity"], "type": "cluster", "node_size": 132, "label": "Endangered Species Conservation"}, "Climate Stressors": {"concepts": "species of conservation concern, conservation management, kenya wildlife survey, conservation concern, endangered species management, human wildlife conflict, endangered species conservation, endangered species", "concept_list": ["species of conservation concern", "conservation management", "kenya wildlife survey", "conservation concern", "endangered species management", "human wildlife conflict", "endangered species conservation", "endangered species"], "type": "cluster", "node_size": 39, "label": "Climate Stressors"}, "Aquatic Ecosystems": {"concepts": "coastal habitats, water quantity, water quality, water availability, river dolphins, aquatic ecosystems, mekong river", "concept_list": ["coastal habitats", "water quantity", "water quality", "water availability", "river dolphins", "aquatic ecosystems", "mekong river"], "type": "cluster", "node_size": 36, "label": "Aquatic Ecosystems"}, "Ecosystem Services": {"concepts": "ecosystem services, ecosystem roles", "concept_list": ["ecosystem services", "ecosystem roles"], "type": "cluster", "node_size": 21, "label": "Ecosystem Services"}};
        const conceptData = {"anthropogenic stressors": {"concepts": "anthropogenic stressors", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "anthropogenic stressors"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "climate change"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "habitat forming species"}, "food benefits": {"concepts": "food benefits", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food benefits"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web"}, "food web supporting": {"concepts": "food web supporting", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web supporting"}, "nutritional benefits": {"concepts": "nutritional benefits", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "nutritional benefits"}, "food web supporting species": {"concepts": "food web supporting species", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web supporting species"}, "food security": {"concepts": "food security", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food security"}, "nutrition": {"concepts": "nutrition", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "nutrition"}, "single species fisheries management": {"concepts": "single species fisheries management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "single species fisheries management"}, "seabirds": {"concepts": "seabirds", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "seabirds"}, "seabird management": {"concepts": "seabird management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "seabird management"}, "small-scale fisheries": {"concepts": "small-scale fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "small-scale fisheries"}, "fisheries": {"concepts": "fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries"}, "fishermen": {"concepts": "fishermen", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishermen"}, "fisheries economics": {"concepts": "fisheries economics", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries economics"}, "nearby fisheries": {"concepts": "nearby fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "nearby fisheries"}, "marine resource management": {"concepts": "marine resource management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "marine resource management"}, "fishing sector": {"concepts": "fishing sector", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishing sector"}, "fishing biomass": {"concepts": "fishing biomass", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishing biomass"}, "oyster farmers": {"concepts": "oyster farmers", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "oyster farmers"}, "marine mammals": {"concepts": "marine mammals", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "marine mammals"}, "fisheries access": {"concepts": "fisheries access", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries access"}, "number of species": {"concepts": "number of species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "number of species"}, "lake victoria": {"concepts": "lake victoria", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "lake victoria"}, "wellbeing": {"concepts": "wellbeing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "wellbeing"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "harmful organisms"}, "unintended consequences": {"concepts": "unintended consequences", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "unintended consequences"}, "adjacency matrix": {"concepts": "adjacency matrix", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "adjacency matrix"}, "hippos": {"concepts": "hippos", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "hippos"}, "mental modeling": {"concepts": "mental modeling", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "mental modeling"}, "thesis chapter": {"concepts": "thesis chapter", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "thesis chapter"}, "cambodia": {"concepts": "cambodia", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "cambodia"}, "data collecting": {"concepts": "data collecting", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "data collecting"}, "tonle sap": {"concepts": "tonle sap", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "tonle sap"}, "flooding": {"concepts": "flooding", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "flooding"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "invasive species"}, "thematic coding framework": {"concepts": "thematic coding framework", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "thematic coding framework"}, "researchers": {"concepts": "researchers", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "researchers"}, "variety of traits": {"concepts": "variety of traits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "variety of traits"}, "mental modeler": {"concepts": "mental modeler", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "mental modeler"}, "regional managers": {"concepts": "regional managers", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "regional managers"}, "human wellbeing": {"concepts": "human wellbeing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "human wellbeing"}, "health": {"concepts": "health", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "health"}, "cultural benefits": {"concepts": "cultural benefits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "cultural benefits"}, "diversity of functions": {"concepts": "diversity of functions", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "diversity of functions"}, "resource users": {"concepts": "resource users", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "resource users"}, "economics": {"concepts": "economics", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "economics"}, "upstate new york": {"concepts": "upstate new york", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "upstate new york"}, "variety of species traits": {"concepts": "variety of species traits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "variety of species traits"}, "diverse functions": {"concepts": "diverse functions", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "diverse functions"}, "qualitative binning": {"concepts": "qualitative binning", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "qualitative binning"}, "stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "stakeholders"}, "kenya": {"concepts": "kenya", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "kenya"}, "species": {"concepts": "species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species"}, "ngos": {"concepts": "ngos", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "ngos"}, "stressors": {"concepts": "stressors", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "stressors"}, "east africa": {"concepts": "east africa", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "east africa"}, "species-specific management": {"concepts": "species-specific management", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species-specific management"}, "species increasing": {"concepts": "species increasing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species increasing"}, "contaminants": {"concepts": "contaminants", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "contaminants"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "biodiversity"}, "species of conservation concern": {"concepts": "species of conservation concern", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "species of conservation concern"}, "conservation management": {"concepts": "conservation management", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "conservation management"}, "kenya wildlife survey": {"concepts": "kenya wildlife survey", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "kenya wildlife survey"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "conservation concern"}, "endangered species management": {"concepts": "endangered species management", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species management"}, "human wildlife conflict": {"concepts": "human wildlife conflict", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "human wildlife conflict"}, "endangered species conservation": {"concepts": "endangered species conservation", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species conservation"}, "endangered species": {"concepts": "endangered species", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species"}, "coastal habitats": {"concepts": "coastal habitats", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "coastal habitats"}, "water quantity": {"concepts": "water quantity", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water quantity"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water quality"}, "water availability": {"concepts": "water availability", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water availability"}, "river dolphins": {"concepts": "river dolphins", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "river dolphins"}, "aquatic ecosystems": {"concepts": "aquatic ecosystems", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "aquatic ecosystems"}, "mekong river": {"concepts": "mekong river", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "mekong river"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Services", "node_size": 10, "label": "ecosystem services"}, "ecosystem roles": {"concepts": "ecosystem roles", "type": "concept", "cluster": "Ecosystem Services", "node_size": 10, "label": "ecosystem roles"}};
        const interClusterEdges = [["ecotourism sector", "habitat forming", {"weight": 0.8, "confidence": 0.5399999999999999, "type": "inter_cluster", "style": "solid"}], ["ecotourism sector", "Food Security", {"weight": -0.8, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["ecotourism sector", "Fisheries Management", {"weight": 0.6, "confidence": 0.39, "type": "inter_cluster", "style": "solid"}], ["habitat forming", "Ecosystem Services", {"weight": 0.6, "confidence": 0.4699999999999999, "type": "inter_cluster", "style": "solid"}], ["habitat forming", "Biodiversity Impacts", {"weight": 0.6, "confidence": 0.41999999999999993, "type": "inter_cluster", "style": "solid"}], ["habitat forming", "ecotourism", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["waterfront homeowners", "ecosystem", {"weight": 0.6, "confidence": 0.39, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "Ecosystem Services", {"weight": 0.6, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "habitat forming", {"weight": 0.8, "confidence": 0.5199999999999999, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "waterfront homeowners", {"weight": 0.75, "confidence": 0.4875, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "recreational benefits", {"weight": 0.5, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "environmental changes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["ecotourism", "Fisheries Management", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["recreational benefits", "Ecosystem Services", {"weight": 0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["recreational benefits", "Climate Stressors", {"weight": 0.8, "confidence": 0.5700000000000001, "type": "inter_cluster", "style": "solid"}], ["recreational benefits", "Fisheries Management", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["recreational benefits", "Endangered Species Conservation", {"weight": 0.25, "confidence": 0.1625, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "Endangered Species Conservation", {"weight": -0.6, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "ecosystem", {"weight": -1.0, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "ecotourism", {"weight": -0.2, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "Biodiversity Impacts", {"weight": -0.4, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "waterfront homeowners", {"weight": -0.3333333333333333, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "ecotourism sector", {"weight": -0.6666666666666666, "confidence": 0.4333333333333333, "type": "inter_cluster", "style": "solid"}], ["environmental changes", "Aquatic Ecosystems", {"weight": -0.5, "confidence": 0.325, "type": "inter_cluster", "style": "solid"}], ["ecosystem", "Fisheries Management", {"weight": 0.4, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["ecosystem", "Food Security", {"weight": -0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["ecosystem", "waterfront homeowners", {"weight": 0.6, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food Security", "Endangered Species Conservation", {"weight": -0.2, "confidence": 0.7200000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Security", "Biodiversity Impacts", {"weight": -0.8, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Security", "Ecosystem Services", {"weight": -0.4, "confidence": 0.5800000000000001, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "ecotourism", {"weight": 0.8, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "recreational benefits", {"weight": 0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Impacts", "Climate Stressors", {"weight": 0.2, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Impacts", "ecosystem", {"weight": 0.4, "confidence": 0.5700000000000001, "type": "inter_cluster", "style": "solid"}], ["Biodiversity Impacts", "habitat forming", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Endangered Species Conservation", "recreational benefits", {"weight": 0.2, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Climate Stressors", "habitat forming", {"weight": 0.8, "confidence": 0.56, "type": "inter_cluster", "style": "solid"}], ["Climate Stressors", "recreational benefits", {"weight": 0.8, "confidence": 0.58, "type": "inter_cluster", "style": "solid"}], ["Climate Stressors", "Ecosystem Services", {"weight": 0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Climate Stressors", "Biodiversity Impacts", {"weight": 0.25, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Aquatic Ecosystems", "waterfront homeowners", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Aquatic Ecosystems", "Food Security", {"weight": -0.4, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["Aquatic Ecosystems", "Ecosystem Services", {"weight": 0.4, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Aquatic Ecosystems", "Biodiversity Impacts", {"weight": 0.8, "confidence": 0.5599999999999999, "type": "inter_cluster", "style": "solid"}], ["Aquatic Ecosystems", "ecosystem", {"weight": 0.3333333333333333, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Services", "Climate Stressors", {"weight": 1.0, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Services", "Fisheries Management", {"weight": 0.8, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Services", "recreational benefits", {"weight": 0.8, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Ecosystem Services", "Aquatic Ecosystems", {"weight": 0.6666666666666666, "confidence": 0.5166666666666666, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Food Security": [["anthropogenic stressors", {"concepts": "anthropogenic stressors", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "anthropogenic stressors"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "climate change"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Food Security", "node_size": 10, "label": "habitat forming species"}]], "Fisheries Management": [["food benefits", {"concepts": "food benefits", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food benefits"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web"}], ["food web supporting", {"concepts": "food web supporting", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web supporting"}], ["nutritional benefits", {"concepts": "nutritional benefits", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "nutritional benefits"}], ["food web supporting species", {"concepts": "food web supporting species", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food web supporting species"}], ["food security", {"concepts": "food security", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "food security"}], ["nutrition", {"concepts": "nutrition", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "nutrition"}]], "Biodiversity Impacts": [["single species fisheries management", {"concepts": "single species fisheries management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "single species fisheries management"}], ["seabirds", {"concepts": "seabirds", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "seabirds"}], ["seabird management", {"concepts": "seabird management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "seabird management"}], ["small-scale fisheries", {"concepts": "small-scale fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "small-scale fisheries"}], ["fisheries", {"concepts": "fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries"}], ["fishermen", {"concepts": "fishermen", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishermen"}], ["fisheries economics", {"concepts": "fisheries economics", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries economics"}], ["nearby fisheries", {"concepts": "nearby fisheries", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "nearby fisheries"}], ["marine resource management", {"concepts": "marine resource management", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "marine resource management"}], ["fishing sector", {"concepts": "fishing sector", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishing sector"}], ["fishing biomass", {"concepts": "fishing biomass", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fishing biomass"}], ["oyster farmers", {"concepts": "oyster farmers", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "oyster farmers"}], ["marine mammals", {"concepts": "marine mammals", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "marine mammals"}], ["fisheries access", {"concepts": "fisheries access", "type": "concept", "cluster": "Biodiversity Impacts", "node_size": 10, "label": "fisheries access"}]], "Endangered Species Conservation": [["number of species", {"concepts": "number of species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "number of species"}], ["lake victoria", {"concepts": "lake victoria", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "lake victoria"}], ["wellbeing", {"concepts": "wellbeing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "wellbeing"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "harmful organisms"}], ["unintended consequences", {"concepts": "unintended consequences", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "unintended consequences"}], ["adjacency matrix", {"concepts": "adjacency matrix", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "adjacency matrix"}], ["hippos", {"concepts": "hippos", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "hippos"}], ["mental modeling", {"concepts": "mental modeling", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "mental modeling"}], ["thesis chapter", {"concepts": "thesis chapter", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "thesis chapter"}], ["cambodia", {"concepts": "cambodia", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "cambodia"}], ["data collecting", {"concepts": "data collecting", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "data collecting"}], ["tonle sap", {"concepts": "tonle sap", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "tonle sap"}], ["flooding", {"concepts": "flooding", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "flooding"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "invasive species"}], ["thematic coding framework", {"concepts": "thematic coding framework", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "thematic coding framework"}], ["researchers", {"concepts": "researchers", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "researchers"}], ["variety of traits", {"concepts": "variety of traits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "variety of traits"}], ["mental modeler", {"concepts": "mental modeler", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "mental modeler"}], ["regional managers", {"concepts": "regional managers", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "regional managers"}], ["human wellbeing", {"concepts": "human wellbeing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "human wellbeing"}], ["health", {"concepts": "health", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "health"}], ["cultural benefits", {"concepts": "cultural benefits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "cultural benefits"}], ["diversity of functions", {"concepts": "diversity of functions", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "diversity of functions"}], ["resource users", {"concepts": "resource users", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "resource users"}], ["economics", {"concepts": "economics", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "economics"}], ["upstate new york", {"concepts": "upstate new york", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "upstate new york"}], ["variety of species traits", {"concepts": "variety of species traits", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "variety of species traits"}], ["diverse functions", {"concepts": "diverse functions", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "diverse functions"}], ["qualitative binning", {"concepts": "qualitative binning", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "qualitative binning"}], ["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "stakeholders"}], ["kenya", {"concepts": "kenya", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "kenya"}], ["species", {"concepts": "species", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species"}], ["ngos", {"concepts": "ngos", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "ngos"}], ["stressors", {"concepts": "stressors", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "stressors"}], ["east africa", {"concepts": "east africa", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "east africa"}], ["species-specific management", {"concepts": "species-specific management", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species-specific management"}], ["species increasing", {"concepts": "species increasing", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "species increasing"}], ["contaminants", {"concepts": "contaminants", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "contaminants"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Endangered Species Conservation", "node_size": 10, "label": "biodiversity"}]], "Climate Stressors": [["species of conservation concern", {"concepts": "species of conservation concern", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "species of conservation concern"}], ["conservation management", {"concepts": "conservation management", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "conservation management"}], ["kenya wildlife survey", {"concepts": "kenya wildlife survey", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "kenya wildlife survey"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "conservation concern"}], ["endangered species management", {"concepts": "endangered species management", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species management"}], ["human wildlife conflict", {"concepts": "human wildlife conflict", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "human wildlife conflict"}], ["endangered species conservation", {"concepts": "endangered species conservation", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species conservation"}], ["endangered species", {"concepts": "endangered species", "type": "concept", "cluster": "Climate Stressors", "node_size": 10, "label": "endangered species"}]], "Aquatic Ecosystems": [["coastal habitats", {"concepts": "coastal habitats", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "coastal habitats"}], ["water quantity", {"concepts": "water quantity", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water quantity"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water quality"}], ["water availability", {"concepts": "water availability", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "water availability"}], ["river dolphins", {"concepts": "river dolphins", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "river dolphins"}], ["aquatic ecosystems", {"concepts": "aquatic ecosystems", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "aquatic ecosystems"}], ["mekong river", {"concepts": "mekong river", "type": "concept", "cluster": "Aquatic Ecosystems", "node_size": 10, "label": "mekong river"}]], "Ecosystem Services": [["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Ecosystem Services", "node_size": 10, "label": "ecosystem services"}], ["ecosystem roles", {"concepts": "ecosystem roles", "type": "concept", "cluster": "Ecosystem Services", "node_size": 10, "label": "ecosystem roles"}]]};
        const clusterEdges = {"Food Security": [], "Fisheries Management": [], "Biodiversity Impacts": [], "Endangered Species Conservation": [], "Climate Stressors": [], "Aquatic Ecosystems": [], "Ecosystem Services": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
