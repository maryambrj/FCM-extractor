
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Biodiversity Management & Stakeholders": {"concepts": "stakeholders, noise pollution, commercial species, biodiversity indices, mental modeling, incentivize, hypoxia, commercial interests, control, regulation change, ecosystem-based management, mpas, threatened species, species richness, place-based management, carbon sequestration, indigenous populations, wind farm, species range, harmful organisms, indigenous population, biogeographic break, management approaches, management, biodiversity, habitat-forming species, condition reports, invasive species, conservation concern, species conservation, upwelling, sanctuary advisory council, biodiversity metrics, transmission cables, microplastics, habitat forming species, kelp forest, resource management, shannon diversity, cultural interests, biogeography, keystone species, wind farms, storm frequency, stakeholder relationships, evenness, area-based tools, channel islands, cold spots, endangered species, transmission cable, research coordinator, decision-making, kelp, temperature, increased temperatures, habitat use, species distribution, no-take areas, user groups, advisory council, food chain, recreational interest, no-take zone, oa, food web, protected areas, species diversity, ecosystem services, voluntarily, hotspots, micro plastics, biodiversity hotspots, recreational interests, climate, cultural importance, noaa, climate change, resource managers, military", "concept_list": ["stakeholders", "noise pollution", "commercial species", "biodiversity indices", "mental modeling", "incentivize", "hypoxia", "commercial interests", "control", "regulation change", "ecosystem-based management", "mpas", "threatened species", "species richness", "place-based management", "carbon sequestration", "indigenous populations", "wind farm", "species range", "harmful organisms", "indigenous population", "biogeographic break", "management approaches", "management", "biodiversity", "habitat-forming species", "condition reports", "invasive species", "conservation concern", "species conservation", "upwelling", "sanctuary advisory council", "biodiversity metrics", "transmission cables", "microplastics", "habitat forming species", "kelp forest", "resource management", "shannon diversity", "cultural interests", "biogeography", "keystone species", "wind farms", "storm frequency", "stakeholder relationships", "evenness", "area-based tools", "channel islands", "cold spots", "endangered species", "transmission cable", "research coordinator", "decision-making", "kelp", "temperature", "increased temperatures", "habitat use", "species distribution", "no-take areas", "user groups", "advisory council", "food chain", "recreational interest", "no-take zone", "oa", "food web", "protected areas", "species diversity", "ecosystem services", "voluntarily", "hotspots", "micro plastics", "biodiversity hotspots", "recreational interests", "climate", "cultural importance", "noaa", "climate change", "resource managers", "military"], "type": "cluster", "node_size": 255, "label": "Biodiversity Management & Stakeholders"}, "Marine Habitat Protection": {"concepts": "harmful algal bloom, coral reefs, bottom disturbance, marine resource management, oysters, ship strikes, deep ocean, noaa fisheries, oil and gas, marine science, deep sea corals, ocean acidification, shipping lanes, fishery, oceanographic habitats, benthic habitats, marine protected areas, derelict fishing gear, marine debris, benthic disturbance, channel national marine sanctuary, seagrass communities, gear types, shipping industry, sponges, cetaceans, oil and gas exploration, marine sanctuary", "concept_list": ["harmful algal bloom", "coral reefs", "bottom disturbance", "marine resource management", "oysters", "ship strikes", "deep ocean", "noaa fisheries", "oil and gas", "marine science", "deep sea corals", "ocean acidification", "shipping lanes", "fishery", "oceanographic habitats", "benthic habitats", "marine protected areas", "derelict fishing gear", "marine debris", "benthic disturbance", "channel national marine sanctuary", "seagrass communities", "gear types", "shipping industry", "sponges", "cetaceans", "oil and gas exploration", "marine sanctuary"], "type": "cluster", "node_size": 99, "label": "Marine Habitat Protection"}};
        const conceptData = {"stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "stakeholders"}, "noise pollution": {"concepts": "noise pollution", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "noise pollution"}, "commercial species": {"concepts": "commercial species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "commercial species"}, "biodiversity indices": {"concepts": "biodiversity indices", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity indices"}, "mental modeling": {"concepts": "mental modeling", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "mental modeling"}, "incentivize": {"concepts": "incentivize", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "incentivize"}, "hypoxia": {"concepts": "hypoxia", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "hypoxia"}, "commercial interests": {"concepts": "commercial interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "commercial interests"}, "control": {"concepts": "control", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "control"}, "regulation change": {"concepts": "regulation change", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "regulation change"}, "ecosystem-based management": {"concepts": "ecosystem-based management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "ecosystem-based management"}, "mpas": {"concepts": "mpas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "mpas"}, "threatened species": {"concepts": "threatened species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "threatened species"}, "species richness": {"concepts": "species richness", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species richness"}, "place-based management": {"concepts": "place-based management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "place-based management"}, "carbon sequestration": {"concepts": "carbon sequestration", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "carbon sequestration"}, "indigenous populations": {"concepts": "indigenous populations", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "indigenous populations"}, "wind farm": {"concepts": "wind farm", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "wind farm"}, "species range": {"concepts": "species range", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species range"}, "harmful organisms": {"concepts": "harmful organisms", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "harmful organisms"}, "indigenous population": {"concepts": "indigenous population", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "indigenous population"}, "biogeographic break": {"concepts": "biogeographic break", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biogeographic break"}, "management approaches": {"concepts": "management approaches", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "management approaches"}, "management": {"concepts": "management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "management"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity"}, "habitat-forming species": {"concepts": "habitat-forming species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat-forming species"}, "condition reports": {"concepts": "condition reports", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "condition reports"}, "invasive species": {"concepts": "invasive species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "invasive species"}, "conservation concern": {"concepts": "conservation concern", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "conservation concern"}, "species conservation": {"concepts": "species conservation", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species conservation"}, "upwelling": {"concepts": "upwelling", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "upwelling"}, "sanctuary advisory council": {"concepts": "sanctuary advisory council", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "sanctuary advisory council"}, "biodiversity metrics": {"concepts": "biodiversity metrics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity metrics"}, "transmission cables": {"concepts": "transmission cables", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "transmission cables"}, "microplastics": {"concepts": "microplastics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "microplastics"}, "habitat forming species": {"concepts": "habitat forming species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat forming species"}, "kelp forest": {"concepts": "kelp forest", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "kelp forest"}, "resource management": {"concepts": "resource management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "resource management"}, "shannon diversity": {"concepts": "shannon diversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "shannon diversity"}, "cultural interests": {"concepts": "cultural interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cultural interests"}, "biogeography": {"concepts": "biogeography", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biogeography"}, "keystone species": {"concepts": "keystone species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "keystone species"}, "wind farms": {"concepts": "wind farms", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "wind farms"}, "storm frequency": {"concepts": "storm frequency", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "storm frequency"}, "stakeholder relationships": {"concepts": "stakeholder relationships", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "stakeholder relationships"}, "evenness": {"concepts": "evenness", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "evenness"}, "area-based tools": {"concepts": "area-based tools", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "area-based tools"}, "channel islands": {"concepts": "channel islands", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "channel islands"}, "cold spots": {"concepts": "cold spots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cold spots"}, "endangered species": {"concepts": "endangered species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "endangered species"}, "transmission cable": {"concepts": "transmission cable", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "transmission cable"}, "research coordinator": {"concepts": "research coordinator", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "research coordinator"}, "decision-making": {"concepts": "decision-making", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "decision-making"}, "kelp": {"concepts": "kelp", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "kelp"}, "temperature": {"concepts": "temperature", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "temperature"}, "increased temperatures": {"concepts": "increased temperatures", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "increased temperatures"}, "habitat use": {"concepts": "habitat use", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat use"}, "species distribution": {"concepts": "species distribution", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species distribution"}, "no-take areas": {"concepts": "no-take areas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "no-take areas"}, "user groups": {"concepts": "user groups", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "user groups"}, "advisory council": {"concepts": "advisory council", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "advisory council"}, "food chain": {"concepts": "food chain", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "food chain"}, "recreational interest": {"concepts": "recreational interest", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "recreational interest"}, "no-take zone": {"concepts": "no-take zone", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "no-take zone"}, "oa": {"concepts": "oa", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "oa"}, "food web": {"concepts": "food web", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "food web"}, "protected areas": {"concepts": "protected areas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "protected areas"}, "species diversity": {"concepts": "species diversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species diversity"}, "ecosystem services": {"concepts": "ecosystem services", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "ecosystem services"}, "voluntarily": {"concepts": "voluntarily", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "voluntarily"}, "hotspots": {"concepts": "hotspots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "hotspots"}, "micro plastics": {"concepts": "micro plastics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "micro plastics"}, "biodiversity hotspots": {"concepts": "biodiversity hotspots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity hotspots"}, "recreational interests": {"concepts": "recreational interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "recreational interests"}, "climate": {"concepts": "climate", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "climate"}, "cultural importance": {"concepts": "cultural importance", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cultural importance"}, "noaa": {"concepts": "noaa", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "noaa"}, "climate change": {"concepts": "climate change", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "climate change"}, "resource managers": {"concepts": "resource managers", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "resource managers"}, "military": {"concepts": "military", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "military"}, "harmful algal bloom": {"concepts": "harmful algal bloom", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "harmful algal bloom"}, "coral reefs": {"concepts": "coral reefs", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "coral reefs"}, "bottom disturbance": {"concepts": "bottom disturbance", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "bottom disturbance"}, "marine resource management": {"concepts": "marine resource management", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine resource management"}, "oysters": {"concepts": "oysters", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oysters"}, "ship strikes": {"concepts": "ship strikes", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "ship strikes"}, "deep ocean": {"concepts": "deep ocean", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "deep ocean"}, "noaa fisheries": {"concepts": "noaa fisheries", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "noaa fisheries"}, "oil and gas": {"concepts": "oil and gas", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oil and gas"}, "marine science": {"concepts": "marine science", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine science"}, "deep sea corals": {"concepts": "deep sea corals", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "deep sea corals"}, "ocean acidification": {"concepts": "ocean acidification", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "ocean acidification"}, "shipping lanes": {"concepts": "shipping lanes", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "shipping lanes"}, "fishery": {"concepts": "fishery", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "fishery"}, "oceanographic habitats": {"concepts": "oceanographic habitats", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oceanographic habitats"}, "benthic habitats": {"concepts": "benthic habitats", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "benthic habitats"}, "marine protected areas": {"concepts": "marine protected areas", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine protected areas"}, "derelict fishing gear": {"concepts": "derelict fishing gear", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "derelict fishing gear"}, "marine debris": {"concepts": "marine debris", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine debris"}, "benthic disturbance": {"concepts": "benthic disturbance", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "benthic disturbance"}, "channel national marine sanctuary": {"concepts": "channel national marine sanctuary", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "channel national marine sanctuary"}, "seagrass communities": {"concepts": "seagrass communities", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "seagrass communities"}, "gear types": {"concepts": "gear types", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "gear types"}, "shipping industry": {"concepts": "shipping industry", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "shipping industry"}, "sponges": {"concepts": "sponges", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "sponges"}, "cetaceans": {"concepts": "cetaceans", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "cetaceans"}, "oil and gas exploration": {"concepts": "oil and gas exploration", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oil and gas exploration"}, "marine sanctuary": {"concepts": "marine sanctuary", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine sanctuary"}};
        const interClusterEdges = [["Biodiversity Management & Stakeholders", "Marine Habitat Protection", {"weight": 1.0, "confidence": 0.9499999999999998, "type": "inter_cluster", "style": "solid"}], ["Marine Habitat Protection", "Biodiversity Management & Stakeholders", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Biodiversity Management & Stakeholders": [["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "stakeholders"}], ["noise pollution", {"concepts": "noise pollution", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "noise pollution"}], ["commercial species", {"concepts": "commercial species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "commercial species"}], ["biodiversity indices", {"concepts": "biodiversity indices", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity indices"}], ["mental modeling", {"concepts": "mental modeling", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "mental modeling"}], ["incentivize", {"concepts": "incentivize", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "incentivize"}], ["hypoxia", {"concepts": "hypoxia", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "hypoxia"}], ["commercial interests", {"concepts": "commercial interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "commercial interests"}], ["control", {"concepts": "control", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "control"}], ["regulation change", {"concepts": "regulation change", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "regulation change"}], ["ecosystem-based management", {"concepts": "ecosystem-based management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "ecosystem-based management"}], ["mpas", {"concepts": "mpas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "mpas"}], ["threatened species", {"concepts": "threatened species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "threatened species"}], ["species richness", {"concepts": "species richness", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species richness"}], ["place-based management", {"concepts": "place-based management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "place-based management"}], ["carbon sequestration", {"concepts": "carbon sequestration", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "carbon sequestration"}], ["indigenous populations", {"concepts": "indigenous populations", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "indigenous populations"}], ["wind farm", {"concepts": "wind farm", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "wind farm"}], ["species range", {"concepts": "species range", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species range"}], ["harmful organisms", {"concepts": "harmful organisms", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "harmful organisms"}], ["indigenous population", {"concepts": "indigenous population", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "indigenous population"}], ["biogeographic break", {"concepts": "biogeographic break", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biogeographic break"}], ["management approaches", {"concepts": "management approaches", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "management approaches"}], ["management", {"concepts": "management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "management"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity"}], ["habitat-forming species", {"concepts": "habitat-forming species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat-forming species"}], ["condition reports", {"concepts": "condition reports", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "condition reports"}], ["invasive species", {"concepts": "invasive species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "invasive species"}], ["conservation concern", {"concepts": "conservation concern", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "conservation concern"}], ["species conservation", {"concepts": "species conservation", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species conservation"}], ["upwelling", {"concepts": "upwelling", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "upwelling"}], ["sanctuary advisory council", {"concepts": "sanctuary advisory council", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "sanctuary advisory council"}], ["biodiversity metrics", {"concepts": "biodiversity metrics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity metrics"}], ["transmission cables", {"concepts": "transmission cables", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "transmission cables"}], ["microplastics", {"concepts": "microplastics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "microplastics"}], ["habitat forming species", {"concepts": "habitat forming species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat forming species"}], ["kelp forest", {"concepts": "kelp forest", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "kelp forest"}], ["resource management", {"concepts": "resource management", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "resource management"}], ["shannon diversity", {"concepts": "shannon diversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "shannon diversity"}], ["cultural interests", {"concepts": "cultural interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cultural interests"}], ["biogeography", {"concepts": "biogeography", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biogeography"}], ["keystone species", {"concepts": "keystone species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "keystone species"}], ["wind farms", {"concepts": "wind farms", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "wind farms"}], ["storm frequency", {"concepts": "storm frequency", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "storm frequency"}], ["stakeholder relationships", {"concepts": "stakeholder relationships", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "stakeholder relationships"}], ["evenness", {"concepts": "evenness", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "evenness"}], ["area-based tools", {"concepts": "area-based tools", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "area-based tools"}], ["channel islands", {"concepts": "channel islands", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "channel islands"}], ["cold spots", {"concepts": "cold spots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cold spots"}], ["endangered species", {"concepts": "endangered species", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "endangered species"}], ["transmission cable", {"concepts": "transmission cable", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "transmission cable"}], ["research coordinator", {"concepts": "research coordinator", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "research coordinator"}], ["decision-making", {"concepts": "decision-making", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "decision-making"}], ["kelp", {"concepts": "kelp", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "kelp"}], ["temperature", {"concepts": "temperature", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "temperature"}], ["increased temperatures", {"concepts": "increased temperatures", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "increased temperatures"}], ["habitat use", {"concepts": "habitat use", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "habitat use"}], ["species distribution", {"concepts": "species distribution", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species distribution"}], ["no-take areas", {"concepts": "no-take areas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "no-take areas"}], ["user groups", {"concepts": "user groups", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "user groups"}], ["advisory council", {"concepts": "advisory council", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "advisory council"}], ["food chain", {"concepts": "food chain", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "food chain"}], ["recreational interest", {"concepts": "recreational interest", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "recreational interest"}], ["no-take zone", {"concepts": "no-take zone", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "no-take zone"}], ["oa", {"concepts": "oa", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "oa"}], ["food web", {"concepts": "food web", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "food web"}], ["protected areas", {"concepts": "protected areas", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "protected areas"}], ["species diversity", {"concepts": "species diversity", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "species diversity"}], ["ecosystem services", {"concepts": "ecosystem services", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "ecosystem services"}], ["voluntarily", {"concepts": "voluntarily", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "voluntarily"}], ["hotspots", {"concepts": "hotspots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "hotspots"}], ["micro plastics", {"concepts": "micro plastics", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "micro plastics"}], ["biodiversity hotspots", {"concepts": "biodiversity hotspots", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "biodiversity hotspots"}], ["recreational interests", {"concepts": "recreational interests", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "recreational interests"}], ["climate", {"concepts": "climate", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "climate"}], ["cultural importance", {"concepts": "cultural importance", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "cultural importance"}], ["noaa", {"concepts": "noaa", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "noaa"}], ["climate change", {"concepts": "climate change", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "climate change"}], ["resource managers", {"concepts": "resource managers", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "resource managers"}], ["military", {"concepts": "military", "type": "concept", "cluster": "Biodiversity Management & Stakeholders", "node_size": 10, "label": "military"}]], "Marine Habitat Protection": [["harmful algal bloom", {"concepts": "harmful algal bloom", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "harmful algal bloom"}], ["coral reefs", {"concepts": "coral reefs", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "coral reefs"}], ["bottom disturbance", {"concepts": "bottom disturbance", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "bottom disturbance"}], ["marine resource management", {"concepts": "marine resource management", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine resource management"}], ["oysters", {"concepts": "oysters", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oysters"}], ["ship strikes", {"concepts": "ship strikes", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "ship strikes"}], ["deep ocean", {"concepts": "deep ocean", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "deep ocean"}], ["noaa fisheries", {"concepts": "noaa fisheries", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "noaa fisheries"}], ["oil and gas", {"concepts": "oil and gas", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oil and gas"}], ["marine science", {"concepts": "marine science", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine science"}], ["deep sea corals", {"concepts": "deep sea corals", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "deep sea corals"}], ["ocean acidification", {"concepts": "ocean acidification", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "ocean acidification"}], ["shipping lanes", {"concepts": "shipping lanes", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "shipping lanes"}], ["fishery", {"concepts": "fishery", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "fishery"}], ["oceanographic habitats", {"concepts": "oceanographic habitats", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oceanographic habitats"}], ["benthic habitats", {"concepts": "benthic habitats", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "benthic habitats"}], ["marine protected areas", {"concepts": "marine protected areas", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine protected areas"}], ["derelict fishing gear", {"concepts": "derelict fishing gear", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "derelict fishing gear"}], ["marine debris", {"concepts": "marine debris", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine debris"}], ["benthic disturbance", {"concepts": "benthic disturbance", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "benthic disturbance"}], ["channel national marine sanctuary", {"concepts": "channel national marine sanctuary", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "channel national marine sanctuary"}], ["seagrass communities", {"concepts": "seagrass communities", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "seagrass communities"}], ["gear types", {"concepts": "gear types", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "gear types"}], ["shipping industry", {"concepts": "shipping industry", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "shipping industry"}], ["sponges", {"concepts": "sponges", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "sponges"}], ["cetaceans", {"concepts": "cetaceans", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "cetaceans"}], ["oil and gas exploration", {"concepts": "oil and gas exploration", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "oil and gas exploration"}], ["marine sanctuary", {"concepts": "marine sanctuary", "type": "concept", "cluster": "Marine Habitat Protection", "node_size": 10, "label": "marine sanctuary"}]]};
        const clusterEdges = {"Biodiversity Management & Stakeholders": [], "Marine Habitat Protection": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
