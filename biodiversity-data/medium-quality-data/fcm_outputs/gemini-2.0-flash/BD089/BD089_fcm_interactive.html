
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Habitat & Ecosystems": {"concepts": "toxic chemicals, toxic, chemicals, industrial laundry, fibercarbon, pharmaceuticals, cancer, chemical concerns, tires, antioxidizing agent", "concept_list": ["toxic chemicals", "toxic", "chemicals", "industrial laundry", "fibercarbon", "pharmaceuticals", "cancer", "chemical concerns", "tires", "antioxidizing agent"], "type": "cluster", "node_size": 45, "label": "Habitat & Ecosystems"}, "Resource Management": {"concepts": "shifting ecosystems, critical habitats, estuaries, marine habitats, forage fish, fish habitat, higher elevation forests, rearing ponds, salmon, small streams, important habitats, marine habitat, ecosystems, marine, ecosystem recovery, water quality, salmon recovery, wetlands, food chain, orca, nearshore, natal river, restoration project", "concept_list": ["shifting ecosystems", "critical habitats", "estuaries", "marine habitats", "forage fish", "fish habitat", "higher elevation forests", "rearing ponds", "salmon", "small streams", "important habitats", "marine habitat", "ecosystems", "marine", "ecosystem recovery", "water quality", "salmon recovery", "wetlands", "food chain", "orca", "nearshore", "natal river", "restoration project"], "type": "cluster", "node_size": 84, "label": "Resource Management"}, "Perspectives & Culture": {"concepts": "populations, resource management, orca recovery, connections, habitat engineers, beaver structures, affect change, bottlenecks, forestry, beaver relocation, trophic bottleneck, regulatory, biodiversity, biodiversity context, change, protect biodiversity, indicator species, conservation, management, changing environments, key aspects, species of concern, system health, mortality", "concept_list": ["populations", "resource management", "orca recovery", "connections", "habitat engineers", "beaver structures", "affect change", "bottlenecks", "forestry", "beaver relocation", "trophic bottleneck", "regulatory", "biodiversity", "biodiversity context", "change", "protect biodiversity", "indicator species", "conservation", "management", "changing environments", "key aspects", "species of concern", "system health", "mortality"], "type": "cluster", "node_size": 87, "label": "Perspectives & Culture"}, "Trophic Dynamics": {"concepts": "treatment plan, workshop, religion, sand culture, climate, culture, perspectives, metabolism rate, perspective", "concept_list": ["treatment plan", "workshop", "religion", "sand culture", "climate", "culture", "perspectives", "metabolism rate", "perspective"], "type": "cluster", "node_size": 42, "label": "Trophic Dynamics"}, "Chemical Toxicity": {"concepts": "pvds, trophic", "concept_list": ["pvds", "trophic"], "type": "cluster", "node_size": 21, "label": "Chemical Toxicity"}, "Ethical PR": {"concepts": "ethics, public relations", "concept_list": ["ethics", "public relations"], "type": "cluster", "node_size": 21, "label": "Ethical PR"}, "Property Law": {"concepts": "legal stuff, legal aspect, state law, legal, property rights", "concept_list": ["legal stuff", "legal aspect", "state law", "legal", "property rights"], "type": "cluster", "node_size": 30, "label": "Property Law"}};
        const conceptData = {"toxic chemicals": {"concepts": "toxic chemicals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "toxic chemicals"}, "toxic": {"concepts": "toxic", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "toxic"}, "chemicals": {"concepts": "chemicals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "chemicals"}, "industrial laundry": {"concepts": "industrial laundry", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "industrial laundry"}, "fibercarbon": {"concepts": "fibercarbon", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "fibercarbon"}, "pharmaceuticals": {"concepts": "pharmaceuticals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "pharmaceuticals"}, "cancer": {"concepts": "cancer", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "cancer"}, "chemical concerns": {"concepts": "chemical concerns", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "chemical concerns"}, "tires": {"concepts": "tires", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "tires"}, "antioxidizing agent": {"concepts": "antioxidizing agent", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "antioxidizing agent"}, "shifting ecosystems": {"concepts": "shifting ecosystems", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "shifting ecosystems"}, "critical habitats": {"concepts": "critical habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "critical habitats"}, "estuaries": {"concepts": "estuaries", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "estuaries"}, "marine habitats": {"concepts": "marine habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine habitats"}, "forage fish": {"concepts": "forage fish", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "forage fish"}, "fish habitat": {"concepts": "fish habitat", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "fish habitat"}, "higher elevation forests": {"concepts": "higher elevation forests", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "higher elevation forests"}, "rearing ponds": {"concepts": "rearing ponds", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "rearing ponds"}, "salmon": {"concepts": "salmon", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "salmon"}, "small streams": {"concepts": "small streams", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "small streams"}, "important habitats": {"concepts": "important habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "important habitats"}, "marine habitat": {"concepts": "marine habitat", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine habitat"}, "ecosystems": {"concepts": "ecosystems", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "ecosystems"}, "marine": {"concepts": "marine", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine"}, "ecosystem recovery": {"concepts": "ecosystem recovery", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "ecosystem recovery"}, "water quality": {"concepts": "water quality", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "water quality"}, "salmon recovery": {"concepts": "salmon recovery", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "salmon recovery"}, "wetlands": {"concepts": "wetlands", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "wetlands"}, "food chain": {"concepts": "food chain", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "food chain"}, "orca": {"concepts": "orca", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "orca"}, "nearshore": {"concepts": "nearshore", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "nearshore"}, "natal river": {"concepts": "natal river", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "natal river"}, "restoration project": {"concepts": "restoration project", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "restoration project"}, "populations": {"concepts": "populations", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "populations"}, "resource management": {"concepts": "resource management", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "resource management"}, "orca recovery": {"concepts": "orca recovery", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "orca recovery"}, "connections": {"concepts": "connections", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "connections"}, "habitat engineers": {"concepts": "habitat engineers", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "habitat engineers"}, "beaver structures": {"concepts": "beaver structures", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "beaver structures"}, "affect change": {"concepts": "affect change", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "affect change"}, "bottlenecks": {"concepts": "bottlenecks", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "bottlenecks"}, "forestry": {"concepts": "forestry", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "forestry"}, "beaver relocation": {"concepts": "beaver relocation", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "beaver relocation"}, "trophic bottleneck": {"concepts": "trophic bottleneck", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "trophic bottleneck"}, "regulatory": {"concepts": "regulatory", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "regulatory"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "biodiversity"}, "biodiversity context": {"concepts": "biodiversity context", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "biodiversity context"}, "change": {"concepts": "change", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "change"}, "protect biodiversity": {"concepts": "protect biodiversity", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "protect biodiversity"}, "indicator species": {"concepts": "indicator species", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "indicator species"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "conservation"}, "management": {"concepts": "management", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "management"}, "changing environments": {"concepts": "changing environments", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "changing environments"}, "key aspects": {"concepts": "key aspects", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "key aspects"}, "species of concern": {"concepts": "species of concern", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "species of concern"}, "system health": {"concepts": "system health", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "system health"}, "mortality": {"concepts": "mortality", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "mortality"}, "treatment plan": {"concepts": "treatment plan", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "treatment plan"}, "workshop": {"concepts": "workshop", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "workshop"}, "religion": {"concepts": "religion", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "religion"}, "sand culture": {"concepts": "sand culture", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "sand culture"}, "climate": {"concepts": "climate", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "climate"}, "culture": {"concepts": "culture", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "culture"}, "perspectives": {"concepts": "perspectives", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "perspectives"}, "metabolism rate": {"concepts": "metabolism rate", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "metabolism rate"}, "perspective": {"concepts": "perspective", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "perspective"}, "pvds": {"concepts": "pvds", "type": "concept", "cluster": "Chemical Toxicity", "node_size": 10, "label": "pvds"}, "trophic": {"concepts": "trophic", "type": "concept", "cluster": "Chemical Toxicity", "node_size": 10, "label": "trophic"}, "ethics": {"concepts": "ethics", "type": "concept", "cluster": "Ethical PR", "node_size": 10, "label": "ethics"}, "public relations": {"concepts": "public relations", "type": "concept", "cluster": "Ethical PR", "node_size": 10, "label": "public relations"}, "legal stuff": {"concepts": "legal stuff", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal stuff"}, "legal aspect": {"concepts": "legal aspect", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal aspect"}, "state law": {"concepts": "state law", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "state law"}, "legal": {"concepts": "legal", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal"}, "property rights": {"concepts": "property rights", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "property rights"}};
        const interClusterEdges = [["Habitat & Ecosystems", "Resource Management", {"weight": -1.0, "confidence": 0.7200000000000001, "type": "inter_cluster", "style": "solid"}], ["Habitat & Ecosystems", "Perspectives & Culture", {"weight": -1.0, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Habitat & Ecosystems", "Chemical Toxicity", {"weight": 0.6, "confidence": 0.38, "type": "inter_cluster", "style": "solid"}], ["Habitat & Ecosystems", "Property Law", {"weight": 0.8, "confidence": 0.29000000000000004, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Perspectives & Culture", {"weight": 1.0, "confidence": 0.7249999999999999, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Property Law", {"weight": 0.25, "confidence": 0.3125, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Habitat & Ecosystems", {"weight": 0.8, "confidence": 0.23000000000000004, "type": "inter_cluster", "style": "solid"}], ["Resource Management", "Ethical PR", {"weight": 0.6, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Perspectives & Culture", "Resource Management", {"weight": 1.0, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Perspectives & Culture", "Ethical PR", {"weight": 1.0, "confidence": 0.51, "type": "inter_cluster", "style": "solid"}], ["Perspectives & Culture", "Property Law", {"weight": 1.0, "confidence": 0.5125, "type": "inter_cluster", "style": "solid"}], ["Perspectives & Culture", "Habitat & Ecosystems", {"weight": -0.8, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Trophic Dynamics", "Ethical PR", {"weight": 0.4, "confidence": 0.15, "type": "inter_cluster", "style": "solid"}], ["Trophic Dynamics", "Resource Management", {"weight": 0.2, "confidence": 0.06999999999999999, "type": "inter_cluster", "style": "solid"}], ["Chemical Toxicity", "Habitat & Ecosystems", {"weight": 1.0, "confidence": 0.71, "type": "inter_cluster", "style": "solid"}], ["Chemical Toxicity", "Perspectives & Culture", {"weight": -1.0, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Chemical Toxicity", "Resource Management", {"weight": -1.0, "confidence": 0.53, "type": "inter_cluster", "style": "solid"}], ["Ethical PR", "Perspectives & Culture", {"weight": 0.5, "confidence": 0.2, "type": "inter_cluster", "style": "solid"}], ["Ethical PR", "Resource Management", {"weight": 0.25, "confidence": 0.075, "type": "inter_cluster", "style": "solid"}], ["Ethical PR", "Habitat & Ecosystems", {"weight": -0.25, "confidence": 0.0625, "type": "inter_cluster", "style": "solid"}], ["Ethical PR", "Trophic Dynamics", {"weight": 0.25, "confidence": 0.05, "type": "inter_cluster", "style": "solid"}], ["Property Law", "Perspectives & Culture", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Property Law", "Resource Management", {"weight": 0.4, "confidence": 0.31000000000000005, "type": "inter_cluster", "style": "solid"}], ["Property Law", "Ethical PR", {"weight": 0.6, "confidence": 0.22000000000000003, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Habitat & Ecosystems": [["toxic chemicals", {"concepts": "toxic chemicals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "toxic chemicals"}], ["toxic", {"concepts": "toxic", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "toxic"}], ["chemicals", {"concepts": "chemicals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "chemicals"}], ["industrial laundry", {"concepts": "industrial laundry", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "industrial laundry"}], ["fibercarbon", {"concepts": "fibercarbon", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "fibercarbon"}], ["pharmaceuticals", {"concepts": "pharmaceuticals", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "pharmaceuticals"}], ["cancer", {"concepts": "cancer", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "cancer"}], ["chemical concerns", {"concepts": "chemical concerns", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "chemical concerns"}], ["tires", {"concepts": "tires", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "tires"}], ["antioxidizing agent", {"concepts": "antioxidizing agent", "type": "concept", "cluster": "Habitat & Ecosystems", "node_size": 10, "label": "antioxidizing agent"}]], "Resource Management": [["shifting ecosystems", {"concepts": "shifting ecosystems", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "shifting ecosystems"}], ["critical habitats", {"concepts": "critical habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "critical habitats"}], ["estuaries", {"concepts": "estuaries", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "estuaries"}], ["marine habitats", {"concepts": "marine habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine habitats"}], ["forage fish", {"concepts": "forage fish", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "forage fish"}], ["fish habitat", {"concepts": "fish habitat", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "fish habitat"}], ["higher elevation forests", {"concepts": "higher elevation forests", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "higher elevation forests"}], ["rearing ponds", {"concepts": "rearing ponds", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "rearing ponds"}], ["salmon", {"concepts": "salmon", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "salmon"}], ["small streams", {"concepts": "small streams", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "small streams"}], ["important habitats", {"concepts": "important habitats", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "important habitats"}], ["marine habitat", {"concepts": "marine habitat", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine habitat"}], ["ecosystems", {"concepts": "ecosystems", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "ecosystems"}], ["marine", {"concepts": "marine", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "marine"}], ["ecosystem recovery", {"concepts": "ecosystem recovery", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "ecosystem recovery"}], ["water quality", {"concepts": "water quality", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "water quality"}], ["salmon recovery", {"concepts": "salmon recovery", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "salmon recovery"}], ["wetlands", {"concepts": "wetlands", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "wetlands"}], ["food chain", {"concepts": "food chain", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "food chain"}], ["orca", {"concepts": "orca", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "orca"}], ["nearshore", {"concepts": "nearshore", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "nearshore"}], ["natal river", {"concepts": "natal river", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "natal river"}], ["restoration project", {"concepts": "restoration project", "type": "concept", "cluster": "Resource Management", "node_size": 10, "label": "restoration project"}]], "Perspectives & Culture": [["populations", {"concepts": "populations", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "populations"}], ["resource management", {"concepts": "resource management", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "resource management"}], ["orca recovery", {"concepts": "orca recovery", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "orca recovery"}], ["connections", {"concepts": "connections", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "connections"}], ["habitat engineers", {"concepts": "habitat engineers", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "habitat engineers"}], ["beaver structures", {"concepts": "beaver structures", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "beaver structures"}], ["affect change", {"concepts": "affect change", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "affect change"}], ["bottlenecks", {"concepts": "bottlenecks", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "bottlenecks"}], ["forestry", {"concepts": "forestry", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "forestry"}], ["beaver relocation", {"concepts": "beaver relocation", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "beaver relocation"}], ["trophic bottleneck", {"concepts": "trophic bottleneck", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "trophic bottleneck"}], ["regulatory", {"concepts": "regulatory", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "regulatory"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "biodiversity"}], ["biodiversity context", {"concepts": "biodiversity context", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "biodiversity context"}], ["change", {"concepts": "change", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "change"}], ["protect biodiversity", {"concepts": "protect biodiversity", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "protect biodiversity"}], ["indicator species", {"concepts": "indicator species", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "indicator species"}], ["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "conservation"}], ["management", {"concepts": "management", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "management"}], ["changing environments", {"concepts": "changing environments", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "changing environments"}], ["key aspects", {"concepts": "key aspects", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "key aspects"}], ["species of concern", {"concepts": "species of concern", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "species of concern"}], ["system health", {"concepts": "system health", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "system health"}], ["mortality", {"concepts": "mortality", "type": "concept", "cluster": "Perspectives & Culture", "node_size": 10, "label": "mortality"}]], "Trophic Dynamics": [["treatment plan", {"concepts": "treatment plan", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "treatment plan"}], ["workshop", {"concepts": "workshop", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "workshop"}], ["religion", {"concepts": "religion", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "religion"}], ["sand culture", {"concepts": "sand culture", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "sand culture"}], ["climate", {"concepts": "climate", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "climate"}], ["culture", {"concepts": "culture", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "culture"}], ["perspectives", {"concepts": "perspectives", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "perspectives"}], ["metabolism rate", {"concepts": "metabolism rate", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "metabolism rate"}], ["perspective", {"concepts": "perspective", "type": "concept", "cluster": "Trophic Dynamics", "node_size": 10, "label": "perspective"}]], "Chemical Toxicity": [["pvds", {"concepts": "pvds", "type": "concept", "cluster": "Chemical Toxicity", "node_size": 10, "label": "pvds"}], ["trophic", {"concepts": "trophic", "type": "concept", "cluster": "Chemical Toxicity", "node_size": 10, "label": "trophic"}]], "Ethical PR": [["ethics", {"concepts": "ethics", "type": "concept", "cluster": "Ethical PR", "node_size": 10, "label": "ethics"}], ["public relations", {"concepts": "public relations", "type": "concept", "cluster": "Ethical PR", "node_size": 10, "label": "public relations"}]], "Property Law": [["legal stuff", {"concepts": "legal stuff", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal stuff"}], ["legal aspect", {"concepts": "legal aspect", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal aspect"}], ["state law", {"concepts": "state law", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "state law"}], ["legal", {"concepts": "legal", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "legal"}], ["property rights", {"concepts": "property rights", "type": "concept", "cluster": "Property Law", "node_size": 10, "label": "property rights"}]]};
        const clusterEdges = {"Habitat & Ecosystems": [], "Resource Management": [], "Perspectives & Culture": [], "Trophic Dynamics": [], "Chemical Toxicity": [], "Ethical PR": [], "Property Law": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
