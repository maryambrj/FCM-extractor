
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Management Policy": {"concepts": "manager, researcher, management research, research coordinator, single species, budget overview, experience, research background, habitat-forming species", "concept_list": ["manager", "researcher", "management research", "research coordinator", "single species", "budget overview", "experience", "research background", "habitat-forming species"], "type": "cluster", "node_size": 42, "label": "Management Policy"}, "Data & Surveys": {"concepts": "escape ring policy, management decisions, ecosystem management, impact assessment, policy changes, operational plans, restrictive management, policy, management plan, harvest strategy, management, bycatch, regulations, species management, habitat management", "concept_list": ["escape ring policy", "management decisions", "ecosystem management", "impact assessment", "policy changes", "operational plans", "restrictive management", "policy", "management plan", "harvest strategy", "management", "bycatch", "regulations", "species management", "habitat management"], "type": "cluster", "node_size": 60, "label": "Data & Surveys"}, "Fisheries Management": {"concepts": "board of fisheries, fishery management, fisheries, fisheries management, charter fleets, dungeness crab", "concept_list": ["board of fisheries", "fishery management", "fisheries", "fisheries management", "charter fleets", "dungeness crab"], "type": "cluster", "node_size": 33, "label": "Fisheries Management"}, "Charter Fleets": {"concepts": "natural science, rocky habitat, demersal-shelf rocinterviewerish, relationship weights, localized depletion, education, inverse relationship, bycatch regulations, maturity age, closures, habitat overlap, stakeholders, data interpretation, subsistence users, quotas, heated discussions, recruitment spikes, mental models, stock abundance, conservation, yelloweye rocinterviewerish, recruitment spike, regulation proposals, yelloweye, public comment, public questions, system components, biomass declines, spatial area, species assemblage, biomass increase, closure risks, commercial users, bycatch dependence, recreational users, quota, system dynamics, possession limits, gear changes, allocative management, sport users, golden king crab, charter interaction, biodiversity, conservative approach, tanner crab, rod line regulations, advisory committees, public meetings, bag limits, habitat specificity, halibut, crab, regulatory process, red king crab, risk assessment, industry meetings, management challenges, user groups, stock recovery, yelloweye bycatch, long-lived species, commercial side, management protocols, stakeholder groups, slinky pots", "concept_list": ["natural science", "rocky habitat", "demersal-shelf rocinterviewerish", "relationship weights", "localized depletion", "education", "inverse relationship", "bycatch regulations", "maturity age", "closures", "habitat overlap", "stakeholders", "data interpretation", "subsistence users", "quotas", "heated discussions", "recruitment spikes", "mental models", "stock abundance", "conservation", "yelloweye rocinterviewerish", "recruitment spike", "regulation proposals", "yelloweye", "public comment", "public questions", "system components", "biomass declines", "spatial area", "species assemblage", "biomass increase", "closure risks", "commercial users", "bycatch dependence", "recreational users", "quota", "system dynamics", "possession limits", "gear changes", "allocative management", "sport users", "golden king crab", "charter interaction", "biodiversity", "conservative approach", "tanner crab", "rod line regulations", "advisory committees", "public meetings", "bag limits", "habitat specificity", "halibut", "crab", "regulatory process", "red king crab", "risk assessment", "industry meetings", "management challenges", "user groups", "stock recovery", "yelloweye bycatch", "long-lived species", "commercial side", "management protocols", "stakeholder groups", "slinky pots"], "type": "cluster", "node_size": 213, "label": "Charter Fleets"}, "Fisheries Data": {"concepts": "fishery data, fisheries science, fishermen data, fisheries background", "concept_list": ["fishery data", "fisheries science", "fishermen data", "fisheries background"], "type": "cluster", "node_size": 27, "label": "Fisheries Data"}, "Commercial Fisheries": {"concepts": "shellfish fisheries, fishery openings, commercial fisheries, commercial fishery, fishery quotas, directed fisheries", "concept_list": ["shellfish fisheries", "fishery openings", "commercial fisheries", "commercial fishery", "fishery quotas", "directed fisheries"], "type": "cluster", "node_size": 33, "label": "Commercial Fisheries"}, "Groundfish Fisheries": {"concepts": "ground fish, sablefish, fishing game, halibut fishery, groundfish topics, sport fisheries, marine resources, groundfish", "concept_list": ["ground fish", "sablefish", "fishing game", "halibut fishery", "groundfish topics", "sport fisheries", "marine resources", "groundfish"], "type": "cluster", "node_size": 39, "label": "Groundfish Fisheries"}};
        const conceptData = {"manager": {"concepts": "manager", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "manager"}, "researcher": {"concepts": "researcher", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "researcher"}, "management research": {"concepts": "management research", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "management research"}, "research coordinator": {"concepts": "research coordinator", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "research coordinator"}, "single species": {"concepts": "single species", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "single species"}, "budget overview": {"concepts": "budget overview", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "budget overview"}, "experience": {"concepts": "experience", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "experience"}, "research background": {"concepts": "research background", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "research background"}, "habitat-forming species": {"concepts": "habitat-forming species", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "habitat-forming species"}, "escape ring policy": {"concepts": "escape ring policy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "escape ring policy"}, "management decisions": {"concepts": "management decisions", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management decisions"}, "ecosystem management": {"concepts": "ecosystem management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "ecosystem management"}, "impact assessment": {"concepts": "impact assessment", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "impact assessment"}, "policy changes": {"concepts": "policy changes", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "policy changes"}, "operational plans": {"concepts": "operational plans", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "operational plans"}, "restrictive management": {"concepts": "restrictive management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "restrictive management"}, "policy": {"concepts": "policy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "policy"}, "management plan": {"concepts": "management plan", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management plan"}, "harvest strategy": {"concepts": "harvest strategy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "harvest strategy"}, "management": {"concepts": "management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management"}, "bycatch": {"concepts": "bycatch", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "bycatch"}, "regulations": {"concepts": "regulations", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "regulations"}, "species management": {"concepts": "species management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "species management"}, "habitat management": {"concepts": "habitat management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "habitat management"}, "board of fisheries": {"concepts": "board of fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "board of fisheries"}, "fishery management": {"concepts": "fishery management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fishery management"}, "fisheries": {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries"}, "fisheries management": {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries management"}, "charter fleets": {"concepts": "charter fleets", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "charter fleets"}, "dungeness crab": {"concepts": "dungeness crab", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "dungeness crab"}, "natural science": {"concepts": "natural science", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "natural science"}, "rocky habitat": {"concepts": "rocky habitat", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "rocky habitat"}, "demersal-shelf rocinterviewerish": {"concepts": "demersal-shelf rocinterviewerish", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "demersal-shelf rocinterviewerish"}, "relationship weights": {"concepts": "relationship weights", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "relationship weights"}, "localized depletion": {"concepts": "localized depletion", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "localized depletion"}, "education": {"concepts": "education", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "education"}, "inverse relationship": {"concepts": "inverse relationship", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "inverse relationship"}, "bycatch regulations": {"concepts": "bycatch regulations", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bycatch regulations"}, "maturity age": {"concepts": "maturity age", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "maturity age"}, "closures": {"concepts": "closures", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "closures"}, "habitat overlap": {"concepts": "habitat overlap", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "habitat overlap"}, "stakeholders": {"concepts": "stakeholders", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stakeholders"}, "data interpretation": {"concepts": "data interpretation", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "data interpretation"}, "subsistence users": {"concepts": "subsistence users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "subsistence users"}, "quotas": {"concepts": "quotas", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "quotas"}, "heated discussions": {"concepts": "heated discussions", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "heated discussions"}, "recruitment spikes": {"concepts": "recruitment spikes", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recruitment spikes"}, "mental models": {"concepts": "mental models", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "mental models"}, "stock abundance": {"concepts": "stock abundance", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stock abundance"}, "conservation": {"concepts": "conservation", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "conservation"}, "yelloweye rocinterviewerish": {"concepts": "yelloweye rocinterviewerish", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye rocinterviewerish"}, "recruitment spike": {"concepts": "recruitment spike", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recruitment spike"}, "regulation proposals": {"concepts": "regulation proposals", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "regulation proposals"}, "yelloweye": {"concepts": "yelloweye", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye"}, "public comment": {"concepts": "public comment", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public comment"}, "public questions": {"concepts": "public questions", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public questions"}, "system components": {"concepts": "system components", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "system components"}, "biomass declines": {"concepts": "biomass declines", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biomass declines"}, "spatial area": {"concepts": "spatial area", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "spatial area"}, "species assemblage": {"concepts": "species assemblage", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "species assemblage"}, "biomass increase": {"concepts": "biomass increase", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biomass increase"}, "closure risks": {"concepts": "closure risks", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "closure risks"}, "commercial users": {"concepts": "commercial users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "commercial users"}, "bycatch dependence": {"concepts": "bycatch dependence", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bycatch dependence"}, "recreational users": {"concepts": "recreational users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recreational users"}, "quota": {"concepts": "quota", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "quota"}, "system dynamics": {"concepts": "system dynamics", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "system dynamics"}, "possession limits": {"concepts": "possession limits", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "possession limits"}, "gear changes": {"concepts": "gear changes", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "gear changes"}, "allocative management": {"concepts": "allocative management", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "allocative management"}, "sport users": {"concepts": "sport users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "sport users"}, "golden king crab": {"concepts": "golden king crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "golden king crab"}, "charter interaction": {"concepts": "charter interaction", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "charter interaction"}, "biodiversity": {"concepts": "biodiversity", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biodiversity"}, "conservative approach": {"concepts": "conservative approach", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "conservative approach"}, "tanner crab": {"concepts": "tanner crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "tanner crab"}, "rod line regulations": {"concepts": "rod line regulations", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "rod line regulations"}, "advisory committees": {"concepts": "advisory committees", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "advisory committees"}, "public meetings": {"concepts": "public meetings", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public meetings"}, "bag limits": {"concepts": "bag limits", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bag limits"}, "habitat specificity": {"concepts": "habitat specificity", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "habitat specificity"}, "halibut": {"concepts": "halibut", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "halibut"}, "crab": {"concepts": "crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "crab"}, "regulatory process": {"concepts": "regulatory process", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "regulatory process"}, "red king crab": {"concepts": "red king crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "red king crab"}, "risk assessment": {"concepts": "risk assessment", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "risk assessment"}, "industry meetings": {"concepts": "industry meetings", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "industry meetings"}, "management challenges": {"concepts": "management challenges", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "management challenges"}, "user groups": {"concepts": "user groups", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "user groups"}, "stock recovery": {"concepts": "stock recovery", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stock recovery"}, "yelloweye bycatch": {"concepts": "yelloweye bycatch", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye bycatch"}, "long-lived species": {"concepts": "long-lived species", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "long-lived species"}, "commercial side": {"concepts": "commercial side", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "commercial side"}, "management protocols": {"concepts": "management protocols", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "management protocols"}, "stakeholder groups": {"concepts": "stakeholder groups", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stakeholder groups"}, "slinky pots": {"concepts": "slinky pots", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "slinky pots"}, "fishery data": {"concepts": "fishery data", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fishery data"}, "fisheries science": {"concepts": "fisheries science", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fisheries science"}, "fishermen data": {"concepts": "fishermen data", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fishermen data"}, "fisheries background": {"concepts": "fisheries background", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fisheries background"}, "shellfish fisheries": {"concepts": "shellfish fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "shellfish fisheries"}, "fishery openings": {"concepts": "fishery openings", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "fishery openings"}, "commercial fisheries": {"concepts": "commercial fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "commercial fisheries"}, "commercial fishery": {"concepts": "commercial fishery", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "commercial fishery"}, "fishery quotas": {"concepts": "fishery quotas", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "fishery quotas"}, "directed fisheries": {"concepts": "directed fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "directed fisheries"}, "ground fish": {"concepts": "ground fish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "ground fish"}, "sablefish": {"concepts": "sablefish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "sablefish"}, "fishing game": {"concepts": "fishing game", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "fishing game"}, "halibut fishery": {"concepts": "halibut fishery", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "halibut fishery"}, "groundfish topics": {"concepts": "groundfish topics", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "groundfish topics"}, "sport fisheries": {"concepts": "sport fisheries", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "sport fisheries"}, "marine resources": {"concepts": "marine resources", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "marine resources"}, "groundfish": {"concepts": "groundfish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "groundfish"}};
        const interClusterEdges = [["Management Policy", "Fisheries Management", {"weight": 1.0, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Management Policy", "Commercial Fisheries", {"weight": 1.0, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Management Policy", "Groundfish Fisheries", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Data & Surveys", "Groundfish Fisheries", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Data & Surveys", "Fisheries Data", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Data & Surveys", "Fisheries Management", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Data & Surveys", "Charter Fleets", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Data & Surveys", "Management Policy", {"weight": 0.3333333333333333, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}], ["Fisheries Management", "Data & Surveys", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Charter Fleets", "Data & Surveys", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Charter Fleets", "Fisheries Data", {"weight": 0.6, "confidence": 0.37, "type": "inter_cluster", "style": "solid"}], ["Fisheries Data", "Fisheries Management", {"weight": 1.0, "confidence": 0.7100000000000002, "type": "inter_cluster", "style": "solid"}], ["Fisheries Data", "Data & Surveys", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Commercial Fisheries", "Fisheries Data", {"weight": 0.8, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Commercial Fisheries", "Management Policy", {"weight": 0.4, "confidence": 0.22000000000000003, "type": "inter_cluster", "style": "solid"}], ["Commercial Fisheries", "Charter Fleets", {"weight": 0.2, "confidence": 0.1, "type": "inter_cluster", "style": "solid"}], ["Groundfish Fisheries", "Charter Fleets", {"weight": 0.6, "confidence": 0.39, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {"Management Policy": [["manager", {"concepts": "manager", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "manager"}], ["researcher", {"concepts": "researcher", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "researcher"}], ["management research", {"concepts": "management research", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "management research"}], ["research coordinator", {"concepts": "research coordinator", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "research coordinator"}], ["single species", {"concepts": "single species", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "single species"}], ["budget overview", {"concepts": "budget overview", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "budget overview"}], ["experience", {"concepts": "experience", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "experience"}], ["research background", {"concepts": "research background", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "research background"}], ["habitat-forming species", {"concepts": "habitat-forming species", "type": "concept", "cluster": "Management Policy", "node_size": 10, "label": "habitat-forming species"}]], "Data & Surveys": [["escape ring policy", {"concepts": "escape ring policy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "escape ring policy"}], ["management decisions", {"concepts": "management decisions", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management decisions"}], ["ecosystem management", {"concepts": "ecosystem management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "ecosystem management"}], ["impact assessment", {"concepts": "impact assessment", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "impact assessment"}], ["policy changes", {"concepts": "policy changes", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "policy changes"}], ["operational plans", {"concepts": "operational plans", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "operational plans"}], ["restrictive management", {"concepts": "restrictive management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "restrictive management"}], ["policy", {"concepts": "policy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "policy"}], ["management plan", {"concepts": "management plan", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management plan"}], ["harvest strategy", {"concepts": "harvest strategy", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "harvest strategy"}], ["management", {"concepts": "management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "management"}], ["bycatch", {"concepts": "bycatch", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "bycatch"}], ["regulations", {"concepts": "regulations", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "regulations"}], ["species management", {"concepts": "species management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "species management"}], ["habitat management", {"concepts": "habitat management", "type": "concept", "cluster": "Data & Surveys", "node_size": 10, "label": "habitat management"}]], "Fisheries Management": [["board of fisheries", {"concepts": "board of fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "board of fisheries"}], ["fishery management", {"concepts": "fishery management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fishery management"}], ["fisheries", {"concepts": "fisheries", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries"}], ["fisheries management", {"concepts": "fisheries management", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "fisheries management"}], ["charter fleets", {"concepts": "charter fleets", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "charter fleets"}], ["dungeness crab", {"concepts": "dungeness crab", "type": "concept", "cluster": "Fisheries Management", "node_size": 10, "label": "dungeness crab"}]], "Charter Fleets": [["natural science", {"concepts": "natural science", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "natural science"}], ["rocky habitat", {"concepts": "rocky habitat", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "rocky habitat"}], ["demersal-shelf rocinterviewerish", {"concepts": "demersal-shelf rocinterviewerish", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "demersal-shelf rocinterviewerish"}], ["relationship weights", {"concepts": "relationship weights", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "relationship weights"}], ["localized depletion", {"concepts": "localized depletion", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "localized depletion"}], ["education", {"concepts": "education", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "education"}], ["inverse relationship", {"concepts": "inverse relationship", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "inverse relationship"}], ["bycatch regulations", {"concepts": "bycatch regulations", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bycatch regulations"}], ["maturity age", {"concepts": "maturity age", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "maturity age"}], ["closures", {"concepts": "closures", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "closures"}], ["habitat overlap", {"concepts": "habitat overlap", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "habitat overlap"}], ["stakeholders", {"concepts": "stakeholders", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stakeholders"}], ["data interpretation", {"concepts": "data interpretation", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "data interpretation"}], ["subsistence users", {"concepts": "subsistence users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "subsistence users"}], ["quotas", {"concepts": "quotas", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "quotas"}], ["heated discussions", {"concepts": "heated discussions", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "heated discussions"}], ["recruitment spikes", {"concepts": "recruitment spikes", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recruitment spikes"}], ["mental models", {"concepts": "mental models", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "mental models"}], ["stock abundance", {"concepts": "stock abundance", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stock abundance"}], ["conservation", {"concepts": "conservation", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "conservation"}], ["yelloweye rocinterviewerish", {"concepts": "yelloweye rocinterviewerish", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye rocinterviewerish"}], ["recruitment spike", {"concepts": "recruitment spike", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recruitment spike"}], ["regulation proposals", {"concepts": "regulation proposals", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "regulation proposals"}], ["yelloweye", {"concepts": "yelloweye", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye"}], ["public comment", {"concepts": "public comment", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public comment"}], ["public questions", {"concepts": "public questions", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public questions"}], ["system components", {"concepts": "system components", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "system components"}], ["biomass declines", {"concepts": "biomass declines", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biomass declines"}], ["spatial area", {"concepts": "spatial area", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "spatial area"}], ["species assemblage", {"concepts": "species assemblage", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "species assemblage"}], ["biomass increase", {"concepts": "biomass increase", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biomass increase"}], ["closure risks", {"concepts": "closure risks", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "closure risks"}], ["commercial users", {"concepts": "commercial users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "commercial users"}], ["bycatch dependence", {"concepts": "bycatch dependence", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bycatch dependence"}], ["recreational users", {"concepts": "recreational users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "recreational users"}], ["quota", {"concepts": "quota", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "quota"}], ["system dynamics", {"concepts": "system dynamics", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "system dynamics"}], ["possession limits", {"concepts": "possession limits", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "possession limits"}], ["gear changes", {"concepts": "gear changes", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "gear changes"}], ["allocative management", {"concepts": "allocative management", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "allocative management"}], ["sport users", {"concepts": "sport users", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "sport users"}], ["golden king crab", {"concepts": "golden king crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "golden king crab"}], ["charter interaction", {"concepts": "charter interaction", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "charter interaction"}], ["biodiversity", {"concepts": "biodiversity", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "biodiversity"}], ["conservative approach", {"concepts": "conservative approach", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "conservative approach"}], ["tanner crab", {"concepts": "tanner crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "tanner crab"}], ["rod line regulations", {"concepts": "rod line regulations", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "rod line regulations"}], ["advisory committees", {"concepts": "advisory committees", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "advisory committees"}], ["public meetings", {"concepts": "public meetings", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "public meetings"}], ["bag limits", {"concepts": "bag limits", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "bag limits"}], ["habitat specificity", {"concepts": "habitat specificity", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "habitat specificity"}], ["halibut", {"concepts": "halibut", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "halibut"}], ["crab", {"concepts": "crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "crab"}], ["regulatory process", {"concepts": "regulatory process", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "regulatory process"}], ["red king crab", {"concepts": "red king crab", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "red king crab"}], ["risk assessment", {"concepts": "risk assessment", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "risk assessment"}], ["industry meetings", {"concepts": "industry meetings", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "industry meetings"}], ["management challenges", {"concepts": "management challenges", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "management challenges"}], ["user groups", {"concepts": "user groups", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "user groups"}], ["stock recovery", {"concepts": "stock recovery", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stock recovery"}], ["yelloweye bycatch", {"concepts": "yelloweye bycatch", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "yelloweye bycatch"}], ["long-lived species", {"concepts": "long-lived species", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "long-lived species"}], ["commercial side", {"concepts": "commercial side", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "commercial side"}], ["management protocols", {"concepts": "management protocols", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "management protocols"}], ["stakeholder groups", {"concepts": "stakeholder groups", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "stakeholder groups"}], ["slinky pots", {"concepts": "slinky pots", "type": "concept", "cluster": "Charter Fleets", "node_size": 10, "label": "slinky pots"}]], "Fisheries Data": [["fishery data", {"concepts": "fishery data", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fishery data"}], ["fisheries science", {"concepts": "fisheries science", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fisheries science"}], ["fishermen data", {"concepts": "fishermen data", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fishermen data"}], ["fisheries background", {"concepts": "fisheries background", "type": "concept", "cluster": "Fisheries Data", "node_size": 10, "label": "fisheries background"}]], "Commercial Fisheries": [["shellfish fisheries", {"concepts": "shellfish fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "shellfish fisheries"}], ["fishery openings", {"concepts": "fishery openings", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "fishery openings"}], ["commercial fisheries", {"concepts": "commercial fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "commercial fisheries"}], ["commercial fishery", {"concepts": "commercial fishery", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "commercial fishery"}], ["fishery quotas", {"concepts": "fishery quotas", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "fishery quotas"}], ["directed fisheries", {"concepts": "directed fisheries", "type": "concept", "cluster": "Commercial Fisheries", "node_size": 10, "label": "directed fisheries"}]], "Groundfish Fisheries": [["ground fish", {"concepts": "ground fish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "ground fish"}], ["sablefish", {"concepts": "sablefish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "sablefish"}], ["fishing game", {"concepts": "fishing game", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "fishing game"}], ["halibut fishery", {"concepts": "halibut fishery", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "halibut fishery"}], ["groundfish topics", {"concepts": "groundfish topics", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "groundfish topics"}], ["sport fisheries", {"concepts": "sport fisheries", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "sport fisheries"}], ["marine resources", {"concepts": "marine resources", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "marine resources"}], ["groundfish", {"concepts": "groundfish", "type": "concept", "cluster": "Groundfish Fisheries", "node_size": 10, "label": "groundfish"}]]};
        const clusterEdges = {"Management Policy": [], "Data & Surveys": [], "Fisheries Management": [], "Charter Fleets": [], "Fisheries Data": [], "Commercial Fisheries": [], "Groundfish Fisheries": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
