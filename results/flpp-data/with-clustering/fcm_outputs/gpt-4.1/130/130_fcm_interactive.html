
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food System Access": {"concepts": "food accessibility, hoop houses, food banks, grocery stores, agriculture, food processing, assistance programs, food system innovation, food systems, lead mitigating vegetables, hurley food farmacy, food hubs, food as medicine, meat, food bank, nutritious foods, fresh produce, food plus detroit, food consumption, genesee county, food assistance, stormwater management, dairy, flint food system, waste management, food equity, food waste, food processing center, food navigation, soup kitchens, groceries, women's farm, landfill, emergency food, food service provider, food quality, food plan, stormwater, food system mapping, food sector integration, vermicomposting, fruits and vegetables, food supply chain, food services, dairy products, environmental uses, fast food, urban agriculture, food system navigator, farmers markets, soil improvement, food delivery, food insecurity, healthy soils, food access, local food economy, resource building, chain restaurants, composting farm, local farmers, food waste diversion, food system, food availability, food security, food sourcing, composting center, medically necessary food, food scraps, food distribution, food system sectors, preservatives, food retail, prescription pills, water crisis, buildings and grounds, supplemental food, farmers market, food farmacy, food affordability, poor quality food, supplemental nutrition programs, worm farm, food is medicine, local farmer, local agriculture, convenience stores, meat products, local restaurants, food navigation system", "concept_list": ["food accessibility", "hoop houses", "food banks", "grocery stores", "agriculture", "food processing", "assistance programs", "food system innovation", "food systems", "lead mitigating vegetables", "hurley food farmacy", "food hubs", "food as medicine", "meat", "food bank", "nutritious foods", "fresh produce", "food plus detroit", "food consumption", "genesee county", "food assistance", "stormwater management", "dairy", "flint food system", "waste management", "food equity", "food waste", "food processing center", "food navigation", "soup kitchens", "groceries", "women's farm", "landfill", "emergency food", "food service provider", "food quality", "food plan", "stormwater", "food system mapping", "food sector integration", "vermicomposting", "fruits and vegetables", "food supply chain", "food services", "dairy products", "environmental uses", "fast food", "urban agriculture", "food system navigator", "farmers markets", "soil improvement", "food delivery", "food insecurity", "healthy soils", "food access", "local food economy", "resource building", "chain restaurants", "composting farm", "local farmers", "food waste diversion", "food system", "food availability", "food security", "food sourcing", "composting center", "medically necessary food", "food scraps", "food distribution", "food system sectors", "preservatives", "food retail", "prescription pills", "water crisis", "buildings and grounds", "supplemental food", "farmers market", "food farmacy", "food affordability", "poor quality food", "supplemental nutrition programs", "worm farm", "food is medicine", "local farmer", "local agriculture", "convenience stores", "meat products", "local restaurants", "food navigation system"], "type": "cluster", "node_size": 282, "label": "Food System Access"}, "Community Health Networks": {"concepts": "value chain, collaboration, distribution, maternal health, market dynamics, life-limiting illness, respect, local organizations, housekeeping, medicaid, support, health issue, disease, metrics, vulnerable populations, supplemental sector, local economy, pandemic, meijers, physical health, fragile system, value alignment, unified goals, access barriers, producer-consumer linkages, access, social empowerment, portion control, covid-19 impact, walmarts, quality of life, community benefit, wic, flint fresh, leverage points, closed loop, root causes, resources, social determinants, hours of operation, organizational roles, health, illness, sector collaboration, touchpoint, kroger, consumer, overall health, subject matter expert, affordability, delivery system, economic development, bold step, root cause, buying power, funding, sector representation, capacity building, stigma, point person, economic viability, hospital leaders, processing center, strategic plan, downstream impacts, screening, social equity, upstream interventions, commercial processors, community, producer networks, market access, organizational partnerships, tipping fees, hospital, kroger's, questionnaires, price point, partnerships, snap, at-risk populations, mental well-being, macro system, product disconnect, grant funding, end users, supply chain, means to cook, world hunger, strategic initiative, assessing, associates, funding allocation, direct producer programs, supplemental programs, outcome metrics, covid-19, upstream solutions, local market, trust, strategic funding, distribution channels, furlough, purchasing power, dignity, safety net, social determinants of health, layoffs, harvest days, emotional well-being, resource allocation, covid, primary care, health systems, sensitive questions, economic incentives, strategic priority, environmental health, referral, stakeholder inclusion, financial support, modeling, poverty, genesis, connection strength, students, educational field trip, mental health, resource sharing, anchor institutions, assessment, economic disconnect, stakeholder engagement, community health, community foundation, market integration, consumer access, minimum wage jobs, funders, blood pressure, partnership, triage assessment, dialogue, career farming, organizational collaboration, school-aged children, organizational responsibility, community empowerment, flint, program manager", "concept_list": ["value chain", "collaboration", "distribution", "maternal health", "market dynamics", "life-limiting illness", "respect", "local organizations", "housekeeping", "medicaid", "support", "health issue", "disease", "metrics", "vulnerable populations", "supplemental sector", "local economy", "pandemic", "meijers", "physical health", "fragile system", "value alignment", "unified goals", "access barriers", "producer-consumer linkages", "access", "social empowerment", "portion control", "covid-19 impact", "walmarts", "quality of life", "community benefit", "wic", "flint fresh", "leverage points", "closed loop", "root causes", "resources", "social determinants", "hours of operation", "organizational roles", "health", "illness", "sector collaboration", "touchpoint", "kroger", "consumer", "overall health", "subject matter expert", "affordability", "delivery system", "economic development", "bold step", "root cause", "buying power", "funding", "sector representation", "capacity building", "stigma", "point person", "economic viability", "hospital leaders", "processing center", "strategic plan", "downstream impacts", "screening", "social equity", "upstream interventions", "commercial processors", "community", "producer networks", "market access", "organizational partnerships", "tipping fees", "hospital", "kroger's", "questionnaires", "price point", "partnerships", "snap", "at-risk populations", "mental well-being", "macro system", "product disconnect", "grant funding", "end users", "supply chain", "means to cook", "world hunger", "strategic initiative", "assessing", "associates", "funding allocation", "direct producer programs", "supplemental programs", "outcome metrics", "covid-19", "upstream solutions", "local market", "trust", "strategic funding", "distribution channels", "furlough", "purchasing power", "dignity", "safety net", "social determinants of health", "layoffs", "harvest days", "emotional well-being", "resource allocation", "covid", "primary care", "health systems", "sensitive questions", "economic incentives", "strategic priority", "environmental health", "referral", "stakeholder inclusion", "financial support", "modeling", "poverty", "genesis", "connection strength", "students", "educational field trip", "mental health", "resource sharing", "anchor institutions", "assessment", "economic disconnect", "stakeholder engagement", "community health", "community foundation", "market integration", "consumer access", "minimum wage jobs", "funders", "blood pressure", "partnership", "triage assessment", "dialogue", "career farming", "organizational collaboration", "school-aged children", "organizational responsibility", "community empowerment", "flint", "program manager"], "type": "cluster", "node_size": 465, "label": "Community Health Networks"}, "Retail Food Sector": {"concepts": "product sourcing, retail outlets, large retailers, retail sector, retail types, retail use", "concept_list": ["product sourcing", "retail outlets", "large retailers", "retail sector", "retail types", "retail use"], "type": "cluster", "node_size": 33, "label": "Retail Food Sector"}};
        const conceptData = {};
        const interClusterEdges = [["Food System Access", "Community Health Networks", {"weight": 0.6, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["Food System Access", "Retail Food Sector", {"weight": 0.4, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Health Networks", "Food System Access", {"weight": 0.8, "confidence": 0.73, "type": "inter_cluster", "style": "solid"}], ["Community Health Networks", "Retail Food Sector", {"weight": 0.8, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Retail Food Sector", "Food System Access", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Retail Food Sector", "Community Health Networks", {"weight": 0.8, "confidence": 0.6200000000000001, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food System Access": [], "Community Health Networks": [], "Retail Food Sector": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
