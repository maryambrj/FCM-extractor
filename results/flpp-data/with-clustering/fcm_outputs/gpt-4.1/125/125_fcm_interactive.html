
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access & Empowerment": {"concepts": "food system food tasting, food system tasting events, food appreciation, tasting events, food tasting, food system tasting, food system appreciation", "concept_list": ["food system food tasting", "food system tasting events", "food appreciation", "tasting events", "food tasting", "food system tasting", "food system appreciation"], "type": "cluster", "node_size": 36, "label": "Food Access & Empowerment"}, "Food Tasting Events": {"concepts": "food empowerment, food system convenience, public health, convenience store, food system access, food system mindfulness, food security, food system demonstrations, safety cameras, food banks, food sustainability, food system exploration, hurley medical center, food system exposure, demonstrations, community organizations, urban agriculture, flint township, pandemic impact, alcohol, vegetable box, mindful meditation, food values, nutrition, well being, community events, food system challenges, nutritious foods, food system events, food system improvement, food system solutions, affordability, pharmacy, community organization, gardening, food preparation, mindful eating, food access, food system demonstration, food, food system change, food bank, farmers markets, food system map, food system marketing, gift cards, unhealthy food, food system empowerment, flint food system, organizational factors, supplemental nutrition programs, flint fresh, exposure, food prescriptions, food service, neighborhood outreach, food system organizations, food distribution, chain restaurants, social factors, grants, food system programs, food system sustainability, food events, cameras, partnerships, food system lead, food choice, safety, food system labor, fresh produce, food system meditation, empowerment, food delivery service, labor, retail use, food preparation skills, neighborhood, food system impact, recipe cards, food system contaminated water, contaminated water, grant funding, food system sectors, food system eating, organic choices, rainwater, food system preparation, food programs, food exploration, sustainability, seniors, fast food, nutritious food, food pharmacy, convenience stores, food system recipe cards, pandemic, food system contamination, food exposure, program sustainability, food education, food system well being, marketing, food sampling, lead water, food system water, food system safety, availability, food system, water garden, food system health, healthy food, local gardener, food system lead water, grocery stores, food system values, social worker, covid-19, technical terms, emergency sector, food coupons, fast casual, city issues, community empowerment, food system community, food system rainwater, food system water garden, candy, food system choice, board members, chips, health, food system gardening, local restaurants, cooking classes, food prescription, food drives, community programs, local businesses, food delivery", "concept_list": ["food empowerment", "food system convenience", "public health", "convenience store", "food system access", "food system mindfulness", "food security", "food system demonstrations", "safety cameras", "food banks", "food sustainability", "food system exploration", "hurley medical center", "food system exposure", "demonstrations", "community organizations", "urban agriculture", "flint township", "pandemic impact", "alcohol", "vegetable box", "mindful meditation", "food values", "nutrition", "well being", "community events", "food system challenges", "nutritious foods", "food system events", "food system improvement", "food system solutions", "affordability", "pharmacy", "community organization", "gardening", "food preparation", "mindful eating", "food access", "food system demonstration", "food", "food system change", "food bank", "farmers markets", "food system map", "food system marketing", "gift cards", "unhealthy food", "food system empowerment", "flint food system", "organizational factors", "supplemental nutrition programs", "flint fresh", "exposure", "food prescriptions", "food service", "neighborhood outreach", "food system organizations", "food distribution", "chain restaurants", "social factors", "grants", "food system programs", "food system sustainability", "food events", "cameras", "partnerships", "food system lead", "food choice", "safety", "food system labor", "fresh produce", "food system meditation", "empowerment", "food delivery service", "labor", "retail use", "food preparation skills", "neighborhood", "food system impact", "recipe cards", "food system contaminated water", "contaminated water", "grant funding", "food system sectors", "food system eating", "organic choices", "rainwater", "food system preparation", "food programs", "food exploration", "sustainability", "seniors", "fast food", "nutritious food", "food pharmacy", "convenience stores", "food system recipe cards", "pandemic", "food system contamination", "food exposure", "program sustainability", "food education", "food system well being", "marketing", "food sampling", "lead water", "food system water", "food system safety", "availability", "food system", "water garden", "food system health", "healthy food", "local gardener", "food system lead water", "grocery stores", "food system values", "social worker", "covid-19", "technical terms", "emergency sector", "food coupons", "fast casual", "city issues", "community empowerment", "food system community", "food system rainwater", "food system water garden", "candy", "food system choice", "board members", "chips", "health", "food system gardening", "local restaurants", "cooking classes", "food prescription", "food drives", "community programs", "local businesses", "food delivery"], "type": "cluster", "node_size": 438, "label": "Food Tasting Events"}};
        const conceptData = {};
        const interClusterEdges = [["Food Access & Empowerment", "Food Tasting Events", {"weight": 1.0, "confidence": 0.8400000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Tasting Events", "Food Access & Empowerment", {"weight": 0.6, "confidence": 0.52, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access & Empowerment": [], "Food Tasting Events": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
