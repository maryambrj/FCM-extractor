
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Physical Interfaces": {"concepts": "system overview, software, iterative process, strategies, progress, firmware, educational processes, libraries, knowledge, bespoke system, avenue, output, experimenter, technical vocabulary, tool software, process steps, high level factors, technical terms, data sheet, primitives, functional interest, target, software component, meaningful information, programming languages, identification, enabling factors, data sheets, decoding, languages, capture the flag, environment, requirement determination, subject matter expert, approach, general purpose, mislabeling, online resources, node, components, information, information decoding, problem, usability, enabling feature, computer visualization, collection, entities, subcomponents, schedules, participant, tool usability, missing data, information acquisition, software availability, layer, domain, semi-structured interview, impediments, memorization, data, granularity, data availability, chart, data collection, tool identification, system components, prior knowledge, communication, professional roles, steps, variables, distraction, fuzzy cognitive map, positive reinforcement, understandability, readability, running, subset activities, framework, institutional policies, encryption, system understanding, non-functional aid, bespoke tools, challenge, connection, knowledge repository, software exploitation, process flow, organizational structures, software interaction, testing device, blocking, activity subset, decisions, capabilities, power filtering, data determination, task diagramming, negative hindrance, recovery, subset of activities, ideas, features, interaction, matrix layout, level, documentation, solution, data collection stage, directed graph, stage, technical requirements, fcm exercise, legibility, key items, hindering factors, functionality, labels, software features, layout, tool availability, analysis, computer visualization tool, beliefs, manufacturer, general purpose tools, force function, matrix, place", "concept_list": ["system overview", "software", "iterative process", "strategies", "progress", "firmware", "educational processes", "libraries", "knowledge", "bespoke system", "avenue", "output", "experimenter", "technical vocabulary", "tool software", "process steps", "high level factors", "technical terms", "data sheet", "primitives", "functional interest", "target", "software component", "meaningful information", "programming languages", "identification", "enabling factors", "data sheets", "decoding", "languages", "capture the flag", "environment", "requirement determination", "subject matter expert", "approach", "general purpose", "mislabeling", "online resources", "node", "components", "information", "information decoding", "problem", "usability", "enabling feature", "computer visualization", "collection", "entities", "subcomponents", "schedules", "participant", "tool usability", "missing data", "information acquisition", "software availability", "layer", "domain", "semi-structured interview", "impediments", "memorization", "data", "granularity", "data availability", "chart", "data collection", "tool identification", "system components", "prior knowledge", "communication", "professional roles", "steps", "variables", "distraction", "fuzzy cognitive map", "positive reinforcement", "understandability", "readability", "running", "subset activities", "framework", "institutional policies", "encryption", "system understanding", "non-functional aid", "bespoke tools", "challenge", "connection", "knowledge repository", "software exploitation", "process flow", "organizational structures", "software interaction", "testing device", "blocking", "activity subset", "decisions", "capabilities", "power filtering", "data determination", "task diagramming", "negative hindrance", "recovery", "subset of activities", "ideas", "features", "interaction", "matrix layout", "level", "documentation", "solution", "data collection stage", "directed graph", "stage", "technical requirements", "fcm exercise", "legibility", "key items", "hindering factors", "functionality", "labels", "software features", "layout", "tool availability", "analysis", "computer visualization tool", "beliefs", "manufacturer", "general purpose tools", "force function", "matrix", "place"], "type": "cluster", "node_size": 408, "label": "Physical Interfaces"}, "Connection Outcomes": {"concepts": "physical interface, standardized interfaces, physical interfacing, interface exploitation, interface, interface targeting, interfacing", "concept_list": ["physical interface", "standardized interfaces", "physical interfacing", "interface exploitation", "interface", "interface targeting", "interfacing"], "type": "cluster", "node_size": 36, "label": "Connection Outcomes"}, "Hardware Exploitation": {"concepts": "success, success factors, connection failure, target connection, partial failure, complete failure, successful access, failure, connector", "concept_list": ["success", "success factors", "connection failure", "target connection", "partial failure", "complete failure", "successful access", "failure", "connector"], "type": "cluster", "node_size": 42, "label": "Hardware Exploitation"}, "Protocol Analysis": {"concepts": "hardware level, hardware exploitation, exploitation target, exploitation path, hardware access, soldering, supporting hardware, exploit, exploitation, physical tools, physical requirements", "concept_list": ["hardware level", "hardware exploitation", "exploitation target", "exploitation path", "hardware access", "soldering", "supporting hardware", "exploit", "exploitation", "physical tools", "physical requirements"], "type": "cluster", "node_size": 48, "label": "Protocol Analysis"}, "System Understanding": {"concepts": "reverse engineering, protocols, file read primitive, data protocol, protocol translation, protocol comprehension", "concept_list": ["reverse engineering", "protocols", "file read primitive", "data protocol", "protocol translation", "protocol comprehension"], "type": "cluster", "node_size": 33, "label": "System Understanding"}, "Access Control": {"concepts": "server access, access level, access, physical access, partial access, access control, information access, full access, access goals, access need, privileged access, access obstruction", "concept_list": ["server access", "access level", "access", "physical access", "partial access", "access control", "information access", "full access", "access goals", "access need", "privileged access", "access obstruction"], "type": "cluster", "node_size": 51, "label": "Access Control"}, "Security Measures": {"concepts": "security mechanisms, security measure, security information, protections, countersecurity, security perspective, security measures, cyber attacks, obfuscation, security layer, security feature", "concept_list": ["security mechanisms", "security measure", "security information", "protections", "countersecurity", "security perspective", "security measures", "cyber attacks", "obfuscation", "security layer", "security feature"], "type": "cluster", "node_size": 48, "label": "Security Measures"}};
        const conceptData = {};
        const interClusterEdges = [["Physical Interfaces", "Hardware Exploitation", {"weight": 1.0, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Physical Interfaces", "Access Control", {"weight": 1.0, "confidence": 0.8374999999999999, "type": "inter_cluster", "style": "solid"}], ["Physical Interfaces", "Connection Outcomes", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Physical Interfaces", "Protocol Analysis", {"weight": 0.75, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Physical Interfaces", "System Understanding", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Connection Outcomes", "Hardware Exploitation", {"weight": 1.0, "confidence": 0.9200000000000002, "type": "inter_cluster", "style": "solid"}], ["Connection Outcomes", "Protocol Analysis", {"weight": 1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["Connection Outcomes", "Physical Interfaces", {"weight": 0.75, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Connection Outcomes", "Access Control", {"weight": 1.0, "confidence": 0.925, "type": "inter_cluster", "style": "solid"}], ["Connection Outcomes", "System Understanding", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Hardware Exploitation", "Access Control", {"weight": 1.0, "confidence": 0.8875000000000001, "type": "inter_cluster", "style": "solid"}], ["Hardware Exploitation", "Protocol Analysis", {"weight": 0.5, "confidence": 0.3625, "type": "inter_cluster", "style": "solid"}], ["Hardware Exploitation", "Security Measures", {"weight": -0.3333333333333333, "confidence": 0.26666666666666666, "type": "inter_cluster", "style": "solid"}], ["Protocol Analysis", "Access Control", {"weight": 0.8, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Protocol Analysis", "Hardware Exploitation", {"weight": 1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["Protocol Analysis", "System Understanding", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Protocol Analysis", "Connection Outcomes", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Protocol Analysis", "Physical Interfaces", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Hardware Exploitation", {"weight": 1.0, "confidence": 0.8333333333333334, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Physical Interfaces", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Connection Outcomes", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Protocol Analysis", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Access Control", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["System Understanding", "Security Measures", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Access Control", "Hardware Exploitation", {"weight": 1.0, "confidence": 0.9200000000000002, "type": "inter_cluster", "style": "solid"}], ["Access Control", "Connection Outcomes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Access Control", "Protocol Analysis", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Access Control", "Physical Interfaces", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Access Control", "System Understanding", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "Connection Outcomes", {"weight": -1.0, "confidence": 0.8099999999999999, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "Hardware Exploitation", {"weight": -1.0, "confidence": 0.9375, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "System Understanding", {"weight": -0.5, "confidence": 0.8125, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "Access Control", {"weight": -1.0, "confidence": 0.9266666666666666, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "Protocol Analysis", {"weight": -1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Security Measures", "Physical Interfaces", {"weight": -1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Physical Interfaces": [], "Connection Outcomes": [], "Hardware Exploitation": [], "Protocol Analysis": [], "System Understanding": [], "Access Control": [], "Security Measures": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
