
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Governance & Regulations": {"concepts": "fisher relationships, fisher knowledge, fisheries meetings, usvi fisheries, fishers, fishery management, fisheries advisory board, fisher conflicts, fishery managers, fishermen livelihoods, fisher adaptation, fisher education, fisheries advisory", "concept_list": ["fisher relationships", "fisher knowledge", "fisheries meetings", "usvi fisheries", "fishers", "fishery management", "fisheries advisory board", "fisher conflicts", "fishery managers", "fishermen livelihoods", "fisher adaptation", "fisher education", "fisheries advisory"], "type": "cluster", "node_size": 54, "label": "Governance & Regulations"}, "Environmental Challenges": {"concepts": "trap regulations, organizational challenges, local markets, community representation, funding support, organizational roles, congressional involvement, resistance, decision making, scientific assessment, generational knowledge, federal regulations, community relations, drug trade involvement, territoriality, management coordination, power dynamics, institutional trust, cooperation, school attendance, stakeholder collaboration, researchers, policy implementation, regulatory alignment, organizational vacancies, local regulations, cultural changes, regulation compliance, territorial disputes, license moratorium, knowledge authority, resource management, stakeholder conflict, community relationships, decision-making processes, tourist demand, decision makers, office capacity, conflict resolution, customer base, nature conservancy, gear bans, moratorium policy, crisis response, resource depletion, commissioner, magnuson-stevens act, tourism industry, rum factory, local government, customer relationships, enforcement capacity, decision-making, professional legitimacy, director role, conflict, directors turnover, enforcement, customers, gillnets, occupational transition, social gatherings, national park expansion, professional expertise, stakeholder engagement, cultural resistance, drug trade, institutional coordination, cultural identity, groupers, training programs, community solidarity, alternative employment, siltation, economic incentives, judicial inconsistency, cultural values, fairness perception, leadership turnover, enforcement mechanisms, meetings, economic valuation, regulatory enforcement, community trust, holiday events, tourism perception, judicial response, government authority, resource dependency, social conflict, local community, resource protection, stakeholder participation, scientific testing, advisory board, manpower shortages, grant writing, regulatory compliance, collaborative meetings, social cohesion, capacity building, dpnr, customer demand, national park, tourism economy, compliance, lobster depletion, expertise recognition, monument expansion, commissioner role, congresswoman, federal government, advisory processes, collective action, intergenerational transfer, role of ngos, educational background, organizational consistency, higher education, governance structure, advisory boards, court system, rule compliance, organizational capacity", "concept_list": ["trap regulations", "organizational challenges", "local markets", "community representation", "funding support", "organizational roles", "congressional involvement", "resistance", "decision making", "scientific assessment", "generational knowledge", "federal regulations", "community relations", "drug trade involvement", "territoriality", "management coordination", "power dynamics", "institutional trust", "cooperation", "school attendance", "stakeholder collaboration", "researchers", "policy implementation", "regulatory alignment", "organizational vacancies", "local regulations", "cultural changes", "regulation compliance", "territorial disputes", "license moratorium", "knowledge authority", "resource management", "stakeholder conflict", "community relationships", "decision-making processes", "tourist demand", "decision makers", "office capacity", "conflict resolution", "customer base", "nature conservancy", "gear bans", "moratorium policy", "crisis response", "resource depletion", "commissioner", "magnuson-stevens act", "tourism industry", "rum factory", "local government", "customer relationships", "enforcement capacity", "decision-making", "professional legitimacy", "director role", "conflict", "directors turnover", "enforcement", "customers", "gillnets", "occupational transition", "social gatherings", "national park expansion", "professional expertise", "stakeholder engagement", "cultural resistance", "drug trade", "institutional coordination", "cultural identity", "groupers", "training programs", "community solidarity", "alternative employment", "siltation", "economic incentives", "judicial inconsistency", "cultural values", "fairness perception", "leadership turnover", "enforcement mechanisms", "meetings", "economic valuation", "regulatory enforcement", "community trust", "holiday events", "tourism perception", "judicial response", "government authority", "resource dependency", "social conflict", "local community", "resource protection", "stakeholder participation", "scientific testing", "advisory board", "manpower shortages", "grant writing", "regulatory compliance", "collaborative meetings", "social cohesion", "capacity building", "dpnr", "customer demand", "national park", "tourism economy", "compliance", "lobster depletion", "expertise recognition", "monument expansion", "commissioner role", "congresswoman", "federal government", "advisory processes", "collective action", "intergenerational transfer", "role of ngos", "educational background", "organizational consistency", "higher education", "governance structure", "advisory boards", "court system", "rule compliance", "organizational capacity"], "type": "cluster", "node_size": 387, "label": "Environmental Challenges"}, "Fisher Relations": {"concepts": "marine park, sewage pollution, ocean warming, marine park creation, sustainability challenges, oil refinery, sahara dust, lionfish invasion, livelihoods, ecological change, species decline, recreational diving, coastal communities, ocean acidification, industrial pollution, fish and wildlife, resource conservation, hurricane hugo, environmental awareness, fertilizers, conservation policy, ecological restoration, cleaner fish, coral loss, conservation organizations, climate change, reef balance, marine parks, algae growth, marine biodiversity, fish pots, environmental conservation, rising temperatures, global warming, livelihood dependence, parrotfish, coral reef health, livelihood protection, fishing regulations, sponge decline, species protection, marine ecosystems, reef fishing, coral reefs, sponges, hurricane protection, coral restoration, reef protection, coral decline, grazers decline, species loss, water pollution, fishing restrictions, department of natural resources, fishing closures, protected areas, reef pollution, overfishing", "concept_list": ["marine park", "sewage pollution", "ocean warming", "marine park creation", "sustainability challenges", "oil refinery", "sahara dust", "lionfish invasion", "livelihoods", "ecological change", "species decline", "recreational diving", "coastal communities", "ocean acidification", "industrial pollution", "fish and wildlife", "resource conservation", "hurricane hugo", "environmental awareness", "fertilizers", "conservation policy", "ecological restoration", "cleaner fish", "coral loss", "conservation organizations", "climate change", "reef balance", "marine parks", "algae growth", "marine biodiversity", "fish pots", "environmental conservation", "rising temperatures", "global warming", "livelihood dependence", "parrotfish", "coral reef health", "livelihood protection", "fishing regulations", "sponge decline", "species protection", "marine ecosystems", "reef fishing", "coral reefs", "sponges", "hurricane protection", "coral restoration", "reef protection", "coral decline", "grazers decline", "species loss", "water pollution", "fishing restrictions", "department of natural resources", "fishing closures", "protected areas", "reef pollution", "overfishing"], "type": "cluster", "node_size": 189, "label": "Fisher Relations"}};
        const conceptData = {};
        const interClusterEdges = [["Governance & Regulations", "Environmental Challenges", {"weight": 0.4, "confidence": 0.5820000000000001, "type": "inter_cluster", "style": "solid"}], ["Governance & Regulations", "Fisher Relations", {"weight": -0.8, "confidence": 0.5780000000000001, "type": "inter_cluster", "style": "solid"}], ["Environmental Challenges", "Governance & Regulations", {"weight": -0.6, "confidence": 0.7799999999999999, "type": "inter_cluster", "style": "solid"}], ["Environmental Challenges", "Fisher Relations", {"weight": 0.4, "confidence": 0.5960000000000001, "type": "inter_cluster", "style": "solid"}], ["Fisher Relations", "Governance & Regulations", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Fisher Relations", "Environmental Challenges", {"weight": 0.6, "confidence": 0.756, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Governance & Regulations": [], "Environmental Challenges": [], "Fisher Relations": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
