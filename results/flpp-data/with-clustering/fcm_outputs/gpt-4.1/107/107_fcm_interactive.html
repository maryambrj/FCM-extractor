
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Social Impact Factors": {"concepts": "public health, emergency sector", "concept_list": ["public health", "emergency sector"], "type": "cluster", "node_size": 21, "label": "Social Impact Factors"}, "Store Viability": {"concepts": "lower income, public opinion, impact, social impact", "concept_list": ["lower income", "public opinion", "impact", "social impact"], "type": "cluster", "node_size": 27, "label": "Store Viability"}, "Community Challenges": {"concepts": "store maintenance, store closure, solvency, store solvency", "concept_list": ["store maintenance", "store closure", "solvency", "store solvency"], "type": "cluster", "node_size": 27, "label": "Community Challenges"}, "Program Operations": {"concepts": "car payments, downtown, social services, politics, social equity, local ownership, houston, hotel development, negative perceptions, product availability, area, negative perception, economic sustainability, bus limitations, minor safety, parishtown ministries, organizational sustainability, housing demolition, pandemic, homeowners, regional implementation, walking, public safety, child safety, sustainability, business competition, medical center, car ownership, buses, water crisis, local economy, president biden, community, local organizations, bus access, logistics, store expansion, penske trucks, minor access, bridge card, summer access, car note, impacts, social structure, apartments, bus station, downtown image, population served, store viability", "concept_list": ["car payments", "downtown", "social services", "politics", "social equity", "local ownership", "houston", "hotel development", "negative perceptions", "product availability", "area", "negative perception", "economic sustainability", "bus limitations", "minor safety", "parishtown ministries", "organizational sustainability", "housing demolition", "pandemic", "homeowners", "regional implementation", "walking", "public safety", "child safety", "sustainability", "business competition", "medical center", "car ownership", "buses", "water crisis", "local economy", "president biden", "community", "local organizations", "bus access", "logistics", "store expansion", "penske trucks", "minor access", "bridge card", "summer access", "car note", "impacts", "social structure", "apartments", "bus station", "downtown image", "population served", "store viability"], "type": "cluster", "node_size": 162, "label": "Program Operations"}, "Public Health Sector": {"concepts": "walmart, squash, sunoco, kettering, model expansion, program expansion, meatballs, family, high school, home grown, livelihood, yogurt, catholic charities, usda, flint, hunger, distribution network, sugar, kroger, mott college, pallet jack, industry breakdown, walk-in freezer, meijer, director, convenience, children, remodeling, growth, operations, license verification, u-haul, dallas, united way, race, pallets, produce, condominiums, program, sports activities, track sports, hard work, forklift, solution model, distribution, university, downtown flint, childhood exposure, elga, detroit, confidence, youth, onions, family support, schools, section eight, basic needs, expansion, distributor, grandchildren, covid-19, condos, chicken quarters, hudson's, rapid response, genesee, walk-in cooler, carry out, agent status, solution development, implementation, utilities", "concept_list": ["walmart", "squash", "sunoco", "kettering", "model expansion", "program expansion", "meatballs", "family", "high school", "home grown", "livelihood", "yogurt", "catholic charities", "usda", "flint", "hunger", "distribution network", "sugar", "kroger", "mott college", "pallet jack", "industry breakdown", "walk-in freezer", "meijer", "director", "convenience", "children", "remodeling", "growth", "operations", "license verification", "u-haul", "dallas", "united way", "race", "pallets", "produce", "condominiums", "program", "sports activities", "track sports", "hard work", "forklift", "solution model", "distribution", "university", "downtown flint", "childhood exposure", "elga", "detroit", "confidence", "youth", "onions", "family support", "schools", "section eight", "basic needs", "expansion", "distributor", "grandchildren", "covid-19", "condos", "chicken quarters", "hudson's", "rapid response", "genesee", "walk-in cooler", "carry out", "agent status", "solution development", "implementation", "utilities"], "type": "cluster", "node_size": 231, "label": "Public Health Sector"}, "Food Access": {"concepts": "food programs, pre-cooked meat, food supply, food income, food deserts, fresh food, food justice, farmers to families, food relief, households, apples, farmers, food desert, household delivery, grapefruit, food giveaway, emergency food, small farmers, food experience, chicken patties, food pantry, food boxes, food insecurity, food retail, food bank of eastern michigan, frozen foods, oranges, farmers market, food bank, food delivery, dollar general, food system actors, milk, food sustainability, food system, potatoes, homemade food, food distribution, food assistance, food logistics, cheese, food availability, cottage cheese, food needs, fresh produce, meat, food weight, sour cream, food security, food aid, food access, food pickup, family dollar, fast food, dairy", "concept_list": ["food programs", "pre-cooked meat", "food supply", "food income", "food deserts", "fresh food", "food justice", "farmers to families", "food relief", "households", "apples", "farmers", "food desert", "household delivery", "grapefruit", "food giveaway", "emergency food", "small farmers", "food experience", "chicken patties", "food pantry", "food boxes", "food insecurity", "food retail", "food bank of eastern michigan", "frozen foods", "oranges", "farmers market", "food bank", "food delivery", "dollar general", "food system actors", "milk", "food sustainability", "food system", "potatoes", "homemade food", "food distribution", "food assistance", "food logistics", "cheese", "food availability", "cottage cheese", "food needs", "fresh produce", "meat", "food weight", "sour cream", "food security", "food aid", "food access", "food pickup", "family dollar", "fast food", "dairy"], "type": "cluster", "node_size": 180, "label": "Food Access"}, "Urban Neighborhoods": {"concepts": "urban neighborhoods, urban planning, urban environment, urban area, urban development, urban decline, city image, townhomes, urban migration, townhouses, neighborhood safety, residential area, suburban areas, urban areas", "concept_list": ["urban neighborhoods", "urban planning", "urban environment", "urban area", "urban development", "urban decline", "city image", "townhomes", "urban migration", "townhouses", "neighborhood safety", "residential area", "suburban areas", "urban areas"], "type": "cluster", "node_size": 57, "label": "Urban Neighborhoods"}, "Community Partnerships": {"concepts": "partnerships, rl jones community outreach, collaborative efforts, community health, program reach, churches, recorded interviews, greater holy temple, church site, community partnerships, community support, outreach, community dynamics, community engagement, community voice, community impact, group discussion, teamwork, community organizations, community resources, community unity, clientele, collaboration, community involvement, community foundation, stakeholder, community needs, community cohesion, togetherness, community preferences, community benefit", "concept_list": ["partnerships", "rl jones community outreach", "collaborative efforts", "community health", "program reach", "churches", "recorded interviews", "greater holy temple", "church site", "community partnerships", "community support", "outreach", "community dynamics", "community engagement", "community voice", "community impact", "group discussion", "teamwork", "community organizations", "community resources", "community unity", "clientele", "collaboration", "community involvement", "community foundation", "stakeholder", "community needs", "community cohesion", "togetherness", "community preferences", "community benefit"], "type": "cluster", "node_size": 108, "label": "Community Partnerships"}, "Organizational Capacity": {"concepts": "smaller organizations, organizational support, organizational base, organizational requirements, organizational mission, organizational challenges, organizational capacity, organizational collaboration, larger organizations, organizational effectiveness, organizational structure, organizational competition, small businesses, organization type, organizations, organizational networks", "concept_list": ["smaller organizations", "organizational support", "organizational base", "organizational requirements", "organizational mission", "organizational challenges", "organizational capacity", "organizational collaboration", "larger organizations", "organizational effectiveness", "organizational structure", "organizational competition", "small businesses", "organization type", "organizations", "organizational networks"], "type": "cluster", "node_size": 63, "label": "Organizational Capacity"}, "Retail Landscape": {"concepts": "restaurant, retail quality, local restaurants, retail, retail infrastructure, liquor store, retail safety, retail closures, shopping patterns, grocery stores, grocery store, mom and pop stores, shopping center, convenience stores, shopping behavior, chain grocery store, retail stores, mom and pop store, grocery access, family-owned stores, family owned stores, supply chain, family grocery store, chain restaurants, chain stores, liquor stores, dollar stores, corner stores, corner store, chain grocery stores", "concept_list": ["restaurant", "retail quality", "local restaurants", "retail", "retail infrastructure", "liquor store", "retail safety", "retail closures", "shopping patterns", "grocery stores", "grocery store", "mom and pop stores", "shopping center", "convenience stores", "shopping behavior", "chain grocery store", "retail stores", "mom and pop store", "grocery access", "family-owned stores", "family owned stores", "supply chain", "family grocery store", "chain restaurants", "chain stores", "liquor stores", "dollar stores", "corner stores", "corner store", "chain grocery stores"], "type": "cluster", "node_size": 105, "label": "Retail Landscape"}, "Economic Factors": {"concepts": "state revenue, economic impact, markets, economic factors, economic interests, strategic placement, demand increase, market regulation, policy decisions, economic development, economy, rent, economic recovery", "concept_list": ["state revenue", "economic impact", "markets", "economic factors", "economic interests", "strategic placement", "demand increase", "market regulation", "policy decisions", "economic development", "economy", "rent", "economic recovery"], "type": "cluster", "node_size": 54, "label": "Economic Factors"}, "Transportation Access": {"concepts": "transportation access, public transit, public transportation, parking, mobility, southeast, vehicles, transportation, infrastructure, parking availability, installation costs, dort highway, central location, transportation barriers", "concept_list": ["transportation access", "public transit", "public transportation", "parking", "mobility", "southeast", "vehicles", "transportation", "infrastructure", "parking availability", "installation costs", "dort highway", "central location", "transportation barriers"], "type": "cluster", "node_size": 57, "label": "Transportation Access"}, "Funding Sources": {"concepts": "relief funds, government responsibility, program funding, funders, increased funding, top-down funding, funding, public assistance, funding barriers, rapid response funds, funding challenges, privately owned, grant funding, private funding, beneficiary, charitable sector, public funding, donations, charitable organizations", "concept_list": ["relief funds", "government responsibility", "program funding", "funders", "increased funding", "top-down funding", "funding", "public assistance", "funding barriers", "rapid response funds", "funding challenges", "privately owned", "grant funding", "private funding", "beneficiary", "charitable sector", "public funding", "donations", "charitable organizations"], "type": "cluster", "node_size": 72, "label": "Funding Sources"}, "Substance and Crime": {"concepts": "alcohol access, drug sales, drugs, violence, crime prevention, drug violence, tobacco sales, crime, drug trafficking, alcohol sales, marijuana legalization, substance abuse", "concept_list": ["alcohol access", "drug sales", "drugs", "violence", "crime prevention", "drug violence", "tobacco sales", "crime", "drug trafficking", "alcohol sales", "marijuana legalization", "substance abuse"], "type": "cluster", "node_size": 51, "label": "Substance and Crime"}, "Neighborhood Identity": {"concepts": "neighborhood development, neighborhood identity, neighborhood, neighbors, neighborhoods, neighborhood reputation, housing, neighborhood change, proximity", "concept_list": ["neighborhood development", "neighborhood identity", "neighborhood", "neighbors", "neighborhoods", "neighborhood reputation", "housing", "neighborhood change", "proximity"], "type": "cluster", "node_size": 42, "label": "Neighborhood Identity"}, "Service Coordination": {"concepts": "resource distribution, service coordination, service accessibility, service gaps, resource constraints, support services, resource allocation, service utilization, service provision, service area, service delivery", "concept_list": ["resource distribution", "service coordination", "service accessibility", "service gaps", "resource constraints", "support services", "resource allocation", "service utilization", "service provision", "service area", "service delivery"], "type": "cluster", "node_size": 48, "label": "Service Coordination"}, "Access Barriers": {"concepts": "barriers, operational barriers, access challenges, access barriers, accessibility, access", "concept_list": ["barriers", "operational barriers", "access challenges", "access barriers", "accessibility", "access"], "type": "cluster", "node_size": 33, "label": "Access Barriers"}, "Seasonal Access": {"concepts": "winter access, water distribution, weather impact, seasonality, weather, seasonal availability", "concept_list": ["winter access", "water distribution", "weather impact", "seasonality", "weather", "seasonal availability"], "type": "cluster", "node_size": 33, "label": "Seasonal Access"}, "Nonprofit Organizations": {"concepts": "nonprofit, nonprofit organizations, nonprofits", "concept_list": ["nonprofit", "nonprofit organizations", "nonprofits"], "type": "cluster", "node_size": 24, "label": "Nonprofit Organizations"}, "Sector Capacity": {"concepts": "sector, sector capacity, social sector, nonprofit sector", "concept_list": ["sector", "sector capacity", "social sector", "nonprofit sector"], "type": "cluster", "node_size": 27, "label": "Sector Capacity"}};
        const conceptData = {};
        const interClusterEdges = [["Social Impact Factors", "Public Health Sector", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Social Impact Factors", "Economic Factors", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Store Viability", "Funding Sources", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Store Viability", "Public Health Sector", {"weight": -0.3333333333333333, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Store Viability", "Service Coordination", {"weight": -1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Community Challenges", "Economic Factors", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community Challenges", "Funding Sources", {"weight": 1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Community Challenges", "Program Operations", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Community Challenges", "Social Impact Factors", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Program Operations", "Substance and Crime", {"weight": 0.5, "confidence": 0.7374999999999999, "type": "inter_cluster", "style": "solid"}], ["Program Operations", "Public Health Sector", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Program Operations", "Service Coordination", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Public Health Sector", "Community Challenges", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Transportation Access", {"weight": 0.5, "confidence": 0.825, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Access Barriers", {"weight": -1.0, "confidence": 0.8875, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Public Health Sector", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Program Operations", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}], ["Urban Neighborhoods", "Food Access", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Urban Neighborhoods", "Transportation Access", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["Urban Neighborhoods", "Community Challenges", {"weight": 1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Urban Neighborhoods", "Nonprofit Organizations", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Urban Neighborhoods", "Program Operations", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Retail Landscape", {"weight": 1.0, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Partnerships", "Program Operations", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Organizational Capacity", "Social Impact Factors", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Organizational Capacity", "Public Health Sector", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Economic Factors", "Urban Neighborhoods", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["Economic Factors", "Social Impact Factors", {"weight": 0.8, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Public Health Sector", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Service Coordination", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Retail Landscape", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Transportation Access", "Store Viability", {"weight": 0.3333333333333333, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Sector Capacity", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Neighborhood Identity", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Community Challenges", {"weight": 1.0, "confidence": 0.7749999999999999, "type": "inter_cluster", "style": "solid"}], ["Funding Sources", "Nonprofit Organizations", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Substance and Crime", "Program Operations", {"weight": -1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Urban Neighborhoods", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Nonprofit Organizations", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Community Challenges", {"weight": 1.0, "confidence": 0.7375, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Service Coordination", {"weight": 1.0, "confidence": 0.7125, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Funding Sources", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Neighborhood Identity", "Sector Capacity", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Service Coordination", "Organizational Capacity", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["Service Coordination", "Community Challenges", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Access Barriers", "Food Access", {"weight": -1.0, "confidence": 0.9125000000000001, "type": "inter_cluster", "style": "solid"}], ["Access Barriers", "Seasonal Access", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Access Barriers", "Urban Neighborhoods", {"weight": -1.0, "confidence": 0.6333333333333333, "type": "inter_cluster", "style": "solid"}], ["Seasonal Access", "Store Viability", {"weight": -1.0, "confidence": 0.7000000000000001, "type": "inter_cluster", "style": "solid"}], ["Seasonal Access", "Service Coordination", {"weight": -1.0, "confidence": 0.7999999999999999, "type": "inter_cluster", "style": "solid"}], ["Seasonal Access", "Social Impact Factors", {"weight": -1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Nonprofit Organizations", "Access Barriers", {"weight": -0.5, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Sector Capacity", "Social Impact Factors", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Sector Capacity", "Retail Landscape", {"weight": 1.0, "confidence": 0.6666666666666666, "type": "inter_cluster", "style": "solid"}], ["Sector Capacity", "Seasonal Access", {"weight": 0.5, "confidence": 0.35, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Social Impact Factors": [], "Store Viability": [], "Community Challenges": [], "Program Operations": [], "Public Health Sector": [], "Food Access": [], "Urban Neighborhoods": [], "Community Partnerships": [], "Organizational Capacity": [], "Retail Landscape": [], "Economic Factors": [], "Transportation Access": [], "Funding Sources": [], "Substance and Crime": [], "Neighborhood Identity": [], "Service Coordination": [], "Access Barriers": [], "Seasonal Access": [], "Nonprofit Organizations": [], "Sector Capacity": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
