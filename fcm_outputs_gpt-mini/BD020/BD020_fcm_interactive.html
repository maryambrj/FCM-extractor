
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"red snapper": {"concepts": "red snapper", "concept_list": ["red snapper"], "type": "cluster", "label": "red snapper"}, "reproductive species": {"concepts": "reproductive species", "concept_list": ["reproductive species"], "type": "cluster", "label": "reproductive species"}, "abundance": {"concepts": "abundance", "concept_list": ["abundance"], "type": "cluster", "label": "abundance"}, "calving rates": {"concepts": "calving rates", "concept_list": ["calving rates"], "type": "cluster", "label": "calving rates"}, "food base": {"concepts": "food base", "concept_list": ["food base"], "type": "cluster", "label": "food base"}, "population viability analysis": {"concepts": "population viability analysis", "concept_list": ["population viability analysis"], "type": "cluster", "label": "population viability analysis"}, "mmpa": {"concepts": "mmpa", "concept_list": ["mmpa"], "type": "cluster", "label": "mmpa"}, "entanglement": {"concepts": "entanglement", "concept_list": ["entanglement"], "type": "cluster", "label": "entanglement"}, "regime shifts": {"concepts": "regime shifts", "concept_list": ["regime shifts"], "type": "cluster", "label": "regime shifts"}, "threats": {"concepts": "threats", "concept_list": ["threats"], "type": "cluster", "label": "threats"}, "fishing pressure": {"concepts": "fishing pressure", "concept_list": ["fishing pressure"], "type": "cluster", "label": "fishing pressure"}, "species abundance": {"concepts": "species abundance", "concept_list": ["species abundance"], "type": "cluster", "label": "species abundance"}, "ecosystem": {"concepts": "ecosystem", "concept_list": ["ecosystem"], "type": "cluster", "label": "ecosystem"}, "msa": {"concepts": "msa", "concept_list": ["msa"], "type": "cluster", "label": "msa"}, "predation": {"concepts": "predation", "concept_list": ["predation"], "type": "cluster", "label": "predation"}, "regional community composition": {"concepts": "regional community composition", "concept_list": ["regional community composition"], "type": "cluster", "label": "regional community composition"}, "section 7": {"concepts": "section 7", "concept_list": ["section 7"], "type": "cluster", "label": "section 7"}, "listing factors": {"concepts": "listing factors", "concept_list": ["listing factors"], "type": "cluster", "label": "listing factors"}, "marine debris": {"concepts": "marine debris", "concept_list": ["marine debris"], "type": "cluster", "label": "marine debris"}, "species presence": {"concepts": "species presence", "concept_list": ["species presence"], "type": "cluster", "label": "species presence"}, "poaching": {"concepts": "poaching", "concept_list": ["poaching"], "type": "cluster", "label": "poaching"}, "habitat destruction": {"concepts": "habitat destruction", "concept_list": ["habitat destruction"], "type": "cluster", "label": "habitat destruction"}, "connectivity": {"concepts": "connectivity", "concept_list": ["connectivity"], "type": "cluster", "label": "connectivity"}, "illegal fishing": {"concepts": "illegal fishing", "concept_list": ["illegal fishing"], "type": "cluster", "label": "illegal fishing"}, "johnson\u2019s seagrass": {"concepts": "johnson\u2019s seagrass", "concept_list": ["johnson\u2019s seagrass"], "type": "cluster", "label": "johnson\u2019s seagrass"}, "adaptive management": {"concepts": "adaptive management", "concept_list": ["adaptive management"], "type": "cluster", "label": "adaptive management"}, "msa listed species": {"concepts": "msa listed species", "concept_list": ["msa listed species"], "type": "cluster", "label": "msa listed species"}, "species resilience": {"concepts": "species resilience", "concept_list": ["species resilience"], "type": "cluster", "label": "species resilience"}, "diversity": {"concepts": "diversity", "concept_list": ["diversity"], "type": "cluster", "label": "diversity"}, "ecosystem function": {"concepts": "ecosystem function", "concept_list": ["ecosystem function"], "type": "cluster", "label": "ecosystem function"}, "knowledge gaps": {"concepts": "knowledge gaps", "concept_list": ["knowledge gaps"], "type": "cluster", "label": "knowledge gaps"}, "habitat conservation": {"concepts": "habitat conservation", "concept_list": ["habitat conservation"], "type": "cluster", "label": "habitat conservation"}, "oil spills": {"concepts": "oil spills", "concept_list": ["oil spills"], "type": "cluster", "label": "oil spills"}, "cetaceans": {"concepts": "cetaceans", "concept_list": ["cetaceans"], "type": "cluster", "label": "cetaceans"}, "ship speed rules": {"concepts": "ship speed rules", "concept_list": ["ship speed rules"], "type": "cluster", "label": "ship speed rules"}, "biodiversity": {"concepts": "biodiversity", "concept_list": ["biodiversity"], "type": "cluster", "label": "biodiversity"}, "deepwater horizon spill": {"concepts": "deepwater horizon spill", "concept_list": ["deepwater horizon spill"], "type": "cluster", "label": "deepwater horizon spill"}, "k selected species": {"concepts": "k selected species", "concept_list": ["k selected species"], "type": "cluster", "label": "k selected species"}, "marine mammals": {"concepts": "marine mammals", "concept_list": ["marine mammals"], "type": "cluster", "label": "marine mammals"}, "overutilization": {"concepts": "overutilization", "concept_list": ["overutilization"], "type": "cluster", "label": "overutilization"}, "invasive species": {"concepts": "invasive species", "concept_list": ["invasive species"], "type": "cluster", "label": "invasive species"}, "gulf of mexico": {"concepts": "gulf of mexico", "concept_list": ["gulf of mexico"], "type": "cluster", "label": "gulf of mexico"}, "large predators": {"concepts": "large predators", "concept_list": ["large predators"], "type": "cluster", "label": "large predators"}, "dynamic management": {"concepts": "dynamic management", "concept_list": ["dynamic management"], "type": "cluster", "label": "dynamic management"}, "red grouper": {"concepts": "red grouper", "concept_list": ["red grouper"], "type": "cluster", "label": "red grouper"}, "nassau grouper": {"concepts": "nassau grouper", "concept_list": ["nassau grouper"], "type": "cluster", "label": "nassau grouper"}, "dams": {"concepts": "dams", "concept_list": ["dams"], "type": "cluster", "label": "dams"}, "habitat forming species": {"concepts": "habitat forming species", "concept_list": ["habitat forming species"], "type": "cluster", "label": "habitat forming species"}, "odds ratios": {"concepts": "odds ratios", "concept_list": ["odds ratios"], "type": "cluster", "label": "odds ratios"}, "smalltooth sawfish": {"concepts": "smalltooth sawfish", "concept_list": ["smalltooth sawfish"], "type": "cluster", "label": "smalltooth sawfish"}, "qualitative tool": {"concepts": "qualitative tool", "concept_list": ["qualitative tool"], "type": "cluster", "label": "qualitative tool"}, "lionfish": {"concepts": "lionfish", "concept_list": ["lionfish"], "type": "cluster", "label": "lionfish"}, "regional collaboration": {"concepts": "regional collaboration", "concept_list": ["regional collaboration"], "type": "cluster", "label": "regional collaboration"}, "bycatch": {"concepts": "bycatch", "concept_list": ["bycatch"], "type": "cluster", "label": "bycatch"}, "vessel strikes": {"concepts": "vessel strikes", "concept_list": ["vessel strikes"], "type": "cluster", "label": "vessel strikes"}, "management measures": {"concepts": "management measures", "concept_list": ["management measures"], "type": "cluster", "label": "management measures"}, "entanglements": {"concepts": "entanglements", "concept_list": ["entanglements"], "type": "cluster", "label": "entanglements"}, "climate change": {"concepts": "climate change", "concept_list": ["climate change"], "type": "cluster", "label": "climate change"}, "prey distribution": {"concepts": "prey distribution", "concept_list": ["prey distribution"], "type": "cluster", "label": "prey distribution"}, "productivity": {"concepts": "productivity", "concept_list": ["productivity"], "type": "cluster", "label": "productivity"}, "esa species": {"concepts": "esa species", "concept_list": ["esa species"], "type": "cluster", "label": "esa species"}, "gear entanglements": {"concepts": "gear entanglements", "concept_list": ["gear entanglements"], "type": "cluster", "label": "gear entanglements"}, "cetacean morbillivirus": {"concepts": "cetacean morbillivirus", "concept_list": ["cetacean morbillivirus"], "type": "cluster", "label": "cetacean morbillivirus"}, "halophila ovalis": {"concepts": "halophila ovalis", "concept_list": ["halophila ovalis"], "type": "cluster", "label": "halophila ovalis"}, "climate adaptation": {"concepts": "climate adaptation", "concept_list": ["climate adaptation"], "type": "cluster", "label": "climate adaptation"}, "mmpa listed species": {"concepts": "mmpa listed species", "concept_list": ["mmpa listed species"], "type": "cluster", "label": "mmpa listed species"}, "manta ray": {"concepts": "manta ray", "concept_list": ["manta ray"], "type": "cluster", "label": "manta ray"}, "johnson's seagrass": {"concepts": "johnson's seagrass", "concept_list": ["johnson's seagrass"], "type": "cluster", "label": "johnson's seagrass"}, "population consequences": {"concepts": "population consequences", "concept_list": ["population consequences"], "type": "cluster", "label": "population consequences"}, "over utilization": {"concepts": "over utilization", "concept_list": ["over utilization"], "type": "cluster", "label": "over utilization"}, "cumulative effects": {"concepts": "cumulative effects", "concept_list": ["cumulative effects"], "type": "cluster", "label": "cumulative effects"}, "spawning aggregations": {"concepts": "spawning aggregations", "concept_list": ["spawning aggregations"], "type": "cluster", "label": "spawning aggregations"}, "fishery ecosystem plans": {"concepts": "fishery ecosystem plans", "concept_list": ["fishery ecosystem plans"], "type": "cluster", "label": "fishery ecosystem plans"}, "giant manta ray": {"concepts": "giant manta ray", "concept_list": ["giant manta ray"], "type": "cluster", "label": "giant manta ray"}, "disease": {"concepts": "disease", "concept_list": ["disease"], "type": "cluster", "label": "disease"}, "shrimp fishery": {"concepts": "shrimp fishery", "concept_list": ["shrimp fishery"], "type": "cluster", "label": "shrimp fishery"}, "sturgeon": {"concepts": "sturgeon", "concept_list": ["sturgeon"], "type": "cluster", "label": "sturgeon"}, "stony coral tissue": {"concepts": "stony coral tissue", "concept_list": ["stony coral tissue"], "type": "cluster", "label": "stony coral tissue"}, "demographic criteria": {"concepts": "demographic criteria", "concept_list": ["demographic criteria"], "type": "cluster", "label": "demographic criteria"}, "sperm whales": {"concepts": "sperm whales", "concept_list": ["sperm whales"], "type": "cluster", "label": "sperm whales"}, "reproductive fitness": {"concepts": "reproductive fitness", "concept_list": ["reproductive fitness"], "type": "cluster", "label": "reproductive fitness"}, "management": {"concepts": "management", "concept_list": ["management"], "type": "cluster", "label": "management"}, "conceptual model": {"concepts": "conceptual model", "concept_list": ["conceptual model"], "type": "cluster", "label": "conceptual model"}, "seismic airguns": {"concepts": "seismic airguns", "concept_list": ["seismic airguns"], "type": "cluster", "label": "seismic airguns"}, "north atlantic right": {"concepts": "north atlantic right", "concept_list": ["north atlantic right"], "type": "cluster", "label": "north atlantic right"}, "entanglement risk": {"concepts": "entanglement risk", "concept_list": ["entanglement risk"], "type": "cluster", "label": "entanglement risk"}, "gene flow": {"concepts": "gene flow", "concept_list": ["gene flow"], "type": "cluster", "label": "gene flow"}, "coral settlement": {"concepts": "coral settlement", "concept_list": ["coral settlement"], "type": "cluster", "label": "coral settlement"}, "caribbean": {"concepts": "caribbean", "concept_list": ["caribbean"], "type": "cluster", "label": "caribbean"}, "parrot fish": {"concepts": "parrot fish", "concept_list": ["parrot fish"], "type": "cluster", "label": "parrot fish"}, "harmful organisms": {"concepts": "harmful organisms", "concept_list": ["harmful organisms"], "type": "cluster", "label": "harmful organisms"}, "observer coverage": {"concepts": "observer coverage", "concept_list": ["observer coverage"], "type": "cluster", "label": "observer coverage"}, "ship strikes": {"concepts": "ship strikes", "concept_list": ["ship strikes"], "type": "cluster", "label": "ship strikes"}, "local prey abundance": {"concepts": "local prey abundance", "concept_list": ["local prey abundance"], "type": "cluster", "label": "local prey abundance"}, "queen conch": {"concepts": "queen conch", "concept_list": ["queen conch"], "type": "cluster", "label": "queen conch"}, "esa species recovery": {"concepts": "esa species recovery", "concept_list": ["esa species recovery"], "type": "cluster", "label": "esa species recovery"}, "food webs": {"concepts": "food webs", "concept_list": ["food webs"], "type": "cluster", "label": "food webs"}, "spatial system": {"concepts": "spatial system", "concept_list": ["spatial system"], "type": "cluster", "label": "spatial system"}, "esa listed species": {"concepts": "esa listed species", "concept_list": ["esa listed species"], "type": "cluster", "label": "esa listed species"}, "key food web": {"concepts": "key food web", "concept_list": ["key food web"], "type": "cluster", "label": "key food web"}, "genetic diversity": {"concepts": "genetic diversity", "concept_list": ["genetic diversity"], "type": "cluster", "label": "genetic diversity"}, "weighting adjustments": {"concepts": "weighting adjustments", "concept_list": ["weighting adjustments"], "type": "cluster", "label": "weighting adjustments"}, "bioenergetics": {"concepts": "bioenergetics", "concept_list": ["bioenergetics"], "type": "cluster", "label": "bioenergetics"}, "semi quantitative tool": {"concepts": "semi quantitative tool", "concept_list": ["semi quantitative tool"], "type": "cluster", "label": "semi quantitative tool"}, "reproduction": {"concepts": "reproduction", "concept_list": ["reproduction"], "type": "cluster", "label": "reproduction"}, "esa": {"concepts": "esa", "concept_list": ["esa"], "type": "cluster", "label": "esa"}, "species of conservation": {"concepts": "species of conservation", "concept_list": ["species of conservation"], "type": "cluster", "label": "species of conservation"}, "mental modeler": {"concepts": "mental modeler", "concept_list": ["mental modeler"], "type": "cluster", "label": "mental modeler"}, "gear entanglement": {"concepts": "gear entanglement", "concept_list": ["gear entanglement"], "type": "cluster", "label": "gear entanglement"}, "multiple stressors": {"concepts": "multiple stressors", "concept_list": ["multiple stressors"], "type": "cluster", "label": "multiple stressors"}};
        const conceptData = {};
        const interClusterEdges = [["red snapper", "gulf of mexico", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["red snapper", "key food web", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["red snapper", "gene flow", {"weight": 1, "confidence": 0.6, "type": "inter_cluster"}], ["reproductive species", "key food web", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["abundance", "calving rates", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["abundance", "msa listed species", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["food base", "gear entanglement", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["mmpa", "msa", {"weight": 0, "confidence": 0.85, "type": "inter_cluster"}], ["entanglement", "cetacean morbillivirus", {"weight": 1, "confidence": 0.5, "type": "inter_cluster"}], ["threats", "red grouper", {"weight": -1, "confidence": 0.7, "type": "inter_cluster"}], ["threats", "johnson's seagrass", {"weight": 1, "confidence": 0.7, "type": "inter_cluster"}], ["fishing pressure", "red snapper", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["msa", "large predators", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["msa", "key food web", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["regional community composition", "local prey abundance", {"weight": 0, "confidence": 0.8, "type": "inter_cluster"}], ["regional community composition", "esa", {"weight": -1, "confidence": 0.8, "type": "inter_cluster"}], ["section 7", "nassau grouper", {"weight": 1, "confidence": 0.7, "type": "inter_cluster"}], ["poaching", "habitat forming species", {"weight": 1, "confidence": 0.44999999999999996, "type": "inter_cluster"}], ["poaching", "diversity", {"weight": -1, "confidence": 0.65, "type": "inter_cluster"}], ["connectivity", "sperm whales", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["illegal fishing", "esa listed species", {"weight": -1, "confidence": 0.9, "type": "inter_cluster"}], ["adaptive management", "marine debris", {"weight": 1, "confidence": 0.4, "type": "inter_cluster"}], ["diversity", "msa listed species", {"weight": 1, "confidence": 0.7, "type": "inter_cluster"}], ["oil spills", "multiple stressors", {"weight": 1, "confidence": 0.9, "type": "inter_cluster"}], ["cetaceans", "calving rates", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["ship speed rules", "ship strikes", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["deepwater horizon spill", "management measures", {"weight": -1, "confidence": 0.8, "type": "inter_cluster"}], ["k selected species", "section 7", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["overutilization", "ship speed rules", {"weight": 1, "confidence": 0.7, "type": "inter_cluster"}], ["invasive species", "odds ratios", {"weight": 1, "confidence": 0.6, "type": "inter_cluster"}], ["gulf of mexico", "red snapper", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["gulf of mexico", "bycatch", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["large predators", "gear entanglements", {"weight": 1, "confidence": 0.4, "type": "inter_cluster"}], ["dynamic management", "large predators", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["smalltooth sawfish", "species abundance", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["regional collaboration", "population consequences", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["bycatch", "ecosystem", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["bycatch", "cetaceans", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["management measures", "poaching", {"weight": -1, "confidence": 0.9, "type": "inter_cluster"}], ["management measures", "mmpa listed species", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["entanglements", "ship strikes", {"weight": 0, "confidence": 0.85, "type": "inter_cluster"}], ["entanglements", "bycatch", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["climate change", "cumulative effects", {"weight": -1, "confidence": 0.75, "type": "inter_cluster"}], ["prey distribution", "regional community composition", {"weight": 1, "confidence": 0.9, "type": "inter_cluster"}], ["prey distribution", "poaching", {"weight": 1, "confidence": 0.7, "type": "inter_cluster"}], ["gear entanglements", "reproductive fitness", {"weight": -1, "confidence": 0.9, "type": "inter_cluster"}], ["cetacean morbillivirus", "ecosystem", {"weight": -1, "confidence": 0.9, "type": "inter_cluster"}], ["climate adaptation", "weighting adjustments", {"weight": 0, "confidence": 0.6, "type": "inter_cluster"}], ["over utilization", "genetic diversity", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["fishery ecosystem plans", "reproduction", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["fishery ecosystem plans", "oil spills", {"weight": -1, "confidence": 0.75, "type": "inter_cluster"}], ["fishery ecosystem plans", "marine mammals", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["fishery ecosystem plans", "sturgeon", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["giant manta ray", "ecosystem", {"weight": 1, "confidence": 0.75, "type": "inter_cluster"}], ["disease", "over utilization", {"weight": 1, "confidence": 0.65, "type": "inter_cluster"}], ["shrimp fishery", "red snapper", {"weight": -1, "confidence": 0.85, "type": "inter_cluster"}], ["demographic criteria", "invasive species", {"weight": 1, "confidence": 0.6, "type": "inter_cluster"}], ["reproductive fitness", "esa listed species", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["entanglement risk", "seismic airguns", {"weight": 1, "confidence": 0.5, "type": "inter_cluster"}], ["coral settlement", "food webs", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["parrot fish", "north atlantic right", {"weight": 1, "confidence": 0.6, "type": "inter_cluster"}], ["local prey abundance", "demographic criteria", {"weight": 1, "confidence": 0.9, "type": "inter_cluster"}], ["local prey abundance", "esa species", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["queen conch", "spawning aggregations", {"weight": 1, "confidence": 0.95, "type": "inter_cluster"}], ["bioenergetics", "dynamic management", {"weight": 1, "confidence": 0.5, "type": "inter_cluster"}], ["species of conservation", "ecosystem", {"weight": 1, "confidence": 0.85, "type": "inter_cluster"}], ["mental modeler", "entanglement risk", {"weight": 1, "confidence": 0.9, "type": "inter_cluster"}], ["mental modeler", "odds ratios", {"weight": 1, "confidence": 0.8, "type": "inter_cluster"}], ["gear entanglement", "gene flow", {"weight": -1, "confidence": 0.75, "type": "inter_cluster"}], ["multiple stressors", "cumulative effects", {"weight": 1, "confidence": 0.95, "type": "inter_cluster"}]];
        const clusterConcepts = {};
        const clusterEdges = {};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
