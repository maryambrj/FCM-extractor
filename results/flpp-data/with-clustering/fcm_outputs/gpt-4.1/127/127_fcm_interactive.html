
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"farm dollars": {"concepts": "farm dollars", "concept_list": ["farm dollars"], "type": "cluster", "node_size": 18, "label": "farm dollars"}, "commercial composting": {"concepts": "commercial composting", "concept_list": ["commercial composting"], "type": "cluster", "node_size": 18, "label": "commercial composting"}, "educator farmer": {"concepts": "educator farmer", "concept_list": ["educator farmer"], "type": "cluster", "node_size": 18, "label": "educator farmer"}, "Education Access": {"concepts": "educational opportunities, free education, education, education opportunities", "concept_list": ["educational opportunities", "free education", "education", "education opportunities"], "type": "cluster", "node_size": 27, "label": "Education Access"}, "Community Leadership": {"concepts": "leadership initiative, policy development, institutional influence, high tunnel initiative, partnerships, board participation, leadership, network expansion, availability, community institutions, csa, board representation, power structures, poverty, local sourcing, income outcomes, initiative, policies, facilitator, public institutions, community representatives, race, equity, vacant land, produce, access, resource connection, feedback loop, racial inequities, producer community, exclusionary practices, covid-19, affordability, community engagement, grassroots leadership, scarcity model, public institution, policy issues, policy strengthening, funding efforts, community foundation, applied research, policy, community empowerment, financial ability, institutional model, grassroots leaders, season extension, top-down institution, corporate background, payment options, msu extension, individual growers, local production, high tunnels, leader fullness, edible flint, institutional limitations, institutions, participation, values, organizational influence, power dynamics, funding, access barriers, policy level, urban ag grant, community leaders", "concept_list": ["leadership initiative", "policy development", "institutional influence", "high tunnel initiative", "partnerships", "board participation", "leadership", "network expansion", "availability", "community institutions", "csa", "board representation", "power structures", "poverty", "local sourcing", "income outcomes", "initiative", "policies", "facilitator", "public institutions", "community representatives", "race", "equity", "vacant land", "produce", "access", "resource connection", "feedback loop", "racial inequities", "producer community", "exclusionary practices", "covid-19", "affordability", "community engagement", "grassroots leadership", "scarcity model", "public institution", "policy issues", "policy strengthening", "funding efforts", "community foundation", "applied research", "policy", "community empowerment", "financial ability", "institutional model", "grassroots leaders", "season extension", "top-down institution", "corporate background", "payment options", "msu extension", "individual growers", "local production", "high tunnels", "leader fullness", "edible flint", "institutional limitations", "institutions", "participation", "values", "organizational influence", "power dynamics", "funding", "access barriers", "policy level", "urban ag grant", "community leaders"], "type": "cluster", "node_size": 219, "label": "Community Leadership"}, "Food Systems": {"concepts": "flint food system, nutritious food, supplemental nutrition programs, healthy food, food system sectors, food access, food production, food sovereignty, food system, food waste, nutritious foods, food systems, food systems institutions", "concept_list": ["flint food system", "nutritious food", "supplemental nutrition programs", "healthy food", "food system sectors", "food access", "food production", "food sovereignty", "food system", "food waste", "nutritious foods", "food systems", "food systems institutions"], "type": "cluster", "node_size": 54, "label": "Food Systems"}, "Health & Wellbeing": {"concepts": "meaningful change, sustainability, systems change, quality of life, health outcomes, health, behavior change, resilience", "concept_list": ["meaningful change", "sustainability", "systems change", "quality of life", "health outcomes", "health", "behavior change", "resilience"], "type": "cluster", "node_size": 39, "label": "Health & Wellbeing"}, "Food Retail": {"concepts": "retail, direct-to-consumer, grocery stores, convenience stores, chain restaurants, retail sector, retail market, local restaurants, market accessibility, retail use, chain grocery store", "concept_list": ["retail", "direct-to-consumer", "grocery stores", "convenience stores", "chain restaurants", "retail sector", "retail market", "local restaurants", "market accessibility", "retail use", "chain grocery store"], "type": "cluster", "node_size": 48, "label": "Food Retail"}, "Land and Resource Conservation": {"concepts": "natural resource conservation, emergency sector, land reuse, land use, community gardens, public transportation, market gardens, master gardener program, urban agriculture, genesee conservation district, conservation district, market garden programs, gardening", "concept_list": ["natural resource conservation", "emergency sector", "land reuse", "land use", "community gardens", "public transportation", "market gardens", "master gardener program", "urban agriculture", "genesee conservation district", "conservation district", "market garden programs", "gardening"], "type": "cluster", "node_size": 54, "label": "Land and Resource Conservation"}, "Local Food Access": {"concepts": "locally grown produce, fresh produce, farmers market, farm to consumer, farm stands, farmers markets", "concept_list": ["locally grown produce", "fresh produce", "farmers market", "farm to consumer", "farm stands", "farmers markets"], "type": "cluster", "node_size": 33, "label": "Local Food Access"}};
        const conceptData = {};
        const interClusterEdges = [["farm dollars", "Food Systems", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["farm dollars", "educator farmer", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["farm dollars", "Food Retail", {"weight": 0.75, "confidence": 0.5249999999999999, "type": "inter_cluster", "style": "solid"}], ["farm dollars", "Community Leadership", {"weight": 1.0, "confidence": 0.5666666666666668, "type": "inter_cluster", "style": "solid"}], ["farm dollars", "Health & Wellbeing", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["commercial composting", "Land and Resource Conservation", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["commercial composting", "Community Leadership", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["commercial composting", "educator farmer", {"weight": 0.8, "confidence": 0.44000000000000006, "type": "inter_cluster", "style": "solid"}], ["commercial composting", "Food Systems", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["educator farmer", "Land and Resource Conservation", {"weight": 1.0, "confidence": 0.72, "type": "inter_cluster", "style": "solid"}], ["educator farmer", "Local Food Access", {"weight": 0.75, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["educator farmer", "Education Access", {"weight": 0.75, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["educator farmer", "Community Leadership", {"weight": 0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["educator farmer", "farm dollars", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Local Food Access", {"weight": 1.0, "confidence": 0.61, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Community Leadership", {"weight": 0.8, "confidence": 0.49000000000000005, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Health & Wellbeing", {"weight": 0.8, "confidence": 0.43000000000000005, "type": "inter_cluster", "style": "solid"}], ["Education Access", "Land and Resource Conservation", {"weight": 0.6666666666666666, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Education Access", "commercial composting", {"weight": 0.6666666666666666, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Community Leadership", "Health & Wellbeing", {"weight": 0.75, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Community Leadership", "Food Systems", {"weight": 0.75, "confidence": 0.6000000000000001, "type": "inter_cluster", "style": "solid"}], ["Community Leadership", "farm dollars", {"weight": 0.75, "confidence": 0.42500000000000004, "type": "inter_cluster", "style": "solid"}], ["Community Leadership", "Education Access", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "farm dollars", {"weight": 1.0, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Local Food Access", {"weight": 0.8, "confidence": 0.6300000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Land and Resource Conservation", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Health & Wellbeing", {"weight": 0.75, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Education Access", {"weight": 0.75, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Food Retail", {"weight": 0.6666666666666666, "confidence": 0.5333333333333333, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "commercial composting", {"weight": 0.75, "confidence": 0.425, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Community Leadership", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "Land and Resource Conservation", {"weight": 1.0, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "Community Leadership", {"weight": 0.8, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "Food Retail", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "educator farmer", {"weight": 0.8, "confidence": 0.42000000000000004, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "Local Food Access", {"weight": 1.0, "confidence": 0.6833333333333332, "type": "inter_cluster", "style": "solid"}], ["Health & Wellbeing", "Education Access", {"weight": 0.75, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Food Systems", {"weight": 0.75, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Land and Resource Conservation", {"weight": 0.5, "confidence": 0.6749999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "educator farmer", {"weight": 0.25, "confidence": 0.4125, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "Community Leadership", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "Food Systems", {"weight": 1.0, "confidence": 0.8299999999999998, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "Local Food Access", {"weight": 0.8, "confidence": 0.6900000000000001, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "commercial composting", {"weight": 1.0, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "Community Leadership", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "Food Retail", {"weight": 0.75, "confidence": 0.5375, "type": "inter_cluster", "style": "solid"}], ["Land and Resource Conservation", "educator farmer", {"weight": 0.75, "confidence": 0.475, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "farm dollars", {"weight": 1.0, "confidence": 0.82, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "Health & Wellbeing", {"weight": 1.0, "confidence": 0.7875000000000001, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "Food Retail", {"weight": 0.8, "confidence": 0.5900000000000001, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "educator farmer", {"weight": 1.0, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "Land and Resource Conservation", {"weight": 1.0, "confidence": 0.6333333333333334, "type": "inter_cluster", "style": "solid"}], ["Local Food Access", "Education Access", {"weight": 0.6666666666666666, "confidence": 0.3166666666666667, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Education Access": [], "Community Leadership": [], "Food Systems": [], "Health & Wellbeing": [], "Food Retail": [], "Land and Resource Conservation": [], "Local Food Access": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
