
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food System": {"concepts": "preparation, initiative linking, personal, community level, residents, income, bus route, programs, cash, convening agency, hub, senior citizens, system map, community engagement, professional, chief, values, data support, availability, trust, cultural values, organizers, community empowerment, trauma, respect, data, audit, canning, usda, professional perception, community foundation, choices, actors, outcome measurement, participant recruitment, higher incomes, buzzword, lansing, odd hours, gaf certifier, rfp, partnership agreements, support structures, certification, map, churches, research dissemination, flint kids cook, pandemic, covid, hutchinson's, community, partnerships, school closures, community roles, leadership sign-off, affordability, universities, by the west, producers, comfort, partnership agreement, program scheduling, community outcomes, organization, barrier, american heart association, data collection, impact, hoophouse education, options, covid-19 impact, cookware, ywca, blackstone's, youth engagement, outside forces, gaf certification, locally grown, store closures, community disinvestment, education navigator, capacity, support, creativity, training, traffic, question marks, evaluative information, survey, leadership, racism, city trust, scarcity mentality, information dissemination, nighttime hours, quantity, msu extension, crisis, foundations, major players, quality, inequitable distribution, covid-19, kroger, mr. b's, seed programs, choice, resource allocation, stakeholder engagement, foundation, education, 501, dignity, research participation, convenience, processing, portion size, scheduling, partnership, transportation, collaboration, landmark, urban ag, engagement, opportunity, downtown, trust building, portions, community support, program initiatives, schools, arby's, expertise, convenings, empowerment, teachers, problem solving, meaningful engagement, common good, job, meijer, structures, group gaf, burger king, accessibility, criteria, transparency, driver, story circles, produce, produce supply, community needs, process, space sharing, groups, race, flint, walmart, event notification, children, career development, access, state, system, equity, flint families cook, resource, safety, mcdonald's, g-card, meeting", "concept_list": ["preparation", "initiative linking", "personal", "community level", "residents", "income", "bus route", "programs", "cash", "convening agency", "hub", "senior citizens", "system map", "community engagement", "professional", "chief", "values", "data support", "availability", "trust", "cultural values", "organizers", "community empowerment", "trauma", "respect", "data", "audit", "canning", "usda", "professional perception", "community foundation", "choices", "actors", "outcome measurement", "participant recruitment", "higher incomes", "buzzword", "lansing", "odd hours", "gaf certifier", "rfp", "partnership agreements", "support structures", "certification", "map", "churches", "research dissemination", "flint kids cook", "pandemic", "covid", "hutchinson's", "community", "partnerships", "school closures", "community roles", "leadership sign-off", "affordability", "universities", "by the west", "producers", "comfort", "partnership agreement", "program scheduling", "community outcomes", "organization", "barrier", "american heart association", "data collection", "impact", "hoophouse education", "options", "covid-19 impact", "cookware", "ywca", "blackstone's", "youth engagement", "outside forces", "gaf certification", "locally grown", "store closures", "community disinvestment", "education navigator", "capacity", "support", "creativity", "training", "traffic", "question marks", "evaluative information", "survey", "leadership", "racism", "city trust", "scarcity mentality", "information dissemination", "nighttime hours", "quantity", "msu extension", "crisis", "foundations", "major players", "quality", "inequitable distribution", "covid-19", "kroger", "mr. b's", "seed programs", "choice", "resource allocation", "stakeholder engagement", "foundation", "education", "501", "dignity", "research participation", "convenience", "processing", "portion size", "scheduling", "partnership", "transportation", "collaboration", "landmark", "urban ag", "engagement", "opportunity", "downtown", "trust building", "portions", "community support", "program initiatives", "schools", "arby's", "expertise", "convenings", "empowerment", "teachers", "problem solving", "meaningful engagement", "common good", "job", "meijer", "structures", "group gaf", "burger king", "accessibility", "criteria", "transparency", "driver", "story circles", "produce", "produce supply", "community needs", "process", "space sharing", "groups", "race", "flint", "walmart", "event notification", "children", "career development", "access", "state", "system", "equity", "flint families cook", "resource", "safety", "mcdonald's", "g-card", "meeting"], "type": "cluster", "node_size": 531, "label": "Food System"}, "Retail & Entrepreneurship": {"concepts": "prepared meals, food sector resilience, food sector community, food sector challenges, food sector solutions, food promotion, food sector assessment, food relationships, food service, food landscape, food distribution, food assessment, fresh produce, food sector empowerment, food strategy, food purchase, food experience, food solutions, food sector integration, food sector leadership, food resources, food network, fast food, food opportunities, food outreach, food traffic, food mapping, food sector improvement, water crisis, economic development, food stamps, food development, food safety, food awareness, double up food bucks, supplemental nutrition programs, school meals, food utilization, food sector partnerships, food sector change, food improvement, food support, food empowerment, food sector transformation, food participation, food growth, food policy, food leadership, food resilience, nutritious food, food change, bottled water, food ecosystem, food sector impact, food sector outreach, food outcomes, food sector, food sector collaboration, fresh food, nutrition program, food sector nutrition, food capacity, food support systems, food bank, supplemental food, food outlets, farmer's market, food intervention, food sector capacity, food system values, food production, food infrastructure, food logistics, farmers market, food challenges, food sector evaluation, food impact, nutrition, food system navigators, food sector policy, food insecurity, food organization, food market, food options, food evaluation, food environment, healthy food, food supply chain, food sector innovation, food innovation, food equity, food system navigator, tap water, cooking, food nutrition, food consumption, food measurement, nutritional content, preservatives, food sector equity, food sector outcomes, food sector safety, food advocacy, food sectors, food crisis, food connection, food donation, food engagement, food system, food sector support, food sector development, food initiative, food sector advocacy, value-added food, food sector justice, food delivery, food education, farmers, food sector measurement, family meals, food sustainability, food hub, calories, food system sectors, food partnerships, food programs, home cooking, farmers markets, cooking skills, food collaboration, nutritious foods, food availability, food access, food health, food planning, waste, food sovereignty, food sector strategy, food stakeholders, food skills, food transformation, flint food system, food sector barriers, food affordability, empty calories, food sector education, food sector health, food sector coordination, food sector engagement, food management, food community, additives, food sector opportunities, food sector planning, food context, food sources, food expertise, emergency food, food barriers, food justice, food retail, value added food, food supply, food provision, urban agriculture, food assistance, local economic development, food pricing, food quality, food sector sustainability, food demand, food sector awareness", "concept_list": ["prepared meals", "food sector resilience", "food sector community", "food sector challenges", "food sector solutions", "food promotion", "food sector assessment", "food relationships", "food service", "food landscape", "food distribution", "food assessment", "fresh produce", "food sector empowerment", "food strategy", "food purchase", "food experience", "food solutions", "food sector integration", "food sector leadership", "food resources", "food network", "fast food", "food opportunities", "food outreach", "food traffic", "food mapping", "food sector improvement", "water crisis", "economic development", "food stamps", "food development", "food safety", "food awareness", "double up food bucks", "supplemental nutrition programs", "school meals", "food utilization", "food sector partnerships", "food sector change", "food improvement", "food support", "food empowerment", "food sector transformation", "food participation", "food growth", "food policy", "food leadership", "food resilience", "nutritious food", "food change", "bottled water", "food ecosystem", "food sector impact", "food sector outreach", "food outcomes", "food sector", "food sector collaboration", "fresh food", "nutrition program", "food sector nutrition", "food capacity", "food support systems", "food bank", "supplemental food", "food outlets", "farmer's market", "food intervention", "food sector capacity", "food system values", "food production", "food infrastructure", "food logistics", "farmers market", "food challenges", "food sector evaluation", "food impact", "nutrition", "food system navigators", "food sector policy", "food insecurity", "food organization", "food market", "food options", "food evaluation", "food environment", "healthy food", "food supply chain", "food sector innovation", "food innovation", "food equity", "food system navigator", "tap water", "cooking", "food nutrition", "food consumption", "food measurement", "nutritional content", "preservatives", "food sector equity", "food sector outcomes", "food sector safety", "food advocacy", "food sectors", "food crisis", "food connection", "food donation", "food engagement", "food system", "food sector support", "food sector development", "food initiative", "food sector advocacy", "value-added food", "food sector justice", "food delivery", "food education", "farmers", "food sector measurement", "family meals", "food sustainability", "food hub", "calories", "food system sectors", "food partnerships", "food programs", "home cooking", "farmers markets", "cooking skills", "food collaboration", "nutritious foods", "food availability", "food access", "food health", "food planning", "waste", "food sovereignty", "food sector strategy", "food stakeholders", "food skills", "food transformation", "flint food system", "food sector barriers", "food affordability", "empty calories", "food sector education", "food sector health", "food sector coordination", "food sector engagement", "food management", "food community", "additives", "food sector opportunities", "food sector planning", "food context", "food sources", "food expertise", "emergency food", "food barriers", "food justice", "food retail", "value added food", "food supply", "food provision", "urban agriculture", "food assistance", "local economic development", "food pricing", "food quality", "food sector sustainability", "food demand", "food sector awareness"], "type": "cluster", "node_size": 531, "label": "Retail & Entrepreneurship"}, "Social Connections": {"concepts": "chamber of commerce, retail, sector, retail outlets, new entrepreneurs, buyers, leverage points, existing businesses, financial opportunities, sellers, mobile market, entrepreneurs, market sites, deliveries, mobile markets, market vendors, investment, market, retail part, growers, businesses, sectors, supplemental sector", "concept_list": ["chamber of commerce", "retail", "sector", "retail outlets", "new entrepreneurs", "buyers", "leverage points", "existing businesses", "financial opportunities", "sellers", "mobile market", "entrepreneurs", "market sites", "deliveries", "mobile markets", "market vendors", "investment", "market", "retail part", "growers", "businesses", "sectors", "supplemental sector"], "type": "cluster", "node_size": 84, "label": "Social Connections"}, "Community Engagement": {"concepts": "health, public health plan, hospitals, quality of life, health department, michigan health endowment fund, public health navigator, lifelong health issues, long term health, public health direction, daycare centers", "concept_list": ["health", "public health plan", "hospitals", "quality of life", "health department", "michigan health endowment fund", "public health navigator", "lifelong health issues", "long term health", "public health direction", "daycare centers"], "type": "cluster", "node_size": 48, "label": "Community Engagement"}, "Organizational Support": {"concepts": "organizational support, garden, gardens, gardening, prices, organizational equity, organizational mission, organizational structure, organizational work, price, transportation convenience", "concept_list": ["organizational support", "garden", "gardens", "gardening", "prices", "organizational equity", "organizational mission", "organizational structure", "organizational work", "price", "transportation convenience"], "type": "cluster", "node_size": 48, "label": "Organizational Support"}, "Kitchen Access": {"concepts": "commercial kitchens, kitchen access, kitchens, kitchen usage, licensed kitchens, kitchen utilization, kitchen capacity", "concept_list": ["commercial kitchens", "kitchen access", "kitchens", "kitchen usage", "licensed kitchens", "kitchen utilization", "kitchen capacity"], "type": "cluster", "node_size": 36, "label": "Kitchen Access"}, "Grant Funding": {"concepts": "funders, funding allocation, grant, grant funding, funding, grant distribution, state funding, grant writer, negative connection, connection, connections, connection strengths, relationships, communication, social network analysis", "concept_list": ["funders", "funding allocation", "grant", "grant funding", "funding", "grant distribution", "state funding", "grant writer", "negative connection", "connection", "connections", "connection strengths", "relationships", "communication", "social network analysis"], "type": "cluster", "node_size": 60, "label": "Grant Funding"}, "Food Retail Access": {"concepts": "grocery stores, shopping patterns, convenience store, chain restaurants, grocery store closures, community shopping, local restaurants, rental spaces, local grocer, grocery store, restaurant usage, restaurant use, convenience stores", "concept_list": ["grocery stores", "shopping patterns", "convenience store", "chain restaurants", "grocery store closures", "community shopping", "local restaurants", "rental spaces", "local grocer", "grocery store", "restaurant usage", "restaurant use", "convenience stores"], "type": "cluster", "node_size": 54, "label": "Food Retail Access"}};
        const conceptData = {};
        const interClusterEdges = [["Food System", "Social Connections", {"weight": 0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Retail & Entrepreneurship", "Organizational Support", {"weight": 0.75, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Retail & Entrepreneurship", "Social Connections", {"weight": 0.6666666666666666, "confidence": 0.4666666666666666, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Food System", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Organizational Support", "Food Retail Access", {"weight": 0.5, "confidence": 0.38749999999999996, "type": "inter_cluster", "style": "solid"}], ["Kitchen Access", "Community Engagement", {"weight": 0.3333333333333333, "confidence": 0.21666666666666667, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Community Engagement", {"weight": 0.75, "confidence": 0.6375, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Retail & Entrepreneurship", {"weight": 0.75, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food System": [], "Retail & Entrepreneurship": [], "Social Connections": [], "Community Engagement": [], "Organizational Support": [], "Kitchen Access": [], "Grant Funding": [], "Food Retail Access": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
