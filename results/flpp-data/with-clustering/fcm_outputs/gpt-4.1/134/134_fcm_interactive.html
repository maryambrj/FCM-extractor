
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Food Access Systems": {"concepts": "behavioral drivers, flint fresh, local business reputation, organizational influence, resilience, urban agriculture, grocery store, local restaurants, big box stores, retail expansion, program participation, feedback loop, distribution channels, decentralization, community ownership, community development, local resources, local control, demand shift, social workers, local production, awareness, placemaking, social domain, broken system, local endeavors, youth employment, social context, macro-level impact, sustainability, social hubs, professors, convenience stores, community power, availability, resource sharing, recovery plan, barriers, chain stores, community level, professionals, farmers markets, service based community, empowerment, generative effect, grocery store initiatives, targeted participants, affordability, local capacity, income allocation, connection strength, service economy, demand, economic system, basic needs, social support, diversity receptive localism, partnerships, child tax credit, structural factors, economic sustainability, societal function, economic development, organizational domain, consumer behavior, retail models, leverage points, democratic participation, community empowerment, quality of life, organizational collaboration, locally developed grocery stores, robert wood johnson foundation, local development, neighborhood revitalization, store reputation, community pride, housing access, extractive retail, critical mass, co-op, main street decline, functional society, social engagement, adults, local retail, chamber of commerce, community context, functional partnerships, branding, defensive localism, delivery services, local food economy, information access, underemployment, local economics, economic model, community control, walmart, edible flint, employment opportunities, walmart business model, civic participation, social capital, national policy, local economy, local economic development, shrinking cities, property taxes, psychological domain, social conflict, grocery stores, chronic disease prevention, advertising, main streets, community hub, psychological factors, wealth accumulation, underpaid labor, wealth creation, community analysis, resource distribution, behavioral issues, chronic disease, global economy, consumer expectations, long-term planning, neighborhood collaboration, retail use, policy intervention, wage stagnation, community engagement, jobs, fiefdom, local wealth creation, macro level, crop production, collaboration, academic performance, creative solutions, price disparity, foundations, housing, college cultural neighborhood, root causes, advocacy, social inequality, decision making, farmers market, education, education access, chain restaurants, price competition, retail types, health care, global society, poverty reduction, covid impact, unionization, organizational partnerships, community organizations, service-based community, corporate influence, recirculating money, neighbors, market analysis, political change, knowledge dissemination, healthcare access, gig economy, recirculation, leafy greens, america first, teenagers, product sovereignty, social values, population decline, trajectory, health behaviors, retail competition, social cohesion, social networks, community gardens, economic impact, community presence, business model, locally owned grocery store, conventional system, local economies, child tax credits, charity model, neighborhood variation, economic stimulus, regional development, resource duplication, immigration policies", "concept_list": ["behavioral drivers", "flint fresh", "local business reputation", "organizational influence", "resilience", "urban agriculture", "grocery store", "local restaurants", "big box stores", "retail expansion", "program participation", "feedback loop", "distribution channels", "decentralization", "community ownership", "community development", "local resources", "local control", "demand shift", "social workers", "local production", "awareness", "placemaking", "social domain", "broken system", "local endeavors", "youth employment", "social context", "macro-level impact", "sustainability", "social hubs", "professors", "convenience stores", "community power", "availability", "resource sharing", "recovery plan", "barriers", "chain stores", "community level", "professionals", "farmers markets", "service based community", "empowerment", "generative effect", "grocery store initiatives", "targeted participants", "affordability", "local capacity", "income allocation", "connection strength", "service economy", "demand", "economic system", "basic needs", "social support", "diversity receptive localism", "partnerships", "child tax credit", "structural factors", "economic sustainability", "societal function", "economic development", "organizational domain", "consumer behavior", "retail models", "leverage points", "democratic participation", "community empowerment", "quality of life", "organizational collaboration", "locally developed grocery stores", "robert wood johnson foundation", "local development", "neighborhood revitalization", "store reputation", "community pride", "housing access", "extractive retail", "critical mass", "co-op", "main street decline", "functional society", "social engagement", "adults", "local retail", "chamber of commerce", "community context", "functional partnerships", "branding", "defensive localism", "delivery services", "local food economy", "information access", "underemployment", "local economics", "economic model", "community control", "walmart", "edible flint", "employment opportunities", "walmart business model", "civic participation", "social capital", "national policy", "local economy", "local economic development", "shrinking cities", "property taxes", "psychological domain", "social conflict", "grocery stores", "chronic disease prevention", "advertising", "main streets", "community hub", "psychological factors", "wealth accumulation", "underpaid labor", "wealth creation", "community analysis", "resource distribution", "behavioral issues", "chronic disease", "global economy", "consumer expectations", "long-term planning", "neighborhood collaboration", "retail use", "policy intervention", "wage stagnation", "community engagement", "jobs", "fiefdom", "local wealth creation", "macro level", "crop production", "collaboration", "academic performance", "creative solutions", "price disparity", "foundations", "housing", "college cultural neighborhood", "root causes", "advocacy", "social inequality", "decision making", "farmers market", "education", "education access", "chain restaurants", "price competition", "retail types", "health care", "global society", "poverty reduction", "covid impact", "unionization", "organizational partnerships", "community organizations", "service-based community", "corporate influence", "recirculating money", "neighbors", "market analysis", "political change", "knowledge dissemination", "healthcare access", "gig economy", "recirculation", "leafy greens", "america first", "teenagers", "product sovereignty", "social values", "population decline", "trajectory", "health behaviors", "retail competition", "social cohesion", "social networks", "community gardens", "economic impact", "community presence", "business model", "locally owned grocery store", "conventional system", "local economies", "child tax credits", "charity model", "neighborhood variation", "economic stimulus", "regional development", "resource duplication", "immigration policies"], "type": "cluster", "node_size": 603, "label": "Food Access Systems"}, "Local Economic Development": {"concepts": "food expenditure, church food programs, food systems, supplemental nutrition programs, food security, real food, food waste, food retail, food purchasing, food insecurity, fast food, processed food, food giveaways, food affordability, child nutrition, organic products, food access, food system, north flint food market, food charity, local food initiatives, church members, food system map, healthy eating, food deserts, food sovereignty, food distribution, food production, value-added food", "concept_list": ["food expenditure", "church food programs", "food systems", "supplemental nutrition programs", "food security", "real food", "food waste", "food retail", "food purchasing", "food insecurity", "fast food", "processed food", "food giveaways", "food affordability", "child nutrition", "organic products", "food access", "food system", "north flint food market", "food charity", "local food initiatives", "church members", "food system map", "healthy eating", "food deserts", "food sovereignty", "food distribution", "food production", "value-added food"], "type": "cluster", "node_size": 102, "label": "Local Economic Development"}};
        const conceptData = {};
        const interClusterEdges = [["Local Economic Development", "Food Access Systems", {"weight": 1.0, "confidence": 0.89, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Food Access Systems": [], "Local Economic Development": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
