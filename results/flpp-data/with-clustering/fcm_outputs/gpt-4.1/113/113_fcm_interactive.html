
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"volunteers": {"concepts": "volunteers", "concept_list": ["volunteers"], "type": "cluster", "node_size": 18, "label": "volunteers"}, "faith communities": {"concepts": "faith communities", "concept_list": ["faith communities"], "type": "cluster", "node_size": 18, "label": "faith communities"}, "Community Events": {"concepts": "older adults, health effects", "concept_list": ["older adults", "health effects"], "type": "cluster", "node_size": 21, "label": "Community Events"}, "Contactless Practices": {"concepts": "graduation events, pantry clients, residents, staff", "concept_list": ["graduation events", "pantry clients", "residents", "staff"], "type": "cluster", "node_size": 27, "label": "Contactless Practices"}, "Food Access Systems": {"concepts": "contactless communion, community periphery", "concept_list": ["contactless communion", "community periphery"], "type": "cluster", "node_size": 21, "label": "Food Access Systems"}, "Social Dynamics": {"concepts": "tradition, quality, autonomy, staple items, salads, access point, less visible piece, perception, technical process, local identity, meijers, michigan lottery, catholic charities, you-buy-we-fry, bus terminal, water crisis, management, contactless service, downtown ministries, liability, choice pantry, succession planning, stock maintenance, commercial spaces, automotive ownership, cider, tokens, invisible barriers, technical eligibility, inventory sheet, flint, flint residents, formula, technology, city limits, middle class, flint area, snap, user experience, meijer, security measures, comfort, visible piece, distributors, pharmacies, model, quality perception, racial profiling, kiosks, msu product center, evaluation, parking, transportation, walmart, adaptation, big city challenge, ownership, zip code, wic benefits, access points, funeral service, coop houses, takeout, mass transit, flint community, value, personality factors, standards, diversity, traffic patterns, transportation link, michigan products, catering, chains, succession, commercial use, snap eligible, transportation reliability, eggs, monitoring, resource utilization, terminal, eastern michigan, equipment upgrade, occasion, suburb, domain-specific terms, vendors, convenience, problem solving, demographic report, ownership type, personality factor, transaction observation, accessibility, produce, benefit usage, following, common good, executive program, affordability, safety, kroger, staples, niche", "concept_list": ["tradition", "quality", "autonomy", "staple items", "salads", "access point", "less visible piece", "perception", "technical process", "local identity", "meijers", "michigan lottery", "catholic charities", "you-buy-we-fry", "bus terminal", "water crisis", "management", "contactless service", "downtown ministries", "liability", "choice pantry", "succession planning", "stock maintenance", "commercial spaces", "automotive ownership", "cider", "tokens", "invisible barriers", "technical eligibility", "inventory sheet", "flint", "flint residents", "formula", "technology", "city limits", "middle class", "flint area", "snap", "user experience", "meijer", "security measures", "comfort", "visible piece", "distributors", "pharmacies", "model", "quality perception", "racial profiling", "kiosks", "msu product center", "evaluation", "parking", "transportation", "walmart", "adaptation", "big city challenge", "ownership", "zip code", "wic benefits", "access points", "funeral service", "coop houses", "takeout", "mass transit", "flint community", "value", "personality factors", "standards", "diversity", "traffic patterns", "transportation link", "michigan products", "catering", "chains", "succession", "commercial use", "snap eligible", "transportation reliability", "eggs", "monitoring", "resource utilization", "terminal", "eastern michigan", "equipment upgrade", "occasion", "suburb", "domain-specific terms", "vendors", "convenience", "problem solving", "demographic report", "ownership type", "personality factor", "transaction observation", "accessibility", "produce", "benefit usage", "following", "common good", "executive program", "affordability", "safety", "kroger", "staples", "niche"], "type": "cluster", "node_size": 330, "label": "Social Dynamics"}, "Senior Health": {"concepts": "societal rules, social awareness, physical presence, social process, social dynamics, interpersonal interaction, societal roles, social gatherings", "concept_list": ["societal rules", "social awareness", "physical presence", "social process", "social dynamics", "interpersonal interaction", "societal roles", "social gatherings"], "type": "cluster", "node_size": 39, "label": "Senior Health"}, "Community Food Connections": {"concepts": "beirut restaurant, consumer choice, chain stores, neighborhood, public health, stigma, supplemental sector, program barriers, st. luke's new life center, resident values, local grocer, community connections, ethnic restaurants, chain restaurants, health department, convenience factors, determinants, independent grocers, small grocers, quality of life, takeout alcohol, sexual harassment, household consumption, committed volunteers, staff presence, program participation, household, connection strength, volunteer labor, communion, graduation, community connection, consumer demand, connections, local restaurants, alcohol sales, local restaurant", "concept_list": ["beirut restaurant", "consumer choice", "chain stores", "neighborhood", "public health", "stigma", "supplemental sector", "program barriers", "st. luke's new life center", "resident values", "local grocer", "community connections", "ethnic restaurants", "chain restaurants", "health department", "convenience factors", "determinants", "independent grocers", "small grocers", "quality of life", "takeout alcohol", "sexual harassment", "household consumption", "committed volunteers", "staff presence", "program participation", "household", "connection strength", "volunteer labor", "communion", "graduation", "community connection", "consumer demand", "connections", "local restaurants", "alcohol sales", "local restaurant"], "type": "cluster", "node_size": 126, "label": "Community Food Connections"}, "Store Experience": {"concepts": "store owner engagement, shopping incidents, store reputation, store cleanliness, corner stores, grocery stores, shopping experience, store expansion, chain grocery, store location, store experience, small business, store maintenance, small stores, shopping centers, consumer behavior, shopper perceptions, store renovation, customer service, customer engagement, store competition, store owner, store closures, store closing, customer experience, convenience stores, stores, store owners, store opening", "concept_list": ["store owner engagement", "shopping incidents", "store reputation", "store cleanliness", "corner stores", "grocery stores", "shopping experience", "store expansion", "chain grocery", "store location", "store experience", "small business", "store maintenance", "small stores", "shopping centers", "consumer behavior", "shopper perceptions", "store renovation", "customer service", "customer engagement", "store competition", "store owner", "store closures", "store closing", "customer experience", "convenience stores", "stores", "store owners", "store opening"], "type": "cluster", "node_size": 102, "label": "Store Experience"}, "Food Access & Systems": {"concepts": "hot food, food-related health, food selection, food quantity, meal preparation, flint farmers market, fresh produce, food systems, food types, small farmer, clothing distribution, food support, food access, soup kitchen, food distribution, food accessibility, canned foods, food dignity, double up food bucks, dignity, food policies, supplemental nutrition assistance, meat counter, meat, flint food system, food landscape, food convenience, food quality, food availability, farmers market, frozen foods, sweetened beverages, food sharing, food bank, shelf life, food culture, food service, food producers, food environment, commercial kitchens, fresh food, food eligibility, food economy, local foods, food licensing, farmers markets, food sector, food traditions, staple foods, food security, apple orchard, food consumption, vegetables, food pantry, growers, cheesemonger, supplemental nutrition programs, organic farm, dairy products, canned food, meal packaging, food system, food appreciation, food events, food practices, shelf stable food, meat quality, food businesses, food pantries, food safety, food sustainability, fresh vegetables, desired foods, food occasions, food gap, frozen meats, food model, frozen food, ready to eat food, food resilience, food outlets, baby products, food court, dairy, convenience foods, food networks, produce quality, produce distribution, food provision, snack foods, shelf stable, food research, food hub, food regulation, food following, fast food, food habits, food industry, high quality food", "concept_list": ["hot food", "food-related health", "food selection", "food quantity", "meal preparation", "flint farmers market", "fresh produce", "food systems", "food types", "small farmer", "clothing distribution", "food support", "food access", "soup kitchen", "food distribution", "food accessibility", "canned foods", "food dignity", "double up food bucks", "dignity", "food policies", "supplemental nutrition assistance", "meat counter", "meat", "flint food system", "food landscape", "food convenience", "food quality", "food availability", "farmers market", "frozen foods", "sweetened beverages", "food sharing", "food bank", "shelf life", "food culture", "food service", "food producers", "food environment", "commercial kitchens", "fresh food", "food eligibility", "food economy", "local foods", "food licensing", "farmers markets", "food sector", "food traditions", "staple foods", "food security", "apple orchard", "food consumption", "vegetables", "food pantry", "growers", "cheesemonger", "supplemental nutrition programs", "organic farm", "dairy products", "canned food", "meal packaging", "food system", "food appreciation", "food events", "food practices", "shelf stable food", "meat quality", "food businesses", "food pantries", "food safety", "food sustainability", "fresh vegetables", "desired foods", "food occasions", "food gap", "frozen meats", "food model", "frozen food", "ready to eat food", "food resilience", "food outlets", "baby products", "food court", "dairy", "convenience foods", "food networks", "produce quality", "produce distribution", "food provision", "snack foods", "shelf stable", "food research", "food hub", "food regulation", "food following", "fast food", "food habits", "food industry", "high quality food"], "type": "cluster", "node_size": 312, "label": "Food Access & Systems"}, "Local Business Strength": {"concepts": "business capacity, business sustainability, local economy, local businesses", "concept_list": ["business capacity", "business sustainability", "local economy", "local businesses"], "type": "cluster", "node_size": 27, "label": "Local Business Strength"}, "Market Competition": {"concepts": "informal economy, local competition, chain landscape, regional chains", "concept_list": ["informal economy", "local competition", "chain landscape", "regional chains"], "type": "cluster", "node_size": 27, "label": "Market Competition"}, "Local Baked Goods": {"concepts": "baked goods, local products, local appreciation", "concept_list": ["baked goods", "local products", "local appreciation"], "type": "cluster", "node_size": 24, "label": "Local Baked Goods"}, "Grant Funding": {"concepts": "grant program, grant, program funding, sustained funding", "concept_list": ["grant program", "grant", "program funding", "sustained funding"], "type": "cluster", "node_size": 27, "label": "Grant Funding"}, "Research Projects": {"concepts": "research project, project, grant funded project", "concept_list": ["research project", "project", "grant funded project"], "type": "cluster", "node_size": 24, "label": "Research Projects"}, "Church Community": {"concepts": "church kitchens, catholic church, church pantries, church life, church, congregation", "concept_list": ["church kitchens", "catholic church", "church pantries", "church life", "church", "congregation"], "type": "cluster", "node_size": 33, "label": "Church Community"}, "Community Meals": {"concepts": "community meals, meal providers, church meals, emergency meals, celebration meals, congregate meals", "concept_list": ["community meals", "meal providers", "church meals", "emergency meals", "celebration meals", "congregate meals"], "type": "cluster", "node_size": 33, "label": "Community Meals"}, "Market Schedule": {"concepts": "market hours, market days", "concept_list": ["market hours", "market days"], "type": "cluster", "node_size": 21, "label": "Market Schedule"}, "Market Dynamics": {"concepts": "market dynamics, marketplace, leverage points, market presence", "concept_list": ["market dynamics", "marketplace", "leverage points", "market presence"], "type": "cluster", "node_size": 27, "label": "Market Dynamics"}, "Product Selection": {"concepts": "product expiration, product selection, market staples, price point", "concept_list": ["product expiration", "product selection", "market staples", "price point"], "type": "cluster", "node_size": 27, "label": "Product Selection"}, "Economic Sectors": {"concepts": "formal economy, sector, trade area, economic data, economic factors, under-recognized economy", "concept_list": ["formal economy", "sector", "trade area", "economic data", "economic factors", "under-recognized economy"], "type": "cluster", "node_size": 33, "label": "Economic Sectors"}, "Entrepreneurship": {"concepts": "entrepreneurs, investment, entrepreneurship", "concept_list": ["entrepreneurs", "investment", "entrepreneurship"], "type": "cluster", "node_size": 24, "label": "Entrepreneurship"}, "Cold Storage": {"concepts": "cooler, protein availability, incubation space, frozen proteins, freezer space, protein, freezer equipment, freezer compartment, cooler space, open refrigerated case, frozen products, flash frozen, refrigeration equipment", "concept_list": ["cooler", "protein availability", "incubation space", "frozen proteins", "freezer space", "protein", "freezer equipment", "freezer compartment", "cooler space", "open refrigerated case", "frozen products", "flash frozen", "refrigeration equipment"], "type": "cluster", "node_size": 54, "label": "Cold Storage"}, "Community Engagement": {"concepts": "crossover outreach, african american community, community adaptation, community mix, focus groups, community health, group adaptation, community, group competition, community garden, neighborhood identity, emergency sector, community assets, community needs", "concept_list": ["crossover outreach", "african american community", "community adaptation", "community mix", "focus groups", "community health", "group adaptation", "community", "group competition", "community garden", "neighborhood identity", "emergency sector", "community assets", "community needs"], "type": "cluster", "node_size": 57, "label": "Community Engagement"}, "Retail Sector": {"concepts": "retailer, retail types, retail use, retail price, retail sector, lottery retailers", "concept_list": ["retailer", "retail types", "retail use", "retail price", "retail sector", "lottery retailers"], "type": "cluster", "node_size": 33, "label": "Retail Sector"}};
        const conceptData = {};
        const interClusterEdges = [["volunteers", "Market Dynamics", {"weight": 1.0, "confidence": 0.6799999999999999, "type": "inter_cluster", "style": "solid"}], ["faith communities", "Church Community", {"weight": 1.0, "confidence": 0.9249999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Events", "Market Schedule", {"weight": 0.25, "confidence": 0.375, "type": "inter_cluster", "style": "solid"}], ["Community Events", "Cold Storage", {"weight": 0.75, "confidence": 0.4, "type": "inter_cluster", "style": "solid"}], ["Community Events", "Community Food Connections", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Events", "volunteers", {"weight": 0.6666666666666666, "confidence": 0.3333333333333333, "type": "inter_cluster", "style": "solid"}], ["Community Events", "Product Selection", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Contactless Practices", "Research Projects", {"weight": 0.75, "confidence": 0.42500000000000004, "type": "inter_cluster", "style": "solid"}], ["Food Access Systems", "Community Food Connections", {"weight": 0.5, "confidence": 0.275, "type": "inter_cluster", "style": "solid"}], ["Food Access Systems", "Local Baked Goods", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Food Access Systems", "Economic Sectors", {"weight": 0.3333333333333333, "confidence": 0.16666666666666666, "type": "inter_cluster", "style": "solid"}], ["Senior Health", "Community Meals", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["Senior Health", "Market Schedule", {"weight": 1.0, "confidence": 0.5625, "type": "inter_cluster", "style": "solid"}], ["Senior Health", "Market Dynamics", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Community Food Connections", "faith communities", {"weight": 0.5, "confidence": 0.32499999999999996, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Market Dynamics", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Food Access & Systems", {"weight": 1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Local Baked Goods", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Entrepreneurship", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Market Schedule", {"weight": 0.6666666666666666, "confidence": 0.3666666666666667, "type": "inter_cluster", "style": "solid"}], ["Store Experience", "Senior Health", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Food Access & Systems", "Contactless Practices", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Food Access & Systems", "Community Engagement", {"weight": 1.0, "confidence": 0.8125, "type": "inter_cluster", "style": "solid"}], ["Food Access & Systems", "Product Selection", {"weight": 1.0, "confidence": 0.8000000000000002, "type": "inter_cluster", "style": "solid"}], ["Food Access & Systems", "Entrepreneurship", {"weight": 1.0, "confidence": 0.7166666666666668, "type": "inter_cluster", "style": "solid"}], ["Local Business Strength", "Community Engagement", {"weight": 1.0, "confidence": 0.74, "type": "inter_cluster", "style": "solid"}], ["Local Business Strength", "Research Projects", {"weight": 1.0, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Market Competition", "Social Dynamics", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Local Baked Goods", "Retail Sector", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Local Baked Goods", "Store Experience", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Local Baked Goods", "faith communities", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "faith communities", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Community Engagement", {"weight": 1.0, "confidence": 0.7875, "type": "inter_cluster", "style": "solid"}], ["Grant Funding", "Social Dynamics", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Research Projects", "Market Competition", {"weight": 1.0, "confidence": 0.6166666666666666, "type": "inter_cluster", "style": "solid"}], ["Church Community", "Community Events", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Church Community", "Market Schedule", {"weight": 1.0, "confidence": 0.525, "type": "inter_cluster", "style": "solid"}], ["Church Community", "Economic Sectors", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Meals", "Economic Sectors", {"weight": 0.75, "confidence": 0.4625, "type": "inter_cluster", "style": "solid"}], ["Community Meals", "Local Baked Goods", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Market Schedule", "Senior Health", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Market Schedule", "Grant Funding", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Market Dynamics", "Retail Sector", {"weight": 1.0, "confidence": 0.7699999999999999, "type": "inter_cluster", "style": "solid"}], ["Product Selection", "Church Community", {"weight": 0.8, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}], ["Product Selection", "Grant Funding", {"weight": 0.8, "confidence": 0.48999999999999994, "type": "inter_cluster", "style": "solid"}], ["Product Selection", "faith communities", {"weight": 0.3333333333333333, "confidence": 0.16666666666666666, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "Community Food Connections", {"weight": 1.0, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "Cold Storage", {"weight": 1.0, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "Community Events", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["Entrepreneurship", "Church Community", {"weight": 1.0, "confidence": 0.59, "type": "inter_cluster", "style": "solid"}], ["Entrepreneurship", "Grant Funding", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Entrepreneurship", "Contactless Practices", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Entrepreneurship", "Market Competition", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Entrepreneurship", "volunteers", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Cold Storage", "Store Experience", {"weight": 1.0, "confidence": 0.8500000000000001, "type": "inter_cluster", "style": "solid"}], ["Cold Storage", "Economic Sectors", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Cold Storage", "Market Competition", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Contactless Practices", {"weight": 0.6666666666666666, "confidence": 0.39999999999999997, "type": "inter_cluster", "style": "solid"}], ["Retail Sector", "Research Projects", {"weight": 0.3333333333333333, "confidence": 0.19999999999999998, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Events": [], "Contactless Practices": [], "Food Access Systems": [], "Social Dynamics": [], "Senior Health": [], "Community Food Connections": [], "Store Experience": [], "Food Access & Systems": [], "Local Business Strength": [], "Market Competition": [], "Local Baked Goods": [], "Grant Funding": [], "Research Projects": [], "Church Community": [], "Community Meals": [], "Market Schedule": [], "Market Dynamics": [], "Product Selection": [], "Economic Sectors": [], "Entrepreneurship": [], "Cold Storage": [], "Community Engagement": [], "Retail Sector": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
