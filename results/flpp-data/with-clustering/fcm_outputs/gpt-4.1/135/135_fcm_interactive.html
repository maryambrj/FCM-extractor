
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ‚Üê Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"local entrepreneurs": {"concepts": "local entrepreneurs", "concept_list": ["local entrepreneurs"], "type": "cluster", "node_size": 18, "label": "local entrepreneurs"}, "climate change": {"concepts": "climate change", "concept_list": ["climate change"], "type": "cluster", "node_size": 18, "label": "climate change"}, "education gap": {"concepts": "education gap", "concept_list": ["education gap"], "type": "cluster", "node_size": 18, "label": "education gap"}, "market integration": {"concepts": "market integration", "concept_list": ["market integration"], "type": "cluster", "node_size": 18, "label": "market integration"}, "Access and Equity": {"concepts": "public health, hhs director", "concept_list": ["public health", "hhs director"], "type": "cluster", "node_size": 21, "label": "Access and Equity"}, "Organizational Dynamics": {"concepts": "access pathways, policy, values mapping, producer, producer representation, affordability, masking, respect, programs, costs, inclusivity, transportation challenge, equity, choice, overconsumption, access, availability, families, values, supplementals, inclusion, eligibility, income, application restrictions, vacant lots, freedom", "concept_list": ["access pathways", "policy", "values mapping", "producer", "producer representation", "affordability", "masking", "respect", "programs", "costs", "inclusivity", "transportation challenge", "equity", "choice", "overconsumption", "access", "availability", "families", "values", "supplementals", "inclusion", "eligibility", "income", "application restrictions", "vacant lots", "freedom"], "type": "cluster", "node_size": 93, "label": "Organizational Dynamics"}, "Local Retail Systems": {"concepts": "informal sector, organizational formation, organizational continuity, organizational sectors, organizational energy, organizational pride, participant roles, state employees, positive outcomes, organizational membership, organizational diversity, organizational outcomes, organizational training, organizational values, organizational roles", "concept_list": ["informal sector", "organizational formation", "organizational continuity", "organizational sectors", "organizational energy", "organizational pride", "participant roles", "state employees", "positive outcomes", "organizational membership", "organizational diversity", "organizational outcomes", "organizational training", "organizational values", "organizational roles"], "type": "cluster", "node_size": 60, "label": "Local Retail Systems"}, "Community Support Systems": {"concepts": "retail sustainability, local retail system, neighborhood stores, chain restaurants, convenience stores, local restaurants, people's restaurant, grocery stores, retail sector", "concept_list": ["retail sustainability", "local retail system", "neighborhood stores", "chain restaurants", "convenience stores", "local restaurants", "people's restaurant", "grocery stores", "retail sector"], "type": "cluster", "node_size": 42, "label": "Community Support Systems"}, "Public Health Leadership": {"concepts": "hhs, pandemic response, federal policies, philanthropic sector, anchor institution, quality of life, eligibility expansion, wraparound supports, intermediate support, safety net services, environmental justice, culture building, health factor, michigan, policymaking, comfort, pandemic, southeast michigan, opportunity for change, philanthropic funders, communication, nonprofit sector, dropoff sites, trust, partnerships, ex-felons, inequities, program funding, pay what you want, reciprocity, progressive services, state government, service provision, environment", "concept_list": ["hhs", "pandemic response", "federal policies", "philanthropic sector", "anchor institution", "quality of life", "eligibility expansion", "wraparound supports", "intermediate support", "safety net services", "environmental justice", "culture building", "health factor", "michigan", "policymaking", "comfort", "pandemic", "southeast michigan", "opportunity for change", "philanthropic funders", "communication", "nonprofit sector", "dropoff sites", "trust", "partnerships", "ex-felons", "inequities", "program funding", "pay what you want", "reciprocity", "progressive services", "state government", "service provision", "environment"], "type": "cluster", "node_size": 117, "label": "Public Health Leadership"}, "Food Systems": {"concepts": "food discourse, beef shortage, free food, food system, food income support, food purchases, farmers markets, produce quality, food insecurity, food movement, food assistance program, flint food system, healthy food, chicken rations, food producer, food security, emergency food, nutritious foods, food pantry, food supply, food citizenship, farm development, food pantries, supplemental food sector, meat consumption, food consumption, pantries, emergency food sector, emergency food system, food mapping, food systems lens, food access, food acquisition, food distribution, food system workers, supplemental food system, food quality, pork shortage, farmers market", "concept_list": ["food discourse", "beef shortage", "free food", "food system", "food income support", "food purchases", "farmers markets", "produce quality", "food insecurity", "food movement", "food assistance program", "flint food system", "healthy food", "chicken rations", "food producer", "food security", "emergency food", "nutritious foods", "food pantry", "food supply", "food citizenship", "farm development", "food pantries", "supplemental food sector", "meat consumption", "food consumption", "pantries", "emergency food sector", "emergency food system", "food mapping", "food systems lens", "food access", "food acquisition", "food distribution", "food system workers", "supplemental food system", "food quality", "pork shortage", "farmers market"], "type": "cluster", "node_size": 132, "label": "Food Systems"}, "Socioeconomic Factors": {"concepts": "social determinants, economic development, poverty, unemployment extension", "concept_list": ["social determinants", "economic development", "poverty", "unemployment extension"], "type": "cluster", "node_size": 27, "label": "Socioeconomic Factors"}, "Migrant Labor": {"concepts": "migrants, migrant labor, migrant laborers, labor conditions, informal economy, forced labor", "concept_list": ["migrants", "migrant labor", "migrant laborers", "labor conditions", "informal economy", "forced labor"], "type": "cluster", "node_size": 33, "label": "Migrant Labor"}, "Community Engagement": {"concepts": "community interest, community level, community action agency, community network, community empowerment, community impact, community engagement", "concept_list": ["community interest", "community level", "community action agency", "community network", "community empowerment", "community impact", "community engagement"], "type": "cluster", "node_size": 36, "label": "Community Engagement"}, "Racial Communities": {"concepts": "black community, white-led organizations, white community", "concept_list": ["black community", "white-led organizations", "white community"], "type": "cluster", "node_size": 24, "label": "Racial Communities"}, "Collaborative Networks": {"concepts": "collective understanding, social connections, cultural reference, collaboration", "concept_list": ["collective understanding", "social connections", "cultural reference", "collaboration"], "type": "cluster", "node_size": 27, "label": "Collaborative Networks"}, "Community Outreach": {"concepts": "churches, focus groups", "concept_list": ["churches", "focus groups"], "type": "cluster", "node_size": 21, "label": "Community Outreach"}, "Document Management": {"concepts": "fap, file retention, checklist", "concept_list": ["fap", "file retention", "checklist"], "type": "cluster", "node_size": 24, "label": "Document Management"}, "City Comparisons": {"concepts": "belo horizonte, flint", "concept_list": ["belo horizonte", "flint"], "type": "cluster", "node_size": 21, "label": "City Comparisons"}, "Inclusive Food Access": {"concepts": "latino, dei, wic, ebt, snap, double up, dei training", "concept_list": ["latino", "dei", "wic", "ebt", "snap", "double up", "dei training"], "type": "cluster", "node_size": 36, "label": "Inclusive Food Access"}, "Meal Safety Practices": {"concepts": "takeout, covid-19, safety, positive culture, congregate meal", "concept_list": ["takeout", "covid-19", "safety", "positive culture", "congregate meal"], "type": "cluster", "node_size": 30, "label": "Meal Safety Practices"}, "Nutrition Support": {"concepts": "nutrition crisis, nutrition, supplemental nutrition", "concept_list": ["nutrition crisis", "nutrition", "supplemental nutrition"], "type": "cluster", "node_size": 24, "label": "Nutrition Support"}, "Nutrition Education": {"concepts": "nutrition education, nutrition programs, nutrition educators", "concept_list": ["nutrition education", "nutrition programs", "nutrition educators"], "type": "cluster", "node_size": 24, "label": "Nutrition Education"}, "Environmental Cycles": {"concepts": "water cycle, plant cycle, air cycle", "concept_list": ["water cycle", "plant cycle", "air cycle"], "type": "cluster", "node_size": 24, "label": "Environmental Cycles"}, "Environmental Impact": {"concepts": "water crisis, waste, pollution, land use", "concept_list": ["water crisis", "waste", "pollution", "land use"], "type": "cluster", "node_size": 27, "label": "Environmental Impact"}, "Sustainability Focus": {"concepts": "environmental sustainability, program sustainability, sustainability, environmental piece", "concept_list": ["environmental sustainability", "program sustainability", "sustainability", "environmental piece"], "type": "cluster", "node_size": 27, "label": "Sustainability Focus"}, "Justice Advocacy": {"concepts": "justice conversation, advocacy, justice, criminal justice, social justice", "concept_list": ["justice conversation", "advocacy", "justice", "criminal justice", "social justice"], "type": "cluster", "node_size": 30, "label": "Justice Advocacy"}, "Drug Inequities": {"concepts": "drug offenses, inequity", "concept_list": ["drug offenses", "inequity"], "type": "cluster", "node_size": 21, "label": "Drug Inequities"}, "Civic Behavior": {"concepts": "citizenship, social distancing", "concept_list": ["citizenship", "social distancing"], "type": "cluster", "node_size": 21, "label": "Civic Behavior"}, "Children's Health": {"concepts": "children's clinic, children", "concept_list": ["children's clinic", "children"], "type": "cluster", "node_size": 21, "label": "Children's Health"}, "Public Education": {"concepts": "public education, schools, education", "concept_list": ["public education", "schools", "education"], "type": "cluster", "node_size": 24, "label": "Public Education"}, "Research Sector": {"concepts": "research process, supplemental sector", "concept_list": ["research process", "supplemental sector"], "type": "cluster", "node_size": 21, "label": "Research Sector"}, "Funding Changes": {"concepts": "funding streams, funding change", "concept_list": ["funding streams", "funding change"], "type": "cluster", "node_size": 21, "label": "Funding Changes"}, "Policy Reform": {"concepts": "system change, policy change", "concept_list": ["system change", "policy change"], "type": "cluster", "node_size": 21, "label": "Policy Reform"}, "System Data Management": {"concepts": "data management, system understanding", "concept_list": ["data management", "system understanding"], "type": "cluster", "node_size": 21, "label": "System Data Management"}, "Self Awareness": {"concepts": "awareness, self awareness, awareness building", "concept_list": ["awareness", "self awareness", "awareness building"], "type": "cluster", "node_size": 24, "label": "Self Awareness"}, "State Governance": {"concepts": "state services, state policies", "concept_list": ["state services", "state policies"], "type": "cluster", "node_size": 21, "label": "State Governance"}, "Economic Gains": {"concepts": "economic advantage, output increase, payout increase", "concept_list": ["economic advantage", "output increase", "payout increase"], "type": "cluster", "node_size": 24, "label": "Economic Gains"}, "Sector Leverage": {"concepts": "sector evolution, leverage points", "concept_list": ["sector evolution", "leverage points"], "type": "cluster", "node_size": 21, "label": "Sector Leverage"}};
        const conceptData = {};
        const interClusterEdges = [["local entrepreneurs", "Organizational Dynamics", {"weight": 1.0, "confidence": 0.6875, "type": "inter_cluster", "style": "solid"}], ["local entrepreneurs", "Collaborative Networks", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["local entrepreneurs", "Drug Inequities", {"weight": 0.5, "confidence": 0.25, "type": "inter_cluster", "style": "solid"}], ["climate change", "Sustainability Focus", {"weight": 0.3333333333333333, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["climate change", "Inclusive Food Access", {"weight": -1.0, "confidence": 0.5, "type": "inter_cluster", "style": "solid"}], ["climate change", "Meal Safety Practices", {"weight": -0.25, "confidence": 0.125, "type": "inter_cluster", "style": "solid"}], ["education gap", "market integration", {"weight": -1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["market integration", "Community Support Systems", {"weight": 1.0, "confidence": 0.78, "type": "inter_cluster", "style": "solid"}], ["market integration", "Policy Reform", {"weight": 1.0, "confidence": 0.7100000000000001, "type": "inter_cluster", "style": "solid"}], ["market integration", "Self Awareness", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["market integration", "Organizational Dynamics", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Access and Equity", "Community Support Systems", {"weight": 1.0, "confidence": 0.6125, "type": "inter_cluster", "style": "solid"}], ["Access and Equity", "Food Systems", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Organizational Dynamics", "Community Support Systems", {"weight": 1.0, "confidence": 0.7833333333333333, "type": "inter_cluster", "style": "solid"}], ["Organizational Dynamics", "Justice Advocacy", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Organizational Dynamics", "Inclusive Food Access", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Community Support Systems", "Economic Gains", {"weight": 1.0, "confidence": 0.7625, "type": "inter_cluster", "style": "solid"}], ["Community Support Systems", "System Data Management", {"weight": 1.0, "confidence": 0.63, "type": "inter_cluster", "style": "solid"}], ["Community Support Systems", "Meal Safety Practices", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Migrant Labor", "Public Health Leadership", {"weight": 0.6, "confidence": 0.66, "type": "inter_cluster", "style": "solid"}], ["Migrant Labor", "Community Outreach", {"weight": 1.0, "confidence": 0.55, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Racial Communities", {"weight": 1.0, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Public Health Leadership", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Racial Communities", "Collaborative Networks", {"weight": -1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Collaborative Networks", "Drug Inequities", {"weight": -0.75, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Collaborative Networks", "Racial Communities", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Collaborative Networks", "climate change", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Collaborative Networks", "Funding Changes", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Community Outreach", "Policy Reform", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Document Management", "Policy Reform", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["City Comparisons", "System Data Management", {"weight": 1.0, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["City Comparisons", "Sustainability Focus", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Inclusive Food Access", "Collaborative Networks", {"weight": 1.0, "confidence": 0.7250000000000001, "type": "inter_cluster", "style": "solid"}], ["Inclusive Food Access", "System Data Management", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Inclusive Food Access", "Community Support Systems", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Meal Safety Practices", "Community Support Systems", {"weight": 0.3333333333333333, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Meal Safety Practices", "Nutrition Education", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Nutrition Education", "Sector Leverage", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Nutrition Education", "City Comparisons", {"weight": 1.0, "confidence": 0.5875, "type": "inter_cluster", "style": "solid"}], ["Nutrition Education", "Migrant Labor", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Nutrition Education", "System Data Management", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Environmental Impact", "local entrepreneurs", {"weight": -1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Sustainability Focus", "Food Systems", {"weight": 1.0, "confidence": 0.8166666666666668, "type": "inter_cluster", "style": "solid"}], ["Sustainability Focus", "Nutrition Support", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["Justice Advocacy", "Community Engagement", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Justice Advocacy", "Environmental Cycles", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Justice Advocacy", "Children's Health", {"weight": 1.0, "confidence": 0.5833333333333334, "type": "inter_cluster", "style": "solid"}], ["Drug Inequities", "Access and Equity", {"weight": -1.0, "confidence": 0.6999999999999998, "type": "inter_cluster", "style": "solid"}], ["Civic Behavior", "Socioeconomic Factors", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Civic Behavior", "City Comparisons", {"weight": 0.25, "confidence": 0.125, "type": "inter_cluster", "style": "solid"}], ["Children's Health", "Collaborative Networks", {"weight": 1.0, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Children's Health", "Public Education", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["Children's Health", "Local Retail Systems", {"weight": 0.8, "confidence": 0.45999999999999996, "type": "inter_cluster", "style": "solid"}], ["Public Education", "Nutrition Support", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Public Education", "Civic Behavior", {"weight": 1.0, "confidence": 0.6100000000000001, "type": "inter_cluster", "style": "solid"}], ["Public Education", "Organizational Dynamics", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Public Education", "Collaborative Networks", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Public Education", "Food Systems", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Research Sector", "Nutrition Education", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Funding Changes", "Policy Reform", {"weight": 1.0, "confidence": 0.86, "type": "inter_cluster", "style": "solid"}], ["Funding Changes", "Sustainability Focus", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Funding Changes", "Nutrition Support", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Funding Changes", "Community Outreach", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Funding Changes", "City Comparisons", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Policy Reform", "Public Education", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["System Data Management", "Socioeconomic Factors", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Self Awareness", "Policy Reform", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Access and Equity", {"weight": 1.0, "confidence": 0.7899999999999998, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Public Education", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Document Management", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Funding Changes", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Research Sector", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["State Governance", "market integration", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["State Governance", "Civic Behavior", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Economic Gains", "Justice Advocacy", {"weight": 1.0, "confidence": 0.575, "type": "inter_cluster", "style": "solid"}], ["Sector Leverage", "Sustainability Focus", {"weight": 1.0, "confidence": 0.725, "type": "inter_cluster", "style": "solid"}], ["Sector Leverage", "Environmental Impact", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Sector Leverage", "Socioeconomic Factors", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Sector Leverage", "Access and Equity", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Access and Equity": [], "Organizational Dynamics": [], "Local Retail Systems": [], "Community Support Systems": [], "Public Health Leadership": [], "Food Systems": [], "Socioeconomic Factors": [], "Migrant Labor": [], "Community Engagement": [], "Racial Communities": [], "Collaborative Networks": [], "Community Outreach": [], "Document Management": [], "City Comparisons": [], "Inclusive Food Access": [], "Meal Safety Practices": [], "Nutrition Support": [], "Nutrition Education": [], "Environmental Cycles": [], "Environmental Impact": [], "Sustainability Focus": [], "Justice Advocacy": [], "Drug Inequities": [], "Civic Behavior": [], "Children's Health": [], "Public Education": [], "Research Sector": [], "Funding Changes": [], "Policy Reform": [], "System Data Management": [], "Self Awareness": [], "State Governance": [], "Economic Gains": [], "Sector Leverage": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} ‚Üí ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
