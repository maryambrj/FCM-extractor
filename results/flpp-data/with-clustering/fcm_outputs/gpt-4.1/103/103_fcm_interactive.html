
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Restaurant Types": {"concepts": "affordability, inclement weather, food sector dine-in, customer request, food supply, connection strength, food excess, commercial aspect, food connection, food location, emergency sector, employment, food retail locations, food system sectors, flint food system, organizational collaboration, home deliveries, food sector availability, supplemental nutrition programs, food sector affordability, food sector bus route, food sector drive thru, food sector promotion, local food, food sector corporate, food sourcing, food sector family, individual needs, traffic, food sector, food sector access, stakeholders, food values, farmers market, food chain, community partners, food programs, food sector influence, mobile market, food, meat department, car ownership, food sector customer, flint, food sector impact, carpooling, food sector fast food, livable wage, childcare, food sector choice, fast food, food system, food sector map, local resources, food sector provision, bus access, collaborative spirit, food program usage, food sector support, state programs, food sector usage, food sector connections, food sector needs, federal support, food availability, food sector values, food sector carpooling, food sector community, small children, food sector request, food map, double up food bucks, program outreach, food sector location, ownership interest, corporate interest, supplemental sector, resident support, food sector accessibility, food quality, local food sources, food sector neighborhood, bus route, emergency food services, food sector transportation, reliable transportation, food assistance, transportation barriers, food sector services, food choice, food benefits, leverage points, food sector infrastructure, location gaps, food desire, residents, food sector sit down, food retail, national resources, food sector strength, emergency food, community interest, food sector excess, support programs, safety, neighborhood, food sector donations, food transaction, food options, food sector ownership, food needs, system dynamics, food sector partners, produce department, food sector desire, food sector individual, culturally specific food, food sector benefits, food affordability, food sector programs, food services, food sector use, household economy, public transportation, food sector distribution, food infrastructure, food promotion, food sector providers, food demand, transportation, food network, food system connections, food access, bridge card, food donations, covid-19 impact, food distribution, community support, family needs, neighborhood resources, public transit, food sector market, food sector network, availability, food partners, food market, resource gaps, food sector system, children's meals, food resources, food provision, food sector chain, food sector interest, stamp benefit, food sector options, food use, quality of life, food sector locations, food sector transaction, food sector connection, food service providers, drive thru, food accessibility, farmers markets, food sector resources, food deserts, food sector quality, resource allocation, food security, food support, michigan grown produce", "concept_list": ["affordability", "inclement weather", "food sector dine-in", "customer request", "food supply", "connection strength", "food excess", "commercial aspect", "food connection", "food location", "emergency sector", "employment", "food retail locations", "food system sectors", "flint food system", "organizational collaboration", "home deliveries", "food sector availability", "supplemental nutrition programs", "food sector affordability", "food sector bus route", "food sector drive thru", "food sector promotion", "local food", "food sector corporate", "food sourcing", "food sector family", "individual needs", "traffic", "food sector", "food sector access", "stakeholders", "food values", "farmers market", "food chain", "community partners", "food programs", "food sector influence", "mobile market", "food", "meat department", "car ownership", "food sector customer", "flint", "food sector impact", "carpooling", "food sector fast food", "livable wage", "childcare", "food sector choice", "fast food", "food system", "food sector map", "local resources", "food sector provision", "bus access", "collaborative spirit", "food program usage", "food sector support", "state programs", "food sector usage", "food sector connections", "food sector needs", "federal support", "food availability", "food sector values", "food sector carpooling", "food sector community", "small children", "food sector request", "food map", "double up food bucks", "program outreach", "food sector location", "ownership interest", "corporate interest", "supplemental sector", "resident support", "food sector accessibility", "food quality", "local food sources", "food sector neighborhood", "bus route", "emergency food services", "food sector transportation", "reliable transportation", "food assistance", "transportation barriers", "food sector services", "food choice", "food benefits", "leverage points", "food sector infrastructure", "location gaps", "food desire", "residents", "food sector sit down", "food retail", "national resources", "food sector strength", "emergency food", "community interest", "food sector excess", "support programs", "safety", "neighborhood", "food sector donations", "food transaction", "food options", "food sector ownership", "food needs", "system dynamics", "food sector partners", "produce department", "food sector desire", "food sector individual", "culturally specific food", "food sector benefits", "food affordability", "food sector programs", "food services", "food sector use", "household economy", "public transportation", "food sector distribution", "food infrastructure", "food promotion", "food sector providers", "food demand", "transportation", "food network", "food system connections", "food access", "bridge card", "food donations", "covid-19 impact", "food distribution", "community support", "family needs", "neighborhood resources", "public transit", "food sector market", "food sector network", "availability", "food partners", "food market", "resource gaps", "food sector system", "children's meals", "food resources", "food provision", "food sector chain", "food sector interest", "stamp benefit", "food sector options", "food use", "quality of life", "food sector locations", "food sector transaction", "food sector connection", "food service providers", "drive thru", "food accessibility", "farmers markets", "food sector resources", "food deserts", "food sector quality", "resource allocation", "food security", "food support", "michigan grown produce"], "type": "cluster", "node_size": 528, "label": "Restaurant Types"}, "Grocery & Retail Access": {"concepts": "sit down restaurant, local restaurants, chain restaurant, local restaurant, dine-in restaurant, chain restaurants", "concept_list": ["sit down restaurant", "local restaurants", "chain restaurant", "local restaurant", "dine-in restaurant", "chain restaurants"], "type": "cluster", "node_size": 33, "label": "Grocery & Retail Access"}, "Food Access & Support": {"concepts": "grocery access, convenience store, grocery store, retail use, retail types, grocery stores, convenience stores", "concept_list": ["grocery access", "convenience store", "grocery store", "retail use", "retail types", "grocery stores", "convenience stores"], "type": "cluster", "node_size": 36, "label": "Food Access & Support"}};
        const conceptData = {};
        const interClusterEdges = [["Restaurant Types", "Food Access & Support", {"weight": 1.0, "confidence": 0.8875, "type": "inter_cluster", "style": "solid"}], ["Restaurant Types", "Grocery & Retail Access", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Grocery & Retail Access", "Restaurant Types", {"weight": 0.8, "confidence": 0.5700000000000001, "type": "inter_cluster", "style": "solid"}], ["Food Access & Support", "Restaurant Types", {"weight": 0.75, "confidence": 0.6625, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Restaurant Types": [], "Grocery & Retail Access": [], "Food Access & Support": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
