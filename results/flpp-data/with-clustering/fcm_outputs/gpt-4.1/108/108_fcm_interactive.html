
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"Community Empowerment": {"concepts": "presence, life, black children, faith, fast casual, brown children, power brokers, compassion, collective good, organizations, grassroots investment, perspective, connection strength, cooperative economics, team, exposure, job creation, human being, state level, diabetes prevalence, creator, prayer list, provision, impact, self determination, connections, black community, blessing, encouragement, kujichagulia, frustration, cultural values, intercessor, warrior, well resourced organization, strength, godliness, transportation issues, food co-op, african american community, health outcomes, change, hypertension, water ponds, community organizing, resource allocation, quality of life, response, spirit, availability, employment creation, community, lead exposure, power, theater, economic development, benefits, socio economic status, business principles, project, holy spirit, organizational response, ujamaa, cooperative ownership, city of flint, inequalities, rationale, community voice, neighborhood disparities, anger, drive, lifelong learning, grassroots mobilization, water crisis, jesus, community empowerment, employment skills, access, solutions, opportunity, belief, job skills, holistic understanding, education, minister, feedback loops, wounded warrior, recommendations, culture, gospel, love, scientific experts, power dynamics, socio-economic status, local level, micro business development, public health, works, prayer, lived experience, sectors, children, poverty, matthew 25, grassroots", "concept_list": ["presence", "life", "black children", "faith", "fast casual", "brown children", "power brokers", "compassion", "collective good", "organizations", "grassroots investment", "perspective", "connection strength", "cooperative economics", "team", "exposure", "job creation", "human being", "state level", "diabetes prevalence", "creator", "prayer list", "provision", "impact", "self determination", "connections", "black community", "blessing", "encouragement", "kujichagulia", "frustration", "cultural values", "intercessor", "warrior", "well resourced organization", "strength", "godliness", "transportation issues", "food co-op", "african american community", "health outcomes", "change", "hypertension", "water ponds", "community organizing", "resource allocation", "quality of life", "response", "spirit", "availability", "employment creation", "community", "lead exposure", "power", "theater", "economic development", "benefits", "socio economic status", "business principles", "project", "holy spirit", "organizational response", "ujamaa", "cooperative ownership", "city of flint", "inequalities", "rationale", "community voice", "neighborhood disparities", "anger", "drive", "lifelong learning", "grassroots mobilization", "water crisis", "jesus", "community empowerment", "employment skills", "access", "solutions", "opportunity", "belief", "job skills", "holistic understanding", "education", "minister", "feedback loops", "wounded warrior", "recommendations", "culture", "gospel", "love", "scientific experts", "power dynamics", "socio-economic status", "local level", "micro business development", "public health", "works", "prayer", "lived experience", "sectors", "children", "poverty", "matthew 25", "grassroots"], "type": "cluster", "node_size": 330, "label": "Community Empowerment"}, "Food Access": {"concepts": "food giveaways, healthy foods, farmers markets, food market cooperative, double up food bucks, access to food, supplemental nutrition programs, food system, food cooperative, food security, food access, nutrition programs, food deserts, food systems, nutritious food, food inequality, child nutrition, fast food, healthy food access, healthy food, food apartheid, food system values, exercise habits, nutritional access", "concept_list": ["food giveaways", "healthy foods", "farmers markets", "food market cooperative", "double up food bucks", "access to food", "supplemental nutrition programs", "food system", "food cooperative", "food security", "food access", "nutrition programs", "food deserts", "food systems", "nutritious food", "food inequality", "child nutrition", "fast food", "healthy food access", "healthy food", "food apartheid", "food system values", "exercise habits", "nutritional access"], "type": "cluster", "node_size": 87, "label": "Food Access"}, "Retail Landscape": {"concepts": "grocery stores, chain restaurants, retail closures, retail types, convenience stores, local restaurants, retail use, grocery store impact", "concept_list": ["grocery stores", "chain restaurants", "retail closures", "retail types", "convenience stores", "local restaurants", "retail use", "grocery store impact"], "type": "cluster", "node_size": 39, "label": "Retail Landscape"}, "Funding & Investment": {"concepts": "funding, underfunding, financing, targeted investment, investment, investors, funding allocation, dividend allocation", "concept_list": ["funding", "underfunding", "financing", "targeted investment", "investment", "investors", "funding allocation", "dividend allocation"], "type": "cluster", "node_size": 39, "label": "Funding & Investment"}};
        const conceptData = {};
        const interClusterEdges = [["Community Empowerment", "Food Access", {"weight": 0.8, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Community Empowerment", "Retail Landscape", {"weight": 0.2, "confidence": 0.16, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Community Empowerment", {"weight": 0.8, "confidence": 0.6599999999999999, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Retail Landscape", {"weight": 0.8, "confidence": 0.64, "type": "inter_cluster", "style": "solid"}], ["Food Access", "Funding & Investment", {"weight": 0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Retail Landscape", "Community Empowerment", {"weight": 0.6, "confidence": 0.45, "type": "inter_cluster", "style": "solid"}], ["Retail Landscape", "Food Access", {"weight": 0.4, "confidence": 0.29, "type": "inter_cluster", "style": "solid"}], ["Retail Landscape", "Funding & Investment", {"weight": 0.4, "confidence": 0.24, "type": "inter_cluster", "style": "solid"}], ["Funding & Investment", "Retail Landscape", {"weight": 0.8, "confidence": 0.69, "type": "inter_cluster", "style": "solid"}], ["Funding & Investment", "Food Access", {"weight": 0.8, "confidence": 0.67, "type": "inter_cluster", "style": "solid"}], ["Funding & Investment", "Community Empowerment", {"weight": 0.6, "confidence": 0.47000000000000003, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Community Empowerment": [], "Food Access": [], "Retail Landscape": [], "Funding & Investment": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
