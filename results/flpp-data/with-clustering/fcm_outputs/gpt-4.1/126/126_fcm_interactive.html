
<!DOCTYPE html>
<html>
<head>
    <title>Hierarchical FCM Visualization (Unconnected nodes removed)</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        
        #network { 
            width: 100%; 
            height: 600px; 
            border: 2px solid #ccc; 
            background: white;
            border-radius: 8px;
        }
        
        #controls {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary { background: #4A90E2; color: white; }
        .btn-primary:hover { background: #357ABD; }
        
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        
        #current-view {
            font-weight: bold;
            color: #333;
            margin-left: 10px;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 12px;
            max-width: 200px;
        }
        
        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            width: 20px;
            height: 2px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Fuzzy Cognitive Map - Hierarchical View</h1>
    
    <div id="controls">
        <button class="btn btn-secondary" id="back-btn" onclick="showClusterView()" style="display: none;">
            ← Back to Clusters
        </button>
        <span id="current-view">Cluster Overview</span>
        <div style="float: right;">
            <label>Min Confidence: </label>
            <input type="range" id="confidence-slider" min="0" max="1" step="0.1" value="0.3" 
                   onchange="updateConfidenceFilter(this.value)">
            <span id="confidence-value">0.3</span>
        </div>
    </div>
    
    <div id="network"></div>
    
    <div id="legend">
        <h4>Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #4A90E2;"></div>
            <span>Clusters</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #FF9500;"></div>
            <span>Concepts</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #28A745;"></div>
            <span>Positive relationship</span>
        </div>
        <div class="legend-item">
            <div class="legend-line" style="background: #DC3545;"></div>
            <span>Negative relationship</span>
        </div>
        <div style="margin-top: 10px; font-style: italic; color: #666;">
            Click clusters to explore internal concepts
        </div>
    </div>

    <script>
        // Embedded data
        const clusterData = {"leverage points": {"concepts": "leverage points", "concept_list": ["leverage points"], "type": "cluster", "node_size": 18, "label": "leverage points"}, "barriers": {"concepts": "barriers", "concept_list": ["barriers"], "type": "cluster", "node_size": 18, "label": "barriers"}, "vulnerable populations": {"concepts": "vulnerable populations", "concept_list": ["vulnerable populations"], "type": "cluster", "node_size": 18, "label": "vulnerable populations"}, "Economic Sectors": {"concepts": "system map, educational campaigns, mapping methods, system outcomes, school supplies, school meals, funding allocation, education, leadership, school lunch program, quality of life, resource allocation, system leverage, resource maximization, water crisis, outcomes, major conveners, program operation, program funding, quality leadership, impact, educational context, research project, resource provision, population subgroups, resource distribution, local economic development, system relationships, hours of operation, after school program, urban agriculture, school lunch, pandemic, stakeholder engagement, coping strategies, research, cost savings, crisis impacts, program usage", "concept_list": ["system map", "educational campaigns", "mapping methods", "system outcomes", "school supplies", "school meals", "funding allocation", "education", "leadership", "school lunch program", "quality of life", "resource allocation", "system leverage", "resource maximization", "water crisis", "outcomes", "major conveners", "program operation", "program funding", "quality leadership", "impact", "educational context", "research project", "resource provision", "population subgroups", "resource distribution", "local economic development", "system relationships", "hours of operation", "after school program", "urban agriculture", "school lunch", "pandemic", "stakeholder engagement", "coping strategies", "research", "cost savings", "crisis impacts", "program usage"], "type": "cluster", "node_size": 132, "label": "Economic Sectors"}, "Food Retail": {"concepts": "resident income, supplemental sector, local economy, income eligibility, sector functioning, sector connections, housing sector, sectors, family purchasing, family households, working poor", "concept_list": ["resident income", "supplemental sector", "local economy", "income eligibility", "sector functioning", "sector connections", "housing sector", "sectors", "family purchasing", "family households", "working poor"], "type": "cluster", "node_size": 48, "label": "Food Retail"}, "Organizational Partnerships": {"concepts": "grocery stores, mom and pop shops, convenience stores, restaurants, locally based grocery, chain restaurants, retail habits, retail chain, neighborhood-based grocery, neighborhood grocery store, local restaurants, neighborhood convenience store, supply chain disruptions, retail location, neighborhood access, online groceries, grocery store, retail stores, consumption practices, retail sector, retail, supply chain", "concept_list": ["grocery stores", "mom and pop shops", "convenience stores", "restaurants", "locally based grocery", "chain restaurants", "retail habits", "retail chain", "neighborhood-based grocery", "neighborhood grocery store", "local restaurants", "neighborhood convenience store", "supply chain disruptions", "retail location", "neighborhood access", "online groceries", "grocery store", "retail stores", "consumption practices", "retail sector", "retail", "supply chain"], "type": "cluster", "node_size": 81, "label": "Organizational Partnerships"}, "Food Systems": {"concepts": "organizational partnerships, partnerships, organizational relationships, organizational connections, organizational context, stakeholder relationships, organizational performance, organizational support, organizational dependency", "concept_list": ["organizational partnerships", "partnerships", "organizational relationships", "organizational connections", "organizational context", "stakeholder relationships", "organizational performance", "organizational support", "organizational dependency"], "type": "cluster", "node_size": 42, "label": "Food Systems"}, "Education Systems": {"concepts": "food policy, nutritious foods, food prices, food skills, food marketing, food sector, nutritious food, locally grown food, food system values, food choice, locally sourced food, food security, food environment, nutrition education, food equity, food transportation, dairy availability, food access, farmers market, food choices, food options, food accessibility, food quality, food businesses, emergency food sector, nutrition support programs, entrepreneurs, food programs, local food system, food availability, food preferences, food system resilience, cooking, oakland food system, food supply, discounted food, food distribution, local food supply, food requirements, food system, food banks, nutrition, double up food bucks, healthier diet, food sourcing, food habits, food insecurity, food resources, food utilization, food retail, supplemental nutrition programs, emergency food system, culturally appropriate foods, vitamins, food assistance, food entrepreneurs, food hub, food sector relationships, healthy food, agriculture, food campaigns", "concept_list": ["food policy", "nutritious foods", "food prices", "food skills", "food marketing", "food sector", "nutritious food", "locally grown food", "food system values", "food choice", "locally sourced food", "food security", "food environment", "nutrition education", "food equity", "food transportation", "dairy availability", "food access", "farmers market", "food choices", "food options", "food accessibility", "food quality", "food businesses", "emergency food sector", "nutrition support programs", "entrepreneurs", "food programs", "local food system", "food availability", "food preferences", "food system resilience", "cooking", "oakland food system", "food supply", "discounted food", "food distribution", "local food supply", "food requirements", "food system", "food banks", "nutrition", "double up food bucks", "healthier diet", "food sourcing", "food habits", "food insecurity", "food resources", "food utilization", "food retail", "supplemental nutrition programs", "emergency food system", "culturally appropriate foods", "vitamins", "food assistance", "food entrepreneurs", "food hub", "food sector relationships", "healthy food", "agriculture", "food campaigns"], "type": "cluster", "node_size": 198, "label": "Education Systems"}, "Marketing Strategies": {"concepts": "program marketing, marketing strategies, marketing", "concept_list": ["program marketing", "marketing strategies", "marketing"], "type": "cluster", "node_size": 24, "label": "Marketing Strategies"}, "Market Size": {"concepts": "small markets, markets", "concept_list": ["small markets", "markets"], "type": "cluster", "node_size": 21, "label": "Market Size"}, "Pricing Models": {"concepts": "pricing, financial model", "concept_list": ["pricing", "financial model"], "type": "cluster", "node_size": 21, "label": "Pricing Models"}, "Program Access": {"concepts": "program expansion, availability, federal programs", "concept_list": ["program expansion", "availability", "federal programs"], "type": "cluster", "node_size": 24, "label": "Program Access"}, "Outreach Efforts": {"concepts": "outreach materials, program awareness, program outreach, outreach", "concept_list": ["outreach materials", "program awareness", "program outreach", "outreach"], "type": "cluster", "node_size": 27, "label": "Outreach Efforts"}, "Local Food Sources": {"concepts": "locally grown, gardening, homegrown approaches, community garden, produce, csa boxes", "concept_list": ["locally grown", "gardening", "homegrown approaches", "community garden", "produce", "csa boxes"], "type": "cluster", "node_size": 33, "label": "Local Food Sources"}, "Food Access Programs": {"concepts": "snap, supplemental programs, wic, contactless app, drive thru programs, curbside pickup", "concept_list": ["snap", "supplemental programs", "wic", "contactless app", "drive thru programs", "curbside pickup"], "type": "cluster", "node_size": 33, "label": "Food Access Programs"}, "Community Engagement": {"concepts": "trust, family, community understanding, new users, community needs, community voice, community impact, relationships, connections, community engagement, collaboration, individuals, community providers, population, children, community values, community, residents, community outcomes, community empowerment", "concept_list": ["trust", "family", "community understanding", "new users", "community needs", "community voice", "community impact", "relationships", "connections", "community engagement", "collaboration", "individuals", "community providers", "population", "children", "community values", "community", "residents", "community outcomes", "community empowerment"], "type": "cluster", "node_size": 75, "label": "Community Engagement"}, "Diverse Populations": {"concepts": "deaf community, hamady family, adults, providers, flint, ann arbor, communication, non-english speakers, co-op model, logistical knowledge, united way, adaptation, career development, knowledge base", "concept_list": ["deaf community", "hamady family", "adults", "providers", "flint", "ann arbor", "communication", "non-english speakers", "co-op model", "logistical knowledge", "united way", "adaptation", "career development", "knowledge base"], "type": "cluster", "node_size": 57, "label": "Diverse Populations"}, "Information Flow": {"concepts": "demand, information, triaging, problem solving, trends, information dissemination, process, covid-19, covid, creativity, values", "concept_list": ["demand", "information", "triaging", "problem solving", "trends", "information dissemination", "process", "covid-19", "covid", "creativity", "values"], "type": "cluster", "node_size": 48, "label": "Information Flow"}, "Urban Locations": {"concepts": "location, neighborhoods, comparable cities", "concept_list": ["location", "neighborhoods", "comparable cities"], "type": "cluster", "node_size": 24, "label": "Urban Locations"}, "Transit Infrastructure": {"concepts": "transportation, infrastructure, public transportation", "concept_list": ["transportation", "infrastructure", "public transportation"], "type": "cluster", "node_size": 24, "label": "Transit Infrastructure"}, "Cultural Factors": {"concepts": "cultural knowledge, cultural values, cultural influences", "concept_list": ["cultural knowledge", "cultural values", "cultural influences"], "type": "cluster", "node_size": 24, "label": "Cultural Factors"}, "Social Networks": {"concepts": "social context, social support, social inclusion, social networks", "concept_list": ["social context", "social support", "social inclusion", "social networks"], "type": "cluster", "node_size": 27, "label": "Social Networks"}, "Accessibility": {"concepts": "access, remote access, language access, language accessibility, accessibility, access points", "concept_list": ["access", "remote access", "language access", "language accessibility", "accessibility", "access points"], "type": "cluster", "node_size": 33, "label": "Accessibility"}, "Program Affordability": {"concepts": "affordability, program affordability", "concept_list": ["affordability", "program affordability"], "type": "cluster", "node_size": 21, "label": "Program Affordability"}, "System Dynamics": {"concepts": "system mapping, system dynamics model, spatial dynamics, system dynamics", "concept_list": ["system mapping", "system dynamics model", "spatial dynamics", "system dynamics"], "type": "cluster", "node_size": 27, "label": "System Dynamics"}, "System Improvement": {"concepts": "system improvement, system resilience, system change, system functioning", "concept_list": ["system improvement", "system resilience", "system change", "system functioning"], "type": "cluster", "node_size": 27, "label": "System Improvement"}, "System Environment": {"concepts": "system environment, water distribution", "concept_list": ["system environment", "water distribution"], "type": "cluster", "node_size": 21, "label": "System Environment"}, "Health Equity": {"concepts": "health literacy, health communication, health disparities, health, population health, public health, health centers", "concept_list": ["health literacy", "health communication", "health disparities", "health", "population health", "public health", "health centers"], "type": "cluster", "node_size": 36, "label": "Health Equity"}, "Emergency Response": {"concepts": "lead exposure, crisis response, emergency sector", "concept_list": ["lead exposure", "crisis response", "emergency sector"], "type": "cluster", "node_size": 24, "label": "Emergency Response"}};
        const conceptData = {};
        const interClusterEdges = [["leverage points", "Food Systems", {"weight": 1.0, "confidence": 0.76, "type": "inter_cluster", "style": "solid"}], ["leverage points", "Outreach Efforts", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["barriers", "Community Engagement", {"weight": -1.0, "confidence": 0.875, "type": "inter_cluster", "style": "solid"}], ["barriers", "Market Size", {"weight": -1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["vulnerable populations", "Information Flow", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "Education Systems", {"weight": 1.0, "confidence": 0.8125000000000001, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "Transit Infrastructure", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Economic Sectors", "vulnerable populations", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Food Retail", "System Dynamics", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Organizational Partnerships", "Pricing Models", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Organizational Partnerships", "Local Food Sources", {"weight": 0.6666666666666666, "confidence": 0.48333333333333334, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "System Improvement", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Food Systems", "Urban Locations", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Education Systems", "Marketing Strategies", {"weight": 1.0, "confidence": 0.775, "type": "inter_cluster", "style": "solid"}], ["Marketing Strategies", "Food Retail", {"weight": 1.0, "confidence": 0.6699999999999999, "type": "inter_cluster", "style": "solid"}], ["Marketing Strategies", "Health Equity", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Market Size", "Information Flow", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Market Size", "Local Food Sources", {"weight": 1.0, "confidence": 0.8, "type": "inter_cluster", "style": "solid"}], ["Market Size", "vulnerable populations", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Market Size", "Organizational Partnerships", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Pricing Models", "Education Systems", {"weight": 1.0, "confidence": 0.8300000000000001, "type": "inter_cluster", "style": "solid"}], ["Pricing Models", "Organizational Partnerships", {"weight": 1.0, "confidence": 0.8250000000000001, "type": "inter_cluster", "style": "solid"}], ["Pricing Models", "vulnerable populations", {"weight": -0.3333333333333333, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Program Access", "Emergency Response", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Outreach Efforts", "Marketing Strategies", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Outreach Efforts", "Cultural Factors", {"weight": 1.0, "confidence": 0.65, "type": "inter_cluster", "style": "solid"}], ["Local Food Sources", "Program Affordability", {"weight": 1.0, "confidence": 0.7166666666666667, "type": "inter_cluster", "style": "solid"}], ["Local Food Sources", "System Improvement", {"weight": 1.0, "confidence": 0.75, "type": "inter_cluster", "style": "solid"}], ["Food Access Programs", "Program Affordability", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Outreach Efforts", {"weight": 1.0, "confidence": 0.7833333333333332, "type": "inter_cluster", "style": "solid"}], ["Community Engagement", "Marketing Strategies", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Diverse Populations", "Outreach Efforts", {"weight": 1.0, "confidence": 0.7666666666666666, "type": "inter_cluster", "style": "solid"}], ["Diverse Populations", "Cultural Factors", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Diverse Populations", "Program Access", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Information Flow", "vulnerable populations", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Urban Locations", "Accessibility", {"weight": 1.0, "confidence": 0.9, "type": "inter_cluster", "style": "solid"}], ["Urban Locations", "Education Systems", {"weight": 1.0, "confidence": 0.85, "type": "inter_cluster", "style": "solid"}], ["Urban Locations", "System Environment", {"weight": 1.0, "confidence": 0.6499999999999999, "type": "inter_cluster", "style": "solid"}], ["Transit Infrastructure", "Emergency Response", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Transit Infrastructure", "Local Food Sources", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Transit Infrastructure", "Economic Sectors", {"weight": 0.5, "confidence": 0.3, "type": "inter_cluster", "style": "solid"}], ["Cultural Factors", "Information Flow", {"weight": 1.0, "confidence": 0.7166666666666668, "type": "inter_cluster", "style": "solid"}], ["Cultural Factors", "Diverse Populations", {"weight": 1.0, "confidence": 0.625, "type": "inter_cluster", "style": "solid"}], ["Accessibility", "Food Systems", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Accessibility", "leverage points", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Accessibility", "Market Size", {"weight": 1.0, "confidence": 0.7, "type": "inter_cluster", "style": "solid"}], ["Program Affordability", "Accessibility", {"weight": 1.0, "confidence": 0.8666666666666667, "type": "inter_cluster", "style": "solid"}], ["System Dynamics", "Education Systems", {"weight": 1.0, "confidence": 0.7333333333333334, "type": "inter_cluster", "style": "solid"}], ["System Improvement", "Marketing Strategies", {"weight": 1.0, "confidence": 0.6166666666666667, "type": "inter_cluster", "style": "solid"}], ["System Environment", "Social Networks", {"weight": 0.6666666666666666, "confidence": 0.4166666666666667, "type": "inter_cluster", "style": "solid"}], ["System Environment", "System Dynamics", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Health Equity", "Marketing Strategies", {"weight": 1.0, "confidence": 0.675, "type": "inter_cluster", "style": "solid"}], ["Health Equity", "Food Retail", {"weight": 1.0, "confidence": 0.6, "type": "inter_cluster", "style": "solid"}], ["Emergency Response", "Marketing Strategies", {"weight": 1.0, "confidence": 0.7125, "type": "inter_cluster", "style": "solid"}]];
        const clusterConcepts = {};
        const clusterEdges = {"Economic Sectors": [], "Food Retail": [], "Organizational Partnerships": [], "Food Systems": [], "Education Systems": [], "Marketing Strategies": [], "Market Size": [], "Pricing Models": [], "Program Access": [], "Outreach Efforts": [], "Local Food Sources": [], "Food Access Programs": [], "Community Engagement": [], "Diverse Populations": [], "Information Flow": [], "Urban Locations": [], "Transit Infrastructure": [], "Cultural Factors": [], "Social Networks": [], "Accessibility": [], "Program Affordability": [], "System Dynamics": [], "System Improvement": [], "System Environment": [], "Health Equity": [], "Emergency Response": []};
        
        let network;
        let currentView = 'clusters';
        let currentCluster = null;
        let minConfidence = 0.3;
        
        // Network options
        const options = {
            nodes: {
                font: { color: 'white', size: 14 },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                arrows: { to: { enabled: true, scaleFactor: 1.2 } },
                shadow: true,
                smooth: { type: 'continuous' }
            },
            physics: {
                stabilization: { iterations: 100 },
                barnesHut: {
                    gravitationalConstant: -8000,
                    springConstant: 0.001,
                    springLength: 200
                }
            },
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };
        
        function initNetwork() {
            const container = document.getElementById('network');
            const data = getClusterViewData();
            network = new vis.Network(container, data, options);
            
            // Handle cluster clicks for drill-down
            network.on("click", function(params) {
                if (params.nodes.length > 0 && currentView === 'clusters') {
                    const clickedNode = params.nodes[0];
                    if (clusterConcepts[clickedNode]) {
                        showClusterDetail(clickedNode);
                    }
                }
            });
        }
        
        function getClusterViewData() {
            const nodes = [];
            const edges = [];
            
            // Add cluster nodes
            Object.entries(clusterData).forEach(([clusterId, data]) => {
                const concepts = data.concepts || [];
                const conceptsStr = Array.isArray(concepts) ? concepts.join(', ') : concepts;
                
                nodes.push({
                    id: clusterId,
                    label: clusterId,
                    title: `Cluster: ${clusterId}\nConcepts: ${conceptsStr}\nClick to explore internal relationships`,
                    color: '#4A90E2',
                    size: 25 + (conceptsStr.split(',').length * 2),
                    font: { color: 'white' }
                });
            });
            
            // Add inter-cluster edges
            interClusterEdges.forEach(([source, target, edgeData]) => {
                const confidence = edgeData.confidence || 1.0;
                const weight = edgeData.weight || 0;
                
                if (confidence >= minConfidence) {
                    edges.push({
                        from: source,
                        to: target,
                        color: weight > 0 ? '#28A745' : '#DC3545',
                        width: Math.abs(weight) * 3 + 1,
                        title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                        dashes: false
                    });
                }
            });
            
            return { nodes: nodes, edges: edges };
        }
        
        function getClusterDetailData(clusterId) {
            const nodes = [];
            const edges = [];
            
            // Add concept nodes for this cluster
            if (clusterConcepts[clusterId]) {
                clusterConcepts[clusterId].forEach(([conceptId, data]) => {
                    nodes.push({
                        id: conceptId,
                        label: conceptId,
                        title: `Concept: ${conceptId}\nFrom cluster: ${clusterId}`,
                        color: '#FF9500',
                        size: 20,
                        font: { color: 'white' }
                    });
                });
            }
            
            // Add intra-cluster edges
            if (clusterEdges[clusterId]) {
                clusterEdges[clusterId].forEach(([source, target, edgeData]) => {
                    const confidence = edgeData.confidence || 1.0;
                    const weight = edgeData.weight || 0;
                    
                    if (confidence >= minConfidence) {
                        edges.push({
                            from: source,
                            to: target,
                            color: weight > 0 ? '#28A745' : '#DC3545',
                            width: Math.abs(weight) * 3 + 1,
                            title: `${source} → ${target}\nWeight: ${weight}\nConfidence: ${confidence.toFixed(2)}`,
                            dashes: true
                        });
                    }
                });
            }
            
            return { nodes: nodes, edges: edges };
        }
        
        function showClusterView() {
            currentView = 'clusters';
            currentCluster = null;
            const data = getClusterViewData();
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('current-view').textContent = 'Cluster Overview';
        }
        
        function showClusterDetail(clusterId) {
            currentView = 'concepts';
            currentCluster = clusterId;
            const data = getClusterDetailData(clusterId);
            network.setData(data);
            
            document.getElementById('back-btn').style.display = 'inline-block';
            document.getElementById('current-view').textContent = `Inside Cluster: ${clusterId}`;
        }
        
        function updateConfidenceFilter(value) {
            minConfidence = parseFloat(value);
            document.getElementById('confidence-value').textContent = value;
            
            // Refresh current view
            if (currentView === 'clusters') {
                showClusterView();
            } else {
                showClusterDetail(currentCluster);
            }
        }
        
        // Initialize the network when page loads
        window.onload = function() {
            initNetwork();
        };
    </script>
</body>
</html>
